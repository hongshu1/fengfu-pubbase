var jbolt_autocomplete_js_version="1.3.0";(function(a){a.fn.extend({autocomplete:function(b,c){var d=typeof b=="string";c=a.extend({},a.Autocompleter.defaults,{url:d?b:null,data:d?null:b,delay:d?a.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150,noRecord:"No Records."},c);c.highlight=c.highlight||function(e){return e};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.Autocompleter(this,c)})},result:function(b){return this.bind("result",b)},search:function(b){return this.trigger("search",[b])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(b){return this.trigger("setOptions",[b])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(n,g){var c={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var j=null;if(g.failure!=null&&typeof g.failure=="function"){j=g.failure}var b=a(n).attr("autocomplete","off").addClass(g.inputClass);var l;var s="";var o=a.Autocompleter.Cache(g);var e=0;var w;var z={mouseDownOnSelect:false};var t=a.Autocompleter.Select(g,n,d,z);var y;navigator.userAgent.indexOf("Opera")!=-1&&a(n.form).bind("submit.autocomplete",function(){if(y){y=false;return false}});var h=(navigator.userAgent.indexOf("Opera")!=-1&&!"KeyboardEvent" in window?"keypress":"keydown")+".autocomplete";b.bind(h,function(A){e=1;w=A.keyCode;switch(A.keyCode){case c.UP:if(t.visible()){A.preventDefault();t.prev()}else{v(0,true)}break;case c.DOWN:if(t.visible()){A.preventDefault();t.next()}else{v(0,true)}break;case c.PAGEUP:if(t.visible()){A.preventDefault();t.pageUp()}else{v(0,true)}break;case c.PAGEDOWN:if(t.visible()){A.preventDefault();t.pageDown()}else{v(0,true)}break;case g.multiple&&a.trim(g.multipleSeparator)==","&&c.COMMA:case c.TAB:case c.RETURN:if(d()){A.preventDefault();y=true;return false}break;case c.ESC:t.hide();break;default:clearTimeout(l);l=setTimeout(v,g.delay);break}}).focus(function(){e++}).blur(function(){e=0;if(!z.mouseDownOnSelect){u()}}).click(function(){if(g.clickFire){if(!t.visible()){v(0,true)}}else{if(e++>1&&!t.visible()){v(0,true)}}}).bind("search",function(){var A=(arguments.length>1)?arguments[1]:null;function B(F,E){var C;if(E&&E.length){for(var D=0;D<E.length;D++){if(E[D].result.toLowerCase()==F.toLowerCase()){C=E[D];break}}}if(typeof A=="function"){A(C)}else{b.trigger("result",C&&[C.data,C.value])}}a.each(i(b.val()),function(C,D){f(D,B,B)})}).bind("flushCache",function(){o.flush()}).bind("setOptions",function(){a.extend(true,g,arguments[1]);if("data" in arguments[1]){o.populate()}}).bind("unautocomplete",function(){t.unbind();b.unbind();a(n.form).unbind(".autocomplete")});function d(){var D=t.selected();if(!D){return false}var A=D.result;s=A;if(g.multiple){var G=i(b.val());if(G.length>1){var C=g.multipleSeparator.length;var F=a(n).selection().start;var E,B=0;a.each(G,function(H,I){B+=I.length;if(F<=B){E=H;return false}B+=C});G[E]=A;A=G.join(g.multipleSeparator)}A+=g.multipleSeparator}b.val(A);x();b.trigger("result",[D.data,D.value]);return true}function v(C,B){if(w==c.DEL){t.hide();return}var A=b.val();if(!B&&A==s){return}s=A;A=k(A);if(A.length>=g.minChars){b.addClass(g.loadingClass);if(!g.matchCase){A=A.toLowerCase()}f(A,m,x)}else{p();t.hide()}}function i(A){if(!A){return[""]}if(!g.multiple){return[a.trim(A)]}return a.map(A.split(g.multipleSeparator),function(B){return a.trim(A).length?a.trim(B):null})}function k(A){if(!g.multiple){return A}var C=i(A);if(C.length==1){return C[0]}var B=a(n).selection().start;if(B==A.length){C=i(A)}else{C=i(A.replace(A.substring(B),""))}return C[C.length-1]}function r(A,B){if(g.autoFill&&(k(b.val()).toLowerCase()==A.toLowerCase())&&w!=c.BACKSPACE){b.val(b.val()+B.substring(k(s).length));a(n).selection(s.length,s.length+B.length)}}function u(){clearTimeout(l);l=setTimeout(x,200)}function x(){var A=t.visible();t.hide();clearTimeout(l);p();if(g.mustMatch){b.search(function(B){if(!B){if(g.multiple){var C=i(b.val()).slice(0,-1);b.val(C.join(g.multipleSeparator)+(C.length?g.multipleSeparator:""))}else{b.val("");b.trigger("result",null)}}})}}function m(B,A){if(A&&A.length&&e){p();t.display(A,B);r(B,A[0].value);t.show()}else{x()}}function f(C,E,B){if(!g.matchCase){C=C.toLowerCase()}var D=o.load(C);if(D){if(D.length){E(C,D)}else{var A=g.parse&&g.parse(g.noRecord)||q(g.noRecord);E(C,A)}}else{if((typeof g.url=="string")&&(g.url.length>0)){var F={timestamp:+new Date()};a.each(g.extraParams,function(G,H){F[G]=typeof H=="function"?H():H});a.ajax({mode:"abort",port:"autocomplete"+n.name,dataType:g.dataType,url:g.url,data:a.extend({q:k(C),limit:g.max},F),success:function(H){var G=g.parse&&g.parse(H)||q(H);o.add(C,G);E(C,G);if(H.state=="fail"){LayerMsgBox.alert(H.msg?H.msg:"数据获取异常",2)}}})}else{t.emptyList();if(j!=null){j()}else{B(C)}}}}function q(D){var A=[];var C=D.split("\n");for(var B=0;B<C.length;B++){var E=a.trim(C[B]);if(E){E=E.split("|");A[A.length]={data:E,value:E[0],result:g.formatResult&&g.formatResult(E,E[0])||E[0]}}}return A}function p(){b.removeClass(g.loadingClass)}};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,clickHeader:false,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:100,max:1000,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(b){return b[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:" ",inputFocus:true,clickFire:true,highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:300,scrollJumpPosition:true};a.Autocompleter.Cache=function(c){var f={};var d=0;function h(l,k){if(!c.matchCase){l=l.toLowerCase()}var j=l.indexOf(k);if(c.matchContains=="word"){j=l.toLowerCase().search("\\b"+k.toLowerCase())}if(j==-1){return false}return j==0||c.matchContains}function g(j,i){if(d>c.cacheLength){b()}if(!f[j]){d++}f[j]=i}function e(){if(!c.data){return false}var k={},j=0;if(!c.url){c.cacheLength=1}k[""]=[];for(var m=0,l=c.data.length;m<l;m++){var p=c.data[m];p=(typeof p=="string")?[p]:p;var o=c.formatMatch(p,m+1,c.data.length);if(typeof(o)==="undefined"||o===false){continue}var n=o.charAt(0).toLowerCase();if(!k[n]){k[n]=[]}var q={value:o,data:p,result:c.formatResult&&c.formatResult(p)||o};k[n].push(q);if(j++<c.max){k[""].push(q)}}a.each(k,function(r,s){c.cacheLength++;g(r,s)})}setTimeout(e,25);function b(){f={};d=0}return{flush:b,add:g,populate:e,load:function(n){if(!c.cacheLength||!d){return null}if(!c.url&&c.matchContains){var m=[];for(var j in f){if(j.length>0){var o=f[j];a.each(o,function(p,k){if(h(k.value,n)){m.push(k)}})}}return m}else{if(f[n]){return f[n]}else{if(c.matchSubset){for(var l=n.length-1;l>=c.minChars;l--){var o=f[n.substr(0,l)];if(o){var m=[];a.each(o,function(p,k){if(h(k.value,n)){m[m.length]=k}});return m}}}}}return null}}};a.Autocompleter.Select=function(e,j,l,p){var i={ACTIVE:"ac_over"};var k,f=-1,r,m="",s=true,c,o;function n(){if(!s){return}var t="acr_"+randomId();a(j).data("acresult",t).attr("data-acresult",t);c=a("<div/>").hide().attr("id",t).addClass(e.resultsClass).css("position","absolute").appendTo(document.body).hover(function(u){if(a(this).is(":visible")){j.focus()}p.mouseDownOnSelect=false});o=a("<ul/>").appendTo(c).mouseover(function(u){if(q(u).nodeName&&q(u).nodeName.toUpperCase()=="LI"){f=a("li",o).removeClass(i.ACTIVE).index(q(u));a(q(u)).addClass(i.ACTIVE)}}).click(function(u){u.preventDefault();u.stopPropagation();a(q(u)).addClass(i.ACTIVE);l();if(e.inputFocus){j.focus()}return false}).mousedown(function(){p.mouseDownOnSelect=true}).mouseup(function(){p.mouseDownOnSelect=false});if(e.width>0){c.css("width",e.width)}s=false}function q(u){var t=u.target;while(t&&t.tagName!="LI"){t=t.parentNode}if(!t){return[]}return t}function h(t){k.slice(f,f+1).removeClass(i.ACTIVE);g(t);var v=k.slice(f,f+1).addClass(i.ACTIVE);if(e.scroll){var u=0;k.slice(0,f).each(function(){u+=this.offsetHeight});if((u+v[0].offsetHeight-o.scrollTop())>o[0].clientHeight){o.scrollTop(u+v[0].offsetHeight-o.innerHeight())}else{if(u<o.scrollTop()){o.scrollTop(u)}}}}function g(t){if(e.scrollJumpPosition||(!e.scrollJumpPosition&&!((t<0&&f==0)||(t>0&&f==k.length-1)))){f+=t;if(f<0){f=k.length-1}else{if(f>=k.length){f=0}}}}function b(t){return e.max&&e.max<t?e.max:t}function d(){o.empty();var v=b(r.length);for(var x=0;x<v;x++){if(!r[x]){continue}var y=e.formatItem(r[x].data,x+1,v,r[x].value,m);if(y===false){continue}var u=a("<li/>");var w=a(y);w.each(function(z,A){if(a.trim(A.innerText)){A.innerHTML=e.highlight(A.innerHTML,m)}});var t=u.html(w).addClass(x%2==0?"ac_even":"ac_odd").appendTo(o)[0];a.data(t,"ac_data",r[x])}k=o.find("li");if(e.selectFirst){k.slice(0,1).addClass(i.ACTIVE);f=0}if(a.fn.bgiframe){o.bgiframe()}}return{processHeaderSpan:function(u,y){if(u.indexOf("-")==-1){html="<span style='text-align:"+y+"'>"+u+"</span>"}else{var x=u.split("-");var w=x[1];if(typeof(w)=="undefined"||w.length==0||(isNaN(w)&&!w.endWith("%"))){w=null}else{if(w.endWith("%")){w="width:"+w+";"}else{w="width:"+w+"px;"}}var t=w;if(x.length==2){html="<span "+(t?"class='auto'":"")+" style='"+w+"text-align:"+y+"'>"+x[0]+"</span>"}else{if(x.length==3){var v=x[2]||y;html="<span "+(t?"class='auto'":"")+" style='"+w+"text-align:"+v+"'>"+x[0]+"</span>"}}}return html},display:function(u,t){n();r=u;m=t;d()},next:function(){h(1)},prev:function(){h(-1)},pageUp:function(){if(f!=0&&f-8<0){h(-f)}else{h(-8)}},pageDown:function(){if(f!=k.length-1&&f+8>k.length){h(k.length-1-f)}else{h(8)}},hide:function(){c&&c.hide();k&&k.removeClass(i.ACTIVE);f=-1},visible:function(){return c&&c.is(":visible")},current:function(){return this.visible()&&(k.filter("."+i.ACTIVE)[0]||e.selectFirst&&k[0])},show:function(){var P=a(j);var T=P.closest("td"),R=false;if(isOk(T)){var A=T.closest("table[data-editable='true']");R=isOk(A)}var y=P.offset(),J=P.data("header"),x=isOk(J),u=jboltWindow.scrollTop(),E=jboltWindow.scrollLeft(),G=P.outerHeight(),F=y.top+G+(R?3:2)-u,w=y.left-E,z=P.outerWidth(),I=P.data("width")||z,O=P.data("height");var D=jboltWindowWidth-w-20;if(I>D){w=w+z-I}if(self!=F){u=0}if(y.top+e.scrollHeight>jboltWindowHeight-25){F=y.top-e.scrollHeight-(R?3:2)-u}var B={top:F+"px",left:w+"px",width:I+"px","max-width":I+"px",height:e.scrollHeight+"px","max-height":e.scrollHeight+"px"};var t=e.scrollHeight;if(x){var L=P.data("text-align")||"center";var S=c.find("div.header");if(notOk(S)){var N=a("<div class='header'></div>");t=t-30;c.addClass("hasHeader");var C="";if(J.indexOf(",")==-1){C=this.processHeaderSpan(J,L)}else{var K=J.split(",");var v;for(var M in K){v=K[M];C+=this.processHeaderSpan(v,L)}}N.html(C);o.before(N)}}c.css(B).show();if(e.scroll){o.scrollTop(0);o.css({maxHeight:t,overflow:"auto"});if(navigator.userAgent.indexOf("MSIE")!=-1&&typeof document.body.style.maxHeight==="undefined"){var H=0;k.each(function(){H+=this.offsetHeight});var Q=H>e.scrollHeight;o.css("height",Q?e.scrollHeight:H);if(!Q){k.width(o.width()-parseInt(k.css("padding-left"))-parseInt(k.css("padding-right")))}}}},selected:function(){var t=k&&k.filter("."+i.ACTIVE).removeClass(i.ACTIVE);return t&&t.length&&a.data(t[0],"ac_data")},emptyList:function(){o&&o.empty()},unbind:function(){c&&c.remove()}}};a.fn.selection=function(i,b){if(i!==undefined){return this.each(function(){if(this.createTextRange){var j=this.createTextRange();if(b===undefined||i==b){j.move("character",i);j.select()}else{j.collapse(true);j.moveStart("character",i);j.moveEnd("character",b);j.select()}}else{if(this.setSelectionRange){this.setSelectionRange(i,b)}else{if(this.selectionStart){this.selectionStart=i;this.selectionEnd=b}}}})}var g=this[0];if(g.createTextRange){var c=document.selection.createRange(),h=g.value,f="<->",d=c.text.length;c.text=f;var e=g.value.indexOf(f);g.value=h;this.selection(e,e+d);return{start:e,end:e+d}}else{if(g.selectionStart!==undefined){return{start:g.selectionStart,end:g.selectionEnd}}}}})(jQuery);