var jbolt_admin_js_version="6.2.7";var jboltJsDevMode=false;var jboltWindow=$(window);var jboltDocument=$(document);var jboltBody=$("body");var jboltAdmin=jboltBody.find(".jbolt_admin");var jboltWithTabs=jboltAdmin.hasClass("withtabs");var jboltAdminMain=jboltBody.find(".jbolt_admin_main");var jboltAdminLeftNavs=jboltBody.find(".jbolt_admin_left_navs");var jboltAllTopNavs=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li");var jboltHasTopNav=jboltAllTopNavs&&jboltAllTopNavs.length>0;var jboltWindowWidth=jboltWindow.width();var jboltWindowHeight=jboltWindow.height();var JBOLT_AUTO_LOCK_SCREEN_SECONDS=0;var JBoltBaseTagHref=$("base").attr("href");var msgCenterRedDot=$("#msgCenterRedDot");var JBoltBaseTagHrefNoSchema=JBoltBaseTagHref.replace("http://","").replace("https://","").replace("www","");var mainPjaxContainerId="#jbolt-container";var mainPjaxContainer=$(mainPjaxContainerId);var summernote_img_uploadurl="admin/summernote/upload/image/";var hasImportSelect2=false;var multipleUploadFiles=new Array();var JBOLT_ASSETS_VERSION=$.trim($("#JBOLT_ASSETS_VERSION").text());if(!JBOLT_ASSETS_VERSION){JBOLT_ASSETS_VERSION=randomId()}var JBOLT_BASE_UPLOAD_PATH_PRE=$.trim($("#JBOLT_BASE_UPLOAD_PATH_PRE").text());var JBoltCityPickerDatas=null;var JBoltTabKeepAfterReload=("true"==$.trim($("#JBOLT_TAB_KEEP_AFTER_RELOAD").text()));var hasPjax=isHasPjax();var jbolt_tabbar=$("#jbolt_tabbar");var jbolt_tabs_container=$("#jbolt_tabs");var jbolt_tabs_array=[];var JBoltTableInts={};var g=function(a){return"string"==typeof a?document.getElementById(a):a};function getSelectText(){var c;if(window.getSelection){var a=window.getSelection();if(a){c=a.toString()}}else{var b=document.selection;if(b){c=b.createRange().text}}return c}function jboltHandleBigData(e,b,h){b=b||15;var a=e.length;var c=1;var f=Math.ceil(a/b);var d=function(){var k=(c-1)*b;var i=c*b;var j=e.slice(k,i);if(typeof h==="function"){h(j,{totalCount:a,totalPageNumer:f,currentPageNumber:c,pageSize:b})}if(c<f){window.requestAnimationFrame(d)}c++};d()}function textareaAutoHeight(c,b){c.style.height="auto";c.style.minHeight=(b||34)+"px";c.scrollTop=0;if(c.scrollHeight>b){if(c.hasAttribute("data-show-count")){var a=$(c).data("show-count");if(typeof(a)=="undefined"||(typeof(a)=="boolean"&&a)||a.length==0){c.style.height=c.scrollHeight+15+"px"}else{c.style.height=c.scrollHeight+5+"px"}}else{c.style.height=c.scrollHeight+5+"px"}}}var TextareaUtil={initEvent:function(c){var a=getRealParentJqueryObject(c);if(!isOk(a)){return false}a.on("keyup","textarea[data-auto-height]",function(){var d=$(this).data("auto-height")||34;if(this.hasAttribute("data-show-count")){var e=$(this).data("data-show-count");if(typeof(e)=="undefined"||(typeof(e)=="boolean"&&e)||e.length==0){d=d+15}}textareaAutoHeight(this,d)});var b=this;a.on("keyup","textarea[maxlength][data-show-count]",function(){var e=$(this);var h=e.attr("maxlength");if(!h){return}var f=e.data("show-count");if(typeof(f)=="undefined"||(typeof(f)=="boolean"&&f)||f.length==0){var d=b.checkSmallCountBox(e);if(isOk(d)){b.updateCount(e,d)}}})},checkSmallCountBox:function(d){var e=d.attr("maxlength");if(!e){return}var c=d.data("small-id");var b=null;if(c){b=jboltBody.find("small#"+c)}else{c="txsm_"+randomId();d.data("small-id",c).attr("data-small-id",c);var a="<small id='"+c+"' style='position:relative;font-size:14px;display: inline-block;float:right;color:#777777;margin-top: -25px;padding-right:8px;text-align: right;'><span data-as='inputCount' tooltip data-title='已输入'>"+0+"</span><span>/</span><span data-as='leaveCount' tooltip data-title='剩余'>"+e+"</span><span>/</span><span tooltip data-title='可输入总数'>"+e+"</span></small>";d.after(a);b=jboltBody.find("small#"+c);initToolTip(b)}return b},updateCount:function(b,a){var c=b.attr("maxlength");if(!c){return}var h=b[0].value.length;var f=c-h;b.data("input-count",h);b.data("leave-count",f);var e=a.find("span[data-as='inputCount']");var d=a.find("span[data-as='leaveCount']");e.text(h);d.text(f);if(f<=0){d.addClass("text-danger")}else{d.removeClass("text-danger")}},initUI:function(c){var a=getRealParentJqueryObject(c);if(!isOk(a)){return false}var b=this;a.find("textarea[data-auto-height]").each(function(){var h=$(this);var e=h.data("auto-height")||34;var d=h.outerHeight();var f=h.data("data-show-count");if(typeof(f)=="undefined"||(typeof(f)=="boolean"&&f)||f.length==0){e=e+15}if(d<e){this.style.height=e+"px";this.style.minHeight=e+"px"}});a.find("textarea[maxlength][data-show-count]").each(function(){var e=$(this);var h=e.attr("maxlength");if(!h){return}var f=e.data("show-count");if(typeof(f)=="undefined"||(typeof(f)=="boolean"&&f)||f.length==0){var d=b.checkSmallCountBox(e);if(isOk(d)){b.updateCount(e,d)}}})}};if(!String.prototype.replaceAll){RegExp.quote=function(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};String.prototype.replaceAll=function(b,a){return this.replace(new RegExp(RegExp.quote(b),"gm"),a)}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}}if(!String.prototype.startWith||!String.prototype.endWith){String.prototype.startWith=function(a){if(a==null||a==""||this.length==0||a.length>this.length){return false}return this.substring(0,a.length)==a};String.prototype.endWith=function(a){if(a==null||a==""||this.length==0||a.length>this.length){return false}return this.substring(this.length-a.length)==a}}if(JBoltBaseTagHrefNoSchema.startWith("://")){JBoltBaseTagHrefNoSchema=JBoltBaseTagHrefNoSchema.substring(3)}var loadedPlugins={};var jboltPlugins={morris:{js:["assets/plugins/morris/morris.min.js","assets/plugins/morris/raphael.min.js"],css:["assets/plugins/morris/morris.css"]},webcam:{js:["assets/plugins/webcam/jquery.webcam.min.js"]},webcamjs:{js:["assets/plugins/webcamjs/js/webcam.js","assets/plugins/webcamjs/js/cropbox.js"],css:["assets/plugins/webcamjs/css/webcam.css"]},summernote:{js:["assets/plugins/summernote/summernote-bs4.min.js","assets/plugins/summernote/lang/summernote-zh-CN.min.js"],css:["assets/plugins/summernote/summernote-bs4.css"]},tamemoji:{js:["assets/plugins/summernote/tam-emoji/js/config.js","assets/plugins/summernote/tam-emoji/js/tam-emoji.min.js"],css:["assets/plugins/summernote/tam-emoji/css/emoji.css"]},neditor:{js:["assets/plugins/neditor/neditor.config.js","assets/plugins/neditor/neditor.all.min.js","assets/plugins/neditor/neditor.service.js"]},fileinput:{js:["assets/plugins/bootstrap-fileinput/last/js/plugins/sortable.min.js","assets/plugins/bootstrap-fileinput/last/js/plugins/piexif.min.js","assets/plugins/bootstrap-fileinput/last/js/fileinput.min.js","assets/plugins/bootstrap-fileinput/last/themes/fa/theme.min.js","assets/plugins/bootstrap-fileinput/last/themes/explorer-fa/theme.min.js","assets/plugins/bootstrap-fileinput/last/js/locales/zh.js"],css:["assets/plugins/bootstrap-fileinput/last/css/fileinput.min.css","assets/plugins/bootstrap-fileinput/last/themes/explorer-fa/theme.min.css"]},imgviewer:{js:["assets/plugins/viewer/js/viewer.min.js","assets/plugins/viewer/js/jquery-viewer.min.js"],css:["assets/plugins/viewer/css/viewer.min.css"]},jbolttable:{js:["assets/plugins/jbolt-table/jbolt-table"+(jboltJsDevMode?"":".min")+".js?v="+(jboltJsDevMode?(randomId()):JBOLT_ASSETS_VERSION)],css:["assets/plugins/jbolt-table/jbolt-table"+(jboltJsDevMode?"":".min")+".css?v="+(jboltJsDevMode?(randomId()):JBOLT_ASSETS_VERSION)]},jstree:{js:["assets/plugins/jstree/jstree.min.js"],css:["assets/plugins/jstree/themes/default/style.min.css"]},splitjs:{js:["assets/plugins/splitjs/split/split.min.js"]},ipicker:{js:["assets/plugins/ipicker/ipicker.min.js"]},autocomplete:{js:["assets/plugins/jquery/autocomplete/autocomplete"+(jboltJsDevMode?"":".min")+".js"]},pagination:{js:["assets/plugins/jquery/pagination/pagination.min.js"]},"bootstrap-select":{js:["assets/plugins/bootstrap-select/js/bootstrap-select.min.js","assets/plugins/bootstrap-select/js/i18n/defaults-zh_CN.min.js"],css:["assets/plugins/bootstrap-select/css/bootstrap-select.min.css"]},echarts:{js:["assets/plugins/echarts/echarts.min.js"]},pdfjs:{js:["assets/plugins/pdfjs/pdf.js"]},videojs:{js:["assets/plugins/videojs/video.min.js"],css:["assets/plugins/videojs/video-js.min.css"]},jcalculator:{js:["assets/plugins/jcalculator/jcalculator.js"],css:["assets/plugins/jcalculator/jcalculator.css"]},fullcalendar:{js:["assets/plugins/fullcalendar/main.min.js","assets/plugins/fullcalendar/locales/zh-cn.js"],css:["assets/plugins/fullcalendar/main.min.css"]},rangeslider:{js:["assets/plugins/rangerslider/ion.rangeSlider.min.js"],css:["assets/plugins/rangerslider/ion.rangeSlider.min.css"]},hiprint:{js:["assets/plugins/hiprint/plugins/jspdf/canvas2image.js","assets/plugins/hiprint/plugins/jspdf/canvg.min.js","assets/plugins/hiprint/plugins/jspdf/html2canvas.min.js","assets/plugins/hiprint/plugins/jspdf/jspdf.min.js","assets/plugins/hiprint/polyfill.min.js","assets/plugins/hiprint/hiprint.bundle.js","assets/plugins/hiprint/plugins/JsBarcode.all.min.js","assets/plugins/hiprint/plugins/qrcode.js","assets/plugins/hiprint/plugins/jquery.hiwprint.js"],css:["assets/plugins/hiprint/css/hiprint.css","assets/plugins/hiprint/css/print-lock.css",{url:"assets/plugins/hiprint/css/print-lock.css",media:"print"}]},qiniu:{js:["assets/plugins/qiniu/3.4.0/qiniu.min.js"]},clipboardjs:{js:["assets/plugins/clipboard/clipboard.min.js"]},jsoneditor:{js:["assets/plugins/jsoneditor/jsoneditor.min.js"],css:["assets/plugins/jsoneditor/jsoneditor.min.css"]}};var JsonEditorUtil={init:function(c){var a=getRealParentJqueryObject(c);if(!isOk(a)){return false}var b=a.find("div[data-jsoneditor]");if(!isOk(b)){return false}this.initJsonEditors(b)},initJsonEditors:function(b){if(!isOk(b)){return false}var a=this;loadJBoltPlugin(["jsoneditor"],function(){var c=b.length;for(var d=0;d<c;d++){a.initJsonEditor(b.eq(d),false)}})},initJsonEditor:function(editor,needLoadPlugin){var that=this;var inputId=editor.attr("id");if(!inputId){inputId=randomId();editor.attr("id",inputId)}var hiddenInputId=editor.data("hidden-input");var mode=editor.data("mode")||"code";var modesStr=editor.data("modes")||"code,tree";var modes=modesStr.split(",");var options={mode:mode,modes:modes};if(hiddenInputId){var hiddenInput=jboltBody.find("#"+hiddenInputId);if(isOk(hiddenInput)){options.onChangeText=function(jsonText){hiddenInput.val(jsonText)}}}var setContent=function(jee,edi){var jsonStr=null;var jsonFuncStr=edi.data("json-func");if(jsonFuncStr){var jsonFunc=eval(jsonFuncStr);if(jsonFunc&&typeof(jsonFunc)=="function"){jsonStr=jsonFunc()}}else{jsonStr=edi.data("json")}if(jsonStr){if(typeof(jsonStr)=="string"){jee.setText(jsonStr)}else{jee.set(jsonStr)}}};if(needLoadPlugin){loadJBoltPlugin(["jsoneditor"],function(){var je=new JSONEditor(editor[0],options);setContent(je,editor);editor.data("editor-inst",je)})}else{var je=new JSONEditor(editor[0],options);setContent(je,editor);editor.data("editor-inst",je)}}};var JBoltClipboardUtil={init:function(){loadJBoltPlugin(["clipboardjs"],function(){var a=new ClipboardJS("[data-clipboard-text],[data-clipboard-target],[data-clipboard-action]");a.on("success",function(b){LayerMsgBox.success("复制成功",500);b.clearSelection()});a.on("error",function(b){LayerMsgBox.error("复制失败",500)})})}};var JBoltBaiduMapUtil={init:function(b,c,d){window.JBoltBaiduMapLoadedCallback=function(){if(d){d()}};var a=document.createElement("script");a.type="text/javascript";a.src="//api.map.baidu.com/api?type=webgl&v="+b+"&ak="+c+"&callback=JBoltBaiduMapLoadedCallback";document.body.appendChild(a)}};function addPluginsToJBoltPluginMgr(a){if(isOk(a)&&jsonObjectValueIsOk(a)){Object.assign(jboltPlugins,a)}}function launchFullscreen(a){if(!a){a=document.documentElement}a.isFullscreen=false;if(a.requestFullscreen){a.requestFullscreen();a.isFullscreen=true}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen();a.isFullscreen=true}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen();a.isFullscreen=true}else{if(a.msRequestFullscreen){a.msRequestFullscreen();a.isFullscreen=true}}}}}function exitFullscreen(a){if(!a){a=document.documentElement}if(document.exitFullscreen){document.exitFullscreen();a.isFullscreen=false}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen();a.isFullscreen=false}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen();a.isFullscreen=false}}}}function toggleFullScreen(a){if(!a){a=document.documentElement}if(a.isFullscreen){exitFullscreen(a)}else{launchFullscreen(a)}}function insertNodeAfter(c,a){var b=a.nextSibling;if(b){a.parentNode.insertBefore(c,b)}else{a.parentNode.appendChild(c)}}function filterAndHighlightChildNodes(e,h){if(e.nodeName=="#text"){var k=e.nodeValue;var b,m,d,j,l,c;if(k){l=k.indexOf(h);if(l!=-1){c=h.length;d=document.createElement("span");d.className="jb_fspan";d.innerHTML='<span class="jb_filter_highlight">'+h+"</span>";e.nodeValue=k.substring(0,l);insertNodeAfter(d,e);m=k.substring(l+c);if(m){j=document.createTextNode(m);insertNodeAfter(j,d)}}}}else{var a=e.childNodes;if(isOk(a)){var n=a.length;for(var f=0;f<n;f++){filterAndHighlightChildNodes(a[f],h)}}}}function filterAndHighlight(e,d){if(d){var a=e.childNodes;if(isOk(a)){var c=a.length;for(var b=0;b<c;b++){filterAndHighlightChildNodes(a[b],d)}}}}var jsonObjectValueIsOk=function(f){if(f==null||typeof(f)=="undefined"){return false}var c=false;if(f.length==undefined){c=Object.prototype.toString.call(f).toLowerCase()=="[object object]"&&JSON.stringify(f)!="{}"}else{c=f.length&&f.length>0}if(c){var h=false;var b=Object.keys(f);var e,d;for(var a in b){e=b[a];d=f[e];h=isOk(d)||(typeof(d)!=undefined&&d.toString()!="");if(h){break}}return h}return false};var notOk=function(a){return !isOk(a)};var isOk=function(c){if(!c){return false}if(isArray(c)){return c.length>0}var b=typeof(c);var a=false;switch(b){case"object":if(c.length==undefined){a=(Object.prototype.toString.call(c).toLowerCase()=="[object object]"&&JSON.stringify(c)!="{}")}else{a=(c.length&&c.length>0)}break;case"string":a=(c!=""&&c.length>0);break;case"number":a=(c>0);break;case"boolean":a=c;break;case"function":a=true;break;case"undefined":a=false;break;default:a=(c.length&&c.length>0);break}if(typeof(a)=="number"){a=a>0}return a};var jboltlog=function(a){if(jboltJsDevMode){console.log("                        ");console.log(new Date().Format("yyyy-MM-dd HH:mm:ss:S"));console.log(a);console.log("--------  end  ---------");console.log("                        ")}};var FullScreenBtnUtil={init:function(){jboltBody.on("click","[data-fullscreenbtn]",function(){var b=$(this);var d=b.data("target");if(d){var a;if(d.startWith("parent")){d=d.replace("parent","");a=b.closest(d)}else{a=jboltBody.find(d)}if(isOk(a)){toggleFullScreen(a[0]);var c=b.find("i.jbicon2.jbi-fullscreen,i.jbicon2.jbi-fullscreen-exit");if(isOk(c)){c.toggleClass("jbi-fullscreen");c.toggleClass("jbi-fullscreen-exit")}disposeTooltip(b)}}else{toggleFullScreen();var c=b.find("i.jbicon2.jbi-fullscreen,i.jbicon2.jbi-fullscreen-exit");if(isOk(c)){c.toggleClass("jbi-fullscreen");c.toggleClass("jbi-fullscreen-exit")}disposeTooltip(b)}})}};function disposeTooltip(a){if(a[0].hasAttribute("tooltip")||a[0].hasAttribute("data-tooltip")){a.tooltip("dispose");a.tooltip({boundary:"window",container:"body"})}}var JBoltInputWithCalculatorUtil={init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("input[data-with-calculator]");if(!isOk(a)){return false}this.initInputs(a)},initInputs:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["jcalculator"],function(){var c=a.length;for(var d=0;d<c;d++){b.initInput(a.eq(d),false)}})},initInput:function(input,needLoadPlugin){var that=this;var inputId=input.attr("id");if(!inputId){inputId=randomId();input.attr("id",inputId)}var isInlineBlock=input.hasClass("d-inline-block");if(isInlineBlock){input.removeClass("d-inline-block")}var theme=input.data("theme")||input.data("with-calculator")||"material";var onResultHandler=input.data("result-handler");var onInputHandler=input.data("input-handler");var options={theme:theme};if(onResultHandler){var extHandler=eval(onResultHandler);if(extHandler&&typeof(extHandler)=="function"){options.onResult=function(value){extHandler(input,value)}}}if(onInputHandler){var extInputHandler=eval(onInputHandler);if(extInputHandler&&typeof(extInputHandler)=="function"){options.onInput=function(input,code){extInputHandler(input,code)}}}if(needLoadPlugin){loadJBoltPlugin(["jcalculator"],function(){input.calculator(options)})}else{input.calculator(options)}}};var JBoltInputWithClearBtnUtil={init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("input[data-with-clearbtn]");if(!isOk(a)){return false}this.initInputs(a)},initInputs:function(b){if(!isOk(b)){return false}var d=this;var a=b.length;for(var c=0;c<a;c++){d.initInput(b.eq(c))}},initInput:function(input){var isInlineBlock=input.hasClass("d-inline-block");if(isInlineBlock){input.removeClass("d-inline-block")}var wrap=$('<div class="ac_input_box '+(isInlineBlock?"d-inline-block":"")+'"></div>');var clearBtnBox=$('<div class="closeBtnBox"><a tabindex="-1" href="javascript:void(0)" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a></div>');input.wrap(wrap);input.after(clearBtnBox);var inputId=input.attr("id");if(!inputId){inputId=randomId();input.attr("id",inputId)}input.on("input",function(){if(input.val()){clearBtnBox.show()}else{clearBtnBox.hide()}}).on("change",function(e){if(input.val()){clearBtnBox.show()}else{clearBtnBox.hide()}});var clearHandler=input.data("clear-handler");clearBtnBox.off("click").on("click",function(e){e.preventDefault();e.stopPropagation();input.removeClass("is-valid");input.removeClass("is-invalid");var tooltipId=input.attr("aria-describedby");if(tooltipId){input.tooltip("dispose")}input.val("").change().trigger("keyup");if(clearHandler){if(typeof(clearHandler)=="string"&&clearHandler=="oninput"){input.trigger("input")}else{if(typeof(clearHandler)=="string"&&clearHandler=="onkeyup"){input.trigger("keyup")}else{var exe_handler=eval(clearHandler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(input,input.val())}}}}if(input[0].hasAttribute("data-with-calculator")){input.trigger("clear")}return false});if(input.val()){clearBtnBox.show()}else{clearBtnBox.hide()}}};function jstreeSetJBoltInputValueHandler(m,p){var a=m.data("checkbox");var c=m.data("textasvalue")||false;var k=m.data("jboltinput");var n=$("#"+k);if(a){var h=m.data("onlyleaf")||false;var s=m.data("onlytype")||"";var f=m.data("onlyattrfilter")||"";var d=n.data("jstree-sync-withroot");if(typeof(d)=="undefined"){d=false}var j=m.jstree(true).get_all_checked(false,d,"text",h,s,f);var q=c?j:(m.jstree(true).get_all_checked(false,d,"id",h,s,f));JBoltInputUtil.setValue(m,j,q)}else{var e=n.data("jstree-value-attr");if(e){if(!p.data){LayerMsgBox.alert("jstree数据接口返回数据必须携带json原始数据，才可以使用data-jstree-value-attr",2);return}if(e.indexOf(",")==-1){var b=(e==="text")?p.text:(p.data[e]||"");JBoltInputUtil.setValue(m,p.text,(c?p.text:b))}else{var o=e.split(",");var t=new Array();var l;for(var r in o){l=o[r];if(l){t.push(p.data[l]||"")}else{t.push("")}}JBoltInputUtil.setValue(m,p.text,t)}}else{JBoltInputUtil.setValue(m,p.text,(c?p.text:p.id))}}}function jboltInputSetValueHandler(b,c,a){JBoltInputUtil.setValue(b,c,a)}var JBoltInputUtil={init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("input[data-jboltinput]");if(!isOk(a)){return false}this.initInputs(a)},initInputs:function(b){if(!isOk(b)){return false}var d=this;var a=b.length;for(var c=0;c<a;c++){d.initInput(b.eq(c))}},filterTable:function(b){if(!isOk(b.input_layer)){var a=b.attr("id");if(a){var c=jboltBody.find(".jbolt_input_layer[data-jbolt-input-id='"+a+"']");if(isOk(c)){b.input_layer=c}}}if(isOk(b.input_layer)){var f=$.trim(b.val());if(isOk(f)){var e,h,d=b.input_layer.find("table");d.find("tbody>tr").each(function(){e=$(this);h=e.text();if(h.indexOf(f)!=-1){e.css({color:"#f00"}).show(100)}else{e.css({color:"#333"}).hide(100)}})}else{b.input_layer.find("table>tbody>tr").css({color:"#333"}).show(100)}}},filterTree:function(b){if(!isOk(b.input_layer)){var a=b.attr("id");if(a){var d=jboltBody.find(".jbolt_input_layer[data-jbolt-input-id='"+a+"']");if(isOk(d)){b.input_layer=d}}}if(isOk(b.input_layer)){var c=b.input_layer.find("div[data-jstree]");if(isOk(c)){c.jstree(true).search($.trim(b.val()))}}},initInput:function(k){var h=this;if(!k.attr("id")){k.attr("id","jbinput_"+randomId())}var n=k.hasClass("d-inline-block");if(n){k.removeClass("d-inline-block")}var d=$('<div class="ac_input_box '+(n?"d-inline-block":"")+'"></div>');var j=$('<div class="closeBtnBox"><a tabindex="-1" href="javascript:void(0)" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a></div>');var f=k.data("readonly");var c=k.data("filter-handler");var a=true;if(!c&&(typeof(f)=="undefined"||(typeof(f)=="boolean"&&f===true))){k.attr("readonly","readonly");a=false}var m=k.data("load-type");if(!m){m="html";k.data("load-type",m)}k.wrap(d);k.after(j);var b=false;if(m=="html"){b=h.checkInputByHtml(k)}else{if(m=="ajaxportal"){b=h.checkInputByAjaxPortal(k)}else{if(m=="jstree"){b=h.checkInputByJstree(k)}}}if(b){var l=k.attr("id");if(!l){l=randomId();k.attr("id",l)}k.off("change").on("change",function(o){if(k.val()){j.show()}else{j.hide()}});k.off("click").on("click",function(o){o.preventDefault();o.stopPropagation();h.showJBoltInputLayer(k);return false});j.off("click").on("click",function(o){o.preventDefault();o.stopPropagation();k.removeClass("is-valid");k.removeClass("is-invalid");var p=k.attr("aria-describedby");if(p){k.tooltip("dispose")}k.val("").change();h.clearHiddenInputValue(k);if(c=="filterTable"){h.filterTable(k)}else{if(c=="filterTree"){h.filterTree(k)}}h.processJBoltTableHandler(k);return false});h.processInputFilterHandler(k,a,c,j)}var i=k.attr("placeholder");var e=k.val();if(i&&e&&e===i){j.hide();return}if(e){j.show()}else{j.hide()}},processInputFilterHandler:function(input,canInput,filterHandler){input.off("keyup");var that=this;if(canInput&&filterHandler){var clearBtnBox=input.parent().find(".closeBtnBox");input.on("keyup",function(e){e.preventDefault();e.stopPropagation();if(!isOk(input.closest("table[data-editable='true']"))){that.clearHiddenInputValue(input)}if(input.val()){clearBtnBox.show()}else{clearBtnBox.hide()}if(filterHandler=="filterTable"){that.filterTable(input)}else{if(filterHandler=="filterTree"){that.filterTree(input)}else{var exe_handler=eval(filterHandler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(input)}}}return false})}},hideJBoltInputLayer:function(a){if(isOk(a)){if(isOk(a.input_layer)){a.input_layer.slideUp(100);var c=a.input_layer.find(".jbolt_ajaxportal_menu");if(isOk(c)){c.hide()}}}else{var b=$(".jbolt_input_layer");if(isOk(b)){b.find(".jbolt_ajaxportal_menu").hide();b.slideUp(100)}}},setValue:function(d,e,k,b){var f=getRealJqueryObject(d);var t=f.closest(".jbolt_input_layer");if(isOk(t)){var j=t.data("jbolt-input-id");if(isOk(j)){var s=t.prev("#"+j);var p=s.data("zero-clear");var h=e;if(p){if(!isOk(k)){h=""}}s.val(h).change();var c=s.data("hidden-input")||s.data("hiddeninput");if(c){if(c.indexOf(",")!=-1){var a=c.split(",");var q=isArray(k);var n=a.length;if(isOk(a)&&q&&n==k.length){for(var o=0;o<n;o++){$("#"+a[o]).val(k[o]).change()}}else{LayerMsgBox.alert("id为："+j+"的JBoltInput组件 隐藏域个数与赋值个数不一致",2);return false}}else{var m=$("#"+c);if(notOk(m)){var l=s.data("name");if(l){s.before("<input type='hidden' id='"+c+"' name='"+l+"' />");m=s.prev()}else{LayerMsgBox.alert("指定的hiddenInput不存在时，自动创建，但是必须指定data-name属性",2);return false}}m.val(k).change()}}if(b){this.processJBoltTableHandler(s,e,k,b)}}}var r=f[0].hasAttribute("data-jstree")&&f.data("checkbox");if(!r&&!f.dontHideJBoltInputLayer){this.hideJBoltInputLayer()}},clearHiddenInputValue:function(c){var e=c.data("hidden-input")||c.data("hiddeninput");if(e){if(e.indexOf(",")!=-1){var b=e.split(",");if(isOk(b)){var a=b.length;for(var d=0;d<a;d++){$("#"+b[d]).val("").change()}}}else{$("#"+e).val("").change()}}},processJBoltTableHandler:function(h,j,i,e){var c=h.data("jbolttable-handler");if(c){var l=h.closest("table");if(isOk(l)){var a=l.jboltTable("inst");if(a){var d=h.closest("td");var f=a.tableListDatas[d.closest("tr").data("index")];var b=d.data("jbolttable-handler-ischangecolumns");if(!b){a.me.processColConfigChangeColumns(a,d,e)}var k=h.data("textasvalue")||false;c(a,d,j,(k?j:i),f,e)}}}},removeLayer:function(b){if(b.input_layer){b.input_layer=null}var a=b.attr("id");if(a){var c=jboltBody.find(".jbolt_input_layer[data-jbolt-input-id='"+a+"']");if(isOk(c)){c.remove()}}b.data("input-layer-clear",true)},showJBoltInputLayer:function(p){var o=this;if(p.data("input-layer-clear")&&p.input_layer){p.input_layer=null;p.data("input-layer-clear",false).removeAttr("data-input-layer-clear")}var b=p.input_layer;if(isOk(b)&&!b.is(":hidden")){return false}o.hideJBoltInputLayer();var k=p.data("load-type");if(!b){b=$("<div class='jbolt_input_layer'></div>");var j=p.data("url");if(j){j=actionUrl(j);j=processEleUrlByLinkOtherParamEle(p,j,false);if(!j){return false}j=processJBoltTableEleUrlByLinkColumn(p,j);if(!j){return false}}if(k=="html"){var D=p.data("content-id");var r=getRealJqueryObject(D);if(isOk(r)){r.addClass("show");b.append(r)}else{b.html('<div class="alert alert-warning d-inline-block"><i class="fa fa-warning mr-1"></i>暂无数据</div>')}b.insertAfter(p);p.next().on("click","[data-jboltinput-setvalue-trigger]",function(J){var I=$(this);var H=I.data("value");var K=I.data("text");var L=typeof(H);if(L=="string"&&H.indexOf(",")!=-1){H=H.split(",")}var G=I.data("json");o.setValue(I,K,H,G)})}else{if(k=="jstree"){var x;var v=p.data("open-level");v=v?('data-open-level="'+v+'"'):"";var c=p.data("jstree-checkbox");var A=p.data("onlyleaf")||false;var e=p.data("onlytype")||"";var F=p.data("onlyattrfilter")||"";var h=p.data("textasvalue")||false;if(p.data("filter-handler")){x=$('<div  data-onlyattrfilter="'+F+'" data-onlyleaf="'+A+'" data-onlytype="'+e+'" data-textasvalue="'+h+'" data-jboltinput="'+p.attr("id")+'" '+v+' data-search-by-jboltinput="true" data-jstree '+(c?" data-checkbox='true' ":"")+' data-read-url="'+j+'"  data-change-handler="jstreeSetJBoltInputValueHandler"> </div>')}else{var n=p.attr("id")+"_jstreesearchbox";x=$('<div class="form-group"><input type="text" class="form-control" id="'+n+'" placeholder="关键字搜索" /></div> <div   data-onlyattrfilter="'+F+'"  data-onlyleaf="'+A+'"  data-onlytype="'+e+'" data-textasvalue="'+h+'" data-jboltinput="'+p.attr("id")+'" '+v+" data-jstree "+(c?" data-checkbox='true' ":"")+'  data-search-input="'+n+'"  data-read-url="'+j+'"  data-change-handler="jstreeSetJBoltInputValueHandler"> </div>')}var C=p.data("jbolttable-handler");if(C){x.data("jbolttable-handler",C)}b.append(x);b.insertAfter(p);JSTreeUtil.init(b)}else{if(k=="ajaxportal"){var i=p.data("refresh");if(typeof(i)=="undefined"){i=true}var d=$("<div data-ajaxportal "+(i?"data-refresh":"")+' data-url="'+j+'"></div>');b.append(d);b.insertAfter(p);d.ajaxPortal(true);d.on("click","[data-jboltinput-setvalue-trigger]",function(J){var I=$(this);var H=I.data("value");var K=I.data("text");var L=typeof(H);if(L=="string"&&H.indexOf(",")!=-1){H=H.split(",")}var G=I.data("json");o.setValue(I,K,H,G)})}}}b.on("click",function(G){G.preventDefault();G.stopPropagation();hideAjaxPortalContextMenu();return false})}else{if(k=="html"){var D=p.data("content-id");var r=b.find("#"+D);if(!isOk(r)){var r=getRealJqueryObject(D);if(isOk(r)){r.addClass("show");b.append(r)}else{b.html('<div class="alert alert-warning d-inline-block"><i class="fa fa-warning mr-1"></i>暂无数据</div>')}}}else{if(k=="jstree"){}else{if(k=="ajaxportal"){var E=b.find("[data-ajaxportal]");if(!isOk(E)){var d=$('<div data-ajaxportal data-url="'+j+'"></div>');b.append(d);d.ajaxPortal(true)}}}}}var l=p.offset(),a=jboltWindow.scrollTop(),q=jboltWindow.scrollLeft(),u=p.outerHeight(),t=l.top+u+4-a,f=l.left-q,s=p.outerWidth(),z=s,m=p.data("width"),B=p.data("height"),w=p.data("max-height");if(m&&m>z){z=m}if(f+z>jboltWindowWidth){f=l.left+s-z}if(!B){B=350}var y=p.attr("id");b.attr("data-jbolt-input-id",y).data("jbolt-input-id",y);if(l.top+B>jboltWindowHeight-25){t=l.top-B-4-a}b.css({top:t+"px",left:f+"px",width:z+"px","max-width":z+"px",height:B+"px","max-height":B+"px"});b.slideDown(100);p.input_layer=b},checkInputByHtml:function(a){var b=this;var c=a.data("content-id");if(!c){showFormEleErrorStyle(a,"请设置data-content-id属性");return false}return true},checkInputByAjaxPortal:function(a){var c=this;var b=a.data("url");if(!b){c.showErrorStyle(a,"请设置data-url属性");return false}return true},checkInputByJstree:function(a){var c=this;var b=a.data("url");if(!b){c.showErrorStyle(a,"请设置data-url属性");return false}return true}};var RangeSliderUtil={reset:function(b){var a=getRealJqueryObject(b);if(notOk(a)){LayerMsgBox.alert("指定update的组件未找到",2);return false}loadJBoltPlugin(["rangeslider"],function(){a.data("ionRangeSlider").reset()})},update:function(c,a){var b=getRealJqueryObject(c);if(notOk(b)){LayerMsgBox.alert("指定update的组件未找到",2);return false}loadJBoltPlugin(["rangeslider"],function(){b.data("ionRangeSlider").update(a)})},init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("input[data-rangeslider],input[data-rangerslider]");if(!isOk(a)){return false}this.initInputs(a)},initInputs:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["rangeslider"],function(){var c=a.length;for(var d=0;d<c;d++){b.initInput(a.eq(d),false)}})},initInput:function(a,c){var b=this;if(c){loadJBoltPlugin(["rangeslider"],function(){b._initInput(a)})}else{b._initInput(a)}},processHandler:function(range,handler,data){var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(range,data)}},_initInput:function(a){var d={};var h=this;var i=false;var f=a.data("start-handler");if(f){i=true;d.onStart=function(j){h.processHandler(a,f,j)}}var c=a.data("change-handler");if(c){i=true;d.onChange=function(j){h.processHandler(a,c,j)}}var b=a.data("finish-handler");if(b){i=true;d.onFinish=function(j){h.processHandler(a,b,j)}}var e=a.data("update-handler");if(e){i=true;d.onUpdate=function(j){h.processHandler(a,e,j)}}if(i){a.ionRangeSlider(d)}else{a.ionRangeSlider()}}};function jsonToUrlParams(e){var d=[];for(var c in e){var b=encodeURIComponent(c);var f=encodeURIComponent(e[c]);d.push(b+"="+f)}var a=d.join("&");return a}var CityPickerUtil={loadJsonPromise:function(){return new Promise(function(a){a(JBoltCityPickerDatas)})},init:function(b){var a=getRealParentJqueryObject(b);if(!isOk(a)){return false}var c=a.find("[data-citypicker]");if(!isOk(c)){return false}this.initPickers(c)},initPickers:function(b){if(!isOk(b)){return false}var a=this;if(JBoltCityPickerDatas==null){$.getJSON("assets/plugins/ipicker/area.json",function(c){JBoltCityPickerDatas=c;loadJBoltPlugin(["ipicker"],function(){var e=b.length;for(var d=0;d<e;d++){a.initPicker(b.eq(d))}})})}else{loadJBoltPlugin(["ipicker"],function(){var d=b.length;for(var c=0;c<d;c++){a.initPicker(b.eq(c))}})}},initPicker:function(cp,data){if(typeof(data)=="undefined"){data=JBoltCityPickerDatas}var setvalueto=cp.data("setvalueto");if(!setvalueto){LayerMsgBox.alert("请设置cityPicker的 data-setvalueto属性 格式 id:name:valueAttr 或者 id:valueAttr",2);return false}var setValueArr=new Array();if(setvalueto.indexOf(";")!=-1){var arr=setvalueto.split(";");var tempArr;for(var i in arr){tempArr=arr[i].split(":");if(!isOk(tempArr)||(tempArr.length!=3&&tempArr.length!=2)){LayerMsgBox.alert("请正确设置cityPicker的 data-setvalueto属性 格式 id:name:valueAttr 或者 id:valueAttr",2);return false}setValueArr.push(tempArr)}}else{var sarr=setvalueto.split(":");if(!isOk(sarr)||(sarr.length!=3&&sarr.length!=2)){LayerMsgBox.alert("请正确设置cityPicker的 data-setvalueto属性 格式 id:name:valueAttr 或者 id:valueAttr",2);return false}setValueArr.push(sarr)}if(!isOk(setValueArr)){LayerMsgBox.alert("请正确设置cityPicker的 data-setvalueto属性 格式 id:name:valueAttr 或者 id:valueAttr",2);return false}var that=this;var cpId=cp.attr("id");if(!cpId){cpId="cityPicker_"+randomId();cp.attr("id",cpId)}var disabled=cp.data("disabled")||[];var disabledItem=cp.data("disabled-item")||[];var theme=cp.data("theme")||"cascader";var level=cp.data("level")||3;var strict=cp.data("strict")||false;var height=cp.data("height")||34;var radius=cp.data("radius")||2;var maxHeight=cp.data("max-height")||300;var placeholder=cp.data("placeholder")||"请选择地区";var separator=cp.data("separator")||"/";var onlyShowLastLevel=cp.data("only-show-last-level")||false;var icon=cp.data("icon")||"triangle";var clearHandler=cp.data("clear-handler");var selectHandler=cp.data("select-handler");var pickerOptions={theme:theme,icon:icon,data:{source:that.loadJsonPromise()},disabled:disabled,level:level,radius:radius,separator:separator,onlyShowLastLevel:onlyShowLastLevel,height:height,disabledItem:disabledItem,maxHeight:maxHeight,clearable:true,placeholder:placeholder,strict:strict,onClear:function(){that.clearHidden(setValueArr);if(clearHandler){var exeClearHandler=eval(clearHandler);if(exeClearHandler&&typeof(exeClearHandler)=="function"){exeClearHandler(cp)}}},onSelect:function(code,name,all){that.selectCity(cp,code,name,all,setValueArr);if(selectHandler){var exeselectHandler=eval(selectHandler);if(exeselectHandler&&typeof(exeselectHandler)=="function"){exeselectHandler(cp,code,name,all)}}}};var select=cp.data("selected")||cp.data("select");if(select){var selectedArray;if(isArray(select)){selectedArray=select}else{if(isNaN(select)){selectedArray=select.split(",")}else{selectedArray=[select]}}if(isOk(selectedArray)){pickerOptions.selected=selectedArray}}var selectedCallback=cp.data("selected-callback")||cp.data("selected-handler");if(selectedCallback){var selectedHandler=eval(selectedCallback);if(selectedHandler&&typeof(selectedHandler)=="function"){pickerOptions.selectedCallback=selectedHandler}}var parent=cp.closest(".form-group");var formInline=cp.closest(".form-inline");var cpw=cp.data("width")||"100%";if(theme=="select"){cpw=cp.data("width")||200}else{if(!isOk(parent)&&isOk(formInline)){cpw=cp.data("width")||200}}pickerOptions.width=cpw;that.initHiddenInput(cp,setValueArr);iPicker("#"+cpId,pickerOptions)},initHiddenInput:function(f,d){var h,b,e,a=0;for(var c in d){a=d[c].length;h=d[c][0];if(a==3){b=(a==2)?null:d[c][1];e=jboltBody.find("input[id='"+h+"'][name='"+b+"']")}else{e=jboltBody.find("input[id='"+h+"']")}if(!isOk(e)&&a==2){LayerMsgBox.alert("指定setvalueto组件不存在，请正确设置cityPicker的 data-setvalueto属性 格式 id:name:valueAttr 或者 id:valueAttr",2);return false}if(!isOk(e)&&a==3){e=$("<input class='form-control my-1' id='"+h+"' type='hidden' name='"+b+"'/>");f.after(e)}}},clearHidden:function(b){for(var a in b){$("#"+b[a][0]).val("").change()}},selectCity:function(j,b,a,l,m){var k,n,d,c,e,h=0;for(var f in m){h=m[f].length;k=m[f][0];if(h==2){d=m[f][1]}else{n=m[f][1];d=m[f][2]}c="";if(d=="code"){c=b}else{if(d=="name"){c=a}else{if(d=="name_join"){c=a.join("")}else{if(d=="code_last"){c=b[b.length-1]}else{if(d=="name_last"){c=a[a.length-1]}}}}}if(h==3){e=jboltBody.find("input[id='"+k+"'][name='"+n+"']")}else{e=jboltBody.find("input[id='"+k+"']")}if(isOk(e)){e.val(c).change()}else{if(h==2){LayerMsgBox.alert("指定setvalueto组件不存在，请正确设置cityPicker的 data-setvalueto属性 格式 id:name:valueAttr 或者 id:valueAttr",2);return false}e=$("<input id='"+k+"' type='hidden' name='"+n+"' value='"+c+"'/>");j.after(e)}}}};function ajaxParseFile(n,c,h,p,o,f){if(h===200){var b=n.response;if(b.type=="application/json"&&b.size>0){if(p){p.data("downloading",false)}LayerMsgBox.closeLoadingNow();var k=new FileReader();k.onload=function(r){var q=JSON.parse(k.result);if(q.state=="fail"){LayerMsgBox.alert((q.msg||"下载失败"),2)}else{processAjaxResultNeedConfirmOr(p,q,function(){if(o){o()}})}};k.readAsText(b);return false}var m="file";if(!f&&p){f=p.data("filename")}if(f){m=f}else{var l=n.getResponseHeader("Content-disposition");if(l){l=decodeURI(l);var d=l.split("=");if(d&&d.length==2){m=$.trim(d[1])}}else{LayerMsgBox.closeLoadingNow();if(p){p.data("downloading",false)}LayerMsgBox.alert("下载失败,未设置下载文件的filename",2);return false}}if(p){p.data("downloading",false)}LayerMsgBox.closeLoadingNow();if(window.navigator.msSaveOrOpenBlob){try{window.navigator.msSaveOrOpenBlob(b,m)}catch(j){LayerMsgBox.closeLoadingNow();if(p){p.data("downloading",false)}LayerMsgBox.alert("下载失败 无法保存文件",2);return false}}else{var a=new Blob([b],{type:"application/octet-stream;charset=utf-8"});var i=window.URL.createObjectURL(a);var e=document.createElement("a");e.download=m.replace(new RegExp('"',"g"),"");e.href=i;e.click();if(window.URL.revokeObjectUrl){window.URL.revokeObjectUrl(i)}}if(p){p.data("downloading",false)}LayerMsgBox.closeLoadingNow()}else{LayerMsgBox.closeLoadingNow();if(p){p.data("downloading",false)}LayerMsgBox.alert("网络异常",2)}}function processAjaxResultNeedConfirmOr(c,a,b){if(a.needConfirm&&a.optUrl&&a.reqType){LayerMsgBox.confirm(a.msg||"请确认是否继续",function(){LayerMsgBox.loading("正在执行...",jboltAjaxTimeout);window.processAjaxResultNeedConfirmOrEle=c;if(a.optUrl){if(a.reqType=="GET"){Ajax.get(a.optUrl,function(h){LayerMsgBox.closeLoadingNow();if(b){b()}})}else{if(a.reqType=="POST"){Ajax.post(a.optUrl,a.data,function(h){LayerMsgBox.closeLoadingNow();if(b){b()}})}else{if(a.reqType=="DOWNLOAD"){if(c){var d=c.data("url")||c.attr("href");if(c[0].hasAttribute("data-url")){c.data("url",a.optUrl).attr("data-url",a.optUrl)}else{if(c[0].hasAttribute("href")){c.attr("href",a.optUrl)}}var f=c.data("form");if(f){c.data("form","").attr("data-form","")}var e=c.data("usecheckedids");if(e){c.data("usecheckedids","").attr("data-usecheckedids","")}DownloadUtil.downloadByEle(c);if(c[0].hasAttribute("data-url")){c.data("url",d).attr("data-url",d)}else{if(c[0].hasAttribute("href")){c.attr("href",d)}}if(f){c.data("form",f).attr("data-form",f)}if(e){c.data("usecheckedids",e).attr("data-form",e)}}}else{LayerMsgBox.closeLoadingNow();LayerMsgBox.alert("继续执行的操作类型只能选择GET、POST、DOWNLOAD",2)}}}}else{LayerMsgBox.closeLoadingNow();LayerMsgBox.alert("未指定 继续执行的URL",2)}})}else{b()}}function refreshJstreeHandler(a){if(a){loadJBoltPlugin(["jstree"],function(){var b=$("#"+a);if(notOk(b)){LayerMsgBox.alert("配置的data-jstree-id指定id无效",2)}else{var d=b.jstree(true).get_selected(false);var c=isOk(d)?d.id:null;JSTreeUtil.refresh(b,c)}})}else{LayerMsgBox.alert("没有配置data-jstree-id",2)}}var DownloadUtil={downloadByEle:function(ele){var that=this,btn=getRealJqueryObject(ele),url=btn.data("url")||btn.attr("href"),downloading=btn.data("downloading");if(!url){LayerMsgBox.alert("请设置data-url='下载地址'！",2);return false}var checkHandler=btn.data("check-handler");var checkMaster=btn.data("check-master");if(typeof(checkMaster)=="undefined"){checkMaster=false}var needCheckMaster=(checkMaster||(checkHandler&&checkHandler=="checkMasterTableId"));if(needCheckMaster){var masterId=btn.data("master-id");if(!masterId){LayerMsgBox.alert("请先选择主表数据",2);return false}}if(checkHandler&&checkHandler!="checkMasterTableId"){var execheck_handler=eval(checkHandler);if(execheck_handler&&typeof(execheck_handler)=="function"){var success=execheck_handler(btn);if(!success){return false}}}var formId=btn.data("form"),usecheckedids=btn.data("usecheckedids"),fileName=btn.data("filename"),loading=btn.data("loading"),params,handler=btn.data("handler"),portalId=btn.data("portalid")||btn.data("portal");if(usecheckedids){var checkedIds=jboltTableGetCheckedIds(btn);if(!isOk(checkedIds)){return false}params={ids:checkedIds}}else{if(formId){params=$("#"+formId).serializeJSON()}var withCurrentPage=btn.data("with-current-page");var jboltTable=JBoltTableUtil.getInst(btn);if(jboltTable&&jboltTable.page){var pageInfo={page:(jboltTable.data("pagenumber")||1),pageSize:(jboltTable.data("pagesize")||15)};if(params){Object.assign(params,pageInfo)}else{params=pageInfo}}}var confirm=btn.data("confirm");var doOptions={ele:btn,url:url,fileName:fileName,params:params,confirm:confirm,loading:loading,handler:handler};if(portalId){doOptions.portalId=portalId}that.download(doOptions)},init:function(){var a=this;jboltBody.on("click","[data-downloadbtn]",function(b){b.preventDefault();b.stopPropagation();a.downloadByEle(this);return false})},doHandler:function(options){if(options.handler){if(options.handler=="refreshPortal"){if(options.portalId){LayerMsgBox.success("操作成功",500,function(){if(options.portalId=="parentPortal"){if(options.ele){var parentPortal=options.ele.closest("[data-ajaxportal]");if(isOk(parentPortal)){parentPortal.ajaxPortal(true)}}}else{$("#"+options.portalId).ajaxPortal(true)}})}else{LayerMsgBox.alert("没有配置data-portalid",2)}}else{if(options.handler=="refreshJstree"){var jstreeId=options.jstreeId||(options.ele?options.ele.data("jstree-id"):null);refreshJstreeHandler(jstreeId)}else{if(options.handler=="jboltTablePageToFirst"){loadJBoltPlugin(["jbolttable"],function(){jboltTablePageToFirst(options.ele)})}else{if(options.handler=="jboltTablePageToLast"){loadJBoltPlugin(["jbolttable"],function(){jboltTablePageToLast(options.ele)})}else{if(options.handler=="refreshJBoltTable"||options.handler=="jboltTableRefresh"){loadJBoltPlugin(["jbolttable"],function(){refreshJBoltTable(options.ele)})}else{if(options.handler=="refreshJBoltMainTable"||options.handler=="jboltMainTableRefresh"){loadJBoltPlugin(["jbolttable"],function(){refreshJBoltMainTable(options.ele)})}else{if(options.handler=="refreshCurrentAjaxPortal"){refreshCurrentAjaxPortal(options.ele)}else{if(options.handler=="removeJBoltTableCheckedTr"){loadJBoltPlugin(["jbolttable"],function(){removeJBoltTableCheckedTr(options.ele,false)})}else{if(options.handler=="jboltTableRemoveCheckedRow"){loadJBoltPlugin(["jbolttable"],function(){jboltTableRemoveCheckedRow(options.ele,false)})}else{var exe_handler=eval(options.handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler()}}}}}}}}}}}},download:function(a){var c=null;if(window.XMLHttpRequest){c=new XMLHttpRequest()}else{c=new ActiveXObject("Microsoft.XMLHTTP")}if(c==null){LayerMsgBox.alert("您的浏览器不支持异步上传,请切换使用高级浏览器",2);return false}if(!a.url){LayerMsgBox.alert("请设置data-url='下载地址'！",2);return false}if(a.ele.data("downloading")){LayerMsgBox.alert("正在下载,请稍等",0);return false}a.loading=a.loading||"下载中...";if(a.confirm){var b=this;if(typeof(a.confirm)=="boolean"){a.confirm="确定下载？"}LayerMsgBox.confirm(a.confirm,function(){b.doDownload(c,a)})}else{this.doDownload(c,a)}},doDownload:function(c,a){var b=this;a.ele.data("downloading",true);LayerMsgBox.loading(a.loading,jboltAjaxTimeout);c.onload=function(){if(this.status===200){var d=this.response;if(d.type=="application/json"&&d.size>0){a.ele.data("downloading",false);LayerMsgBox.closeLoadingNow();var k=new FileReader();k.onload=function(o){var n=JSON.parse(k.result);if(n.state=="fail"){LayerMsgBox.alert((n.msg||"下载失败"),2)}else{processAjaxResultNeedConfirmOr(a.ele,n,function(){b.doHandler(a)})}};k.readAsText(d);return false}var m="file";if(a.fileName){m=a.fileName}else{var l=c.getResponseHeader("Content-disposition");if(l){l=decodeURI(l);var f=l.split("=");if(f&&f.length==2){m=$.trim(f[1])}}else{LayerMsgBox.closeLoadingNow();a.ele.data("downloading",false);LayerMsgBox.alert("下载失败,未设置下载文件的filename",2);return false}}a.ele.data("downloading",false);LayerMsgBox.closeLoadingNow();if(window.navigator.msSaveOrOpenBlob){try{window.navigator.msSaveOrOpenBlob(d,m)}catch(j){LayerMsgBox.closeLoadingNow();a.ele.data("downloading",false);LayerMsgBox.alert("下载失败 无法保存文件",2);return false}}else{var e=new Blob([d],{type:"application/octet-stream;charset=utf-8"});var i=window.URL.createObjectURL(e);var h=document.createElement("a");h.download=m.replace(new RegExp('"',"g"),"");h.href=i;h.click();if(window.URL.revokeObjectUrl){window.URL.revokeObjectUrl(i)}}a.ele.data("downloading",false);LayerMsgBox.closeLoadingNow()}else{LayerMsgBox.closeLoadingNow();a.ele.data("downloading",false);LayerMsgBox.alert("网络异常",2)}};c.open("POST",a.url,true);c.timeout=jboltAjaxTimeout;c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.responseType="blob";c.setRequestHeader("AJAX-DOWNLOAD","true");if(a.params){c.send(jsonToUrlParams(a.params))}else{c.send()}}};var JSTreeUtil={delNodeId:0,init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("div[data-jstree],section[data-jstree],p[data-jstree]");if(!isOk(a)){return false}this.initTrees(a)},initTrees:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["jstree"],function(){var c=a.length;for(var d=0;d<c;d++){b.initTree(a.eq(d),false)}})},initTree:function(a,c){var b=this;if(c){loadJBoltPlugin(["jstree"],function(){b._initTree(a)})}else{b._initTree(a)}},processCurdDialog:function(j,a,h,e,d){if(h=="add"||h=="edit"){var b=$('<button data-openpage="dialog" data-url="'+a+'" data-title="'+d.text+'" data-area="720,560"></button>');var c=j.data("dialog-area");if(c){b.data("area",c).attr("data-area",c)}var i=j.data("dialog-handler");if(i){if(i=="refreshJstree"){var f=j.attr("id");if(!f){f="jstree_"+randomId(5);j.attr("id",f)}b.data("jstree-id",f).attr("data-jstree-id",f)}b.data("handler",i).attr("data-handler",i)}DialogUtil.openBy(b)}else{if(h=="delete"){this.processDeletePortal(j,a,e,d)}else{if(h=="toggleEnable"){this.processToggleEnable(j,a,e,d)}}}},processToggleEnable:function(a,c,e,f){var d=this;var b=a.data("toggle-enable-confirm")||"确定切换数据[启用/禁用]状态?";LayerMsgBox.confirm(b,function(){LayerMsgBox.loading("执行中...");Ajax.get(c,function(i){LayerMsgBox.success("切换成功",1000);if(typeof(i.data)=="undefined"||typeof(i.data)!="object"){JSTreeUtil.refresh(a,f.id)}else{var h=a.data("toggle-enable-attr")||"enable";var j=i.data[h];if(typeof(j)=="undefined"){JSTreeUtil.refresh(a,f.id)}else{if(j.toString()=="true"){var k=f.text;k=k.replace('<span class="text-danger">禁用</span>',"");k=k.replace("[","").replace("]","");e.rename_node(f,k)}else{e.rename_node(f,f.text+'[<span class="text-danger">禁用</span>]')}}}})})},processDeletePortal:function(a,c,e,f){var d=this;var b=a.data("delete-confirm")||a.data("confirm")||"确定删除此项?";LayerMsgBox.confirm(b,function(){LayerMsgBox.loading("执行中...");Ajax.get(c,function(h){LayerMsgBox.success("删除成功",1000);d.delNodeId=f.id;if(e.is_selected(f)){e.delete_node(e.get_selected())}else{e.delete_node(f)}})})},processCurdPortal:function(b,d,e,h,i){var f=this;var c=b.data("portalid")||b.data("portal");var a=$("#"+c);if(e=="delete"){f.processDeletePortal(b,d,h,i)}else{if(e=="toggleEnable"){f.processToggleEnable(b,d,h,i)}else{a.ajaxPortal(true,d,true)}}},clearSelected:function(a){a.jstree(true).deselect_all()},refresh:function(a,b){var c=this;if(typeof(a)=="string"){a=getRealJqueryObject(a)}var d=c.processTreeReadUrl(a);if(!d){LayerMsgBox.alert("未设置jstree的data-read-url",2);return}if(b){if(d.indexOf("?")!=-1){d=d+"&selectId="+b}else{if(d[d.length-1]!="/"){d=d+"/"+b}else{d=d+b}}}var c=this;Ajax.get(d,function(f){var e=f.data;a.jstree(true).deselect_all();a.jstree(true).settings.core.data=e;a.jstree(true).refresh();if(b){setTimeout(function(){a.jstree(true).select_node({id:b,selected:true});var h=a.jstree(true).get_selected(false);if(notOk(h)){c.setChecked(a,"0");c.clearSelected(a)}},100)}})},processCurdHandler:function(n,d,m){var l=n.data("target");if(l==undefined||l=="undefined"){l="dialog"}var h=$.jstree.reference(d),e=h.get_node(d);var c=e.id;if((c==0&&m=="delete")||(c==0&&m=="toggleEnable")||(c==0&&m=="edit")||(c==0&&l=="dialog"&&m=="edit")){LayerMsgBox.alert("不能操作根节点",2);return false}var j=this;var f=e.id;var a="";switch(m){case"add":var b=n.data("add-url");if(b.indexOf("?")==-1){if(b.endWith("/")||b.endWith("-")){a=b+f}else{a=b+"/"+f}}else{if(b.endWith("/")||b.endWith("-")||b.endWith("=")){a=b+f}else{a=b+"&pid="+f}}if(f=="0"||f==0){var k=n.data("conditions-form");if(k){var i=$("#"+k);if(isOk(i)){a=urlWithFormData(a,i)}}}break;case"edit":a=n.data("edit-url")+f;break;case"portalEdit":a=n.data("edit-url")+f;break;case"delete":a=n.data("delete-url")+f;break;case"toggleEnable":a=n.data("toggle-enable-url")+f;break}switch(l){case"dialog":j.processCurdDialog(n,a,m,h,e);break;case"portal":j.processCurdPortal(n,a,m,h,e);break}},processChangeTextHandler:function(a,d,b){var c=this;switch(b){case"portalEdit":c.processCurdHandler(a,d,"portalEdit");break}},processJBoltTableHandler:function(l,i,h,e,c){if(c){var k=l.closest("table");if(isOk(k)){var a=k.jboltTable("inst");if(a){var d=l.closest("td");var f=a.tableListDatas[d.closest("tr").data("index")];var b=d.data("jbolttable-handler-ischangecolumns");if(!b){a.me.processColConfigChangeColumns(a,d,e)}var j=l.data("textasvalue")||false;c(a,d,i,(j?i:h),f,e)}}}},processTreeReadUrl:function(a){var b=a.data("read-url");if(!b){return null}var d=a.data("open-level");if(typeof(d)=="undefined"){d=0}if(d!=0){if(b.charAt(b.length-1)=="/"){b=b.substring(0,b.length-1)}if(b.indexOf("?")!=-1){b=b+"&openLevel="+d}else{b=b+"?openLevel="+d}}var c=this.processConditionsForm(a);if(isOk(c)){a.data("orign-read-url",b).attr("data-orign-read-url",b);b=urlWithFormData(b,c)}return b},_initTree:function(tree){var that=this;var autoLoad=tree.data("autoload");if(typeof(autoLoad)=="undefined"){autoLoad=true}var read_url;if(autoLoad){read_url=that.processTreeReadUrl(tree)}else{read_url=tree.data("read-url")}if(!read_url){LayerMsgBox.alert("未设置jstree的data-read-url",2);return}var curd=tree.data("curd");if(curd==undefined||curd=="undefined"){curd=false}var treeOptionsHandler=tree.data("options");if(treeOptionsHandler){treeOptionsHandler=eval(treeOptionsHandler);if(!treeOptionsHandler||typeof(treeOptionsHandler)!="function"){LayerMsgBox.alert("设置jstree的data-options 必须为自定义function 并且有返回值",2);return}}var stripes=tree.data("stripes");if(typeof(stripes)=="undefined"){stripes=false}var treeOptions={core:{check_callback:true,animation:200,themes:{stripes:stripes}},plugins:["themes","sort","state"]};var wholerow=tree.data("wholerow");if((typeof(wholerow)=="boolean"&&wholerow)){treeOptions.plugins.push("wholerow")}var searchInputId=tree.data("search-input");var searchInput;var hasCheckbox=false;if(searchInputId){searchInput=jboltBody.find("#"+searchInputId);if(!isOk(searchInput)){LayerMsgBox.alert("jstree组件data-search-input属性设置的id，无法定位",2);return false}treeOptions.plugins.push("search");$.jstree.defaults.search.show_only_matches=true}else{if(tree.data("search-by-jboltinput")){treeOptions.plugins.push("search");$.jstree.defaults.search.show_only_matches=true}}var checkboxEnable=tree.data("checkbox");if(checkboxEnable){treeOptions.plugins.push("checkbox");var onlyleaf=tree.data("onlyleaf")||false;if(onlyleaf){treeOptions.checkbox={three_state:false,cascade:"down",keep_selected_style:false}}hasCheckbox=true}if(curd){treeOptions.plugins.push("dnd");var target=tree.data("target");if(target&&target=="portal"){var portalId=tree.data("portalid")||tree.data("portal");if(!portalId){LayerMsgBox.alert("当data-target='portal'时，请设置:data-portalid",2);return false}}var createUrl=tree.data("add-url");if(!createUrl){LayerMsgBox.alert("请设置创建节点的接口地址:data-add-url",2);return false}var updateUrl=tree.data("edit-url");if(!updateUrl){LayerMsgBox.alert("请设置更新节点的接口地址:data-edit-url",2);return false}var deleteUrl=tree.data("delete-url");if(!deleteUrl){LayerMsgBox.alert("请设置创建节点的接口地址:data-delete-url",2);return false}var moveUrl=tree.data("move-url");if(!moveUrl){LayerMsgBox.alert("请设置创建节点的接口地址:data-move-url",2);return false}treeOptions.plugins.push("contextmenu");treeOptions.contextmenu={items:{refresh:{label:"刷新数据",action:function(data){var reference=data.reference;var inst=$.jstree.reference(reference),obj=inst.get_node(reference);that.refresh(tree,obj.id);return true}},add:{label:"创建子项",action:function(data){var reference=data.reference;that.processCurdHandler(tree,reference,"add");return true}},edit:{label:"编辑此项",action:function(data){var reference=data.reference;that.processCurdHandler(tree,reference,"edit");return true}},"delete":{label:"删除此项",action:function(data){var reference=data.reference;that.processCurdHandler(tree,reference,"delete");return true}}}}}else{tree.on("contextmenu",function(){return false})}if(tree.data("toggle-enable-menu")){treeOptions.contextmenu["items"]["toggleEnable"]={label:"切换[启用/禁用]",action:function(data){var reference=data.reference;that.processCurdHandler(tree,reference,"toggleEnable");return true}}}treeOptions.plugins.push("types");var defaultTypes={"#":{icon:"fa fa-folder"},root:{icon:"fa fa-folder"},"default":{icon:"fa fa-folder-o"},parent:{icon:"fa fa-folder-o"},node:{icon:"fa fa-file-o"},parent_opened:{icon:"fa fa-folder-open-o"},root_opened:{icon:"fa fa-folder-open"}};var types=tree.data("types");if(types){var cusTypes=eval(types)();Object.assign(defaultTypes,cusTypes)}treeOptions.types=defaultTypes;var async=tree.data("async");var that=this;if(async){treeOptions.core["data"]=function(obj,callback){var jsonarray=[];var url=read_url;if(obj.id!="#"){if(read_url.indexOf("?")!=-1){url=read_url+"&pid="+obj.id}else{url=read_url+"?pid="+obj.id}}Ajax.get(url,function(data){jsonarray=data.data},null,true);callback.call(this,jsonarray);that.processCheckedByTreeDataValue(tree);that.processCheckedByJBoltInput(tree)};tree.hasCheckbox=hasCheckbox;if(treeOptionsHandler&&typeof(treeOptionsHandler)=="function"){treeOptionsHandler(tree,treeOptions)}var theTree=tree.jstree(treeOptions);that.initTreeEvent(tree,theTree,searchInput,curd);that.processCheckedByTreeDataValue(tree);that.processCheckedByJBoltInput(tree)}else{if(autoLoad){Ajax.get(read_url,function(data){var treeDatas=data.data;treeOptions.core["data"]=treeDatas;tree.hasCheckbox=hasCheckbox;if(treeOptionsHandler&&typeof(treeOptionsHandler)=="function"){treeOptionsHandler(tree,treeOptions)}var theTree=tree.jstree(treeOptions);that.initTreeEvent(tree,theTree,searchInput,curd);that.processCheckedByJBoltInput(tree);that.processCheckedByTreeDataValue(tree)})}else{tree.hasCheckbox=hasCheckbox;if(treeOptionsHandler&&typeof(treeOptionsHandler)=="function"){treeOptionsHandler(tree,treeOptions)}var theTree=tree.jstree(treeOptions);that.initTreeEvent(tree,theTree,searchInput,curd)}}},processSyncEle:function(l,d){var e=l.data("sync-ele");if(!e){return}var k=l.data("sync-must");if(typeof(k)=="undefined"){k=true}var a=l.data("onlyleaf")||false;var b=l.data("onlytype")||"";var f=l.data("onlyattrfilter")||"";var j,h,i,c;$(e).each(function(){j=$(this);h=j.data("sync-attr")||j.data("value-attr");i=j.data("sync-withroot");if(typeof(i)=="undefined"){i=false}if(l.hasCheckbox){if(h){c=l.jstree(true).get_all_checked(false,i,h,a,b,f)}else{c=l.jstree(true).get_all_checked(false,i,null,a,b,f)}}else{if(d){if(h){if(h.startWith("data.")){if(d.data){c=d.data[h.substring(5)]}else{c=""}}else{c=d[h]}}}else{c=""}}if(typeof(c)=="undefined"){c=""}if(isFormEle(this.tagName)){if(this.value){if(k){this.value=c}}else{this.value=c}}else{if(this.innerText){if(k){this.innerText=c}}else{this.innerText=c}}})},setChecked:function(b,d){if(!d){this.clearSelected(b);return}if(isArray(d)){b.dontHideJBoltInputLayer=true;for(var c in d){if(!b.jstree(true).is_parent({id:d[c]})){b.jstree(true).check_node({id:d[c],checked:true})}}b.dontHideJBoltInputLayer=false;return}d=d+"";if(d.indexOf(",")!=-1){var a=d.split(",");if(isOk(a)){this.setChecked(b,a)}else{this.clearSelected(b)}}else{b.dontHideJBoltInputLayer=true;b.jstree(true).select_node({id:d,selected:true});b.dontHideJBoltInputLayer=false}},processCheckedByTreeDataValue:function(a){var b=a.data("jboltinput");if(b){return}var d=a.data("value")||a.data("select");if(!d){d=a.data("default-value")||a.data("default-select")}if(d){var c=this;setTimeout(function(){c.setChecked(a,d)},100)}},processCheckedByJBoltInput:function(a){var c=a.data("jboltinput");if(!c){return}var b=$("#"+c);if(!isOk(b)){return}var h=b.data("hidden-input");if(!h){return}var d=$("#"+h);if(!isOk(d)){return}var e=this;var f=d.val();setTimeout(function(){e.setChecked(a,f)},100)},initTreeEvent:function(tree,theTree,searchInput,curd){var changehandler=tree.data("change-handler");var jbolttablehandler=tree.data("jbolttable-handler");if(tree.hasCheckbox){tree.jstree(true).get_all_checked=function(full,withroot,attr,onlyleaf,onlytype,dataAttrFilterFunc){var tmp=new Array;var tempId,tempData,datas=this._model.data,types;for(var i in datas){tempData=datas[i];if((onlyleaf&&this.is_checked(i)&&this.is_leaf(i))||(!onlyleaf&&(this.is_undetermined(i)||this.is_checked(i)))){tempId=tempData.id;if(attr){if(attr.startWith("data.")){if(tempData){if(tempData.data){tempId=tempData.data[attr.substring(5)]}else{tempId=null}}else{tempId=null}}else{if(tempData){tempId=tempData[attr]}else{tempId=null}}}if(!withroot&&(tempId=="#"||tempId=="0"||tempId==null)){continue}if(isOk(onlytype)){types=onlytype.split(",");if(isOk(types)){if(types.includes(tempData.type)){tmp.push(full?tempData:tempId)}}}else{if(isOk(dataAttrFilterFunc)){var exe_func=eval(dataAttrFilterFunc);if(exe_func&&typeof(exe_func)=="function"){if(exe_func(tempData)){tmp.push(full?tempData:tempId)}}}else{tmp.push(full?tempData:tempId)}}}}return tmp}}var that=this;var syncEle=tree.data("sync-ele");if(changehandler||jbolttablehandler||isOk(syncEle)){theTree.on("changed.jstree",function(e,tdata){if(tdata&&tdata.node){if(tree.data("onlyleaf")){var currentNode=tdata.node;if(!tdata.instance.is_leaf(currentNode)){tdata.instance.deselect_node(currentNode);layer.msg("只能选择子节点",{time:1000});return false}}if(changehandler){if(typeof(changehandler)=="string"&&changehandler=="portalEdit"){that.processChangeTextHandler(tree,tdata.node,"portalEdit")}else{var exe_handler=eval(changehandler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(tree,tdata.node)}}}if(jbolttablehandler){var textasvalue=tree.data("textasvalue")||false;that.processJBoltTableHandler(tree,tdata.node.text,(textasvalue?tdata.node.text:tdata.node.id),tdata.node.data,jbolttablehandler)}that.processSyncEle(tree,tdata.node)}})}theTree.on("after_open.jstree",function(e,tdata){if(tdata.node.parent=="#"){tdata.instance.set_type(tdata.node,"root_opened")}else{tdata.instance.set_type(tdata.node,"parent_opened")}}).on("after_close.jstree",function(e,tdata){if(tdata.node.parent=="#"){tdata.instance.set_type(tdata.node,"root")}else{tdata.instance.set_type(tdata.node,"parent")}});if(curd){var moveUrl=tree.data("move-url");if(!moveUrl){LayerMsgBox.alert("请设置创建节点的接口地址:data-move-url",2);return false}theTree.on("move_node.jstree",function(e,tdata){var parent=tdata.parent;if(parent=="#"){parent=0}LayerMsgBox.loading("处理中...",10000);Ajax.post(moveUrl,{id:tdata.node.id,pid:parent,rank:tdata.position},function(res){LayerMsgBox.success("操作成功",1000);that.refresh(tree,tdata.node.id)})})}if(isOk(searchInput)){var to=false;searchInput.keyup(function(){if(to){clearTimeout(to)}to=setTimeout(function(){tree.jstree(true).search(searchInput.val())},100)})}},processConditionsForm:function(a){var d=a.data("conditions-form");if(!d){return}var c=$("#"+d);if(!isOk(c)){LayerMsgBox.alert("树绑定data-conditions-form未找到",2);return}var b=this;c.on("submit",function(j){j.preventDefault();j.stopPropagation();if(FormChecker.check(c)){var f=a.data("orign-read-url");var h=urlWithFormData(f,c);a.data("read-url",h).attr("data-read-url",h);var i=a.jstree(true).get_selected(false);b.refresh(a,i)}return false});return c},openAll:function(b){var a=getRealJqueryObject(b);if(isOk(a)){a.jstree(true).open_all()}},closeAll:function(b){var a=getRealJqueryObject(b);if(isOk(a)){a.jstree(true).close_all()}}};AssetsLazyLoad=(function(m){var j,k,b={},f=0,i={css:[],js:[]},p=m.styleSheets,d,h;function o(s,r){var t=m.createElement(s),q;for(q in r){if(r.hasOwnProperty(q)){t.setAttribute(q,r[q])}}return t}function l(q){var s=b[q],t,r;if(s){t=s.callback;r=s.urls;r.shift();f=0;if(!r.length){t&&t.call(s.context,s.obj);b[q]=null;i[q].length&&n(q)}}}function c(){var q=navigator.userAgent;j={async:m.createElement("script").async===true};(j.webkit=/AppleWebKit\//.test(q))||(j.ie=/MSIE|Trident/.test(q))||(j.opera=/Opera/.test(q))||(j.gecko=/Gecko\//.test(q))||(j.unknown=true)}function n(C,B,D,y,t){d=new Date().getTime();var w=function(){l(C)},E=C==="css",r=[],x,z,v,s,A,q,u;j||c();if(B){B=typeof B==="string"?[B]:B.concat();if(E||j.async||j.gecko||j.opera){i[C].push({urls:B,callback:D,obj:y,context:t})}else{for(x=0,z=B.length;x<z;++x){i[C].push({urls:[B[x]],callback:x===z-1?D:null,obj:y,context:t})}}}if(b[C]||!(s=b[C]=i[C].shift())){return}k||(k=m.head||m.getElementsByTagName("head")[0]);A=s.urls.concat();for(x=0,z=A.length;x<z;++x){q=A[x];if(E){if(typeof(q)=="string"){v=j.gecko?o("style"):o("link",{href:q,rel:"stylesheet"})}else{u=q.media;if(u){v=j.gecko?o("style"):o("link",{href:q.url,media:u,rel:q.rel?q.rel:"stylesheet"})}else{v=j.gecko?o("style"):o("link",{href:q.url,rel:q.rel?q.rel:"stylesheet"})}}}else{v=o("script",{src:q});v.async=false}v.className="lazyload";v.setAttribute("charset","utf-8");if(j.ie&&!E&&"onreadystatechange" in v&&!("draggable" in v)){v.onreadystatechange=function(){if(/loaded|complete/.test(v.readyState)){v.onreadystatechange=null;w()}}}else{if(E&&(j.gecko||j.webkit)){if(j.webkit){s.urls[x]=v.href;e()}else{v.innerHTML='@import "'+q+'";';a(v)}}else{v.onload=v.onerror=w}}r.push(v)}for(x=0,z=r.length;x<z;++x){k.appendChild(r[x]);var q=A[x];if(/.js/.exec(q)){jboltlog((x+1)+"--> js成功:  "+q)}else{if(/.css/.exec(q)){jboltlog((x+1)+"--> css成功:  "+q)}else{console.log("error:  "+q)}}}h=new Date().getTime();jboltlog("执行时间: "+(h-d)+" ms  -------  end时间戳:"+h)}function a(s){var r;try{r=!!s.sheet.cssRules}catch(q){f+=1;if(f<200){setTimeout(function(){a(s)},50)}else{r&&l("css")}return}l("css")}function e(){var r=b.css,q;if(r){q=p.length;while(--q>=0){if(p[q].href===r.urls[0]){l("css");break}}f+=1;if(r){if(f<200){setTimeout(e,50)}else{l("css")}}}}return{css:function(s,t,r,q){n("css",s,t,r,q)},js:function(s,t,r,q){n("js",s,t,r,q)}}})(this.document);var ImageViewerUtil={initViewers:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["imgviewer"],function(){var c=a.length;for(var d=0;d<c;d++){b.initViewer(a.eq(d),false)}})},init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("[data-imgviewer]");if(!isOk(a)){return false}this.initViewers(a)},_initViewer:function(e){var d=e.is("img");if(d){var c=e.data("origin-url")||e.data("orign-url")||e.data("orignurl");if(c){e.viewer({navbar:false,url:"data-origin-url"})}else{e.viewer({navbar:false})}return}var a=e.is("div")||e.is("section")||e.is("p");if(a){var b=e.data("useorigin")||e.data("useorign");if(b){e.viewer({url:"data-origin-url"})}else{e.viewer()}return}this.initLinkViewerClick(e)},albumLinkViewerClick:function(h,d,i){LayerMsgBox.loading("加载中...",5000);var a=h.data("imgid");var b=h.closest(".jbolt_page");var j=b.find(".imgviewer-album[data-id='"+d+"']");if(isOk(j)){var f=j.find("img[data-album='"+d+"']");if(f.length==i.length){var m=j.find("img[data-album='"+d+"'][data-imgid='"+a+"']");if(isOk(m)){m.trigger("click");LayerMsgBox.closeLoadingNow();return}j.remove()}else{j.remove()}}var e='<div class="imgviewer-album d-none" data-id="'+d+'"><div class="data-imgviewer">';var k,c,l;i.each(function(){k=$(this);c=k.data("imgid");if(!c){c=randomId();k.data("imgid",c).attr("data-imgid",c)}l=k.data("url")||k.attr("href");e+='<img style="width:100px;height:100px" class="d-block"  src="'+l+'"  data-imgid="'+c+'"  data-album="'+d+'"/>'});e+="</div></div>";j=$(e);b.append(j);ImageViewerUtil._initViewer(j);var m=j.find("img[data-album='"+d+"'][data-imgid='"+a+"']");if(isOk(m)){m.trigger("click")}LayerMsgBox.closeLoadingNow()},initLinkViewerClick:function(b){var a=this;b.off("click").on("click",function(k){k.preventDefault();k.stopPropagation();var d=$(this);var j=d.data("url")||d.attr("href");if(!j){LayerMsgBox.alert("请给点击的元素加上data-url属性 配置图片地址",2);return}var f=d.data("album");if(f){var h=d.data("imgid");if(!h){var l=randomId();d.data("imgid",l).attr("data-imgid",l)}var i=d.closest(".jbolt_page").find("[data-imgviewer][data-album='"+f+"'][href],[data-imgviewer][data-album='"+f+"'][data-url]");var c=i.length;if(c==1){a.oneLinkViewerClick(j)}else{a.albumLinkViewerClick(d,f,i)}}else{a.oneLinkViewerClick(j)}return false})},oneLinkViewerClick:function(b){var c=new Image();c.src=b;var a=new Viewer(c,{hidden:function(){a.destroy()}});a.show()},initViewer:function(c,b){var a=this;if(b){loadJBoltPlugin(["imgviewer"],function(){a._initViewer(c)})}else{this._initViewer(c)}}};function processAutocompleteItem(e,m,l){if(typeof(l)=="undefined"){l="center"}var o="";if(!e){return"----"}if(m.indexOf(",")==-1){o=e[m];if(!o&&(o=="undefined"||o==undefined)){if(m!="text"){o=e.text||"-";if(!o&&(o=="undefined"||o==undefined)){o=e.name||"-";if(!o&&(o=="undefined"||o==undefined)){o=e.title||"-"}}}else{if(!o&&(o=="undefined"||o==undefined)){o=e.name||"-";if(!o&&(o=="undefined"||o==undefined)){o=e.title||"-"}}}}return"<span style='text-align:"+l+"'>"+o+"</span>"}var n=m.split(",");var p,f,a,c,b=l,k;for(var d in n){b=l;f=n[d];if(f.indexOf("-")!=-1){a=f.split("-");p=e[a[0]];c=a[1];if(a.length==3){k=$.trim(a[2]);if(k&&k.length>0){b=k}}if(c.indexOf("px")==-1&&c.indexOf("%")==-1){c=c+"px"}}else{p=e[f];c=null}var j=typeof(p);if(j=="undefined"){p="-"}else{if(j=="string"&&p.length==0){p="-"}}var h=c;c=c?("width:"+c+";"):"";o=o+"<span "+(h?"class='auto'":"")+" style='"+c+"text-align:"+b+"'>"+p+"</span>"}return o}function processEleUrlByLinkOtherParamEle(p,b,d,e){var j=p.data("link-para-ele"),q=null,c,h,i,m,k=false;if(j&&j!="#"){c=j.split(",");if(!isOk(c)){return b}i=j.replaceAll("_required","");var n,o,a,l;var f="";$.each(c,function(r,s){k=s.endWith("_required");if(k){m=s.replace("_required","")}else{m=s}if(m){l=jboltBody.find(m);if(isOk(l)){if(!l.is("input")&&!l.is("textarea")&&!l.is("select")){if(l[0].hasAttribute("data-radio")){n=RadioUtil.getCheckedValue(l.data("name"),l)}else{if(l[0].hasAttribute("data-checkbox")){n=CheckboxUtil.getCheckedValueToString(l.data("name"),",",l)}else{n=l.data("value")||l.data("text")||l.val()}}}else{n=l.val()}if(k&&(n==undefined||n=="")){f="关联组件["+m+"]的值不能为空<br/>";return false}a=l.data("para-name")||l.data("name")||l.attr("name")||l.attr("id");if(a){if(a.indexOf(".")!=-1){a=a.split(".")[1]}if(isOk(n)){if(q==null){q={}}q[a]=n}}}}});if(f&&f.length>0){LayerMsgBox.alert(f,2);return false}}else{q=p.data("paras")}if(q){b=urlWithJsonData(b,q)}if(d&&i){$(i).each(function(){var r=$(this);if(r.is("select")&&r.data("linkage")){r.on("linkChange",function(){if(e){e()}})}else{r.on("change",function(){if(e){e()}})}})}return b}function processJBoltTableEleUrlByLinkColumn(m,h){if(!isOk(m)){return h}var u=m.data("link-column"),f,v,d;if(u){var t=m.closest("table");if(!isOk(t)){return false}var k=t.jboltTable("inst");if(!k){return false}var b=m.closest("tr");var c=u.split(",");var n=c.length;var o=-1,l,p,e=false,j="",q,r,a;d={};for(var s=0;s<n;s++){f=c[s];e=f.endWith("_required");if(e){f=f.replace("_required","")}v=StrUtil.camel(f);o=k.columnIndexMap[f];a=k.tableListDatas[b.data("index")];p=isOk(a)?(a[v]||a[f]):null;if(e&&!isOk(p)){if(o>=0){q=k.thead.find("tr>th[data-col-index='"+o+"']");if(isOk(q)){r=q.text()}else{r=f}j="关联本行数据内列["+r+"]的值不能为空<br/>"}else{j="关联本行数据内属性["+v+"]的值不能为空<br/>"}break}d[v]=p}if(j&&j.length>0){LayerMsgBox.alert(j,2);return false}}if(d){h=urlWithJsonData(h,d)}return h}function flushAutocompleteCache(a){AutocompleteUtil.flushCache(a)}function flushTheAutocompleteCache(c){var b=getRealJqueryObject(c);var a=b.data("input-id");if(a){flushAutocompleteCache(a)}else{LayerMsgBox.alert("按钮上需要data-input-id属性指定哪个Autocomplete组件",2)}}var AutocompleteUtil={get:function(a){var b=getRealJqueryObject(a);if(!isOk(b)){return null}return b.data("acobj")},resetParamBind:function(c){var e=this.get(c);if(!isOk(e)){return}var b=e.data("url");var d=processEleUrlByLinkOtherParamEle(e,b,false);if(d){d=processJBoltTableEleUrlByLinkColumn(e,d);var a={url:d};e.setOptions(a);e.flushCache()}},changeUrl:function(c,b){var a={url:b};this.setOptions(c,a)},setOptions:function(b,a){var c=this.get(b);if(c){c.setOptions(a);c.flushCache()}else{LayerMsgBox.alert("AutocompleteUtil.changeUrl异常,获取不到autocomplete对象")}},flushCache:function(b){var a=getRealJqueryObject(b);if(isOk(a)){a.autocomplete().flushCache()}},initInputs:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["autocomplete"],function(){var c=a.length;for(var d=0;d<c;d++){b.initInput(a.eq(d),false)}})},init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("input[data-autocomplete]");if(!isOk(a)){return false}this.initInputs(a)},defaultFormat:function(b,a,c){return processAutocompleteItem(b,a,c)},processGetSyncEditor:function(c,b){var d=c.data("sync-editor-id");if(!d){return null}var h=c.data("sync-editor-type");var a=c.data("sync-attr");var e=document.createElement("input");var f=$(e);f.data("editor-id",d);f.data("editor-type",h);f.data("value-attr",a?a:b);return f},processGetAutocomplateHiddens:function(c){var b=new Array();if(c){if(c.indexOf(",")==-1){if(c.indexOf("#")==-1){b.push($("#"+c))}else{b.push($(c))}}else{var d;var a=c.split(",");for(var e in a){d=a[e];if(d.indexOf("#")==-1){b.push($("#"+d))}else{b.push($(d))}}}}return b},changeHiddenInputValue:function(c,f,d){if(!isOk(c)){return false}var i=typeof(d);if(i=="undefined"){d=""}var e=c.data("value-attr")||c.data("sync-attr");var h="";if(e){if(e=="value"){h=h+d+""}else{h=h+(f[e]||"")}}else{h=h+d+""}var a=c.data("editor-type");if(a){var b=c.data("editor-id");if(a=="neditor"){UE.getEditor(b).execCommand("insertHtml",h)}else{if(a=="summernote"){$("#"+b).summernote("code",h)}else{c.val(h).change()}}}else{c.val(h).change()}},changeHiddenInputsValue:function(a,d,c){if(isOk(a)&&isArray(a)){for(var b in a){this.changeHiddenInputValue(a[b],d,c)}}else{this.changeHiddenInputValue(a,d,c)}},clearHiddenInputsValue:function(a){if(isOk(a)){if(isArray(a)){for(var b in a){a[b].val("").change()}}else{a.val("").change()}}},processJBoltTableHandler:function(h,e,i){var c=h.data("jbolttable-handler");if(c){var j=h.closest("table");if(isOk(j)){var a=j.jboltTable("inst");if(a){var d=h.closest("td");var f=a.tableListDatas[d.closest("tr").data("index")];var b=d.data("jbolttable-handler-ischangecolumns");if(!b){a.me.processColConfigChangeColumns(a,d,e)}c(a,d,h.data("text"),i,f,e);setTimeout(function(){var l=a.me.processFocusChangeToExtraForm(a,d);if(l){var k=a.tbody.focusTd.nextTd;if(k){a.me.changeTdFocus(a,k);a.isEditableLock=false}}},100)}}}},_initInput:function(input){var url=input.data("url");var isInlineBlock=input.hasClass("d-inline-block");if(isInlineBlock){input.removeClass("d-inline-block")}var wrap=$('<div class="ac_input_box '+(isInlineBlock?"d-inline-block":"")+'"></div>');var clearBtnBox=$('<div class="closeBtnBox"><a tabindex="-1" href="javascript:void(0)" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a></div>');url=actionUrl(url);url=processEleUrlByLinkOtherParamEle(input,url,true,function(){AutocompleteUtil.resetParamBind(input)});if(!url){return false}url=processJBoltTableEleUrlByLinkColumn(input,url);if(!url){return false}var hiddenInputId=input.data("sync-ele")||input.data("hidden-input")||input.data("hiddeninput")||input.data("sync-input")||input.data("syncinput");var that=this,syncInputArray=new Array(),width=input.data("width"),height=input.data("height")||300,widthAuto=false,text_attr=input.data("text-attr"),value_attr=input.data("value-attr"),column_attr=input.data("column-attr"),formatHandler=input.data("format-handler"),handler=input.data("handler"),matchCase=input.data("match-case")||false,limit=input.data("limit");if(!limit){limit=100}if(!width){width=parseInt(input.css("width"));widthAuto=true}if(!text_attr){text_attr="text"}if(!value_attr){value_attr="value"}if(!column_attr){column_attr=text_attr}if(column_attr.indexOf(",")!=-1&&widthAuto){var arr=column_attr.split(",");var autoW=(arr.length+1)*100;if(autoW>width){width=autoW}}var hiddenInput=that.processGetAutocomplateHiddens(hiddenInputId),editor=that.processGetSyncEditor(input,value_attr);if(editor){hiddenInput.push(editor)}if(isOk(hiddenInput)){input.hiddenInput=hiddenInput}var inputId=input.attr("id");if(!inputId){inputId="autocomplate_"+randomId();input.attr("id",inputId)}input.wrap(wrap);input.after(clearBtnBox);var refresh=input.data("refresh");if(typeof(refresh)=="undefined"){refresh=false}if(refresh){var inJBoltTable=input.closest("table[data-jbolttable]");if(!isOk(inJBoltTable)){var refreshBtnBox=$('<div tooltip title="刷新缓存" class="refreshBtn input-group-append hand text-center"><span class="input-group-text"><i class="fa fa-refresh"></i></span></div>');var fg=input.closest(".ac_input_box");if(isOk(fg)){fg.addClass("input-group")}input.parent().append(refreshBtnBox);refreshBtnBox.off("click").on("click",function(e){e.preventDefault();e.stopPropagation();LayerMsgBox.loading("执行中...",2000);disposeTooltip(refreshBtnBox);input.flushCache();LayerMsgBox.success("缓存已刷新",500);return false});refreshBtnBox.tooltip({boundary:"window",container:"body"})}}var delimiter=input.data("delimiter");var textFormatHandler=input.data("text-format-handler");var mustMatch=input.data("mustmatch");if(typeof(mustMatch)=="undefined"){mustMatch=true}var align=input.data("text-align")||"center";var header=input.data("header");var ac=input.autocomplete(url,{minChars:0,width:width,scrollHeight:height,matchContains:true,autoFill:false,matchSubset:false,mustMatch:false,matchCase:matchCase,dataType:"json",max:limit,parse:function(res){var rows=[];if(!res||(!res.data)){return rows}var datas=res.data,size=datas.length,text,value,optionItem;for(var i=0;i<size;i++){optionItem=datas[i];text=processOptionTextByFormatHandler(textFormatHandler,optionItem,text_attr,delimiter);value=processOptionValue(optionItem,value_attr);rows[rows.length]={data:optionItem,value:value,result:text}}return rows},formatItem:function(row,i,max){return that.defaultFormat(row,column_attr,align)}}).result(function(e,data,value,sec){input.data("exe-result",true);clearBtnBox.show();FormChecker.checkIt(input);that.changeHiddenInputsValue(hiddenInput,data,value);if(handler){var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(input,hiddenInput,value,data)}}that.processJBoltTableHandler(input,data,value)}).bind("unmatch",function(){input.val("").change();that.clearHiddenInputsValue(hiddenInput);if(handler){var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(input,hiddenInput)}}}).blur(function(){var textasvalue=input.data("textasvalue");if(!textasvalue){clearBtnBox.show();if(isOk(hiddenInput)&&isArray(hiddenInput)){var clear=true,hinput;for(var i in hiddenInput){hinput=hiddenInput[i];if($.trim(hinput.val())){clear=false}}if(clear&&mustMatch){input.val("").change();clearBtnBox.hide()}}else{if((isOk(hiddenInput)&&hiddenInput.val()=="")){input.val("").change();clearBtnBox.hide()}}}}).on("input",function(){if(input.val()){clearBtnBox.show()}else{clearBtnBox.hide()}that.clearHiddenInputsValue(hiddenInput)});input.data("acobj",ac);if(input.val()){clearBtnBox.show()}clearBtnBox.off("click").on("click",function(e){e.preventDefault();e.stopPropagation();input.removeClass("is-valid");input.removeClass("is-invalid");var tooltipId=input.attr("aria-describedby");if(tooltipId){input.tooltip("dispose")}input.val("").change();that.clearHiddenInputsValue(hiddenInput);clearBtnBox.hide();if(handler){var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(input,hiddenInput)}}that.processJBoltTableHandler(input);return false})},initInput:function(a,d){var b=a.data("url");if(!b){LayerMsgBox.alert("autocomplete组件未设置data-url属性",2);return false}var c=this;if(d){loadJBoltPlugin(["autocomplete"],function(){c._initInput(a)})}else{c._initInput(a)}},hideResult:function(){if(mainPjaxContainer){var a=mainPjaxContainer.find("input[data-autocomplete]");if(isOk(a)){var b;a.each(function(){b=$(this).data("acresult");if(b){$("#"+b).hide()}})}}else{$("div.ac_results").hide()}}};function closeJBoltLayer(a){JBoltLayerUtil.close(a)}var JBoltLayerUtil={init:function(){var a=this;jboltBody.on("click","[data-jboltlayertrigger]",function(b){b.preventDefault();b.stopPropagation();JBoltInputUtil.hideJBoltInputLayer();JBoltTabUtil.hideJboltContextMenu();FormDate.hide();a.open($(this));return false}).on("click","[data-closejboltlayer]",function(b){b.preventDefault();b.stopPropagation();a.close();return false}).on("click",".jbolt_layer",function(c){c.preventDefault();c.stopPropagation();var b=$(this);if(!b.data("cancel-click")&&b.data("mask-close")){a.close(false,"jbolt_layer")}return false}).on("click",".jbolt_layer_portal",function(b){if(b.target.tagName.toLowerCase()!="input"){FormDate.hide()}JBoltInputUtil.hideJBoltInputLayer();b.stopPropagation()}).on("click",".jbolt_admin_main",function(b){a.close(false,"body")}).on("submit",".jbolt_layer_portal form[data-jboltlayersubmit]",function(){var c=$(this);var b=c.closest("[data-ajaxportal]");if(isOk(b)){var d=c.data("needcheck");if(typeof(d)=="boolean"&&d===true){if(FormChecker.check(c)){formSubmitToAjaxPortal(c,b)}}else{formSubmitToAjaxPortal(c,b)}}return false})},openByNav:function(b,c){var a=$("<a tabindex='-1' style='display:none;' class='openByNavTrigger' href='"+b+"'></a>");if((typeof(c.close)=="string"&&c.close=="false")||(typeof(c.close)=="boolean"&&c.close==false)){a.data("noclose",true);a.attr("data-noclose","true")}if((typeof(c.nomask)=="string"&&c.nomask=="true")||(typeof(c.nomask)=="boolean"&&c.nomask==true)){a.data("nomask",true);a.attr("data-nomask","true")}if((typeof(c.resize)=="string"&&c.resize=="true")||(typeof(c.resize)=="boolean"&&c.resize==true)){a.data("resize",true);a.attr("data-resize","true")}if(c.width){a.data("width",c.width)}if(c.dir){a.data("dir",c.dir)}if(c.confirm){a.data("confirm",c.confirm);a.attr("data-confirm",c.confirm)}if(c.height){a.data("height",c.height)}else{if(c.top){a.data("top",c.top)}}if(c.loadType){a.data("load-type",c.loadType);a.attr("data-load-type",c.loadType)}jboltBody.append(a);this.open(a)},openBy:function(a){this.open(a)},processLayerByWindowResize:function(){var e=jboltBody.find("#jbolt_layer");if(!isOk(e)){return false}var i=e.data("triggerid");if(!isOk(i)){return false}var d=jboltBody.find("#"+i);var b=e.find(".jbolt_layer_portal");var h=d.data("top");if(h&&typeof(h)=="string"&&h.indexOf("%")!=-1){var f=Number(h.replace("%",""));h=parseInt(jboltWindowHeight*f/100)}else{if(h&&typeof(h)=="string"&&h.indexOf("%")==-1){h=Number(h)}}if(!h&&h!=0){h=0}var c=0;var a=d.data("height");if(a){if(typeof(a)=="string"&&a.indexOf("%")!=-1){var f=Number(a.replace("%",""));a=parseInt(jboltWindowHeight*f/100)}else{if(typeof(a)=="string"&&a.indexOf("%")==-1){a=Number(a)}}if(h==0){h=jboltWindowHeight-a;if(h<0){h=0}}c=jboltWindowHeight-h-a;if(c<0){c=0}}b.css({top:h+"px",bottom:c+"px"})},open:function(trigger){disposeTooltip(trigger);var url=trigger.attr("href");if(!url){url=trigger.data("url")}if(!url){LayerMsgBox.alert("jboltlayertrigger未设置URL",2);return false}var checkHandler=trigger.data("check-handler");if(checkHandler){var checkResult;var exeCheck_handler=eval(checkHandler);if(exeCheck_handler&&typeof(exeCheck_handler)=="function"){checkResult=exeCheck_handler(trigger);if(!checkResult){return false}if(typeof(checkResult)!="boolean"){if(isArray(checkResult)){url=url+checkResult.join(",")}else{url=url+checkResult}}}}url=actionUrl(url);url=processEleUrlByLinkOtherParamEle(trigger,url);if(!url){return false}url=processJBoltTableEleUrlByLinkColumn(trigger,url);if(!url){return false}var keepOpen=false;var existLayer=jboltBody.find("#jbolt_layer");if(isOk(existLayer)){if(trigger[0].hasAttribute("data-keep-open")&&trigger.data("keep-open")){keepOpen=true}if(keepOpen==false){existLayer.remove()}}var triggerid=trigger.attr("id");if(!triggerid){triggerid=randomId();trigger.attr("id",triggerid)}var top=trigger.data("top");if(top&&typeof(top)=="string"&&top.indexOf("%")!=-1){var p=Number(top.replace("%",""));top=parseInt(jboltWindowHeight*p/100)}else{if(top&&typeof(top)=="string"&&top.indexOf("%")==-1){top=Number(top)}}if(!top&&top!=0){top=0}var bottom=0;var height=trigger.data("height");if(height){if(typeof(height)=="string"&&height.indexOf("%")!=-1){var p=Number(height.replace("%",""));height=parseInt(jboltWindowHeight*p/100)}else{if(typeof(height)=="string"&&height.indexOf("%")==-1){height=Number(height)}}if(top==0){top=jboltWindowHeight-height;if(top<0){top=0}}bottom=jboltWindowHeight-top-height;if(bottom<0){bottom=0}}var hasClose=true;if(trigger[0].hasAttribute("data-noclose")){hasClose=false}var noMask=trigger[0].hasAttribute("data-nomask");var width=trigger.data("width");if(width&&typeof(width)=="string"&&width.indexOf("%")!=-1){var p=Number(width.replace("%",""));width=parseInt(jboltWindowWidth*p/100)}else{if(width&&typeof(width)=="string"&&width.indexOf("%")==-1){width=Number(width)}}if(!width){width=jboltWindowWidth/2;if(width<900){width=900}else{if(width>1360){width=1360}}}trigger.data("portal-width",width);var dir=trigger.data("dir");if(!dir){dir="right";trigger.data("dir",dir)}var canResize=trigger.data("resize");var refreshMenu=trigger.data("refresh");var loadType=trigger.data("load-type")||"ajaxportal";var handler=trigger.data("handler");var callback=null;if(handler){var exe_hanlder=eval(handler);if(exe_hanlder&&typeof(exe_hanlder)=="function"){callback=exe_hanlder}}var maskClose=trigger.data("mask-close");if(typeof(maskClose)=="undefined"){maskClose=true}if(keepOpen==false){var layer;if(loadType=="ajaxportal"){layer=$('<div data-mask-close="'+maskClose+'" draggable="false" data-triggerid="'+triggerid+'" class="jbolt_layer '+(noMask?" nomask ":"")+dir+(hasClose?" hasclose ":" noclose ")+'" id="jbolt_layer">'+(canResize?"<div style='top:"+top+"px;bottom:"+bottom+"px' class='jbolt_layer_resizebox'></div><div style='top:"+(hasClose?(top+40):top)+"px;bottom:"+bottom+"px' class='jbolt_layer_resizebar'></div>":"")+'<div draggable="false" data-dir="'+dir+'" '+(refreshMenu?"data-refresh":"")+' class="jbolt_layer_portal '+(canResize?"resize":"")+'"  style="top:'+top+"px;width:"+width+"px;bottom:"+bottom+'px"   data-ajaxportal  data-url="'+url+'"></div></div>')}else{url=processUrlRqType(url,"iframe");layer=$('<div data-mask-close="'+maskClose+'" draggable="false" data-triggerid="'+triggerid+'" class="jbolt_layer '+(noMask?" nomask ":"")+dir+(hasClose?" hasclose ":" noclose ")+'" id="jbolt_layer">'+(canResize?"<div style='top:"+top+"px;bottom:"+bottom+"px' class='jbolt_layer_resizebox'></div><div style='top:"+(hasClose?(top+40):top)+"px;bottom:"+bottom+"px' class='jbolt_layer_resizebar'></div>":"")+'<div draggable="false" data-dir="'+dir+'" '+(refreshMenu?"data-refresh":"")+' class="jbolt_layer_portal '+(canResize?"resize":"")+'"  style="top:'+top+"px;width:"+width+"px;bottom:"+bottom+'px" data-url="'+url+'"><iframe frameborder="0" class="jbolt_layer_iframe"></iframe></div></div>')}jboltBody.append(layer);if(hasClose){layer.append('<a tabindex="-1" data-closejboltlayer  style="top:'+top+'px;"  class="jbolt_layer_close">&times;</a>')}if(loadType=="ajaxportal"){this.load(null,callback)}else{if(loadType=="iframe"){this.iframeLoad(url,callback)}}this.showOpenAnimate(trigger);if(canResize){this.processResizeEvent(layer,trigger)}}else{if(loadType=="ajaxportal"){this.load(url,callback)}else{if(loadType=="iframe"){this.iframeLoad(url,callback)}}}},iframeLoad:function(b,d){var c=$("#jbolt_layer");if(isOk(c)){var a=c.find(".jbolt_layer_portal>iframe");if(b){a.attr("src",b)}else{a.attr("src",a.attr("src"))}if(d){d()}}},processResizeEvent:function(c,b){var d=this,i=c.find(".jbolt_layer_portal"),h=c.find(".jbolt_layer_resizebar"),f=c.find(".jbolt_layer_resizebox"),a=b.data("dir"),e=c.find(".jbolt_layer_close");if(isOk(i)&&isOk(h)){h.on("mousedown",function(n){FormDate.hide(c);JBoltInputUtil.hideJBoltInputLayer();n.preventDefault();n.stopPropagation();c.addClass("resizing");c.data("resizing",true);c.data("cancel-click",true);c.css("cursor","e-resize");var p=i.offset(),o=getMousePos(n),j,l,k=p.left-o.x,m=Math.abs(k);if(a=="right"){j=o.x;l=0;f.css({left:j,right:l})}else{j=0;l=o.x;f.css({left:j,width:l})}return false}).on("click",function(j){j.preventDefault();j.stopPropagation();return false});c.on("mouseup",function(k){var j=c.data("resizing");if(j){k.preventDefault();k.stopPropagation();var l=getMousePos(k);d.resize(i,e,h,l.x);c.data("resizing",false);c.removeAttr("data-resizing");c.css("cursor","auto");setTimeout(function(){c.data("cancel-click",false);c.removeClass("resizing")},60);return false}}).on("mousemove",function(o){var j=c.data("resizing");if(j){o.preventDefault();o.stopPropagation();var q=i.offset(),p=getMousePos(o),k,m,l=q.left-p.x,n=Math.abs(l);if(a=="right"){k=p.x;m=0;f.css({left:k,right:m})}else{k=0;m=p.x;f.css({left:k,width:m})}return false}})}},load:function(b,d){var c=$("#jbolt_layer");if(c&&c.length==1){var a=c.find(".jbolt_layer_portal");if(b){a.ajaxPortal(true,b,true,d)}else{a.ajaxPortal(true,null,true,d)}}},close:function(c,h){var d=this;var j=$("#jbolt_layer");if(j&&j.length==1){var i=j.data("triggerid");var f=$("#"+i);if(h&&(h=="jbolt_layer"||h=="body")&&f.data("only-active-close")){FormDate.hide(j);JBoltInputUtil.hideJBoltInputLayer();JBoltTabUtil.hideJboltContextMenu();return}var b=f.attr("data-confirm");var e=(typeof(b)!="undefined");if(e&&!c){var a=f.data("confirm");if(!a){a="确认关闭?"}LayerMsgBox.confirm(a,function(){d.showCloseAnimateAndRemove(f,j)})}else{d.showCloseAnimateAndRemove(f,j)}if(f.hasClass("openByNavTrigger")){f.remove()}}FormDate.hide(j);JBoltInputUtil.hideJBoltInputLayer();JBoltTabUtil.hideJboltContextMenu()},showCloseAnimateAndRemove:function(trigger,existLayer){var layerPortal=existLayer.find(".jbolt_layer_portal");var exf=function(callback){var dir=trigger.data("dir");if(!dir){dir="right"}var layerClose=existLayer.find(".jbolt_layer_close");var resizeBar=existLayer.find(".jbolt_layer_resizebar");var portalWidth=trigger.data("portal-width");if(dir=="right"){layerPortal.css({right:-portalWidth+"px"});layerClose.hide().css({right:-portalWidth+"px"});resizeBar.hide().css({right:-portalWidth+"px",zIndex:0})}else{layerPortal.css({left:-jboltWindowWidth+"px"});layerClose.hide().css({left:-jboltWindowWidth+"px"});resizeBar.hide().css({left:-jboltWindowWidth+"px",zIndex:0})}if(callback){callback()}};var closeFunc=function(){var beforeCloseHandler=trigger.data("before-close-handler");if(beforeCloseHandler){var exeBeforeCloseHandler=eval(beforeCloseHandler);if(exeBeforeCloseHandler&&typeof(exeBeforeCloseHandler)=="function"){exeBeforeCloseHandler(trigger,layerPortal)}}exf(function(){existLayer.fadeOut(300,function(){var closeHandler=trigger.data("close-handler");if(closeHandler){var exeHandler=eval(closeHandler);if(exeHandler&&typeof(exeHandler)=="function"){exeHandler(trigger,layerPortal)}}existLayer.remove()})})};var closeCheckHandler=trigger.data("close-check-handler");if(closeCheckHandler){var exeCheckHandler=eval(closeCheckHandler);if(exeCheckHandler&&typeof(exeCheckHandler)=="function"){var result=exeCheckHandler(trigger,layerPortal);if(result){closeFunc()}}else{console.error("data-close-check-handler无效")}}else{closeFunc()}},resize:function(f,e,c,d){e.hide();c.hide().css({zIndex:0});var a=f.data("dir");if(!a){a="right"}var b=jboltWindowWidth-d;if(a=="right"){f.css("width",b);if(isOk(c)){setTimeout(function(){c.css({right:b-5,zIndex:101}).fadeIn(200)},300)}if(isOk(e)){setTimeout(function(){e.css({right:b}).fadeIn(200)},300)}}else{b=d;f.css("width",d);if(isOk(c)){setTimeout(function(){c.css({left:b-5,zIndex:101}).fadeIn(200)},300)}if(isOk(e)){setTimeout(function(){e.css({left:b}).fadeIn(200)},300)}}},showOpenAnimate:function(c){var e=$("#jbolt_layer");if(e&&e.length==1){e.fadeIn(200);var a=e.find(".jbolt_layer_portal");var h=e.find(".jbolt_layer_close");var f=e.find(".jbolt_layer_resizebar");var b=c.data("dir");if(!b){b="right"}if(e.hasClass("nomask")){e.addClass(b)}var d=c.data("portal-width");if(b=="right"){a.css({right:"0px"});if(isOk(f)){setTimeout(function(){f.css({right:d-5,zIndex:101}).fadeIn(200)},300)}if(isOk(h)){setTimeout(function(){h.css({right:d}).fadeIn(200)},300)}}else{a.css({left:"0px"});if(isOk(f)){setTimeout(function(){f.css({left:d-5,zIndex:101}).fadeIn(200)},300)}if(isOk(h)){setTimeout(function(){h.css({left:d}).fadeIn(200)},300)}}}}};function getMousePos(b){var d=b||window.event;var f=document.documentElement.scrollLeft||document.body.scrollLeft;var c=document.documentElement.scrollTop||document.body.scrollTop;var a=d.pageX||d.clientX+f;var h=d.pageY||d.clientY+c;return{x:a,y:h}}function pjaxAdminLeftNavWithIframe(a,c){LayerMsgBox.load(3);if(c&&c.hideLeftNav){hideLeftAndFullMainConainer()}else{jboltAdmin.removeClass("fullMainContainer")}a=processUrlRqType(a,"iframe");mainPjaxContainer.html('<iframe frameborder="0" src="'+a+'" class="jbolt_main_iframe"></iframe>');var b=mainPjaxContainer.find("iframe");b.on("load",function(){LayerMsgBox.closeLoadNow()}).on("error",function(){LayerMsgBox.closeLoadNow()})}function adminLeftNavshowInDialog(f,b,i){var a="80%",e="80%",d="no";if(i.width){a=i.width}if(i.height){e=i.height}if(i.btn&&i.btn=="true"){d="yes"}if(i.title){var c=$.trim(i.title);if(c&&c.length>0){f=c}}b=actionUrl(b);DialogUtil.openNewDialog({title:f,width:a,height:e,url:b,scroll:"yes",offset:"auto",btn:d})}function currentPageGo(b,a){if(jboltWithTabs){if(a){changeCurrentTabTitle(a)}JBoltTabUtil.currentTabGo(b)}else{JBoltPjaxUtil.sendPjax(b,mainPjaxContainerId)}}function pageBack(a){if(jboltWithTabs){closeCurrentAndReloadTiggerTab()}else{JBoltPjaxUtil.sendPjax(a,mainPjaxContainerId)}}var JBoltTabUtil={changeCurrentTabTitle:function(a){var b=this.getCurrentTab();if(b){this.changeTabTitle(b,a)}},changeTabTitle:function(b,c){if(b){var a=b.find("span.jb_tabtitle");if(isOk(a)){a.html(c)}}},init:function(){var a=this;a.createJboltTabContextMenu();a.initAdminLeftNavTabsEvent();a.initTabsEvent();a.initTabsTriggerEvent()},initTabsTriggerEvent:function(){var a=this;jboltBody.on("click","[data-tabtrigger]",function(i){i.preventDefault();i.stopPropagation();var b=$(this);var d=b.attr("href");if(!d){d=b.data("url")}if(!d){LayerMsgBox.alert("请指定选项卡内容加载地址",2);return}var j=b.attr("target");if(!j){j=b.data("target")}if(d&&d.indexOf("javascript")==-1){if(j&&j=="_self"){currentTabContentRedirectWithAjaxPortal(d)}else{var k=b.data("key");var l=$.trim(b.data("text")||b.data("title")||b.attr("title")||b.text()||"新标签页");var f=b.data("open-type");if(!f){f=1}var h=b.data("open-option");var c=a.getCurrentTab();if(!h||(h&&!h.hideLeftNav)){jboltAdmin.removeClass("fullMainContainer")}if(c){var m=c.data("key");switch(f){case 1:a.addJboltTab(k,d,l,m,true,f,h);break;case 2:a.addJboltTabWithIFrame(k,d,l,m,true,f,h);break}}else{switch(f){case 1:a.addJboltTab(k,d,l,null,true,f,h);break;case 2:a.addJboltTabWithIFrame(k,d,l,null,true,f,h);break}}}}})},initAdminLeftNavTabsEvent:function(){var a=this;jboltBody.on("click",".jbolt_admin_left_navs a:not([target]):not([href='javascript:void(0)'])",function(b){b.preventDefault();b.stopPropagation();a.openByType($(this))})},openByType:function(f){if(window.self!=window.top){parent.JBoltTabUtil.openByType(f)}else{var c=f.attr("href")||f.data("url");if(!c||c.indexOf("javascript")!=-1){return false}var d=f.data("key")||randomId();var e=$.trim(f.data("text")||f.data("title")||f.attr("title")||f.text()||"新标签页");var a=f.data("open-type");if(!a){a=1}var i=f.data("open-option");c=actionUrl(c);c=processEleUrlByLinkOtherParamEle(f,c);c=processJBoltTableEleUrlByLinkColumn(f,c);var b=null;var h=this.getCurrentTab();if(isOk(h)){b=h.data("key")}this.openTabWithOptions(d,c,e,b,true,a,i)}},openTab:function(d,c,f,b,e,a,h){this.openTabWithOptions(d,c,f,b,e,a,h)},openTabWithOptions:function(d,c,f,b,e,a,h){if(typeof(a)=="number"){switch(a){case 1:this.addJboltTab(d,c,f,b,e,a,h);break;case 2:this.addJboltTabWithIFrame(d,c,f,b,e,a,h);break;case 3:activeLeftNavByKey(d);adminLeftNavshowInDialog(f,c,h);break;case 4:activeLeftNavByKey(d);JBoltLayerUtil.openByNav(c,h);break;default:this.addJboltTab(d,c,f,b,e,a,h);break}}else{if(typeof(a)=="string"){switch(a){case"iframe":this.addJboltTabWithIFrame(d,c,f,b,e,a,h);break;case"dialog":activeLeftNavByKey(d);adminLeftNavshowInDialog(f,c,h);break;case"jboltlayer":activeLeftNavByKey(d);JBoltLayerUtil.openByNav(c,h);break;default:this.addJboltTab(d,c,f,b,e,a,h);break}}}},refreshJboltTab:function(a){this.showJboltTab(a,false,refreshPjaxContainer)},initTabsEvent:function(){var a=this;jboltBody.on("click","ul.jbolt_tabs>li",function(c){var b=$(this).data("key");a.showJboltTab(b,true)}).on("click","ul.jbolt_tabs>li>i.close",function(c){c.preventDefault();c.stopPropagation();var b=$(this).parent().data("key");a.closeJboltTab(b)}).on("click","#jbolt_tabbar .jbolt_tab_left",function(b){b.preventDefault();a.jboltTabToLeft()}).on("click","#jbolt_tabbar .jbolt_tab_right",function(b){b.preventDefault();b.stopPropagation();a.jboltTabToRight()}).on("click","#jboltTabContextMenu>a",function(d){d.preventDefault();d.stopPropagation();var c=$(this).data("func");var b=$(this).data("key");switch(c){case"close":JBoltTabUtil.closeJboltTab(b);break;case"closeAll":JBoltTabUtil.closeAllJboltTab();break;case"closeLeft":JBoltTabUtil.closeAllLeftJboltTab(b);break;case"closeRight":JBoltTabUtil.closeAllRightJboltTab(b);break;case"closeOther":JBoltTabUtil.closeOtherJboltTab(b);break;case"refresh":JBoltTabUtil.refreshJboltTab(b);break;case"back":JBoltTabUtil.back(b);break}a.hideJboltContextMenu();return false}).on("dblclick","ul.jbolt_tabs>li",function(c){c.preventDefault();c.stopPropagation();var b=$(this).data("key");LayerMsgBox.confirm("确认刷新此选项卡内容？",function(){a.showJboltTab(b,false,refreshPjaxContainer)})}).on("contextmenu","ul.jbolt_tabs>li",function(b){b.preventDefault();b.stopPropagation();var c=getMousePos(b);a.showTabContextmenu($(this),c);return false}).on("click","#jboltTabContextMenu",function(b){b.preventDefault();b.stopPropagation();return false}).on("click",function(){a.hideJboltContextMenu()})},createJboltTabContextMenu:function(){var b=$("#jboltTabContextMenu");if(!b||b.length==0){var a='<div id="jboltTabContextMenu" class="dropdown-menu"><span class="dropdown-item-text"><i class="fa fa-th mr-1"></i>可选操作</span><div class="dropdown-divider"></div><a tabindex="-1" class="dropdown-item d-none" data-func="back" href="javascript:void(0)"><i class="fa fa-reply mr-1"></i>返回</a><a tabindex="-1" class="dropdown-item" data-func="close" href="javascript:void(0)"><i class="fa fa-close mr-1"></i>关闭这个</a><a tabindex="-1" class="dropdown-item" data-func="refresh" href="javascript:void(0)"><i class="fa fa-refresh mr-1"></i>刷新</a><a tabindex="-1" class="dropdown-item" data-func="closeOther" href="javascript:void(0)"><i class="fa fa-window-close-o mr-1"></i>关闭其它</a><a tabindex="-1" class="dropdown-item" data-func="closeLeft" href="javascript:void(0)"><i class="fa fa-toggle-left mr-1"></i>关闭左侧</a><a tabindex="-1" class="dropdown-item" data-func="closeRight" href="javascript:void(0)"><i class="fa fa-toggle-right mr-1"></i>关闭右侧</a><a tabindex="-1" class="dropdown-item" data-func="closeAll" href="javascript:void(0)"><i class="fa fa-window-close mr-1"></i>关闭所有</a></div>';jboltBody.append(a)}},hideJboltContextMenu:function(){var a=$("#jboltTabContextMenu");if(a&&a.length==1){a.hide()}},showTabContextmenu:function(a,e){var c=$(a);var b=c.data("key");var d=$("#jboltTabContextMenu");if(!d||d.length==0){this.createJboltTabContextMenu()}d.data("key",b);d.find("a").data("key",b);d.css({top:e.y,left:e.x});if(c.data("backurl")){d.find("a[data-func='back']").removeClass("d-none")}else{d.find("a[data-func='back']").addClass("d-none")}d.show()},getCurrentTab:function(){var a=jbolt_tabs_container.find("li.active");if(a&&a.length==1){return a}return null},getCurrentTabContent:function(){var a=mainPjaxContainer.find("div.jbolt_tabcontent.active");if(a&&a.length==1){return a}return null},isJboltTabExist:function(b){var a=jbolt_tabs_container.find("li[data-key='"+b+"']");return a&&a.length==1},getTab:function(a){return jbolt_tabs_container.find("li[data-key='"+a+"']")},getTabContent:function(a){return mainPjaxContainer.find("div.jbolt_tabcontent[data-key='"+a+"']")},addJboltTabWithoutContentUrl:function(){var m=this;var k=mainPjaxContainer.find(".jbolt_page[data-key]");if(k&&k.length==1){var o=useSessionStorageToActiveTab();if(o){return}var b=k.data("key");var a=jboltAdminLeftNavs.find("a[href='"+b+"']");if(a&&a.length==1){var p=a.data("key");var r=$.trim(a.text().replace("├",""));var d=a.data("open-type");if(!d){d=1}var l=a.data("open-option");m.addJboltTabWithoutContent(p,b,r,d,l)}else{var j=k.data("text")||k.data("title");if(!j){var n=k.find(".jbolt_page_title h1");if(isOk(n)){j=n.text()}}var d=1;var l={};if(!j){var f=k.data("dontchangeleftnav");if(f){var i=jboltAdminLeftNavs.find("a[href]");if(isOk(i)){var q,h,c,e;i.each(function(){q=$(this);h=q.attr("href");c=$.trim(q.text().replace("├",""));if(b.indexOf(h)!=-1){if(!e||h.length>e){j=c;e=h.length;d=q.data("open-type");if(!d){d=1}l=q.data("open-option");return false}}})}}}if(!j){j="新标签页"}m.addJboltTabWithoutContent(p,b,j,d,l)}}},addJboltTabWithoutContent:function(c,b,d,a,e){this.openTabWithOptions(c,b,d,null,true,a,e)},initTabContextMenuEvent:function(){},addJboltTabWithIFrame:function(k,a,l,b,d,c,h){var i=this;if(h&&h.hideLeftNav){hideLeftAndFullMainConainer()}else{jboltAdmin.removeClass("fullMainContainer")}var j=i.isJboltTabExist(k);if(j){if(d){i.showJboltTab(k,true)}}else{LayerMsgBox.load(3);a=processUrlRqType(a,"iframe");b=b?b:"";jbolt_tabs_container.append('<li id="tab_'+k+'" data-key="'+k+'" data-trigger-tab-key="'+b+'"  data-url="'+a+'"><span>'+l+'</span><i class="close">&times;</i></li>');pushJBoltTabToArray(k,a,l,b,c,h);mainPjaxContainer.append('<div class="jbolt_tabcontent" id="tab_content_'+k+'"   data-key="'+k+'" data-trigger-tab-key="'+b+'" data-url="'+a+'"><iframe frameborder="0" src="'+a+'" class="jbolt_main_iframe"></iframe></div>');if(d){i.showJboltTab(k)}i.jboltTabToRight();var f="#tab_content_"+k+">iframe";var e=mainPjaxContainer.find(f);e.on("load",function(){LayerMsgBox.closeLoadNow()}).on("error",function(){LayerMsgBox.closeLoadNow()})}},addJboltTab:function(j,a,k,b,d,c,e){if(typeof(d)=="undefined"){d=true}var f=this;if(!isOk(k)){k="新标签页"}var i=f.isJboltTabExist(j);if(i){if(d){f.showJboltTab(j,true)}}else{a=actionUrl(a);b=b?b:"";jbolt_tabs_container.append('<li id="tab_'+j+'" data-key="'+j+'" data-trigger-tab-key="'+b+'" data-url="'+a+'"><span class="jb_tabtitle">'+k+'</span><i class="close">&times;</i></li>');pushJBoltTabToArray(j,a,k,b,c,e);mainPjaxContainer.append('<div class="jbolt_tabcontent" id="tab_content_'+j+'" data-trigger-tab-key="'+b+'" data-ajaxportal data-key="'+j+'" data-url="'+a+'"></div>');var h=mainPjaxContainer.find("div#tab_content_"+j);h.ajaxPortal(true,null,true,function(){f.changeTabTitleByPortalPageSet(h,j)});if(d){f.showJboltTab(j)}f.jboltTabToRight()}},changeTabTitleByPortalPageSet:function(d,b){var a=d.find(".jbolt_page[data-title]");if(isOk(a)){var c=a.data("title")||a.data("text");if(c){this.changeCurrentTabTitle(c)}}},hideAllJboltTab:function(){jbolt_tabs_container.find("li.active").removeClass("active");mainPjaxContainer.find("div.jbolt_tabcontent.active").removeClass("active")},changeUrlByContentPortal:function(){var c=this.getCurrentTab();var b=this.getCurrentTabContent();var a=b.data("url");c.data("url",a)},changeUrl:function(a){var c=this.getCurrentTab();var b=this.getCurrentTabContent();if(c&&c.length==1){a=actionUrl(a);c.data("url",a);b.data("url",a);c.attr("data-url",a);b.attr("data-url",a)}},currentTabGo:function(b,d){var e=this.getCurrentTab();if(isOk(e)){var c=this.getCurrentTabContent();b=actionUrl(b);if(isOk(d)){b=urlWithJsonData(b,d)}var a=e.data("url");e.data("url",b);e.data("backurl",a);e.attr("data-backurl",a);c.attr("data-url",b);c.data("url",b);e.attr("data-url",b);c.ajaxPortal(true,b,true)}},showJboltTab:function(e,c,h){JBoltInputUtil.hideJBoltInputLayer();JBoltTabUtil.hideJboltContextMenu();closeJBoltLayer();var f=this;var a=jbolt_tabs_container.find("li#tab_"+e);if(a&&a.length==1){var b=a.hasClass("active");if(!b){f.hideAllJboltTab();a.addClass("active");var d=mainPjaxContainer.find("div#tab_content_"+e);d.addClass("active");activeLeftNavByKey(e);processAutoRefreshTabContent(d)}if(c){f.changeTabLocation()}if(h){h()}activeJBoltTabFromArray(e)}},showFirstLeftNavTab:function(){var e=jboltAdminLeftNavs.find("a[data-hasurl]").first();if(e&&e.length==1){var b=e.attr("href");if(b&&b.indexOf("javascript")==-1){var c=e.data("key");var d=e.text().replace("├","");var a=e.data("open-type");if(!a){a=1}var f=e.data("open-option");this.openTabWithOptions(c,b,d,null,true,a,f)}}},getTabCount:function(){var a=jbolt_tabs_container.find("li");if(a&&a.length>0){return a.length}return 0},close:function(a){this.closeJboltTab(a.data("key"))},closeCurrentTab:function(){var a=this.getCurrentTab();if(isOk(a)){this.close(a)}},back:function(d){var e=this;var b=jbolt_tabs_container.find("li#tab_"+d);if(b&&b.length==1){var c=b.data("backurl");if(c){b.data("url",c);b.attr("data-url",c);e.showJboltTab(d);var a=mainPjaxContainer.find("div#tab_content_"+d);if(isOk(a)){a.data("url",c);a.attr("data-url",c);b.data("backurl","");b.removeAttr("data-backurl");a.data("backurl","");a.removeAttr("data-backurl");a.ajaxPortal(true,c,true)}}}},closeJboltTab:function(c){var e=this;var b=jbolt_tabs_container.find("li#tab_"+c);if(b&&b.length==1){var f=b.hasClass("active");if(f){e.changeToBrotherTab(b)}b.remove();var a=mainPjaxContainer.find("div#tab_content_"+c);if(isOk(a)){AjaxPortalUtil.triggerPortalJBoltPageCloseHandler(a);a.remove()}removeJBoltTabFromArray(c);var d=e.getTabCount();if(d==0){e.showFirstLeftNavTab()}if(!f){e.changeTabLocation()}}},closeOtherJboltTab:function(e){var f=this;f.showJboltTab(e);var d=jbolt_tabs_container.find("li:not(#tab_"+e+")");if(d&&d.length>0){var b,c,a;d.each(function(){b=$(this);c=b.data("key");b.remove();a=mainPjaxContainer.find("div#tab_content_"+c);if(isOk(a)){AjaxPortalUtil.triggerPortalJBoltPageCloseHandler(a);a.remove()}removeJBoltTabFromArray(c)})}},closeAllJboltTab:function(){jbolt_tabs_container.empty();var a=mainPjaxContainer.find(".jbolt_page[data-close-handler]");if(isOk(a)){var b=a.length;var d;for(var c=0;c<b;c++){d=a.eq(c);AjaxPortalUtil.triggerPortalJBoltPageCloseHandler(mainPjaxContainer,d)}}mainPjaxContainer.empty();jbolt_tabs_array=[];this.showFirstLeftNavTab()},closeAllLeftJboltTab:function(f){var d=this;var j=jbolt_tabs_container.find("li#tab_"+f);var i=j.prevAll("li");var e=j.hasClass("active");var c=false;if(i&&i.length>0){var h,a,b;i.each(function(){h=$(this);a=h.data("key");if(h.hasClass("active")){c=true}h.remove();b=mainPjaxContainer.find("div#tab_content_"+a);if(isOk(b)){AjaxPortalUtil.triggerPortalJBoltPageCloseHandler(b);b.remove()}removeJBoltTabFromArray(a)})}if(!e&&c){d.showJboltTab(f)}},closeAllRightJboltTab:function(f){var d=this;var j=jbolt_tabs_container.find("li#tab_"+f);var i=j.nextAll("li");var e=j.hasClass("active");var c=false;if(i&&i.length>0){var h,a,b;i.each(function(){h=$(this);a=h.data("key");if(h.hasClass("active")){c=true}h.remove();b=mainPjaxContainer.find("div#tab_content_"+a);if(isOk(b)){AjaxPortalUtil.triggerPortalJBoltPageCloseHandler(b);b.remove()}removeJBoltTabFromArray(a)})}if(!e&&c){d.showJboltTab(f)}},changeToBrotherTab:function(a){var e=this;var b=a.prev();var d=b&&b.length==1;if(!d){b=a.next();d=b&&b.length==1}if(d){var c=b.data("key");e.showJboltTab(c)}else{e.showFirstLeftNavTab()}},checkCanToLeft:function(){var b=jbolt_tabbar.width();var a=jbolt_tabs_container.outerWidth();if(a>b){var d=Math.abs(parseInt(jbolt_tabs_container.css("margin-left")));var c=Math.abs(parseInt(b-a));if(d<c){return true}}return false},checkCanToRight:function(){var a=Math.abs(parseInt(jbolt_tabs_container.css("margin-left")));return a!=0},jboltTabToLeft:function(){jbolt_tabs_container.css("margin-left","0px")},jboltTabToRight:function(){var f=jbolt_tabbar.width();var d=jbolt_tabs_container.outerWidth();if(d>f){var b=(f/2)-d;var e=null;var a=0;var c=Math.abs(b);jbolt_tabs_container.find("li").each(function(){b=a*-1;a=a+$(this).outerWidth();if(a>=c){return false}});jbolt_tabs_container.css("margin-left",b+"px")}},changeTabLocation:function(){var e=this;var h=jbolt_tabbar.width();var d=jbolt_tabs_container.outerWidth();if(d>h){var b=e.getCurrentTab();var j=Math.abs(parseInt(jbolt_tabs_container.css("margin-left")));var f=0;var c=0;jbolt_tabs_container.find("li").each(function(){var k=$(this);c=c+k.outerWidth();if(k.data("key")==b.data("key")){return false}else{f=f+k.outerWidth()}});if(j==0){if(f<=h){}else{var i=f*-1;jbolt_tabs_container.css("margin-left",i+"px")}}else{if(c<=h){e.jboltTabToLeft()}else{var a=(h/2)-d;var i=f*-1;if(f>Math.abs(parseInt(a))){e.jboltTabToRight()}else{jbolt_tabs_container.css("margin-left",i+"px")}}}}else{e.jboltTabToLeft()}}};function pushJBoltTabToArray(d,c,e,b,a,f){if(jboltWithTabs){if(!a){a=1}jbolt_tabs_array.push({key:d,url:c,text:e,openType:a,openOptions:f,triggerTabKey:b});sessionStorage.setItem("jbolt_tabs_array",JSON.stringify(jbolt_tabs_array))}}function activeJBoltTabFromArray(a){if(jboltWithTabs&&isOk(jbolt_tabs_array)){JBoltArrayUtil.changeItemsAttrValue(jbolt_tabs_array,"active",false);JBoltArrayUtil.changeOneItemOtherAttrValueByAttr(jbolt_tabs_array,"key",a,"active",true);sessionStorage.setItem("jbolt_tabs_array",JSON.stringify(jbolt_tabs_array))}}function removeJBoltTabFromArray(a){if(jboltWithTabs&&isOk(jbolt_tabs_array)){JBoltArrayUtil.removeObjectByAttr(jbolt_tabs_array,"key",a);sessionStorage.setItem("jbolt_tabs_array",JSON.stringify(jbolt_tabs_array))}}function clearJBoltTabFromArray(){if(jboltWithTabs&&isOk(jbolt_tabs_array)){jbolt_tabs_array=[];sessionStorage.removeItem("jbolt_tabs_array")}}function initJBoltTabsFromSessionStorage(){if(jboltWithTabs&&JBoltTabKeepAfterReload){var d=sessionStorage.getItem("jbolt_tabs_array");var a;if(isOk(d)){a=JSON.parse(d)}if(isOk(a)&&isArray(a)){var c,e;for(var b in a){c=a[b];if(typeof(c.active)=="boolean"&&c.active){e=c.key}JBoltTabUtil.openTabWithOptions(c.key,c.url,c.text,c.triggerTabKey,false,c.openType,c.openOptions)}if(e){JBoltTabUtil.showJboltTab(e)}}}}function formToJson(a){var b=getRealJqueryObject(a);if(isOk(b)){return b.serializeJSON()}return null}(function(a){a.fn.extend({toggleContent:function(c){var b=this.html();if(b&&b>0){this.html("")}else{this.html(c)}}})})(jQuery);(function(a){a.fn.extend({formToggleDisabled:function(){var b=this.find("input,select,textarea,.form-control");if(isOk(b)){a.each(b,function(c,d){if(d.disabled){d.disabled=false}else{d.disabled=true}})}},formDisabled:function(){var b=this.find("input,select,textarea,.form-control");if(isOk(b)){a.each(b,function(c,d){if(!d.disabled){d.disabled=true}})}this.addClass("disabled")},formEnable:function(){var b=this.find("input,select,textarea,.form-control");if(isOk(b)){a.each(b,function(c,d){if(d.disabled){d.disabled=false}})}this.removeClass("disabled")},formSetJsonVal:function(f,c){this[0].reset();var h=this;if(!isOk(f)){var e,i,j;this.find("img[data-switchbtn][data-name]").data("value","false").each(function(){i=a(this);e=i.data("name");j="false";SwitchBtnUtil.set(e,j,h)})}var b=this.find("input[name]:not([data-switchbtn-hidden]),select[name],textarea[name],.form-control[name],[data-column][name],img[data-switchbtn][data-name]");if(isOk(b)){if(!isOk(f)){b.each(function(){removeFormEleAllStyle(a(this))});return}var e,i,j,d;a.each(b,function(k,l){j=null;d=l.tagName;i=a(l);removeFormEleAllStyle(i);e=l.name||i.data("column")||i.data("name");if(e){if(f.hasOwnProperty(e)){j=f[e]}if(c){j=c(i,f,e,j)}if(typeof(j)=="undefined"||j==null){j=""}if(isFormEle(d)){if(d=="INPUT"&&(l.type=="checkbox"||l.type=="radio")){if(l.value==j){i.trigger("click")}}else{if(l.hasAttribute("data-date")){l.value=j}else{i.val(j)}i.trigger("change")}}else{if(d=="IMG"){SwitchBtnUtil.set(e,j,h)}else{i.html(j)}}}})}}})})(jQuery);function formToggleDisabled(a){var b=getRealJqueryObject(a);if(isOk(b)){b.formToggleDisabled()}}function formDisabled(a){var b=getRealJqueryObject(a);if(isOk(b)){b.formDisabled()}}function formEnable(a){var b=getRealJqueryObject(a);if(isOk(b)){b.formEnable()}}function formSetJsonVal(b,c,a){var d=getRealJqueryObject(b);if(isOk(d)){d.formSetJsonVal(c,a)}}function getRandomInt(b,a){return Math.floor(Math.random()*(a-b+1))+b}function randomId(a){if(!a){a=8}var d="";var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var c=0;c<a;c++){d+=b.charAt(Math.floor(Math.random()*b.length))}return d}var formEleArray=["INPUT","SELECT","TEXTAREA"];function isFormEle(a){return $.inArray(a,formEleArray)>=0}var SwitchBtnUtil={initBtn:function(h){var k=h.data("value");if(!k||k=="null"||k=="undefined"){k=false}else{k=true}var b=h.data("style");if(!b){b="default"}var a="assets/img/switch/"+b+"/"+(k?"on":"off")+".png";h.attr("src",a);h.data("value",k).attr("data-value",k);var c=h.data("name")||h.attr("name");if(c){var d=h.data("hiddeninput");var f=d?jboltBody.find("#"+d):jboltBody.find("input[name='"+c+"']");if(!isOk(f)){f=$('<input type="hidden" name="'+c+'" value="'+k+'"/>');h.after(f)}f.data("switchbtn-hidden",true).attr("data-switchbtn-hidden",true)}var l=h.data("text");if(l&&l.indexOf(":")!=-1){var j=l.split(":");h.trueText='<i class="text-success font-normal">'+j[0]+"</i>";h.falseText='<i class="text-danger font-normal">'+j[1]+"</i>";var i=h.nextAll("span.linktext");if(!isOk(i)){var e=$('<span class="linktext d-inline-block px-1">'+(k?h.trueText:h.falseText)+"</span>");h.after(e)}}},setByCss:function(k,m,p,f){var n=getRealParentJqueryObject(p);if(!isOk(n)){return}var j=n.find(k);if(!isOk(j)){return}m=m+"";var b=j.data("value")+"";if(m!=b){j.data("nochange",f);j.trigger("click")}else{if(m=="false"&&b=="false"){var c=j.data("style");if(!c){c="default"}var a="assets/img/switch/"+c+"/off.png";j.attr("src",a);j.data("value",m).attr("data-value",m);var e=j.data("hiddeninput");var i=e?jboltBody.find("#"+e):jboltBody.find("input[name='"+name+"']");if(isOk(i)){i.val(m)}var o=j.data("text");if(o&&o.indexOf(":")!=-1){var l=o.split(":");var d='<i class="text-danger font-normal">'+l[1]+"</i>";var h=j.nextAll(".linktext");if(isOk(h)){h.html(d)}}}}},set:function(a,f,d,c,e){var b="img[data-switchbtn][data-name~='"+a+"']";if(c){b=b+c}this.setByCss(b,f,d,e)},initEvent:function(){var a=this;jboltBody.on("click","img[data-switchbtn]",function(j){var f=$(this);j.preventDefault();j.stopPropagation();var i=f.data("doing");if(i){return false}var b=f.data("disabled");if(b){var h=f.data("disabled-msg");LayerMsgBox.alert(h?h:"无权操作",2);f.data("doing",false);return false}i=true;f.data("doing",true);var d=f.data("url");var c=f.data("confirm");if(d){if(c){LayerMsgBox.confirm(c,function(){a.switchIt(f)},function(){f.data("doing",false)})}else{a.switchIt(f)}}else{if(c){LayerMsgBox.confirm(c,function(){a.switchSuccessHandler(f)},function(){f.data("doing",false)})}else{a.switchSuccessHandler(f)}}})},initBtns:function(d){if(!isOk(d)){return false}var c=this,a=d.length;for(var b=0;b<a;b++){c.initBtn(d.eq(b))}},init:function(d){var c=this;var a=getRealParentJqueryObject(d);if(!isOk(a)){return false}var b=a.find("img[data-switchbtn]");if(!isOk(b)){return false}c.initBtns(b)},switchIt:function(b){var c=this;var a=b.data("url");LayerMsgBox.loading("正在执行...",10000);a=actionUrl(a);a=processEleUrlByLinkOtherParamEle(b,a);a=processJBoltTableEleUrlByLinkColumn(b,a);$.ajax({type:"post",url:a,timeout:10000,dataType:"json",success:function(d){if(d.state=="ok"){c.switchSuccessHandler(b,d.data)}else{b.data("doing",false);if(d.msg&&d.msg=="jbolt_system_locked"){showJboltLockSystem()}else{if(d.msg&&d.msg=="jbolt_nologin"){showReloginDialog()}else{if(d.msg&&d.msg=="jbolt_terminal_offline"){showReloginDialog();LayerMsgBox.alert("当前用户已在其它终端登录，本机已下线",2)}else{LayerMsgBox.alert(d.msg,2)}}}}},error:function(){b.data("doing",false);LayerMsgBox.alert("操作失败",2)}})},processJBoltTableFixedColumnSameSwitchBtn:function(j){var c=j.closest("table.jbolt_table");if(!isOk(c)){return false}var e=c.closest(".jbolt_table_view");if(!isOk(e)){return false}var b=j.closest(".jbolt_table_fixed");var f=isOk(b);var a=j.attr("src");var i=j.closest("td");var o=i.index();var m=j.closest("tr");var h=m.index();var n=i.data("col-index");var l;if(f){var d=e.find(".jbolt_table_box>.jbolt_table_body:first>table");if(!isOk(d)){return false}l=d.find("tbody>tr:eq("+h+")>td[data-col-index='"+n+"']")}else{var k=e.find(".jbolt_table_fixed>.jbolt_table_body>table");if(!isOk(k)){return false}l=k.find("tbody>tr:eq("+h+")>td[data-col-index='"+n+"']")}if(isOk(l)){l.find("img[data-switchbtn]").attr("src",a)}},switchMainJBoltTableEditableTd:function(){},switchEditableTd:function(b,a){var f=b.closest("td");if(!isOk(f)){LayerMsgBox.alert("switchEditableTd这个handler只能在jbolttable的可编辑表格里用[1]",2);return false}var e=f.closest("tr");var d=e.closest("table");var c=d.jboltTable("inst");if(!c){LayerMsgBox.alert("switchEditableTd这个handler只能在jbolttable的可编辑表格里用[2]",2);return false}c.me.processSwitchBtnTd(c,f,b,a)},switchSuccessHandler:function(_btn,onOrOff){var that=this;var src=_btn.attr("src");var handler=_btn.data("handler");var on=src.indexOf("off")!=-1;if(onOrOff==undefined){if(src.indexOf("off")!=-1){src=src.replace("off","on");_btn.attr("data-value",true).data("value",true)}else{src=src.replace("on","off");_btn.attr("data-value",false).data("value",false)}}else{if(typeof(onOrOff)=="boolean"){if(onOrOff){if(src.indexOf("off")!=-1){src=src.replace("off","on")}}else{if(src.indexOf("on")!=-1){src=src.replace("on","off")}}_btn.attr("data-value",onOrOff).data("value",onOrOff)}else{if(src.indexOf("off")!=-1){src=src.replace("off","on");_btn.attr("data-value",true).data("value",true)}else{src=src.replace("on","off");_btn.attr("data-value",false).data("value",false)}}}_btn.attr("src",src);if(!_btn.hiddenInput){var name=_btn.data("name");var hiddenId=_btn.data("hidden-input")||_btn.data("hiddeninput");var hiddenInput=hiddenId?jboltBody.find("#"+hiddenId):jboltBody.find("input[name='"+name+"']");if(isOk(hiddenInput)){_btn.hiddenInput=hiddenInput}}if(_btn.hiddenInput){_btn.hiddenInput.val(on).trigger("change")}if(!_btn.linkText){var text=_btn.data("text");if(text&&text.indexOf(":")!=-1){var tta=text.split(":");_btn.trueText='<i class="text-success font-normal">'+tta[0]+"</i>";_btn.falseText='<i class="text-danger font-normal">'+tta[1]+"</i>";var btnLinkText=_btn.nextAll(".linktext");if(isOk(btnLinkText)){_btn.linkText=btnLinkText}}}if(_btn.linkText){_btn.linkText.html(on?_btn.trueText:_btn.falseText)}var setvalueto=_btn.data("setvalueto");if(setvalueto){var eleObjs=$(setvalueto);if(isOk(eleObjs)){var eleObj,ele,tagName;eleObjs.each(function(){ele=this;eleObj=$(ele);tagName=ele.tagName;if(isFormEle(tagName)){if(tagName=="INPUT"&&(ele.type=="checkbox"||ele.type=="radio")){if(on){if(!ele.checked){ele.checked=true;eleObj.attr("checked","checked");eleObj.trigger("change")}}else{if(ele.checked){ele.checked=false;eleObj.removeAttr("checked");eleObj.trigger("change")}}}else{eleObj.val(on).trigger("change")}}else{eleObj.text(on)}})}}this.processJBoltTableFixedColumnSameSwitchBtn(_btn);LayerMsgBox.closeLoadingNow();if(handler&&!_btn.data("nochange")){if(handler=="switchEditableTd"){that.switchEditableTd(_btn,on);if(_btn.data("nomsg")){_btn.data("doing",false)}else{LayerMsgBox.success("操作成功",300,function(){_btn.data("doing",false)})}}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){if(_btn.data("nomsg")){exe_handler(_btn);_btn.data("doing",false)}else{LayerMsgBox.success("操作成功",300,function(){exe_handler(_btn);_btn.data("doing",false)})}}else{if(_btn.data("nomsg")){_btn.data("doing",false)}else{LayerMsgBox.success("操作成功",300,function(){_btn.data("doing",false)})}}}}else{if(_btn.data("nomsg")){_btn.data("doing",false)}else{LayerMsgBox.success("操作成功",300,function(){_btn.data("doing",false)})}}if(_btn.data("nochange")){_btn.data("nochange",false)}}};var CheckboxUtil={processHiddenInput:function(b,d,a){var c=this.getCheckedValueToString(b,",",a);$("#"+d).val(c).change()},initCheckBoxEvent:function(ck,name,hiddenInputId,handler){var that=this;if(handler){if(handler=="processHiddenInput"){if(hiddenInputId){that.processHiddenInput(name,hiddenInputId,ck)}else{LayerMsgBox.alert("请checkbox组件设置对应隐藏域data-hidden-input",2)}}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){ck.find("input[type='checkbox'][name='"+name+"']").unbind("change").on("change",function(){var input=$(this);var values=that.getCheckedValueToString(name,",",ck);if(hiddenInputId){$("#"+hiddenInputId).val(values).change()}exe_handler(ck,values,input,input.is(":checked"))})}}}else{if(hiddenInputId){ck.find("input[type='checkbox'][name='"+name+"']").unbind("change").on("change",function(){that.processHiddenInput(name,hiddenInputId,ck)})}}},initCheckboxs:function(b){if(!isOk(b)){return false}var a=b.length;for(var c=0;c<a;c++){this.initCheckbox(b.eq(c))}},initCheckbox:function(k){var d=this,l=k.data("handler"),a=k.data("name"),j=k.data("value")+"",f=k.data("default")+"",c=k.data("hidden-input")||k.data("hiddeninput"),b=k.data("url"),i=k.data("label"),e=k.data("options");if(b){d.insertDatas(k,b,a,i,function(){d.initCheckBoxEvent(k,a,c,l);d.setChecked(k,a,j,f);d.processDisabled(k)})}else{var h=function(){var m=k.find(".checkbox-inline");if(m){d.processCheckboxAlignAndWidth(k)}d.initCheckBoxEvent(k,a,c,l);d.setChecked(k,a,j,f);d.processDisabled(k)};if(isOk(e)){d.insertDatas(k,e,a,i,h,true)}else{h()}}},processDisabled:function(c){var a=c[0].hasAttribute("data-disabled");if(a){var e=c.data("disabled");if(!(typeof(e)=="undefined")&&(e+"")!="false"){var d=c.data("name");var b=c.find("input[type='checkbox'][name='"+d+"']");b.attr("disabled","disabled")}}},init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("[data-checkbox]");if(!isOk(a)){return false}this.initCheckboxs(a)},insertDatas:function(o,j,C,n,k,h){var m=this;o.empty();var w=o.data("width");var z="";var q="";if(w){var a=w.split(",");z=a[0];q=a[1]}else{z="col-sm-2";q="col"}var p="";if(n){var f=(o.data("rule")&&(!o.data("notnull")));if(z.indexOf("px")!=-1){p='<label class="col-12 col-sm-auto col-form-label '+(f?"is_required":"")+'" style="width:'+z+'">'+n+"</label>"}else{p='<label class="'+z+" col-form-label "+(f?"is_required":"")+'">'+n+"</label>"}}var e="";var v=o.data("inline");var u=o.data("item-min-width");if(u){if(typeof(u)=="number"){u=u+"px"}}else{u="60px"}if(v){e="checkbox-inline"}var s=o.data("text-attr");if(!s){s="text"}var B=o.data("value-attr");if(!B){B="value"}var A=o.data("delimiter");var l=o.data("text-format-handler");var y=function(G){var L=C.replace("\\.","_");if(G&&G.length>0){p+='<div class="'+q+'"  style="padding-top: 1px;">';var K,J,H,F,I=randomId();for(var D in G){K=G[D];J=processOptionTextByFormatHandler(l,K,s,A);H=processOptionValue(K,B);F=L+"_"+I+"_"+D;var E="<div "+(v?'style="min-width:'+(u)+';"':"")+' class="checkbox checkbox-primary '+e+'"><input  id="'+F+'" type="checkbox" name="'+C+'" value="'+H+'"/><label for="'+F+'">'+J+"</label></div>";p+=E}p+="</div>";o.html(p);if(v){m.processCheckboxAlignAndWidth(o)}}else{p+='<div class="'+q+'"  style="padding-top: 1px;"></div>';o.html(p)}if(k){k()}};if(h){if(j){var t;if(!isArray(j)){var d;if(j.indexOf(",")!=-1){d=j.split(",")}else{d=[d]}if(isOk(d)){var r,b,c;t=new Array();for(var x in d){r=d[x];if(r.indexOf(":")!=-1){b=r.split(":");if(isOk(b)){if(b.length>=2){c={name:b[0],value:b[1]}}else{c={name:b[0],value:b[0]}}}}else{c={name:r,value:r}}if(c){t.push(c)}}}}else{t=j}y(t)}}else{Ajax.get(j,function(i){y(i.data)})}},processCheckboxAlignAndWidth:function(c){var e=c.data("align-left");if(e){var d=c.find(".checkbox.checkbox-inline");if(isOk(d)){var a=0,b;d.each(function(){b=$(this).outerWidth();if(b>a){a=b}});d.css({width:a+"px","max-width":a+"px"})}}},checkByArray:function(h,c,b){var f=this;if(!isOk(b)){f.uncheckAll(c,h);return false}if(typeof(b)=="string"&&b=="all"){f.checkAll(c,h);return true}if(!isArray(b)){b=b.toString();if(b.indexOf(",")!=-1){b=b.split(",");if(!isOk(b)){f.uncheckAll(c,h);return false}}else{b=[b]}}var e=getRealParentJqueryObject(h);var a;for(var d in b){a=e.find("input[type='checkbox'][name='"+c+"'][value='"+b[d]+"']");if(isOk(a)){a[0].checked=true;a.attr("checked","checked")}}},setChecked:function(d,b,e,a){if(e!=undefined&&e!="undefined"&&e!=""){if(!isArray(e)){e=e+""}}else{e=""}if(a!=undefined&&a!="undefined"&&a!=""){if(!isArray(a)){a=a+""}}else{a=""}var c=this;if(e){c.checkByArray(d,b,e)}else{if(a||a==0||a=="0"){c.checkByArray(d,b,a)}}},checkIt:function(a){$(a).each(function(){if(!this.checked){$(this).prop("checked",true).change()}})},uncheckIt:function(a){$(a).each(function(){if(this.checked){$(this).prop("checked",false).change()}})},checkAll:function(a,c){var b=getRealParentJqueryObject(c);b.find("input[type='checkbox'][name='"+a+"']:not(:checked):not(:disabled)").prop("checked",true).change()},uncheckAll:function(a,c){var b=getRealParentJqueryObject(c);b.find("input[type='checkbox'][name='"+a+"']:checked:not(:disabled)").prop("checked",false).change()},convertCheckAll:function(a,e){var d=getRealParentJqueryObject(e);var c=d.find("input[type='checkbox'][name='"+a+"']:checked:not(:disabled)");var b=d.find("input[type='checkbox'][name='"+a+"']:not(:checked):not(:disabled)");if(isOk(c)){c.prop("checked",false).change()}if(isOk(b)){b.prop("checked",true).change()}},getCheckedValue:function(b,e,a){var d=new Array(),f;var c=getRealParentJqueryObject(e);if(a){f=c.find("input[type='checkbox'][name='"+b+"']:checked:not(:disabled)")}else{f=c.find("input[type='checkbox'][name='"+b+"']:checked")}if(isOk(f)){f.each(function(h){d.push($(this).val())})}return d},getCheckedValueToString:function(c,d,h,b){var f=this,a;var e=f.getCheckedValue(c,h,b);if(isOk(e)){a=e.join(d?d:",")}return a},getCheckedTextToString:function(d,e,h,c){var f=this,a;var b=f.getCheckedText(d,h,c);if(isOk(b)){a=b.join(e?e:",")}return a},getCheckedText:function(d,f,b){var a=new Array(),h;var e=getRealParentJqueryObject(f);if(b){h=e.find("input[type='checkbox'][name='"+d+"']:checked:not(:disabled)")}else{h=e.find("input[type='checkbox'][name='"+d+"']:checked")}if(isOk(h)){var c;h.each(function(j){c=h.eq(j).parent().find("label");if(isOk(c)){a.push(c.text())}})}return a}};var HtmlEditorUtil={ing:false,initEditors:function(h){if(!isOk(h)){return false}var c=this,e=h.length;if(e>0){var l=new Array();var a=new Array();var j,d;for(var b=0;b<e;b++){d=h.eq(b);j=d.data("editor");if(j=="summernote"){a.push(d)}else{if(j=="neditor"){l.push(d)}}}var f=l.length;var k=a.length;if(f>0){loadJBoltPlugin(["neditor"],function(){for(var m=0;m<f;m++){c.initEditor(l[m])}})}if(k>0){loadJBoltPlugin(["summernote"],function(){for(var m=0;m<k;m++){c.initEditor(a[m])}})}}},init:function(c){var a=getRealParentJqueryObject(c);if(!isOk(a)){return false}var b=jboltBody.find("[data-editor]");if(!isOk(b)){return false}this.ing=false;this.initEditors(b)},initNEditor:function(u){var c=this;var m=u.attr("id");if(!m){m="neditor_"+randomId(6);u.attr("id",m)}var o=u.data("imgmaxsize")||200;o=o*1024;var n=u.data("videomaxsize")||10;n=n*1024*1024*1024;var e=u.data("wordcount")||false;var h=u.data("elementpathenabled")||false;var f=u.data("maximumwords")||10000;var r=u.data("autoheightenabled")||false;var l=u.data("catchremoteimageenable")||false;var p=u.data("toolbar")||"normal";var j;if(p=="normal"){j=[["source","undo","redo","bold","italic","underline","strikethrough","fontborder","indent","superscript","subscript","justifyleft","justifyright","justifycenter","justifyjustify","forecolor","backcolor","removeformat","formatmatch","autotypeset","touppercase","tolowercase","fontfamily","fontsize","paragraph","customstyle","searchreplace","blockquote","pasteplain","selectall","cleardoc","link","unlink","emotion","spechars","insertorderedlist","insertunorderedlist","horizontal","date","time","insertimage","wordimage","imagenone","imageleft","imageright","imagecenter","lineheight","map","insertvideo","insertcode","inserttable","edittable","edittd","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","deletecaption","inserttitle","mergecells","deletetable","insertparagraphbeforetable","directionalityltr","directionalityrtl","rowspacingtop","rowspacingbottom","background","template","scrawl","drafts","print","preview","help","fullscreen"]]}else{if(p=="simple"){j=[["undo","redo","bold","italic","underline","strikethrough","fontborder","indent","superscript","subscript","justifyleft","justifyright","justifycenter","justifyjustify","forecolor","backcolor","removeformat","formatmatch","autotypeset","touppercase","tolowercase","fontfamily","fontsize","paragraph","customstyle","searchreplace","blockquote","pasteplain","selectall","cleardoc","link","unlink","emotion","spechars","insertorderedlist","insertunorderedlist","horizontal","date","time","insertimage","imagenone","imageleft","imageright","imagecenter","lineheight","insertvideo","directionalityltr","directionalityrtl","rowspacingtop","rowspacingbottom","background","fullscreen"]]}else{if(p=="none"){j=[]}}}var a={imageMaxSize:o,videoMaxSize:n,wordCount:e,maximumWords:f,autoHeightEnabled:r,catchRemoteImageEnable:l,elementPathEnabled:h,toolbars:j,allowDivTransToP:false};var i=u.data("width");var d=u.data("height");if(!i){i="100%"}if(!d){d=300}a.initialFrameWidth=i;a.initialFrameHeight=d;var s=u.data("urlprefix");if(!s){s=u.data("imghost")}if(s){a.imageUrlPrefix=s;a.scrawlUrlPrefix=s;a.videoUrlPrefix=s;a.fileUrlPrefix=s}else{var q=u.data("imageurlprefix");if(q){a.imageUrlPrefix=imageurlprefix}var b=u.data("scrawlurlprefix");if(b){a.scrawlUrlPrefix=b}var t=u.data("videourlprefix");if(t){a.videoUrlPrefix=t}var k=u.data("fileurlprefix");if(k){a.fileUrlPrefix=k}}c.processInitNEditor(u,a)},processInitNEditor:function(f,a){var c=this;var b=f.attr("id");if(!b){b="summernote_"+randomId(6);f.attr("id",b)}var e=f.data("hidden-input")||f.data("hiddeninput");UE.delEditor(b);var d=UE.getEditor(b,a);d.addListener("contentChange",function(){if(e){var i=$("#"+b).closest(".jbolt_page").find("#"+e);if(i&&i.length>0){var h=d.getContent();i.val(h).change()}}})},initSummernoteEditor:function(htmlEditor){var that=this;var editorId=htmlEditor.attr("id");if(!editorId){editorId="summernote_"+randomId(6);htmlEditor.attr("id",editorId)}var emoji=htmlEditor.data("emoji");var optionsFuncName=htmlEditor.data("options");var summernoteOptions=null;if(optionsFuncName){var optionsFunc=eval(optionsFuncName);if(optionsFunc&&typeof(optionsFunc)=="function"){summernoteOptions=optionsFunc(htmlEditor);if(summernoteOptions){if(!summernoteOptions.lang){summernoteOptions.lang="zh-CN"}summernoteOptions.dialogsInBody=true}}}if(!summernoteOptions){var toolbarTheme=htmlEditor.data("toolbar")||"normal";var noImg=htmlEditor.data("no-img");if(typeof(noImg)=="undefined"){noImg=false}var noVideo=htmlEditor.data("no-video");if(typeof(noVideo)=="undefined"){noVideo=false}var noTable=htmlEditor.data("no-table");if(typeof(noTable)=="undefined"){noTable=false}var noCodeview=htmlEditor.data("no-codeview");if(typeof(noCodeview)=="undefined"){noCodeview=false}var toolbar=null;if(toolbarTheme=="normal"){var insertItems=["hr","link"];if(!noImg){insertItems.push("picture")}if(!noVideo){insertItems.push("video")}if(!noTable){insertItems.push("table")}var miscItems=["fullscreen","codeview","undo","redo","help"];if(noCodeview){miscItems=["fullscreen","undo","redo","help"]}if(emoji){insertItems.push("emoji")}toolbar=[["style",["style"]],["font",["bold","italic","underline","clear","strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph","height"]],["insert",insertItems],["misc",miscItems]]}else{if(toolbarTheme=="simple"){var insertItems=["hr"];if(!noImg){insertItems.push("picture")}if(emoji){insertItems.push("emoji")}toolbar=[["font",["bold","italic","underline","clear","strikethrough","superscript","subscript"]],["insert",insertItems],["misc",["undo","redo","help"]]]}else{if(toolbarTheme=="none"){if(emoji){toolbar=[["insert",["emoji"]]]}else{toolbar=[]}}}}var width=htmlEditor.data("width");var height=htmlEditor.data("height")||300;var maxsize=htmlEditor.data("imgmaxsize")||htmlEditor.data("maxsize")||200;var placeholder=htmlEditor.data("placeholder");var summernoteOptions={lang:"zh-CN",dialogsInBody:true,toolbar:toolbar,callbacks:{onImageUpload:function(files,editor,$editable){if(that.ing){alert("有文件正在上传，请稍后~~")}else{that.ing=true;var len=files.length;var qiniuBucketSn=htmlEditor.data("bucket-sn");var uploadTo=htmlEditor.data("upload-to")||"local";if(uploadTo=="local"){for(var i=0;i<len;i++){if(files[i].size/1024>maxsize){that.ing=false;LayerMsgBox.alert("图片文件不能大于"+maxsize+"k",2);return false}that.sendSummernoteFile(htmlEditor,files[i])}}else{if(uploadTo=="qiniu"){that.sendSummernoteFileToQiniu(htmlEditor,files)}else{LayerMsgBox.alert("暂不支持上传"+uploadTo,2)}}that.ing=false}},onChange:function(contents,$editable){var hiddenInputId=htmlEditor.data("hidden-input")||htmlEditor.data("hiddeninput");if(hiddenInputId){var hidden=$("#"+hiddenInputId);if(hidden&&hidden.length>0){hidden.val(contents)}}},onPaste:function(e){if(that.ing){alert("有文件正在上传，请稍后~~")}else{that.parseWord(e,htmlEditor);that.parseIamge(e,htmlEditor)}}}};if(placeholder){summernoteOptions.placeholder=placeholder}if(width){if(isNaN(width)){summernoteOptions.width=width}else{summernoteOptions.width=width+"px"}}if(isNaN(height)){summernoteOptions.height=height}else{summernoteOptions.height=height+"px"}}var goit=function(){htmlEditor.summernote(summernoteOptions);var disabled=htmlEditor.data("disabled");if(disabled){htmlEditor.summernote("disable")}};if(emoji){loadJBoltPlugin(["tamemoji"],function(){var emojiType=htmlEditor.data("emoji-type")||"unicode";var emojiSource=htmlEditor.data("emoji-source")||"assets/plugins/summernote/tam-emoji/img";document.emojiType=emojiType;document.emojiSource=emojiSource;goit()})}else{goit()}},initEditor:function(c){var b=this;var a=c.data("editor");if(a=="summernote"){b.initSummernoteEditor(c)}else{if(a=="neditor"){b.initNEditor(c)}else{LayerMsgBox.alert("data-editor类型错误",2)}}},parseWord:function(c,b){if(b.data("word-clear-html")){var a=((c.originalEvent||c).clipboardData||window.clipboardData).getData("Text/plain");if(a){c.preventDefault?c.preventDefault():(c.returnValue=false);setTimeout(function(){document.execCommand("insertText",false,a)},10)}}},parseIamge:function(l,j){var h=this;h.ing=true;var c=j.data("maxsize");if(!c){c=200}var d=l.originalEvent;var a=d.clipboardData.files;if(!a||a.length==0){h.ing=false;return false}d.stopPropagation();d.preventDefault();var k=a.length;var f=j.data("upload-to")||"local";h.ing=true;if(f=="local"){var m;for(var b=0;b<k;b++){m=a[b];if(h.ing==false||!(m.type.match(/^image/))){return false}if(m.size/1024>c){h.ing=false;LayerMsgBox.alert("图片文件不能大于"+c+"k",2);return false}h.sendSummernoteFile(j,m)}}else{if(f=="qiniu"){h.sendSummernoteFileToQiniu(j,a)}else{LayerMsgBox.alert("暂不支持上传"+f,2)}}h.ing=false},sendSummernoteFileToQiniu:function(b,a){loadJBoltPlugin(["qiniu"],function(){uploadFileToQiniu(b,"img",a,null,null,null,true,null,b.data("upload-loading"),function(f,e,d){for(var c in d.data){b.summernote("insertImage",d.data[c].url)}})})},sendSummernoteFile:function(e,d){var f=this;f.ing=true;var b=e.data("imguploadurl");if(!b){b=summernote_img_uploadurl}else{b=actionUrl(b)}var a=e.data("fileinputname");if(!a){a="file"}var i=e.data("imghost");var h=e.data("timeout")||60000;var c=new FormData();c.append(a,d);$.ajax({type:"post",url:b,data:c,timeout:h,cache:false,async:true,processData:false,contentType:false,success:function(j){if(j.state=="ok"){if(j.data){if(j.data.indexOf("http://")!=-1||j.data.indexOf("https://")!=-1||j.data.indexOf("://")!=-1){e.summernote("insertImage",j.data)}else{var k=actionUrl(j.data);if(i){if(i.charAt(i.length-1)!="/"){i=i+"/"}k=i+k}e.summernote("insertImage",k)}LayerMsgBox.success("上传成功",1000)}else{LayerMsgBox.success("上传异常",1000)}}else{LayerMsgBox.error(j.msg,1000)}f.ing=false},error:function(j){f.ing=false;LayerMsgBox.error("网络异常",1000)}})}};var RadioUtil={initRadioEvent:function(r,name,handler){if(handler){var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){r.find("input[type='radio'][name='"+name+"']").unbind("click").on("click",function(e){exe_handler(r,this.value)})}}},initRadios:function(c){if(!isOk(c)){return false}var a=c.length;for(var b=0;b<a;b++){this.initRadio(c.eq(b))}},initRadio:function(a){var d=this,i=a.data("value")+"",f=a.data("default")+"",b=a.data("name"),j=a.data("handler"),c=a.data("url"),h=a.data("label");if(c){d.insertDatas(a,c,b,h,function(){d.initRadioEvent(a,b,j);d.setChecked(a,b,i,f);d.processDisabled(a)})}else{var e=a.find(".radio-inline");if(e){d.processRadioAlignAndWidth(a)}d.initRadioEvent(a,b,j);d.setChecked(a,b,i,f);d.processDisabled(a)}},processDisabled:function(e){var a=e[0].hasAttribute("data-disabled");if(a){var d=e.data("disabled");if(!(typeof(d)=="undefined")&&(d+"")!="false"){var c=e.data("name");var b=e.find("input[type='radio'][name='"+c+"']");b.attr("disabled","disabled")}}},init:function(b){var a=getRealParentJqueryObject(b);if(!isOk(a)){return false}var c=a.find("[data-radio]");if(!isOk(c)){return false}this.initRadios(c)},refresh:function(c){if(!c){return false}var b,d;if(isDOM(c)){if(c.hasAttribute("data-radio")){b=$(c)}else{d=$(c);b=d.closest("[data-radio]");if(c.hasAttribute("tooltip")){d.tooltip("hide")}}}else{var a=typeof(c);if(a=="string"){if(c.startWith("#")){b=$(c)}else{b=$("#"+c)}}else{if(a=="object"){if(c[0].hasAttribute("data-radio")){b=c}else{b=c.closest("[data-radio]")}}}}if(!isOk(b)){return false}this.initRadio(b)},insertDatas:function(o,d,w,i,e){var h=this;o.empty();var q=o.data("width");var t="";var l="";if(q){var a=q.split(",");t=a[0];l=a[1]}var k="";if(i){var j=o.data("notnull");var c=o.data("rule");var m=(c&&typeof(j)=="undefined")||(c&&((typeof(j)=="boolean"&&j==true)||(typeof(j)=="string"&&j=="true")));if(m&&c=="required"){o.data("rule","radio").attr("data-rule","radio")}if(o.hasClass("row")){if(t.indexOf("px")!=-1){k='<label class="col-auto col-form-label '+(m?"is_required":"")+'" style="width:'+t+'">'+i+"</label>"}else{k='<label class="'+t+" col-form-label "+(m?"is_required":"")+'">'+i+"</label>"}}else{if(t.indexOf("px")!=-1){k='<label class="col-auto '+(m?"is_required":"")+'" style="width:'+t+'">'+i+"</label>"}else{k='<label class="'+t+" "+(m?"is_required":"")+'">'+i+"</label>"}}o.append(k);k=""}var b="";var p=o.data("inline");if(p){b="radio-inline"}var n=o.data("text-attr");if(!n){n="text"}var v=o.data("value-attr");if(!v){v="value"}var u=o.data("delimiter");var f=o.data("text-format-handler");var s=15;if(!o.hasClass("row")){s=6}Ajax.get(d,function(A){k+='<div class="'+l+'"  style="padding-top: 1px;padding-left:'+s+'px">';var z=A.data;var F=w.replace("\\.","_");if(z&&z.length>0){var E,D,B,r,C=randomId();if(o.data("text")){var x=o.data("value");if(typeof(x)=="undefined"){x=""}r=F+"_"+C+"_all";k+='<div class="radio radio-primary '+b+'"><input  id="'+r+'" type="radio" name="'+w+'" value="'+x+'"/><label for="'+r+'">'+o.data("text")+"</label></div>"}for(var y in z){E=z[y];D=processOptionTextByFormatHandler(f,E,n,u);B=processOptionValue(E,v);r=F+"_"+C+"_"+y;k+='<div class="radio radio-primary '+b+'"><input  id="'+r+'" type="radio" name="'+w+'" value="'+B+'"/><label for="'+r+'">'+D+"</label></div>"}k+="</div>";o.append(k);if(p){h.processRadioAlignAndWidth(o)}if(e){e()}}else{k+="<span class='form-control-plaintext text-info'>[暂无可选项]</span></div>";o.append(k)}})},processRadioAlignAndWidth:function(e){var d=e.data("align-left");if(d){var c=e.find(".radio.radio-inline");if(isOk(c)){var a=0,b;c.each(function(){b=$(this).outerWidth();if(b>a){a=b}});c.css({width:a+"px","max-width":a+"px"})}}},setChecked:function(d,b,e,a){var c=getRealParentJqueryObject(d);if(typeof(e)!="undefined"&&e!="undefined"&&e.toString().length>0){e=e+""}else{e=""}if(typeof(a)!="undefined"&&a!="undefined"&&a.toString().length>0){a=a+""}else{a=""}if(e){c.find("input[type='radio'][name='"+b+"'][value='"+e+"']").click()}else{if(a){if(a=="all"){c.find("input[type='radio'][name='"+b+"'][data-all]").click()}else{if(a=="options_first"){c.find("input[type='radio'][name='"+b+"']:first").click()}else{if(a=="options_last"){c.find("input[type='radio'][name='"+b+"']:last").click()}else{c.find("input[type='radio'][name='"+b+"'][value='"+a+"']").click()}}}}}},getCheckedRadio:function(b,d){var a;if(d){var c=getRealParentJqueryObject(d);if(isOk(c)){a=c.find("input[type='radio'][name='"+b+"']:checked")}}else{a=jboltBody.find("input[type='radio'][name='"+b+"']:checked")}return a},getCheckedValue:function(b,d){var c=this,e;var a=c.getCheckedRadio(b,d);if(isOk(a)){e=a.val()}return e},getCheckedText:function(d,f){var e=this,b;var a=e.getCheckedRadio(d,f);if(isOk(a)){var c=a.parent().find("label");if(isOk(c)){b=c.text()}}return b}};var LayerTipsUtil={initTip:function(c){var a=c.data("trigger");if(a&&a=="click"){var b=0;c.off("click").on("click",function(f){f.stopPropagation();f.preventDefault();var d=$(this).data("content");b=layer.tips(d,this,{tips:[4,"#3595CC"],time:30000});$("#layui-layer"+b).on("click",function(h){h.stopPropagation();h.preventDefault()});jboltBody.on("click",function(){layer.close(b)})})}else{var b=0;c.off("mouseenter").on("mouseenter",function(){var d=$(this).data("content");b=layer.tips(d,this,{tips:[4,"#3595CC"],time:30000})}).off("mouseleave").on("mouseleave",function(){layer.close(b)})}},initTips:function(b){if(!isOk(b)){return false}var d=this;var a=b.length;for(var c=0;c<a;c++){d.initTip(b.eq(c))}},init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("[data-tipsbtn]");if(!isOk(a)){return false}this.initTips(a)}};var LayerPhotoUtil={init:function(){var a=this;jboltBody.on("click","[data-photobtn]",function(j){j.preventDefault();j.stopPropagation();var h=$(this);var d=null;var i=h.data("target");if(this.tagName.toLowerCase()=="a"){d=h.attr("href")}else{if(this.tagName.toLowerCase()=="img"){d=h.attr("src")}}if(!d){d=h.data("url")}if(d){var b=null;var c=h.data("album")||h.data("ablum");if(c){b=a.getalbum(c,d);if(!b){b=[{src:d}]}}else{b=[{src:d}]}var f={photos:{title:"JBolt图片查看器",start:0,data:b},anim:5};if(i&&i=="parent"){parent.layer.photos(f)}else{layer.photos(f)}}else{alert("页面存在未设置图片地址的 photobtn")}})},getalbum:function(a,d){var c=jboltBody.find("[data-photobtn][data-album='"+a+"'],[data-photobtn][data-ablum='"+a+"']");if(!isOk(c)){return null}var b=new Array();b.push({src:d});c.each(function(){var f=$(this);var e=null;if(this.tagName.toLowerCase()=="a"){e=f.attr("href")}else{if(this.tagName.toLowerCase()=="img"){e=f.attr("src")}}if(!e){e=f.data("url")}if(e!=d){b.push({src:e})}});return b}};(function(a){a.extend(a.fn,{ajaxPortal:function(d,b,c,f,e){return this.each(function(){var n=a(this);var s="";if(b){s=b}else{s=n.data("url")}if(s.indexOf("?")!=-1){s=s+"&t="+new Date().getTime()}else{s=s+"?t="+new Date().getTime()}var p=n.data("autoload");var j=n.data("triggerload");if(typeof(p)=="undefined"){p=true}if(!p&&j){p=true}var q="replace";if(typeof(d)=="boolean"){if(d){q="replace"}else{q="append"}}else{if(d=="prepend"){q="prepend"}else{if(d=="append"){q="append"}else{if(d=="replace"){q="replace"}}}}if(p){var k=n.data("show-loading");if(typeof(k)=="undefined"){k=true}switch(q){case"prepend":if(k){n.prepend("<div class='m-2 p-2 text-center ajaxPortalLoading'><div class='spinner-grow text-secondary' style='width: 3rem; height: 3rem;' role='status'><span class='sr-only'>Loading...</span></div></div>")}break;case"append":if(k){n.append("<div class='m-2 p-2 text-center ajaxPortalLoading'><div class='spinner-grow text-secondary' style='width: 3rem; height: 3rem;' role='status'><span class='sr-only'>Loading...</span></div></div>")}break;case"replace":AjaxPortalUtil.triggerPortalJBoltPageCloseHandler(n);if(k){n.html("<div class='m-2 p-2 text-center ajaxPortalLoading'><div class='spinner-grow text-secondary' style='width: 3rem; height: 3rem;' role='status'><span class='sr-only'>Loading...</span></div></div>")}break;default:if(k){n.html("<div class='m-2 p-2 text-center ajaxPortalLoading'><div class='spinner-grow text-secondary' style='width: 3rem; height: 3rem;' role='status'><span class='sr-only'>Loading...</span></div></div>")}break}s=actionUrl(s);if(s){s=processEleUrlByLinkOtherParamEle(n,s);if(!s){console.error("AjaxPortal data-link-para-ele配置无法处理URL");return false}var r=n.data("conditions-form");if(r){var i=a("#"+r);if(!isOk(i)){LayerMsgBox.alert("ajaxPortal绑定data-conditions-form未找到",2);return}s=urlWithFormData(s,i)}}var o=n.data("type");if(o&&o=="json"){var m=n.data("tpl");if(m){var h=g(m);var l=null;if(h.tagName=="SCRIPT"){l=h.innerHTML}else{if(h.tagName=="TEXTAREA"){l=h.value}else{LayerMsgBox.alert("AjaxPortal配置data-tpl模板指定的组件只能是Script和Textarea",2);return false}}if(!l){LayerMsgBox.alert("AjaxPortal配置data-tpl模板中未发现可用模板数据",2);return false}if(l){Ajax.get(s,function(u){var t=juicer(l,{res:u});AjaxPortalUtil.processContent(n,t,u,b,c,q,f);if(isOk(n.pages)==false){AjaxPortalUtil.initPage(n,u.data)}},function(t){if(t.responseText){n.find(".ajaxPortalLoading").remove();LayerMsgBox.alert(t.responseText,2)}else{AjaxPortalUtil.processError(n,q,e)}})}}}else{a.ajax({type:"GET",url:s,beforeSend:function(t){t.setRequestHeader("AJAX-PORTAL","true")},dataType:"html",success:function(t){AjaxPortalUtil.processContent(n,t,null,b,c,q,f)},error:function(t){if(t.responseText){AjaxPortalUtil.processContent(n,t.responseText,null,b,c,q,f)}else{AjaxPortalUtil.processError(n,q,e)}}})}}})}})})(jQuery);function afterAjaxPortal(a){portalLoadRequirePluginAndInit(a);$(".tooltip.show").remove();SelectUtil.initAutoSetValue(a);FileUploadUtil.init(a);ImgUploadUtil.init(a);SwitchBtnUtil.init(a);FormDate.init(a);CityPickerUtil.init(a);LayerTipsUtil.init(a);HtmlEditorUtil.init(a);ImageViewerUtil.init(a);RadioUtil.init(a);CheckboxUtil.init(a);AutocompleteUtil.init(a);Select2Util.init(a);SelectUtil.init({parent:a});MasterSlaveUtil.init(a);MultipleFileInputUtil.init(a);AjaxPortalUtil.init(a);JSTreeUtil.init(a);JBoltInputUtil.init(a);RangeSliderUtil.init(a);JBoltInputWithClearBtnUtil.init(a);JBoltInputWithCalculatorUtil.init(a);initToolTip(a);initPopover(a);JBoltTableUtil.init(a);JBoltTreeTableUtil.init(a);JBoltTabViewUtil.initUI(a);TextareaUtil.initUI(a);JsonEditorUtil.init(a);LayerMsgBox.closeLoadNow();processAutoRefreshTabContent(a);findRequiredAndStarIt(a)}function processAutoRefreshTabContent(a){if(!jboltWithTabs){return false}if(!(a.hasClass("jbolt_tabcontent")&&a.hasClass("active"))){return false}var c=a.find(".jbolt_page");if(!isOk(c)){return false}var b=c.data("auto-refresh");if(b){b=b*1000;setTimeout(function(){a.ajaxPortal(true)},b)}}function isFileData(a){return a&&a.constructor==File}function validateFileMaxSize(f,h){var b=0;if(isFileData(f)){b=f.size}else{b=f.files[0].size}var c=(b>h);b=(b/1024).toFixed(1);var a=b+"KB";if(b>1024){a=((b/1024).toFixed(1))+"M"}if(c){var e="";var d=(h/1024).toFixed(1);if(d>1024){d=(h/1024/1024).toFixed(1);e=d+"MB"}else{e=d+"KB"}LayerMsgBox.alert("您选择的文件["+a+"],上传限制不能超过:"+e,2)}return c}function validateExcel(b,d,a){var c;if(isFileData(b)){c=b.name}else{c=b.files[0].name}if(!/.(xls|xlsx)$/.test(c.toLowerCase())){if(!a){LayerMsgBox.alert("文件类型必须是xls,xlsx中的一种",2)}return false}if(validateFileMaxSize(b,d)){return false}return true}function validateNormal(b,d,a){var c;if(isFileData(b)){c=b.name}else{c=b.files[0].name}if(!/.(txt|xls|xlsx|jpg|jpeg|png|gif|bmp|rar|zip|pdf|mp4|wmv|flv|rmvb|mpg|mkv|mov|mp3|wav|ogg|midi|mac|acc|doc|docx|ppt|pptx|ppts)$/.test(c.toLowerCase())){if(!a){LayerMsgBox.alert("此文件类型不允许上传",2)}return false}if(validateFileMaxSize(b,d)){return false}return true}function validateAudio(b,d,a){var c;if(isFileData(b)){c=b.name}else{c=b.files[0].name}if(!/.(mp3|wav|ogg|midi|mac|acc)$/.test(c.toLowerCase())){if(!a){LayerMsgBox.alert("此文件类型不允许上传，只允许mp3|wav|ogg|midi|mac|acc",2)}return false}if(validateFileMaxSize(b,d)){return false}return true}function validateVideo(b,d,a){var c;if(isFileData(b)){c=b.name}else{c=b.files[0].name}if(!/.(mp4|wmv|flv|rmvb|mpg|mkv|mov)$/.test(c.toLowerCase())){if(!a){LayerMsgBox.alert("此文件类型不允许上传,只允许mp4|wmv|flv|rmvb|mpg|mkv|mov",2)}return false}if(validateFileMaxSize(b,d)){return false}return true}function validateSelfFileAccept(file,maxSize,accept,dontShowMsg){var fileName;if(isFileData(file)){fileName=file.name}else{fileName=file.files[0].name}var tt=eval("/.("+accept+")$/");if(!tt.test(fileName.toLowerCase())){if(!dontShowMsg){LayerMsgBox.alert("此文件类型不允许上传,只允许"+accept,2)}return false}if(validateFileMaxSize(file,maxSize)){return false}return true}function isImg(a){return(/.(jpg|jpeg|png|gif|bmp|webp)$/.test(a.toLowerCase()))}function isPdf(a){return(/.(pdf)$/.test(a.toLowerCase()))}function validateImg(b,d,a){var c;if(isFileData(b)){c=b.name}else{c=b.files[0].name}if(isImg(c)==false){if(!a){LayerMsgBox.alert("图片类型必须是jpg|jpeg|png|gif|bmp|webp中的一种",2)}return false}if(validateFileMaxSize(b,d)){return false}return true}function getRealAccept(b){var a;switch(b){case"img":a="image/*";break;case"csv":a="text/csv";break;case"excel":a="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel";break;case"xls":a="application/vnd.ms-excel";break;case"xlsx":a="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";break;case"word":a="application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case"doc":a="application/msword";break;case"docx":a="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case"powerpoint":a=".ppt,.pptx,.pps,.ppsx";break;case"ppt":a=".ppt";break;case"pptx":a=".pptx";break;case"pps":a=".pps";break;case"ppsx":a=".ppsx";break;case"video":a="video/*";break;case"audio":a="audio/*";break;case"pdf":a="application/pdf";break;case"mp4":a="video/mp4";break;case"amp4":a="audio/mp4";break;case"flv":a=".flv";break;case"mp3":a="audio/mp3";break;case"wav":a="audio/wav";break;case"zip":a="application/zip";break;case"rar":a=".rar";break;case"7z":a=".7z";break;case"ai":a=".ai";break;case"psd":a=".psd";break;case"cdr":a=".cdr";break;default:if(b.indexOf(",")==-1){if(b.indexOf("/")!=-1||b.startWith(".")){a=b}else{a="."+b}}else{a=getRealAcceptSplit(b)}break}return a}function getRealAcceptSplit(c){if(c.indexOf(",")==-1){return c}var a=c.split(",");if(notOk(a)){return c}var e=[];var d;for(var b in a){d=getRealAccept(a[b]);if(d){e.push(d)}}if(notOk(e)){return c}return e.join(",")}function validateFileDatas(b,a,e,d){if(!b||b.length==0){return false}var c=true;$.each(b,function(h,f){c=validateFile(f,a,e,d);if(!c){return false}});return c}function validateFile(c,d,j,h){var m;if(isFileData(c)){m=c}else{m=c[0].files[0]}var e=m.name;if(!h){h=50}if(e&&e.length>h){LayerMsgBox.alert("文件名["+e+"]太长了，请缩短修改后上传,不能超过["+h+"]个字符",2);return false}if(j){j=j*1024}else{j=10485760}var a=true;if(d){if(d.indexOf(",")==-1){switch(d){case"img":a=validateImg(m,j);break;case"excel":a=validateExcel(m,j);break;case"file":a=validateNormal(m,j);break;case"all":a=!validateFileMaxSize(m,j);break;case"video":a=validateVideo(m,j);break;case"audio":a=validateAudio(m,j);break;default:a=validateSelfFileAccept(m,j,d);break}}else{var k=d.split(",");var b,l=k.length;for(var f=0;f<l;f++){b=k[f];switch(b){case"img":a=validateImg(m,j,true);break;case"excel":a=validateExcel(m,j,true);break;case"file":a=validateNormal(m,j,true);break;case"all":a=!validateFileMaxSize(m,j);break;case"video":a=validateVideo(m,j,true);break;case"audio":a=validateAudio(m,j,true);break;default:a=validateSelfFileAccept(m,j,b,true);break}if(a){break}}}}else{a=validateNormal(m,j)}return a}function getObjectURL(a){return getObjectURLByFileData(a.files[0])}function getObjectURLByFileData(b){var a=null;if(window.createObjectURL!=undefined){a=window.createObjectURL(b)}else{if(window.URL!=undefined){a=window.URL.createObjectURL(b)}else{if(window.webkitURL!=undefined){a=window.webkitURL.createObjectURL(b)}}}return a}var ImgUploadUtil={tpl:'<p class="j_img_uploder_msg"><span class="j_file_name"></span><i class="fa fa-remove j_text_danger j_remove_file"></i></p>',input_tpl:'<div class="j_upload_img_input"><input id="${inputId}" data-boxid="${boxId}" type="file" {@if multi}multiple="multiple"{@/if} accept="image/*"  {@if rule}data-rule="${rule}"{@/if}  {@if tips}data-tips="${tips}"{@/if} ></div>',init:function(e){var d=getRealParentJqueryObject(e);if(!isOk(d)){return false}var b=d.find(".j_img_uploder,[data-imguploader]:not(.j_img_uploder)");if(!isOk(b)){return false}var a=b.length;for(var c=0;c<a;c++){this.initSingle(b.eq(c))}},initSingle:function(k){if(!k.hasClass("j_img_uploder")){k.addClass("j_img_uploder")}var j=this;var f=k.data("rule");var a=k.data("tips");var s=k.data("area");var p=k.data("multi")||false;if(s){var b=s.split(",");k.css({width:b[0],height:b[1]})}var c=k.attr("id");var i=randomId();var n="ipt_"+i;if(!c){c="box_"+i;k.attr("id",c);k.data("inputid",n).attr("data-inputid",n)}k.html(juicer(j.tpl,{}));jboltBody.append(juicer(j.input_tpl,{boxId:c,inputId:n,rule:f,tips:a,multi:p}));var o=k.data("value");if(o&&typeof(o)=="string"&&o!="assets/img/uploadimg.png"){if(o.indexOf("\\")!=-1){o=o.replace(/\\/g,"/")}var d="#999 url('"+o+"') center center no-repeat";k.css({background:d,"background-size":"100%"});k.find("p.j_img_uploder_msg").show()}k.off("click").on("click",function(y){y.preventDefault();y.stopPropagation();var x=$(this).data("inputid");var w=jboltBody.find(".j_upload_img_input>input#"+x);if(isOk(w)){w.trigger("click")}return false});jboltBody.find("input[type='file']#"+k.data("inputid")).off("change").on("change",function(y){var x=$(this);var w=y.target.files;if(w.length>0){if(p){j.changeFiles(k,x,w)}else{j.changeFile(k,x,w[0])}}});k.find(".j_img_uploder_msg").on("click",function(w){w.preventDefault();w.stopPropagation();return false});k.find(".j_remove_file").on("click",function(w){w.preventDefault();w.stopPropagation();var x=$(this);j.removeFile(x);return false});if(p){var l=k.data("hidden-input")||k.data("hiddeninput");if(!l){return}var u=k.data("imgbox");if(!u){return}var r=$("#"+l);if(!isOk(r)){return}var t=$("#"+u);if(!isOk(t)){return}var v=$.trim(r.val());if(!v){return}var h=k.data("value-attr");if(h&&h=="id"){var q=(k.data("load-jboltfile-url")||"admin/jboltfileChange?ids=")+v;Ajax.get(q,function(x){var w=x.data;if(w){if(!isArray(w)){w=[w]}t.empty();var y=t.data("imgstyle")||"";$.each(w,function(A,z){t.append("<li data-imgbox='"+u+"' data-remove-file='"+z.id+"' data-hiddeninput='"+l+"'><img data-photobtn data-album='"+u+"' style='"+y+"' src='"+z.localUrl+"'/><div class='optbox' ><i title='查看大图' class='fa fa-eye' onclick='lookUploadImgPhoto(this)'></i><i title='删除' onclick='removeUploadImgBoxLi(this)' class='fa fa-trash'></i><i onclick='imgGotoLeft(this)' class='fa fa-arrow-left' title='左移'></i><i title='右移' onclick='imgGotoRight(this)' class='fa fa-arrow-right'></i></div></li>").show()})}})}else{var m=new Array();if(v.indexOf(",")==-1){m.push(v)}else{m=v.split(",")}if(!isOk(m)){return}t.empty();var e=t.data("imgstyle")||"";$.each(m,function(x,w){t.append("<li data-imgbox='"+u+"' data-remove-file='"+real_image(w)+"' data-hiddeninput='"+l+"'><img data-photobtn data-album='"+u+"' style='"+e+"' src='"+real_image(w)+"'/><div class='optbox' ><i title='查看大图' class='fa fa-eye' onclick='lookUploadImgPhoto(this)'></i><i title='删除' onclick='removeUploadImgBoxLi(this)' class='fa fa-trash'></i><i onclick='imgGotoLeft(this)' class='fa fa-arrow-left' title='左移'></i><i title='右移' onclick='imgGotoRight(this)' class='fa fa-arrow-right'></i></div></li>").show()})}}},removeFile:function(removeBtn){var uploder=removeBtn.closest(".j_img_uploder");var removehandler=uploder.data("remove-handler")||uploder.data("removehandler");var removeConfirm=uploder.data("remove-confirm");var rf=function(){var inputId=uploder.data("inputid");if(inputId){var fileInput=jboltBody.find(".j_upload_img_input>input[type='file']#"+inputId);if(isOk(fileInput)){fileInput.val("")}}uploder.find("span.j_file_name").text("");uploder.find("p.j_img_uploder_msg").hide();uploder.css({background:"url('assets/img/uploadimg.png') center center no-repeat","background-size":"80%"});var hiddeninput=uploder.data("hidden-input")||uploder.data("hiddeninput");if(hiddeninput){$("#"+hiddeninput).val("")}if(removehandler){var exe=eval(removehandler);if(exe){exe(uploder)}}};var removeUrl=uploder.data("remove-url");if(removeUrl&&removeUrl.indexOf("[file]")!=-1){var hiddeninputId=uploder.data("hidden-input")||uploder.data("hiddeninput");if(hiddeninputId){var hiinput=$("#"+hiddeninputId);if(isOk(hiinput)){var hipt_value=hiinput.val();if(hipt_value){removeUrl=removeUrl.replace("[file]",hipt_value)}}}}if(removeConfirm){var cfMsg;if(typeof(removeConfirm)=="string"){cfMsg=removeConfirm}else{cfMsg="确认移除已选图片？"}LayerMsgBox.confirm(cfMsg,function(){if(removeUrl){LayerMsgBox.loading("正在删除...",4000);Ajax.get(removeUrl,function(res){LayerMsgBox.closeLoadingNow();rf();LayerMsgBox.success("删除成功",500)})}else{rf()}})}else{if(removeUrl){LayerMsgBox.loading("正在删除...",4000);Ajax.get(removeUrl,function(res){LayerMsgBox.closeLoadingNow();rf();LayerMsgBox.success("删除成功",500)})}else{rf()}}},changeFiles:function(uploder,fileInput,fileDatas){var maxSize=uploder.data("maxsize");var fileValue=fileInput.val();var handler=uploder.data("handler");var fileNameMaxLength=uploder.data("filename-maxlength")||50;if(fileValue){if(!validateFileDatas(fileDatas,"img",maxSize,fileNameMaxLength)){fileInput.val("");return false}}else{fileInput.val("");uploder.find("span.j_file_name").text("");uploder.find("p.j_img_uploder_msg").hide();uploder.css({background:"url('assets/img/uploadimg_multi.png') center center no-repeat","background-size":"80%"})}if(handler){var url=null;if(handler=="uploadMultipleFile"){url=uploder.data("url");if(!url){LayerMsgBox.alert("未设置文件上传地址 data-url",2);return}}if(url){url=processEleUrlByLinkOtherParamEle(uploder,url)}LayerMsgBox.loading("处理中",10000);var hiddeninputId=uploder.data("hidden-input")||uploder.data("hiddeninput");var imgbox=uploder.data("imgbox");var limit=uploder.data("limit")||9;if(imgbox){var imgs=$("#"+imgbox+" img");if((isOk(imgs)&&(imgs.length>=limit||(imgs.length+fileDatas.length>limit)))||fileDatas.length>limit){LayerMsgBox.alert("最多上传["+limit+"]张图片",5);fileInput.val("");uploder.find("span.j_file_name").text("");uploder.find("p.j_img_uploder_msg").hide();uploder.css({background:"url('assets/img/uploadimg_multi.png') center center no-repeat","background-size":"80%"});return false}}var fileName=uploder.data("filename");if(!fileName){fileName="file"}var ucallback=uploder.data("upload-success-handler")||uploder.data("upload-success-callback");var failcallback=uploder.data("upload-fail-handler")||uploder.data("upload-fail-callback");var hiddeninput;if(hiddeninputId){hiddeninput=$("#"+hiddeninputId);if(isOk(hiddeninput)){var timeout=uploder.data("timeout");if(timeout){hiddeninput.data("timeout",timeout).attr("data-timeout",timeout)}if(!hiddeninput[0].hasAttribute("data-value-attr")){var valueAttr=uploder.data("value-attr");if(valueAttr){hiddeninput.data("value-attr",valueAttr).attr("data-value-attr",valueAttr)}}}}var loading=uploder.data("loading");var showDefaultSuccessMsg=uploder.data("show-default-success-msg");if(typeof(showDefaultSuccessMsg)=="undefined"){showDefaultSuccessMsg=true}if(handler=="uploadMultipleFile"){uploadFile("img",url,fileName,fileDatas,hiddeninput,null,null,true,imgbox,loading,function(type,res){fileInput.val("");if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}},function(type,res){if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传失败",2)}},!showDefaultSuccessMsg)}else{if(handler=="uploadMultipleFileToQiniu"){loadJBoltPlugin(["qiniu"],function(){uploadFileToQiniu(uploder,"img",fileDatas,hiddeninput,null,null,true,imgbox,loading,function(type,res){fileInput.val("");if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}},function(type,res){if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传失败",2)}})})}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(uploder,"img",fileInput)}}}}},changeFile:function(uploder,fileInput,fileData){var maxSize=uploder.data("maxsize");var fileNameMaxLength=uploder.data("filename-maxlength")||50;var fileValue=fileInput.val();var hiddeninput=uploder.data("hidden-input")||uploder.data("hiddeninput");var handler=uploder.data("handler");if(hiddeninput&&handler&&handler!="uploadMultipleFile"){$("#"+hiddeninput).val("")}if(fileValue){if(validateFile(fileInput,"img",maxSize,fileNameMaxLength)){var arr=fileValue.split("\\");var fileName=arr[arr.length-1];if(handler&&handler!="uploadMultipleFile"){uploder.find("span.j_file_name").text(fileName).attr("title",fileName);uploder.find("p.j_img_uploder_msg").show();var imgDataUrl=getObjectURLByFileData(fileData);if(imgDataUrl){uploder.css({background:"#999 url('"+imgDataUrl+"') center center no-repeat","background-size":"100%"})}}uploder.closest(".form-group").removeClass("has-error")}else{fileInput.val("");uploder.find("span.j_file_name").text("");uploder.find("p.j_img_uploder_msg").hide();uploder.css({background:"url('assets/img/uploadimg.png') center center no-repeat","background-size":"80%"});return false}}else{fileInput.val("");uploder.find("span.j_file_name").text("");uploder.find("p.j_img_uploder_msg").hide();uploder.css({background:"url('assets/img/uploadimg.png') center center no-repeat","background-size":"80%"})}if(handler){var url=uploder.data("url");if(!url&&handler=="uploadFile"){LayerMsgBox.alert("未设置文件上传地址 data-url",2);return}if(url){url=processEleUrlByLinkOtherParamEle(uploder,url)}LayerMsgBox.loading("处理中",1000);var hiddeninputId=uploder.data("hidden-input")||uploder.data("hiddeninput");var imgbox=uploder.data("imgbox");var limit=uploder.data("limit")||9;if(imgbox){var imgs=$("#"+imgbox+" img");if(isOk(imgs)&&imgs.length>=limit){LayerMsgBox.alert("最多上传["+limit+"]张图片",5);fileInput.val("");uploder.find("span.j_file_name").text("");uploder.find("p.j_img_uploder_msg").hide();uploder.css({background:"url('assets/img/uploadimg.png') center center no-repeat","background-size":"80%"});return false}}var fileName=uploder.data("filename");if(!fileName){fileName="file"}var ucallback=uploder.data("upload-success-handler")||uploder.data("upload-success-callback");var failcallback=uploder.data("upload-fail-handler")||uploder.data("upload-fail-callback");var hiddeninput;if(hiddeninputId){hiddeninput=$("#"+hiddeninputId);if(isOk(hiddeninput)){var timeout=uploder.data("timeout");if(timeout){hiddeninput.data("timeout",timeout).attr("data-timeout",timeout)}if(!hiddeninput[0].hasAttribute("data-value-attr")){var valueAttr=uploder.data("value-attr");if(valueAttr){hiddeninput.data("value-attr",valueAttr).attr("data-value-attr",valueAttr)}}}}var loading=uploder.data("loading");var showDefaultSuccessMsg=uploder.data("show-default-success-msg");if(typeof(showDefaultSuccessMsg)=="undefined"){showDefaultSuccessMsg=true}if(handler=="uploadFile"){uploadFile("img",url,fileName,fileData,hiddeninput,null,null,false,imgbox,loading,function(type,res){if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}},function(type,res){if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传失败",2)}},!showDefaultSuccessMsg)}else{if(handler=="uploadFileToQiniu"){loadJBoltPlugin(["qiniu"],function(){uploadFileToQiniu(uploder,"img",fileData,hiddeninput,null,null,false,imgbox,loading,function(type,res){if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}},function(type,res){if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传失败",2)}})})}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(uploder,"img",fileInput)}}}}}};function processImagesHiddenInputValue(i,k,h){var d=$("#"+k);var c=$("#"+h);var l="";var b=i.data("value-attr");if(b){var n=d.find("li");var a=n.length;var j=a-1;var m;if(a>0){n.each(function(o){m=$(this);l=l+(m.data("remove-file")||m.data("id")||m.data("path"));if(o<j){l=l+","}})}}else{var f=d.find("img");var a=f.length;var j=a-1;var e;if(a>0){f.each(function(o){e=$(this);l=l+(e.data("path")||e.attr("src"));if(o<j){l=l+","}})}}c.val(l)}function processFilesHiddenInputValue(h,e){if(!e){return}var d=$("#"+h);var c=$("#"+e);var j="";var l=d.find("li");if(!isOk(l)){l=d.find(".file")}var b=l.length;var f=b-1;var k,i;if(b>0){l.each(function(a){k=$(this);i=k.find("a");j=j+(i.data("path")||i.attr("href"));if(a<f){j=j+","}})}c.val(j)}function removeUploadImgBoxLi(p){var f=$(p);var n=f.closest("li");var l=n.find("a");var k=n.data("imgbox");var i=$("#"+k);if(!isOk(i)){i=n.parent()}var b=i.data("remove-confirm");var h=n.data("hidden-input")||n.data("hiddeninput");var c=$(".j_img_uploder[data-imgbox='"+k+"']");var m;if(isOk(c)){m=c.data("remove-url");if(m&&m.indexOf("[file]")!=-1){var d=n.data("remove-file")||n.data("id")||n.data("path")||f.data("remove-file")||f.data("id")||f.data("path");if(!d){if(isOk(l)){d=l.data("remove-file")||l.data("id")||l.data("path")}if(!d){d=n.find("img").attr("src");console.log("data-remove-url中存在[file]，需要文件上携带data-remove-file 或者 data-path 或者 data-id,如果不设置，直接启用img的src属性")}}m=m.replace("[file]",d)}}var j=typeof(b);var e="确定删除？";var o=function(){if(m){LayerMsgBox.loading("删除中...",4000);Ajax.get(m,function(a){n.remove();processImagesHiddenInputValue(c,k,h);LayerMsgBox.success("删除成功",500)})}else{n.remove();processImagesHiddenInputValue(c,k,h);LayerMsgBox.success("删除成功",500)}};if(j!="undefined"){if(j=="string"){e=b}LayerMsgBox.confirm(e,o)}else{o()}}function removeUploadFileBoxLi(p){var f=$(p);var n=f.closest("li");if(!isOk(n)){n=f.closest(".file")}var l=n.find("a");var k=n.data("filebox");var i=$("#"+k);if(!isOk(i)){i=n.parent()}var c=$(".j_upload_file_box[data-filebox='"+k+"']");var m;if(isOk(c)){m=i.data("remove-url")||c.data("remove-url");if(m&&m.indexOf("[file]")!=-1){var d=n.data("remove-file")||n.data("id")||n.data("path")||f.data("remove-file")||f.data("id")||f.data("path");if(!d){if(isOk(l)){d=l.data("remove-file")||l.data("id")||l.data("path")}if(!d){LayerMsgBox.alert("data-remove-url中存在[file]，需要文件上携带data-remove-file 或者 data-path 或者 data-id",2);return}}m=m.replace("[file]",d)}}var b=i.data("remove-confirm")||c.data("remove-confirm");var h=n.data("hidden-input")||n.data("hiddeninput")||c.data("hidden-input");var j=typeof(b);var e="确定删除？";var o=function(){if(m){LayerMsgBox.loading("删除中...",4000);Ajax.get(m,function(a){n.remove();processFilesHiddenInputValue(k,h);LayerMsgBox.success("删除成功",500)})}else{n.remove();processFilesHiddenInputValue(k,h);LayerMsgBox.success("删除成功",500)}};if(j!=undefined&&j!="undefined"){if(j=="string"){e=b}LayerMsgBox.confirm(e,o)}else{o()}}function lookUploadImgPhoto(d){var b=$(d);var a=b.closest("li");var c=a.find("img");c.click()}function imgGotoLeft(c){var f=$(c);var a=f.closest("li");var d=a.prev();if(d){var b=a.clone();d.before(b);var e=a.data("hidden-input")||a.data("hiddeninput");var j=a.data("imgbox");a.remove();var h=$(".j_img_uploder[data-imgbox='"+j+"']");processImagesHiddenInputValue(h,j,e)}else{layer.msg("已经是第一个",{time:1000})}}function imgGotoRight(c){var f=$(c);var a=f.closest("li");var d=a.next();if(d){var b=a.clone();d.after(b);var e=a.data("hidden-input")||a.data("hiddeninput");var j=a.data("imgbox");a.remove();var h=$(".j_img_uploder[data-imgbox='"+j+"']");processImagesHiddenInputValue(h,j,e)}else{layer.msg("已经是最后一个",{time:1000})}}function isFileList(a){return a&&a.constructor==FileList}function processImgUploadCallback(s,h,b,p,k){var o=s.data;var n;var i;var r;var q=false;if(typeof(o)=="string"){i=o;n=real_image(o)}else{var d="id";if(b&&p){var j=$(".j_img_uploder[data-imgbox='"+p+"']");d=j.data("value-attr")||(k?"id":"url")}else{d=h.data("value-attr")||(k?"id":"url")}if(isArray(o)){if(typeof(o[0])=="string"){n=new Array();i=new Array();$.each(o,function(t,u){i.push(u);n.push(real_image(u))})}else{q=true;n=new Array();i=new Array();r=new Array();$.each(o,function(u,t){i.push(t.url||t.localUrl||t.imgUrl);r.push(t[d]||"");n.push(real_image(t.url||t.localUrl||t.imgUrl))})}}else{q=true;i=o.url||o.imgUrl;n=real_image((o.url||o.imgUrl));r=o[d]||""}}var a=h;var m=h.attr("id");var f=$.trim(a.val());if(b&&p){var e=$("#"+p);var c=e.data("imgstyle")||"";if(isArray(n)){var l="";if(q){$.each(n,function(u,t){l=l+"<li data-imgbox='"+p+"' data-remove-file='"+r[u]+"' data-hiddeninput='"+m+"'><img   data-photobtn data-album='"+p+"' style='"+c+"' data-path='"+i[u]+"' src='"+t+"'/><div class='optbox' ><i title='查看大图' class='fa fa-eye' onclick='lookUploadImgPhoto(this)'></i><i title='删除' onclick='removeUploadImgBoxLi(this)' class='fa fa-trash'></i><i onclick='imgGotoLeft(this)' class='fa fa-arrow-left' title='左移'></i><i title='右移' onclick='imgGotoRight(this)' class='fa fa-arrow-right'></i></div></li>"});e.append(l).show();if(!f){f=r.join(",")}else{f=f+","+r.join(",")}}else{$.each(n,function(u,t){l=l+"<li data-imgbox='"+p+"' data-remove-file='"+i[u]+"' data-hiddeninput='"+m+"'><img   data-photobtn data-album='"+p+"' style='"+c+"' data-path='"+i[u]+"' src='"+t+"'/><div class='optbox' ><i title='查看大图' class='fa fa-eye' onclick='lookUploadImgPhoto(this)'></i><i title='删除' onclick='removeUploadImgBoxLi(this)' class='fa fa-trash'></i><i onclick='imgGotoLeft(this)' class='fa fa-arrow-left' title='左移'></i><i title='右移' onclick='imgGotoRight(this)' class='fa fa-arrow-right'></i></div></li>"});e.append(l).show();if(!f){f=i.join(",")}else{f=f+","+i.join(",")}}}else{if(q){e.append("<li data-imgbox='"+p+"'  data-remove-file='"+r+"' data-hiddeninput='"+m+"'><img data-photobtn data-album='"+p+"' style='"+c+"' data-path='"+i+"' src='"+n+"'/><div class='optbox' ><i title='查看大图' class='fa fa-eye' onclick='lookUploadImgPhoto(this)'></i><i title='删除' onclick='removeUploadImgBoxLi(this)' class='fa fa-trash'></i><i onclick='imgGotoLeft(this)' class='fa fa-arrow-left' title='左移'></i><i title='右移' onclick='imgGotoRight(this)' class='fa fa-arrow-right'></i></div></li>").show();if(!f){f=r}else{f=f+","+r}}else{e.append("<li data-imgbox='"+p+"'  data-remove-file='"+i+"'  data-hiddeninput='"+m+"'><img data-photobtn data-album='"+p+"' style='"+c+"' data-path='"+i+"' src='"+n+"'/><div class='optbox' ><i title='查看大图' class='fa fa-eye' onclick='lookUploadImgPhoto(this)'></i><i title='删除' onclick='removeUploadImgBoxLi(this)' class='fa fa-trash'></i><i onclick='imgGotoLeft(this)' class='fa fa-arrow-left' title='左移'></i><i title='右移' onclick='imgGotoRight(this)' class='fa fa-arrow-right'></i></div></li>").show();if(!f){f=i}else{f=f+","+i}}}}else{if(q){if(isArray(r)){f=r.join(",")}else{f=r}}else{if(isArray(i)){f=i.join(",")}else{f=i}}}a.val(f)}function getFileName(a){return a.substring(a.lastIndexOf("/")+1)}function getFileExtension(a){return a.substring(a.lastIndexOf(".")+1)}function processFileUploadCallback(J,w,A,k,v){if(!k){if(w){var o=w.data("value-attr");if(o){w.val(J.data[o])}else{if(typeof(J.data)=="string"){w.val(J.data)}else{w.val(J.data.fileUrl||J.data.localUrl||J.data.url)}}}if(A&&typeof(J.data)=="object"){$("#"+A).val(J.data.fileName||"")}else{$("#"+A).val("")}return}var r;if(v){r=$("#"+v)}var I=J.data;var y;var s,f;var C,o;if(typeof(I)=="string"){C=I;y=real_image(I);s=getFileName(C)}else{if(w){o=w.data("value-attr")}else{if(isOk(r)){o=r.data("path-attr")}}if(isArray(I)){if(typeof(I[0])=="string"){y=new Array();s=new Array();C=new Array();$.each(I,function(K,L){C.push(L);y.push(real_image(L));s.push(getFileName(L))})}else{y=new Array();s=new Array();C=new Array();$.each(I,function(L,K){C.push(o?K[o]:(K.localUrl||K.url||K.fileUrl));y.push(real_image(K.localUrl||K.url||K.fileUrl));f=K.fileName?K.fileName:getFileName(K.localUrl||K.url||K.fileUrl);if(f.indexOf("/")!=-1){f=getFileName(f)}s.push(f)})}}else{C=o?I[o]:(I.fileUrl||I.localUrl||I.url);y=real_image((I.fileUrl||I.localUrl||I.url));s=I.fileName?I.fileName:getFileName(C);if(s.indexOf("/")!=-1){s=getFileName(s)}}}var F=w?(w.attr("id")):"";var q=w?($.trim(w.val())):"";if(v){var r=$("#"+v);var D=r.data("tpl");var z;if(D){var l=g(D);var z;if(l.tagName=="SCRIPT"){z=l.innerHTML}else{if(l.tagName=="TEXTAREA"){z=l.value}else{LayerMsgBox.alert("多文件上传组件 data-tpl模板指定的组件只能是Script和Textarea",2);return}}if(!z){LayerMsgBox.alert("多文件上传组件 data-tpl指定模板内容为空",2);return}}var t=$(".j_upload_file_box[data-filebox='"+v+"']");var h=r.data("filestyle")||"";var e=t.data("imgviewer")||false;var m=t.data("pdfviewer")||false;var H=t.data("dialogviewer")||false;var p=t.data("dialogviewer-url");var a=t.data("pdfviewer-area")||"1280,80%";var i=t.data("dialogviewer-area")||"1280,80%";var G=t.data("pdfviewer-url");if(isArray(y)){if(z){var I=[];$.each(y,function(L,K){I.push({path:C[L],url:K,fileName:s[L],fileSuffix:getFileExtension(s[L]),isImg:isImg(s[L]),isPdf:isPdf(s[L])})});var d="<div>"+juicer(z,{fileboxId:v,hiddeninputId:F,datas:I})+"</div>";if(d){var x=$(d);var n=x.find(".file");n.data("filebox",v).attr("data-filebox",v).data("hiddeninput",F).attr("data-hiddeninput",F);var E=x.find(".file>[data-imgviewer]");ImageViewerUtil.initViewers(E);r.append(n).show()}else{var u="";var c="";var j="";var B;var b="li_"+randomId(6);$.each(y,function(L,K){u="";B="";c="";j="";if(isImg(K)&&e){u=" data-imgviewer data-album='"+v+"' ";B=K}else{if(isPdf(K)&&m&&G){if(G.indexOf("[file]")!=-1){B=G.replace("[file]",K)}else{B=G+K}c=' data-openpage="dialog" data-btn="close" data-area="'+a+'" '}else{if(H){j=' data-openpage="dialog" data-btn="close" data-area="'+i+'" ';if(p){if(p.indexOf("[file]")!=-1){B=p.replace("[file]",K)}else{B=p+K}}else{B=K}}else{B=K}}}r.append("<li data-randkey='"+b+"'  data-filebox='"+v+"' data-remove-file='"+C[L]+"' data-hiddeninput='"+F+"'><a "+j+u+c+" href='"+B+"' style='"+h+"' target='_blank' data-path='"+C[L]+"'>"+s[L]+"</a><i title='删除' onclick='removeUploadFileBoxLi(this)' class='fa fa-trash text-danger ml-3 hand'></i></li>").show()});var E=r.find("li[data-randkey='"+b+"']>[data-imgviewer]");ImageViewerUtil.initViewers(E)}}else{var u="";var c="";var j="";var B;var b="li_"+randomId(6);$.each(y,function(L,K){u="";B="";c="";j="";if(isImg(K)&&e){u=" data-imgviewer data-album='"+v+"' ";B=K}else{if(isPdf(K)&&m&&G){if(G.indexOf("[file]")!=-1){B=G.replace("[file]",K)}else{B=G+K}c=' data-openpage="dialog" data-btn="close" data-area="'+a+'" '}else{if(H){j=' data-openpage="dialog" data-btn="close" data-area="'+i+'" ';if(p){if(p.indexOf("[file]")!=-1){B=p.replace("[file]",K)}else{B=p+K}}else{B=K}}else{B=K}}}r.append("<li data-randkey='"+b+"' data-filebox='"+v+"' data-remove-file='"+C[L]+"' data-hiddeninput='"+F+"'><a "+j+u+c+" href='"+B+"' style='"+h+"' target='_blank' data-path='"+C[L]+"' >"+s[L]+"</a><i title='删除' onclick='removeUploadFileBoxLi(this)' class='fa fa-trash text-danger ml-3  hand'></i></li>").show()});var E=r.find("li[data-randkey='"+b+"']>[data-imgviewer]");ImageViewerUtil.initViewers(E)}if(w){if(!q){q=C.join(",")}else{q=q+","+C.join(",")}}}else{if(z){var I=[];I.push({path:C,url:y,fileName:s,fileSuffix:getFileExtension(s),isImg:isImg(s),isPdf:isPdf(s)});var d="<div>"+juicer(z,{fileboxId:v,hiddeninputId:F,datas:I})+"</div>";if(d){var x=$(d);var n=x.find(".file");n.data("filebox",v).attr("data-filebox",v).data("hiddeninput",F).attr("data-hiddeninput",F);var E=x.find(".file>[data-imgviewer]");ImageViewerUtil.initViewers(E);r.append(n).show()}else{var u="";var c="";var j="";var B;if(isImg(y)&&e){u=" data-imgviewer data-album='"+v+"' ";B=y}else{if(isPdf(y)&&m&&G){if(G.indexOf("[file]")!=-1){B=G.replace("[file]",y)}else{B=G+y}c=' data-openpage="dialog" data-btn="close" data-area="'+a+'" '}else{if(H){j=' data-openpage="dialog" data-btn="close" data-area="'+i+'" ';if(p){if(p.indexOf("[file]")!=-1){B=p.replace("[file]",y)}else{B=p+y}}else{B=y}}else{B=y}}}r.append("<li data-filebox='"+v+"' data-remove-file='"+C+"' data-hiddeninput='"+F+"'><a "+j+u+c+" href='"+B+"' style='"+h+"' target='_blank' data-path='"+C+"'>"+s+"</a><i title='删除' onclick='removeUploadFileBoxLi(this)' class='fa fa-trash text-danger ml-3 hand'></i></li>").show();var E=r.find("li:last>[data-imgviewer]");ImageViewerUtil.initViewers(E)}}else{var u="";var c="";var j="";var B;if(isImg(y)&&e){u=" data-imgviewer data-album='"+v+"' ";B=y}else{if(isPdf(y)&&m&&G){if(G.indexOf("[file]")!=-1){B=G.replace("[file]",y)}else{B=G+y}c=' data-openpage="dialog" data-btn="close" data-area="'+a+'" '}else{if(H){j=' data-openpage="dialog" data-btn="close" data-area="'+i+'" ';if(p){if(p.indexOf("[file]")!=-1){B=p.replace("[file]",y)}else{B=p+y}}else{B=y}}else{B=y}}}r.append("<li data-filebox='"+v+"' data-remove-file='"+C+"' data-hiddeninput='"+F+"'><a "+j+u+c+" href='"+B+"' style='"+h+"' target='_blank' data-path='"+C+"' >"+s+"</a><i title='删除' onclick='removeUploadFileBoxLi(this)' class='fa fa-trash text-danger ml-3 hand'></i></li>").show();var E=r.find("li:last>[data-imgviewer]");ImageViewerUtil.initViewers(E)}if(w){if(!q){q=C}else{q=q+","+C}}}}else{if(w){if(isArray(C)){q=C.join(",")}else{q=C}}}if(w){w.val(q)}}function uploadFileToQiniu(uploader,type,fileDatas,hiddeninput,filenameInput,sizeinput,isMultiple,imgbox,loading,successCallback,failCallback){if(isMultiple&&fileDatas.length==0){return false}if(!isMultiple&&!fileDatas.size){return false}var sn=uploader.data("bucket-sn")||"default";Ajax.get("admin/qiniu/uploadParas?sn="+sn,function(res){if(res.data){uploader.completeCount=0;uploader.totalSize=isMultiple?fileDatas.length:1;uploader.qiniuFiles=new Array(uploader.totalSize);_uploadFileToQiniu(uploader,type,fileDatas,loading,res.data,isMultiple,function(){try{var qiniuFiles=uploader.qiniuFiles;if(!isMultiple&&sizeinput){$("#"+sizeinput).val(qiniuFiles[0].fileSize)}if((type=="img")&&hiddeninput&&isOk(qiniuFiles)){processImgUploadCallback({data:qiniuFiles},hiddeninput,isMultiple,imgbox,false)}else{if((type=="file")&&hiddeninput&&isOk(qiniuFiles)){processFileUploadCallback({data:(isMultiple?(uploader.totalSize==1?qiniuFiles[0]:qiniuFiles):qiniuFiles[0])},hiddeninput,filenameInput,isMultiple,imgbox)}}if(successCallback){var exe_callback=eval(successCallback);if(exe_callback&&typeof(exe_callback)=="function"){exe_callback(uploader,type,{data:qiniuFiles})}}}catch(e){if(failCallback){var exe_callback=eval(failCallback);if(exe_callback&&typeof(exe_callback)=="function"){exe_callback(uploader,type)}}else{LayerMsgBox.alert("上传失败",2)}}finally{LayerMsgBox.success("上传成功",1000)}})}else{LayerMsgBox.alert("获取七牛upload token失败",2)}})}function _uploadFileToQiniu(f,k,a,c,h,e,p){var m=f.data("timeout")||jboltAjaxTimeout;LayerMsgBox.loading(c?c:"上传中",m);var j=f.data("file-key");if(!j){j=date(new Date(),"yyyyMMdd_"+randomId())}else{j=j.replaceAll("[dateTime]",date(new Date(),"yyyyMMddHHmmss"));j=j.replaceAll("[date]",date(new Date(),"yyyyMMdd"));j=j.replaceAll("[randomId]",randomId())}var b={useCdnDomain:true,disableStatisticsReport:false,retryCount:6,region:getQiniuRegion(h.region)};var o={fname:"",params:{},mimeType:null};var l,n=f.totalSize;for(var d=0;d<n;d++){if(e){l=(n==1?a[0]:a[d])}else{l=(n==1?a:a[d])}__uploadFileToQiniu(f,d,l,j,h,k,o,b,p)}}function __uploadFileToQiniu(f,h,l,k,i,j,n,c,m){var e;if(k.indexOf("[filename]")!=-1){e=k.replaceAll("[filename]",l.name)}else{e=k+"/"+l.name}e=e.replaceAll("//","/");var d=parseInt((l.size/1024).toFixed(0));var a=qiniu.upload(l,e,i.token,n,c);var b=a.subscribe(function(o){},function(o){alert("上传七牛出现异常:"+JSON.stringify(o))},function(p){f.completeCount=f.completeCount+1;var o="";if(i.domain.endWith("/")){if(p.key.startWith("/")){p.key=p.key.subString(1)}o=i.domain+p.key}else{if(p.key.startWith("/")){o=i.domain+p.key}else{o=i.domain+"/"+p.key}}f.qiniuFiles[h]={url:o,fileSize:d,fileName:p.key};if(f.completeCount==f.totalSize&&m){m()}})}function getQiniuRegion(b){var a="";switch(b){case"z0":a=qiniu.region.z0;break;case"z1":a=qiniu.region.z1;break;case"z2":a=qiniu.region.z2;break;case"na0":a=qiniu.region.na0;break;case"as0":a=qiniu.region.as0;break}return a}function uploadFile(type,url,name,fileDatas,hiddeninput,filenameInput,sizeinput,isMultiple,imgbox,loading,successCallback,failCallback,dontShowDefaultSuccessMsg){if(!fileDatas){return false}if(isMultiple&&fileDatas.length==0){return false}if(!isMultiple&&!fileDatas.size){return false}var timeout=jboltAjaxTimeout;if(isOk(hiddeninput)){timeout=hiddeninput.data("timeout")||jboltAjaxTimeout}LayerMsgBox.loading(loading?loading:"上传中",timeout);var fileSize=isMultiple?0:parseInt((fileDatas.size/1024).toFixed(0));var fd=new FormData();if(isMultiple){$.each(fileDatas,function(i,fileData){fd.append(name,fileData)})}else{fd.append(name,fileDatas)}url=actionUrl(url);$.ajax({type:"POST",url:url,data:fd,timeout:timeout,cache:false,async:true,processData:false,contentType:false,success:function(res){if(res.state=="ok"){if(sizeinput){$("#"+sizeinput).val(fileSize)}if((type=="img")&&hiddeninput&&res.data){processImgUploadCallback(res,hiddeninput,isMultiple,imgbox,true)}else{if((type=="file")&&res.data){processFileUploadCallback(res,hiddeninput,filenameInput,isMultiple,imgbox)}}if(successCallback){var exe_callback=eval(successCallback);if(exe_callback&&typeof(exe_callback)=="function"){exe_callback(type,res)}}if(!dontShowDefaultSuccessMsg){LayerMsgBox.success("上传成功",1000)}}else{if(failCallback){LayerMsgBox.closeLoadingNow();var exe_callback=eval(failCallback);if(exe_callback&&typeof(exe_callback)=="function"){exe_callback(type,res)}}else{LayerMsgBox.alert(res.msg,2)}}},error:function(err){LayerMsgBox.error("网络异常",1000)}})}function getBase64Image(b){var c=document.createElement("canvas");c.width=b.width;c.height=b.height;var a=c.getContext("2d");a.drawImage(b,0,0,b.width,b.height);var d=c.toDataURL("image/png");return d}function dataURItoBlob(b){var f=atob(b.split(",")[1]);var a=b.split(",")[0].split(":")[1].split(";")[0];var e=new ArrayBuffer(f.length);var c=new Uint8Array(e);for(var d=0;d<f.length;d++){c[d]=f.charCodeAt(d)}return new Blob([e],{type:a})}var FileUploadUtil={tpl:'<button id="${buttonId}" data-inputid="${inputId}" type="button" class="j_upload_file ${btnClass}" style="{@if width}width:${width}px;{@/if}{@if height}height:${height}px;{@/if}{@if fontSize}font-size:${fontSize}px;{@/if}"><div class="placeholder"><i class="fa fa-upload {@if placeholder}mr-2{@/if}"></i>${placeholder}</div></button><div class="j_upload_file_box_msg"><span class="j_file_name"></span><i class="fa fa-remove text-danger j_remove_file"></i></div>',input_tpl:'<div class="j_upload_file_input"><input data-btnid="${buttonId}" id="${inputId}"  {@if multi}multiple="multiple"{@/if}  type="file" {@if accept}accept="${accept}"{@/if} {@if rule}data-rule="${rule}"{@/if} {@if tips}data-tips="${tips}"{@/if}  /></div>',initFileBoxUI:function(b){if(!isOk(b)){return false}var j=b.length;var f,o,l,c,p,d,a,h,k,n,q,m;for(var e=0;e<j;e++){o="选择文件";a="";c=0;p="100%";f=b.eq(e);if(!f.hasClass("j_upload_file_box")){f.addClass("j_upload_file_box")}d=f.data("accept");if(d){a=getRealAccept(d)}c=f.data("width")||c;p=f.data("height")||p;l=f.data("placeholder");if(l){l=$.trim(l);if(l=="none"){o=""}else{o=l}}h=f.data("multi")||false;q=randomId();k="jufbtn_"+q;n="jufipt_"+q;f.html(juicer(this.tpl,{buttonId:k,inputId:n,width:c,height:p,placeholder:o,fontSize:f.data("font-size"),btnClass:(f.data("btn-class")||"btn btn-outline-primary")}));jboltBody.append(juicer(this.input_tpl,{buttonId:k,inputId:n,rule:f.data("rule"),tips:f.data("tips"),multi:h,accept:a}));if(!h){this.initValueMsg(f)}this.initFileBoxDatas(f)}},initValueMsg:function(c){var e=c.data("show-result");if(typeof(e)=="boolean"&&!e){return}var a=c.find("div.j_upload_file_box_msg");if(notOk(a)){return}var d=c.data("value");if(!d){return}var b=c.data("value-attr");if(d.indexOf(".")!=-1){var f=getFileName(d);if(f){a.find("span.j_file_name").text(f);a.addClass("show")}}},initExistFileLi:function(c,b,d){var a=c.find(".file");if(isOk(a)){a.data("filebox",b).attr("data-filebox",b);if(d){a.data("hiddeninput",d).attr("data-hiddeninput",d)}}},initFileBoxDatas:function(t){var v=t.data("filebox");if(!v){return}var r=$("#"+v);if(!isOk(r)){return}var I=t.data("hidden-input")||t.data("hiddeninput");this.initExistFileLi(r,v,I);var B=r.data("files");if(!B){return}var j=r.data("filestyle")||"";var o=[];if(typeof(B)=="string"){if(B.indexOf("[")==-1&&B.indexOf(":")==-1){var s=JSON.parse(B);var x=r.data("path-attr")||"path";var b=r.data("url-attr")||"url";var F=r.data("filename-attr")||"fileName";var A=s.length;var C;for(var G=0;G<A;G++){C=s[G];o.push({path:C[x],url:C[b],fileName:C[F],fileSuffix:getFileExtension(C[F]),isImg:isImg(C[F]),isPdf:isPdf(C[F])})}}else{if(B.indexOf(",")!=-1&&B.indexOf(":")==-1){var m=B.split(",");for(var G in m){o.push({path:m[G],url:m[G],fileName:getFileName(m[G]),fileSuffix:getFileExtension(m[G]),isImg:isImg(m[G]),isPdf:isPdf(m[G])})}}else{o.push({path:B,url:B,fileName:getFileName(B),fileSuffix:getFileExtension(B),isImg:isImg(B),isPdf:isPdf(B)})}}}else{if(isArray(B)){var s=B;var x=r.data("path-attr")||"path";var b=r.data("url-attr")||"url";var F=r.data("filename-attr")||"fileName";var A=s.length;var C;for(var G=0;G<A;G++){C=s[G];o.push({path:C[x],url:C[b],fileName:C[F],fileSuffix:getFileExtension(C[F]),isImg:isImg(C[F]),isPdf:isPdf(C[F])})}}}if(o.length==0){return}var E=r.data("tpl");var y;if(E){var n=g(E);var y;if(n.tagName=="SCRIPT"){y=n.innerHTML}else{if(n.tagName=="TEXTAREA"){y=n.value}else{LayerMsgBox.alert("多文件上传组件 data-tpl模板指定的组件只能是Script和Textarea",2);return}}if(!y){LayerMsgBox.alert("多文件上传组件 data-tpl指定模板内容为空",2);return}}var f=t.data("imgviewer")||false;var p=t.data("pdfviewer")||false;var K=t.data("dialogviewer")||false;var q=t.data("dialogviewer-url");var a=t.data("pdfviewer-area")||"1280,80%";var k=t.data("dialogviewer-area")||"1280,80%";var J=t.data("pdfviewer-url");var e=[];if(y){var d="<div>"+juicer(y,{fileboxId:v,hiddeninputId:I,datas:o})+"</div>";var w=$(d);w.find(".file").data("filebox",v).attr("data-filebox",v).data("hiddeninput",I).attr("data-hiddeninput",I);r.append(w.html()).show()}else{var u="";var c="";var l="";var z;$.each(o,function(M,L){u="";z="";c="";l="";if(L.isImg&&f){u=" data-imgviewer data-album='"+v+"' ";z=L.url}else{if(L.isPdf&&p&&J){if(J.indexOf("[file]")!=-1){z=J.replace("[file]",L.url)}else{z=J+L.url}}else{if(K){l=' data-openpage="dialog" data-btn="close" data-area="'+k+'" ';if(q){if(q.indexOf("[file]")!=-1){z=q.replace("[file]",L.url)}else{z=q+L.url}}else{z=L.url}}else{z=L.url}}}r.append("<li data-filebox='"+v+"' data-hiddeninput='"+I+"'><a "+l+u+c+" href='"+z+"' style='"+j+"' target='_blank' data-path='"+L.path+"' >"+L.fileName+"</a><i title='删除' onclick='removeUploadFileBoxLi(this)' class='fa fa-trash text-danger ml-3 hand'></i></li>").show()})}var H=r.find("[data-imgviewer]");if(isOk(H)){ImageViewerUtil.initViewers(H)}$.each(o,function(M,L){e.push(L.path)});if(e.length>0){var h=$("#"+I);if(isOk(h)){var D=$.trim(h.val());if(!D){h.val(e.join(","))}}}},oneFileBoxProcess:function(box,file){var fileInput=file;var that=this;var fileValue=file.val();var arr=fileValue.split("\\");var fileName=arr[arr.length-1];box.find("span.j_file_name").text(fileName);var multi=box.data("multi")||false;var showResult=box.data("show-result");if(!multi&&(typeof(showResult)=="undefined"||(typeof(showResult)=="boolean"&&showResult))){box.find("div.j_upload_file_box_msg").addClass("show")}box.closest(".form-group").removeClass("has-error");var imgpreview=box.data("imgpreview");if(imgpreview){if(isImg(fileName)){var imgpreviewBox=$(imgpreview);if(imgpreviewBox&&imgpreviewBox.length){var url=getObjectURL(file[0]);if(url){imgpreviewBox.html("<img src='"+url+"'/>")}}}}var handler=box.data("handler");if(handler){var url=box.data("url");if(!url&&handler=="uploadFile"){that.clearIt(box);LayerMsgBox.alert("未设置文件上传地址 data-url",2);return}if(url){url=processEleUrlByLinkOtherParamEle(box,url)}var hiddeninputId=box.data("hidden-input")||box.data("hiddeninput");var sizeinput=box.data("size-input")||box.data("sizeinput");var fileNameInput=box.data("filename-input")||box.data("filenameinput");var fileName=box.data("filename");if(!fileName){fileName="file"}var ucallback=box.data("upload-success-handler")||box.data("upload-success-callback");var failcallback=box.data("upload-fail-handler")||box.data("upload-fail-callback");var hiddeninput;if(hiddeninputId){hiddeninput=$("#"+hiddeninputId);if(isOk(hiddeninput)){var timeout=box.data("timeout");if(timeout){hiddeninput.data("timeout",timeout).attr("data-timeout",timeout)}if(!hiddeninput[0].hasAttribute("data-value-attr")){var valueAttr=box.data("value-attr");if(valueAttr){hiddeninput.data("value-attr",valueAttr).attr("data-value-attr",valueAttr)}}}}var loading=box.data("loading");var showDefaultSuccessMsg=box.data("show-default-success-msg");if(typeof(showDefaultSuccessMsg)=="undefined"){showDefaultSuccessMsg=true}if(handler=="uploadFile"){uploadFile("file",url,fileName,file[0].files[0],hiddeninput,fileNameInput,sizeinput,null,null,loading,function(type,res){if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(box,type,fileInput,res)}}},function(type,res){if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(box,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传异常",2)}},!showDefaultSuccessMsg)}else{if(handler=="uploadFileToQiniu"){loadJBoltPlugin(["qiniu"],function(){uploadFileToQiniu(box,"file",file[0].files[0],hiddeninput,fileNameInput,sizeinput,false,null,loading,function(type,res){if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(box,type,fileInput,res)}}},function(type,res){if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(box,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传异常",2)}})})}else{if(handler=="clear"){that.clearIt(box)}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(box,"file",fileInput,fileValue)}}}}}},changeFile:function(e,d){var c=this;var b=e.data("accept");var i=e.data("maxsize");var h=e.data("filename-maxlength")||50;var a=d.val();if(a){if(validateFile(d,b,i,h)){var f=e.data("confirm");if(f){LayerMsgBox.confirm(f,function(){c.oneFileBoxProcess(e,d)},function(){c.clearIt(e)})}else{c.oneFileBoxProcess(e,d)}}else{c.clearIt(e);return false}}else{c.clearIt(e)}},changeFiles:function(uploder,fileInput,fileDatas){var maxSize=uploder.data("maxsize");var fileNameMaxLength=uploder.data("filename-maxlength")||50;var fileValue=fileInput.val();var handler=uploder.data("handler");var accept=uploder.data("accept")||"file";if(fileValue){if(!validateFileDatas(fileDatas,accept,maxSize,fileNameMaxLength)){fileInput.val("");return false}}else{fileInput.val("")}if(handler){var url=uploder.data("url");if(!url&&handler=="uploadMultipleFile"){that.clearIt(box);LayerMsgBox.alert("未设置文件上传地址 data-url",2);return}if(url){url=processEleUrlByLinkOtherParamEle(uploder,url)}LayerMsgBox.loading("处理中",10000);var hiddeninputId=uploder.data("hidden-input")||uploder.data("hiddeninput");var filebox=uploder.data("filebox");var limit=uploder.data("limit")||9;if(filebox){var files=$("#"+filebox+" li.file");if((isOk(files)&&(files.length>=limit||(files.length+fileDatas.length>limit)))||fileDatas.length>limit){LayerMsgBox.alert("最多上传["+limit+"]个文件",5);uploder.find("input[type='file']").val("");return false}}var fileName=uploder.data("filename");if(!fileName){fileName="file"}var ucallback=uploder.data("upload-success-handler")||uploder.data("upload-success-callback");var failcallback=uploder.data("upload-fail-handler")||uploder.data("upload-fail-callback");var hiddeninput;if(hiddeninputId){hiddeninput=$("#"+hiddeninputId);if(isOk(hiddeninput)){var timeout=uploder.data("timeout");if(timeout){hiddeninput.data("timeout",timeout).attr("data-timeout",timeout)}if(!hiddeninput[0].hasAttribute("data-value-attr")){var valueAttr=uploder.data("value-attr");if(valueAttr){hiddeninput.data("value-attr",valueAttr).attr("data-value-attr",valueAttr)}}}}var loading=uploder.data("loading");var showDefaultSuccessMsg=uploder.data("show-default-success-msg");if(typeof(showDefaultSuccessMsg)=="undefined"){showDefaultSuccessMsg=true}if(handler=="uploadMultipleFile"){uploadFile("file",url,fileName,fileDatas,hiddeninput,null,null,true,filebox,loading,function(type,res){fileInput.val("");if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}},function(type,res){fileInput.val("");if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传异常",2)}},!showDefaultSuccessMsg)}else{if(handler=="uploadMultipleFileToQiniu"){loadJBoltPlugin(["qiniu"],function(){uploadFileToQiniu(uploder,"file",fileDatas,hiddeninput,null,null,true,filebox,loading,function(type,res){fileInput.val("");if(ucallback){var execa_handler=eval(ucallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}},function(type,res){fileInput.val("");if(failcallback){LayerMsgBox.closeLoadingNow();var execa_handler=eval(failcallback);if(execa_handler&&typeof(execa_handler)=="function"){execa_handler(uploder,type,fileInput,res)}}else{LayerMsgBox.alert(res.msg||"上传异常",2)}})})}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(uploder,type,fileInput)}}}}},initFileBoxEvent:function(fileBoxs){if(!isOk(fileBoxs)){return false}var that=this,fbox,fbtn;fileBoxs.each(function(){fbox=$(this);fbtn=fbox.find("button");fbtn.off("click").on("click",function(e){e.preventDefault();e.stopPropagation();var innerInputId=$(this).data("inputid");var fileInput=jboltBody.find(".j_upload_file_input>input#"+innerInputId);if(isOk(fileInput)){fileInput.trigger("click")}return false});jboltBody.find("input[type='file']#"+fbtn.data("inputid")).off("change").on("change",function(event){var files=event.target.files;var file=$(this);var btnId=file.data("btnid");var linkBtn=jboltBody.find("button#"+btnId);var box=linkBtn.closest(".j_upload_file_box");if(files.length>0){var multi=box.data("multi")||false;if(multi){that.changeFiles(box,file,files)}else{that.changeFile(box,file)}var finallyHandler=box.data("finally-handler");if(finallyHandler&&finallyHandler=="clear"){that.clearIt(box)}else{var exe_finallyHandler=eval(finallyHandler);if(exe_finallyHandler&&typeof(exe_finallyHandler)=="function"){exe_finallyHandler(box,file)}}}else{that.clearIt(box)}})});fileBoxs.find(".j_remove_file").on("click",function(){var removefile=$(this);var box=removefile.closest(".j_upload_file_box");that.clearIt(box)})},init:function(c){var b=this;var a=getRealParentJqueryObject(c);if(!isOk(a)){return false}var d=a.find(".j_upload_file_box,[data-fileuploader]");if(isOk(d)){b.initFileBoxUI(d);b.initFileBoxEvent(d)}},clearIt:function(uploder){var rf=function(){var inputId=uploder.find("button").data("inputid");var fileInput=jboltBody.find("input[type='file']#"+inputId);fileInput.val("");uploder.find("span.j_file_name").text("");uploder.find("div.j_upload_file_box_msg").removeClass("show");uploder.find(".j_upload_file").removeClass("j_reupload");var hiddenInputId=uploder.data("hidden-input");if(hiddenInputId){var hiddenInput=$("#"+hiddenInputId);if(isOk(hiddenInput)){hiddenInput.val("");uploder.hiddenInput=hiddenInput}}var imgpreview=uploder.data("imgpreview");if(imgpreview){imgpobj=getRealJqueryObject(imgpreview);if(isOk(imgpobj)){imgpobj.empty();uploder.imgpreview=imgpreview}}var removehandler=uploder.data("remove-handler");if(removehandler){var rhexe=eval(removehandler);if(rhexe&&typeof(rhexe)=="function"){rhexe(uploder)}}};var removeConfirm=uploder.data("remove-confirm");var removeUrl=uploder.data("remove-url");if(removeUrl&&removeUrl.indexOf("[file]")!=-1){var hiddeninputId=uploder.data("hidden-input")||uploder.data("hiddeninput");if(hiddeninputId){var hiinput=$("#"+hiddeninputId);if(isOk(hiinput)){var hipt_value=hiinput.val();if(hipt_value){removeUrl=removeUrl.replace("[file]",hipt_value)}}}}if(removeConfirm){var cfMsg;if(typeof(removeConfirm)=="string"){cfMsg=removeConfirm}else{cfMsg="确认删除已选文件？"}LayerMsgBox.confirm(cfMsg,function(){if(removeUrl){LayerMsgBox.loading("正在删除...",4000);Ajax.get(removeUrl,function(res){LayerMsgBox.closeLoadingNow();rf();LayerMsgBox.success("删除成功",500)})}else{rf()}})}else{if(removeUrl){LayerMsgBox.loading("正在删除...",4000);Ajax.get(removeUrl,function(res){LayerMsgBox.closeLoadingNow();rf();LayerMsgBox.success("删除成功",500)})}else{rf()}}}};var LayerMsgBox={alert:function(c,b,a){if(b){layer.alert(c,{icon:b},function(d){if(a){a()}layer.close(d)})}else{layer.alert(c,function(d){if(a){a()}layer.close(d)})}},confirm:function(c,a,b){layer.confirm(c,{icon:3,title:"请选择"},function(d){if(a){a()}layer.close(d)},function(d){if(b){b()}layer.close(d)})},success:function(d,c,b){if(!d){d="操作成功"}if(!c){c=1000}var a=layer.msg(d,{time:c,icon:1},function(){if(b){b()}});return a},error:function(d,c,b){if(!d){d="错误"}if(!c){c=1500}var a=layer.msg(d,{time:c,icon:2},function(){if(b){b()}});return a},prompt:function(d,e,c,b){if(b==undefined&&b!=0){b=2}var a=layer.prompt({title:d,value:(e?e:""),formType:b},function(h,f){if(c){c(f,h)}});return a},loading:function(d,c,b){if(!d){d="执行中..."}var a=null;c=(c?c:10000);if(c){a=layer.msg(d,{time:c,icon:16,shade:0.3},function(){if(b){b()}})}else{a=layer.msg(d,{icon:16})}return a},close:function(a){layer.close(a)},closeAll:function(a){if(a){layer.closeAll(a)}else{layer.closeAll()}},closeLoading:function(){setTimeout(function(){layer.closeAll("dialog")},500)},closeLoadingNow:function(){layer.closeAll("dialog")},load:function(b,c){var a=null;if(c){a=layer.load(b,{time:c})}else{a=layer.load(b)}return a},closeLoad:function(){setTimeout(function(){layer.closeAll("loading")},200)},closeLoadNow:function(){layer.closeAll("loading")}};var jboltAjaxTimeout=60000;var Ajax={uploadBase64File:function(d,b,i,h,c,e,f){var a=dataURItoBlob(b);this.uploadBlob(d,a,i,h,c,e,f)},uploadBlob:function(c,a,i,h,b,d,e){var f=new FormData();f.append("file",a,i);this.uploadFormData(c,f,h,b,d,e)},uploadFormData:function(b,f,h,a,d,e){var c=true;if(d){c=false}b=actionUrl(b);$.ajax({url:b,type:"post",processData:false,contentType:false,timeout:e?e:jboltAjaxTimeout,async:c,data:f,success:function(i){if(i.state=="ok"){processAjaxResultNeedConfirmOr(window.processAjaxResultNeedConfirmOrEle,i,function(){if(h){h(i)}})}else{if(i.msg&&i.msg=="jbolt_system_locked"){showJboltLockSystem()}else{if(i.msg&&i.msg=="jbolt_nologin"){showReloginDialog()}else{if(i.msg&&i.msg=="jbolt_terminal_offline"){showReloginDialog();LayerMsgBox.alert("当前用户已在其它终端登录，本机已下线",2)}else{LayerMsgBox.closeLoadingNow();if(a){LayerMsgBox.alert(i.msg?i.msg:"上传异常",2);a(i)}else{LayerMsgBox.alert(i.msg,2)}}}}}},error:function(){var k=xhr.responseJSON;var j="网络通讯异常";var i;if(k){i=k.msg||j}else{i=j}LayerMsgBox.alert(i,2);if(a){a()}}});jboltAjaxTimeout=60000},post:function(a,c,j,e,h,f,d){var b=true;if(h){b=false}a=actionUrl(a);var i="application/x-www-form-urlencoded";if(typeof c=="string"){i="application/json"}$.ajax({url:a,type:"post",contentType:i,dataType:d?d:"json",timeout:f?f:jboltAjaxTimeout,async:b,data:c,success:function(k){if(k.state=="ok"){processAjaxResultNeedConfirmOr(window.processAjaxResultNeedConfirmOrEle,k,function(){if(j){j(k)}})}else{if(k.msg&&k.msg=="jbolt_system_locked"){showJboltLockSystem()}else{if(k.msg&&k.msg=="jbolt_nologin"){showReloginDialog()}else{if(k.msg&&k.msg=="jbolt_terminal_offline"){showReloginDialog();LayerMsgBox.alert("当前用户已在其它终端登录，本机已下线",2)}else{LayerMsgBox.closeLoadingNow();if(e){LayerMsgBox.alert(k.msg?k.msg:"请求异常",2);e(k)}else{LayerMsgBox.alert(k.msg,2)}}}}}},error:function(n,k,l){var p=n.responseJSON;var o="网络通讯异常";var m;if(p){m=p.msg||o}else{m=o}LayerMsgBox.alert(m,2);if(e){e()}}});jboltAjaxTimeout=60000},getWithForm:function(a,c,h,b,e,f){var d=getRealJqueryObject(a);if(!isOk(d)){LayerMsgBox.alert("请指定正确的formEle参数",2);return false}c=urlWithFormData(c,d);this.get(c,h,b,e,f)},get:function(b,h,a,e,f,c){var d=true;if(e){d=false}b=actionUrl(b);$.ajax({url:b,type:"get",dataType:c?c:"json",timeout:f?f:jboltAjaxTimeout,async:d,success:function(i){if(i.state=="ok"){processAjaxResultNeedConfirmOr(window.processAjaxResultNeedConfirmOrEle,i,function(){if(h){h(i)}})}else{if(i.msg&&i.msg=="jbolt_system_locked"){showJboltLockSystem()}else{if(i.msg&&i.msg=="jbolt_nologin"){showReloginDialog()}else{if(i.msg&&i.msg=="jbolt_terminal_offline"){showReloginDialog();LayerMsgBox.alert("当前用户已在其它终端登录，本机已下线",2)}else{LayerMsgBox.closeLoadingNow();if(a){LayerMsgBox.alert(i.msg?i.msg:"请求异常",2);a(i)}else{LayerMsgBox.alert(i.msg,2)}}}}}},error:function(l,i,j){var n=l.responseJSON;var m="网络通讯异常";var k;if(n){k=n.msg||m}else{k=m}LayerMsgBox.alert(k,2);if(a){a()}}});jboltAjaxTimeout=60000}};function processOptionValue(b,c){var a=b[c];if(!a&&(a=="undefined"||a==undefined)){if(c!="value"){a=b.value;if(!a&&(a=="undefined"||a==undefined)){a=b.id}}else{a=b.id}}return a}function processOptionTextByFormatHandler(handler,data,text_attr,delimiter){if(!handler){return processOptionText(data,text_attr,delimiter)}var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){return exe_handler(data)}return processOptionText(data,text_attr,delimiter)}function processOptionText(h,f,b){var j="";if(f.indexOf(",")==-1){j=h[f];if(!j&&(j=="undefined"||j==undefined)){if(f!="text"){j=h.text;if(!j&&(j=="undefined"||j==undefined)){j=h.name;if(!j&&(j=="undefined"||j==undefined)){j=h.title}}}else{if(!j&&(j=="undefined"||j==undefined)){j=h.name;if(!j&&(j=="undefined"||j==undefined)){j=h.title}}}}return j}var c=f.split(",");var e,a=c.length;for(var d=0;d<a;d++){e=h[c[d]];if(!b){j=j+"["+(e?e:"-")+"]"}else{j=j+(e?e:"*")+((d<a-1)?b:"")}}return j}var formInputValueControls=["input","textarea","select"];function isFormInputValueControl(c){var b=c,a;if(!isDOM(c)){b=c[0]}a=b.tagName.toLowerCase();return formInputValueControls.indexOf(a)!=-1}function syncOtherInput(c,b){var a=$(b);if(isOk(a)){var a;a.each(function(){a=$(this);if(!$.trim(a.val())){a.val(c).trigger("change");FormChecker.checkIt(a)}})}}var SelectUtil={setValueToOther:function(a){var b=a.data("setvalueto");if(b){var h=$("#"+b);if(isOk(h)){var d=a.data("select-type");var c=a.val();if(d&&d=="select2"){var f=a.data("text");if(f){var e=a.find("option").first();if(e.is(":selected")){if(c&&c.length>0){c.shift()}}}}if(isFormInputValueControl(h)){h.val(c?c:"").change()}else{h.text(c?c:"")}if(d&&d=="select2"){var f=a.data("text");setTimeout(function(){var i=new RegExp("&nbsp;","g");a.next().find("li.select2-selection__choice").each(function(){var j=$(this);if(f&&j.attr("title")==f){j.remove()}else{var k=j.html();k=k.replace(i,"");k=k.replace("├","");j.html(k)}})},60)}}}else{LayerMsgBox.alert("请配置data-setvalueto属性",2)}},setTextToOther:function(h){var c=h.data("settextto");if(c){var j=$("#"+c);if(isOk(j)){var f=h.data("select-type");var b=h.find("option:selected");var a=new RegExp("&nbsp;","g");var m=h.data("text");if(f&&f=="select2"){setTimeout(function(){h.next().find("li.select2-selection__choice").each(function(){var n=$(this);if(m&&n.attr("title")==m){n.remove()}else{var o=n.html();o=o.replace(a,"");o=o.replace("├","");n.html($.trim(o))}})},60)}if(isOk(b)){var k=isFormInputValueControl(j);var d=b.length;if(m&&d==1&&m==b.text()){if(k){j.val("").change()}else{j.text("")}return}var l=new Array(),e;b.each(function(){e=$(this).text();if(m&&m==e){return}e=e.replace(a,"");e=e.replace("├","");e=$.trim(e);l.push(e)});if(isOk(l)){var i=l;if(l.length==1){i=l[0]}else{i=l.join(",")}if(k){j.val(i).change()}else{j.text(i)}}}else{if(k){j.val("").change()}else{j.text("")}}}}else{LayerMsgBox.alert("请配置data-settextto属性",2)}},syncAttrToOther:function(i){var b=i.data("sync-ele")||i.data("sync-input")||i.data("syncele")||i.data("syncinput");if(!isOk(b)){return}var e=i.data("option-datas");var k=i.data("sync-must");if(typeof(k)=="undefined"){k=true}if(!isOk(e)){$(b).each(function(){if(isFormEle(this.tagName)){if(this.value){if(k){this.value=""}}else{this.value=""}}else{if(this.innerText){if(k){this.innerText=""}}else{this.innerText=""}}});return}var h=i.data("text");var d=i.prop("selectedIndex");if(d<=0){if(h||d<0){$(b).each(function(){if(isFormEle(this.tagName)){if(this.value){if(k){this.value=""}}else{this.value=""}}else{if(this.innerText){if(k){this.innerText=""}}else{this.innerText=""}}});return}}else{if(h){d=d-1}}var j,f,c,a=e[d];$(b).each(function(){j=$(this);if(a){f=j.data("sync-attr")||j.data("value-attr");if(f){c=a[f]}}else{c=""}if(typeof(c)=="undefined"){c=""}if(isFormEle(this.tagName)){if(this.value){if(k){this.value=c;j.change()}}else{this.value=c;j.change()}}else{if(this.innerText){if(k){this.innerText=c}}else{this.innerText=c}}})},processItems:function(f,c,r,o,d,m,t,s,h,a){var e=this;var l,n,k,v;var u="&nbsp;&nbsp;&nbsp;&nbsp;";var q="&nbsp;&nbsp;&nbsp;";if(a>2){for(var p=0;p<(a-2);p++){u=u+q}}u=u+"├";for(var p in r){k=r[p];v=k.items;var b=v&&v.length>0;l=u+processOptionTextByFormatHandler(d,k,m,s);n=processOptionValue(k,t);var j='<option value="'+n+'">'+l+"</option>";if(b&&h){j='<optgroup data-value="'+n+'" label="'+l+'">'}else{j='<option value="'+n+'">'+l+"</option>"}if(o){j=o(j,k)}f+=j;c.push(k);if(b){f=e.processItems(f,c,v,o,d,m,t,s,h,(a+1));if(h){f+="</optgroup>"}}}return f},processChangeEventHandler:function(_thisSelect,setting){var that=this;if(setting&&setting.handler){if(setting.handler=="setValueToOther"){that.setValueToOther(_thisSelect);return true}if(setting.handler=="setTextToOther"){that.setTextToOther(_thisSelect);return true}if(setting.handler=="syncAttrToOther"){that.syncAttrToOther(_thisSelect);return true}if(setting.handler=="refreshPortal"||setting.handler=="changePortal"){processRefreshAjaxPortalHandler(_thisSelect);return true}if(setting.handler=="refreshJstree"){var jstreeId=_thisSelect.data("jstree-id");refreshJstreeHandler(jstreeId);return true}that.processSetValueOrTextToOther(_thisSelect);setting.handler(_thisSelect);return true}var handler=_thisSelect.data("handler");if(handler){if(handler=="setValueToOther"){that.setValueToOther(_thisSelect);return true}if(handler=="setTextToOther"){that.setTextToOther(_thisSelect);return true}if(handler=="syncAttrToOther"){that.syncAttrToOther(_thisSelect);return true}if(handler=="refreshPortal"||handler=="changePortal"){processRefreshAjaxPortalHandler(_thisSelect);return true}if(handler=="refreshJstree"){var jstreeId=_thisSelect.data("jstree-id");refreshJstreeHandler(jstreeId);return true}that.processSetValueOrTextToOther(_thisSelect);that.syncAttrToOther(_thisSelect);try{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(_thisSelect)}}catch(e){}}else{that.processSetValueOrTextToOther(_thisSelect);that.syncAttrToOther(_thisSelect);var jbolttableHandler=_thisSelect.data("jbolttable-handler");if(jbolttableHandler){var table=_thisSelect.closest("table");if(isOk(table)){var jboltTable=table.jboltTable("inst");if(jboltTable){var td=_thisSelect.closest("td");var selectedIndex=_thisSelect.prop("selectedIndex");var data={};if(_thisSelect.data("text")){selectedIndex=selectedIndex-1}if(selectedIndex>=0){var datas=_thisSelect.data("option-datas");data=datas[selectedIndex]}var isChangeColumns=td.data("jbolttable-handler-ischangecolumns");if(!isChangeColumns){jboltTable.me.processColConfigChangeColumns(jboltTable,td,data)}var jsonData=jboltTable.tableListDatas[td.closest("tr").data("index")];jbolttableHandler(jboltTable,td,_thisSelect.find("option:selected").text(),_thisSelect.val(),jsonData,data)}}}}},processSetValueOrTextToOther:function(d){var c=this,b=d.data("setvalueto"),a=d.data("settextto");if(b){c.setValueToOther(d)}if(a){c.setTextToOther(d)}},refresh:function(a){var c=getRealParentJqueryObject(a);if(isOk(c)){var b=c.data("setting");LayerMsgBox.loading("正在刷新数据...",10000);this.readAndInsertItems(c,b,true)}},readAndInsertItems:function(f,c,e){var d=this;f.empty();f.data("setting",c);if(f.data("text")){var b=f.data("value");if(typeof(b)=="undefined"){b=""}f.append('<option data-empty="true" value="'+b+'">'+f.data("text")+"</option>")}var a=null;if(c&&c.url){a=c.url}else{a=f.data("url")}if(a){a=actionUrl(a);a=processEleUrlByLinkOtherParamEle(f,a,false);if(!a){return false}a=processJBoltTableEleUrlByLinkColumn(f,a);if(!a){return false}$.ajax({type:"GET",url:a,dataType:"json",timeout:10000,context:f,success:function(h){if(e){LayerMsgBox.closeLoading()}d.processSetOptionsHandler(f,c,e,h);if(e){if("select2"==f.data("select-type")){FormChecker.checkIt(f,true,true)}}d.processDefaultValue(f)}})}},processDefaultValue:function(d){var b=d.data("default");var e=d.data("text");var c=d.val();var a=d.data("option-datas");if(e&&(typeof(c)=="undefined"||(typeof(c)=="string")&&notOk(c))&&isOk(a)&&typeof(b)!="undefined"){if(b=="options_first"){d[0].selectedIndex=1;d.change()}else{if(b=="options_last"){d[0].selectedIndex=a.length;d.change()}else{if(b.toString().startWith("options_")){b=b.toString().replace("options_","");if(!isNaN(b)){d[0].selectedIndex=parseInt(b);d.change()}}else{d.val(b).change()}}}}},processOneSelectByOptions:function(a,j){a.empty();if(a.data("text")){a.append('<option data-empty="true" value="'+a.data("value")+'">'+a.data("text")+"</option>")}var k=a.data("options");if(!k){return}if(isArray(k)){this.processSetOptionsHandler(a,j,false,{state:"ok",data:k});return}var d;if(k.indexOf(",")!=-1){d=k.split(",")}else{d=[k]}if(!isOk(d)){return}var h,f,e,b=new Array();for(var c in d){h=d[c];if(h){if(h.indexOf(":")!=-1){f=h.split(":");e={text:f[0],value:f[1]}}else{e={text:h,value:h}}b.push(e)}}this.processSetOptionsHandler(a,j,false,{state:"ok",data:b})},processSetOptionsHandler:function(_thisSelect,setting,refreshing,result){var that=this;var selectedValue=_thisSelect.data("select");if(refreshing){selectedValue=_thisSelect.val()}var text_attr=_thisSelect.data("text-attr");if(!text_attr){text_attr="text"}var value_attr=_thisSelect.data("value-attr");if(!value_attr){value_attr="value"}var delimiter=_thisSelect.data("delimiter");var appendHandler=_thisSelect.data("append-handler");if(appendHandler){appendHandler=eval(appendHandler)}var onlyleaf=_thisSelect.data("onlyleaf");if(result.state=="ok"){var html="";var list=result.data;var newList=new Array();var text,value,optionItem,option_items,hasItems,textFormatHandler=_thisSelect.data("text-format-handler");for(var i in list){optionItem=list[i];option_items=optionItem.items;hasItems=option_items&&option_items.length>0;text=processOptionTextByFormatHandler(textFormatHandler,optionItem,text_attr,delimiter);value=processOptionValue(optionItem,value_attr);var option;if(hasItems&&onlyleaf){option='<optgroup data-value="'+value+'" label="'+text+'">'}else{option='<option value="'+value+'">'+text+"</option>"}if(appendHandler){option=appendHandler(option,optionItem)}html+=option;newList.push(optionItem);if(hasItems){html=that.processItems(html,newList,option_items,appendHandler,textFormatHandler,text_attr,value_attr,delimiter,onlyleaf,2);if(onlyleaf){html+="</optgroup>"}}}_thisSelect.data("option-datas",newList);_thisSelect.append(html);if(selectedValue||(typeof(selectedValue)=="boolean")){selectedValue=selectedValue.toString();if(selectedValue.indexOf(",")!=-1){var arr=selectedValue.split(",");_thisSelect.val(arr)}else{_thisSelect.val(selectedValue)}if(!_thisSelect.val()){var selectOptions=_thisSelect.find("option");if(isOk(selectOptions)){_thisSelect.val(selectOptions.eq(0).val())}}}else{if(selectedValue==0||selectedValue=="0"){var selectOptions=_thisSelect.find("option[value='0']");if(isOk(selectOptions)){_thisSelect.val(selectedValue)}}}_thisSelect.change()}var selectType=_thisSelect.data("select-type");if(selectType){if(selectType=="select2"){Select2Util.initAutoLoadSelect(_thisSelect)}else{if(selectType=="bootstrap"){var muil=_thisSelect[0].hasAttribute("multiple");var opts={actionsBox:muil};_thisSelect.selectpicker(opts)}}}that.processRefresh(_thisSelect,setting)},processRefresh:function(c,l){var e=this;if(c.data("refresh")){var k=c.closest("div.input-group");if(isOk(k)){var h=k.find(".fa-refresh");if(isOk(h)){return false}}var i=c.data("select-type");var a;if(i&&i=="select2"){$(".tooltip.show").remove();var d=c.parent().find(".select2");d.addClass("hasRefresh");var j=d.find(".select2-selection__arrow");a=$('<span class="refresh"><i class="fa fa-refresh"></i></span>');d.append(a)}else{var b=c.parent();if(isOk(b)&&!b.hasClass("input-group")){var f=c.closest(".form-inline");if(isOk(f)){c.wrap('<div class="d-inline-block align-middle"><div class="input-group"></div></div>')}else{c.wrap('<div class="input-group"></div>')}}a=$('<div class="input-group-append hand jb_select_refresh"><span class="input-group-text"><i class="fa fa-refresh"></i></span></div>');c.after(a)}a.click(function(m){m.preventDefault();m.stopPropagation();LayerMsgBox.loading("正在刷新数据...",10000);$(".tooltip.show").remove();e.readAndInsertItems(c,l,true);return false})}},findSelect:function(b){var a=null;if(b){if(b.selectId){if(b.parent){if(typeof b.parent=="object"){if(isDOM(b.parent)){a=$(b.parent).find("#"+b.selectId)}else{a=b.parent.find("#"+b.selectId)}}else{if(b.parent.indexOf("#")!=-1){a=$(b.parent).find("#"+b.selectId)}else{a=$("#"+b.parent).find("#"+b.selectId)}}}else{a=$("#"+b.selectId)}}else{if(b.parent){if(typeof b.parent=="object"){if(isDOM(b.parent)){a=$(b.parent).find("select[data-autoload]")}else{a=b.parent.find("select[data-autoload]")}}else{if(b.parent.indexOf("#")!=-1){a=$(b.parent).find("select[data-autoload]")}else{a=$("#"+b.parent).find("select[data-autoload]")}}}else{a=$("select[data-autoload]")}}}else{a=$("select[data-autoload]")}return a},init:function(d){var e=this;var c=e.findSelect(d);if(c&&c.length>0){var a=c.length;for(var b=0;b<a;b++){e.processOneSelect(c.eq(b),d)}}},initByParent:function(f){var d=getRealJqueryObject(f);if(notOk(d)){LayerMsgBox.alert("initByParent参数指定元素不存在",2);return}var c=d.find("select[data-autoload]");if(c&&c.length>0){var a=c.length;var e=this;for(var b=0;b<a;b++){e.processOneSelect(c.eq(b))}}},initSelect:function(a){this.processOneSelect(a)},processOneSelect:function(f,c){var e=this;e.processLinkAge(f,c);if((f.data("url")||(c&&c.url))){e.readAndInsertItems(f,c,false)}else{if(f.data("options")){e.processOneSelectByOptions(f,c)}else{var b=f.data("select");if(typeof(b)!="undefined"){f.val(b).change()}else{var a=f.data("default");if(typeof(a)!="undefined"){if(a=="options_first"){f[0].selectedIndex=1;f.change()}else{if(a=="options_last"){var d=f[0].options.length;if(d>0){f[0].selectedIndex=d;f.change()}}else{if(a.toString().startWith("options_")){a=a.toString().replace("options_","");if(!isNaN(a)){f[0].selectedIndex=parseInt(a);f.change()}}else{f.val(a).change()}}}}}}}},processLinkAge:function(_thisSelect,setting){var that=this;var islinkage=_thisSelect.data("linkage");if(islinkage){_thisSelect.unbind("change")}_thisSelect.on("change",function(){var beforechange=_thisSelect.data("beforechange");if(beforechange){var exe=eval(beforechange);if(exe){exe(_thisSelect)}}that.processChangeEventHandler(_thisSelect,setting);var sonIds=_thisSelect.data("sonid"),sonId,sonSelect,sonIdArr,srcUrl,url,sonLen,linkage_attr,linkageValue=_thisSelect.val();if(islinkage&&sonIds){sonIdArr=sonIds.split(",");sonLen=sonIdArr.length;linkage_attr=_thisSelect.data("linkage-attr");if(linkage_attr){var selectIndex=_thisSelect[0].options.selectedIndex;var optionDatas=_thisSelect.data("option-datas");if(optionDatas&&optionDatas.length>0){if(_thisSelect.data("text")){selectIndex=selectIndex-1}if(selectIndex!=-1){linkageValue=optionDatas[selectIndex][linkage_attr]}else{linkageValue=""}}else{linkageValue=""}}for(var i=0;i<sonLen;i++){sonId=sonIdArr[i];sonSelect=$("#"+sonId);sonSelect.data("parent-value",linkageValue).attr("data-parent-value",linkageValue);srcUrl=sonSelect.data("origin-url")||sonSelect.data("src-url")||sonSelect.data("srcurl")||sonSelect.data("url");if(srcUrl){var tempEndStr=srcUrl[srcUrl.length-1];if(tempEndStr=="="||tempEndStr=="-"||tempEndStr=="/"){url=srcUrl+linkageValue}else{url=srcUrl+"/"+linkageValue}}var parentBox=_thisSelect.closest(".jbolt_page");if(isOk(parentBox)){SelectUtil.init({parent:parentBox,selectId:sonId,url:url})}else{SelectUtil.init({selectId:sonId,url:url})}}}_thisSelect.trigger("linkChange")})},setValue:function(d,c,b){if(c!=undefined&&c!="undefined"&&c!=""){c=c+""}if(b!=undefined&&b!="undefined"&&b!=""){b=b+""}var a=$("#"+d);if(isOk(a)){if(c){$("#"+d).val(c).change()}else{if(b){$("#"+d).val(b).change()}}}},initAutoSetValue:function(b){var a=getRealParentJqueryObject(b);if(isOk(a)){a.find("select[data-autosetvalue]").each(function(){var c=$(this);var d=c.data("autosetvalue");c.val(""+d).change()})}}};function removeTableRow(h,f){var c=h.index();if(!f){f=h.closest("table")}var d=f.closest(".jbolt_table_view");if(isOk(d)&&!f.hasClass("jbolt_main_table")){f=d.find(".jbolt_table_box>.jbolt_table_body>table[data-jbolttable].jbolt_main_table")}var b=f[0].hasAttribute("data-jbolttable");var a=f[0].hasAttribute("data-jbolttreetable");if(b&&!a){var e=f.jboltTable("inst");if(e){e.me.removeRow(e,c)}}else{if(b&&a){var e=f.jboltTable("inst");if(e){e.me.deleteTreeTableRow(e,c)}}else{if(a&&!b){deleteTreeTableRow(f,h)}else{h.remove()}}}}function removeTr(b){var a=$(b).closest("tr");if(isOk(a)){removeTableRow(a)}else{LayerMsgBox.alert("removeTr-找不到所在TR",2)}}function refreshJBoltLayer(){var a=$(".jbolt_layer");if(isOk(a)){a.find("[data-ajaxportal]").ajaxPortal(true)}}function removeByKey(b){var a=$(b).data("removekey");$("[data-removekey='"+a+"']").remove()}function removeTrCascade(f){var e=f.closest("tr");if(!e){return false}var h=e.data("id");if(!h){return false}var d=e.closest("table");removeTableRow(e,d);var b=d.find("tbody>tr[data-pid='"+h+"']");if(isOk(b)){var a=b.length;for(var c=0;c<a;c++){removeTrCascade(b.eq(c))}}}function trChangeToUp(currentTr,prevTr,jboltTable){var isArr=isArray(currentTr);if(isArr){var size=currentTr.length;var tplTr;var showArr=new Array();for(var i=0;i<size;i++){tplTr=currentTr[i];tplTr.insertBefore(prevTr);if(!tplTr.is(":hidden")){tplTr.addClass("sortActive");showArr.push(tplTr)}}if(isOk(showArr)){var len=showArr.length;var tplTr;setTimeout(function(){for(var i=0;i<len;i++){tplTr=showArr[i];tplTr.removeClass("sortActive")}},300)}}else{if(currentTr.index()>0){currentTr.insertBefore(prevTr);currentTr.addClass("sortActive");setTimeout(function(){currentTr.removeClass("sortActive")},300)}}if(jboltTable){if(jboltTable.fixedColumnTables){jboltTable.me.processColumnFixed(jboltTable);setTimeout(function(){jboltTable.fixedColumnTables.find("tbody>tr.sortActive").removeClass("sortActive");var sortSuccessHandler=jboltTable.data("sort-success-handler");if(sortSuccessHandler){var exeSortHandler=eval(sortSuccessHandler);if(exeSortHandler&&typeof(exeSortHandler)=="function"){exeSortHandler(jboltTable)}}},300)}else{var sortSuccessHandler=jboltTable.data("sort-success-handler");if(sortSuccessHandler){setTimeout(function(){var exeSortHandler=eval(sortSuccessHandler);if(exeSortHandler&&typeof(exeSortHandler)=="function"){exeSortHandler(jboltTable)}},300)}}}}function processToChangeUpByPrevPage(e){var c=e.closest("table");var a=c.data("page");var h;if(a){h=jboltBody.find("#"+a)}else{h=jboltBody.find(".pages>.mainPagination")}if(h){var d=h.find(".pagination>a.current:not(.prev):not(.next)");if(isOk(d)){var f=parseInt(d.text());if(f>1){var b=h.find(".pagination>a.prev");if(isOk(b)){b.click()}}}}}function processToChangeDownByNextPage(a){var j=a.closest("table");var b=j.data("page");var c;if(b){c=jboltBody.find("#"+b)}else{c=jboltBody.find(".pages>.mainPagination")}if(c){var f=c.find(".pagination>a.current:not(.prev):not(.next)");var i=c.find(".pagination>a:not(.prev):not(.next):last");if(isOk(f)&&isOk(i)){var h=parseInt(f.text());var e=parseInt(i.text());if(h<e){var d=c.find(".pagination>a.next");if(isOk(d)){d.click()}}}}}function trMoveUp(h){var f=h.closest("table");var a=f.closest(".jbolt_table_fixed");var d=h.index();if(isOk(a)){f=f.closest(".jbolt_table_box").find(".jbolt_table_body>table.jbolt_main_table");h=f.find("tbody>tr:eq("+d+")")}if(d==0){processToChangeUpByPrevPage(h);return false}var c=f[0].hasAttribute("data-jbolttable")&&f.hasClass("jbolt_table");var b=f[0].hasAttribute("data-jbolttreetable");if(c&&!b){var e=f.jboltTable("inst");if(e){e.me.moveUpRow(e,h)}}else{if(b&&!c){moveUpTreeTableRow(f,h)}else{trChangeToUp(h,h.prev())}}}function trChangeToDown(b,h,a){var c=isArray(b);if(c){var k=b.length;var l;var j=new Array();var e=k-1;for(var d=e;d>=0;d--){l=b[d];l.insertAfter(h);if(!l.is(":hidden")){l.addClass("sortActive");j.push(l)}}if(isOk(j)){var f=j.length;setTimeout(function(){for(var m=0;m<f;m++){j[m].removeClass("sortActive")}},1000)}}else{if(b.index()>=0){b.insertAfter(h);b.addClass("sortActive");setTimeout(function(){b.removeClass("sortActive")},1000)}}if(a&&a.fixedColumnTables){a.me.processColumnFixed(a);setTimeout(function(){a.fixedColumnTables.find("tbody>tr.sortActive").removeClass("sortActive")},1000)}}function trMoveDown(h){var f=h.closest("table");var a=f.closest(".jbolt_table_fixed");var d=h.index();var i=h.closest("tbody").find("tr:last").index();if(isOk(a)){f=f.closest(".jbolt_table_box").find(".jbolt_table_body>table.jbolt_main_table");h=f.find("tbody>tr:eq("+d+")")}if(d==i){processToChangeDownByNextPage(h);return false}var c=f[0].hasAttribute("data-jbolttable")&&f.hasClass("jbolt_table");var b=f[0].hasAttribute("data-jbolttreetable");if(c&&!b){var e=f.jboltTable("inst");if(e){e.me.moveDownRow(e,h)}}else{if(b&&!c){moveDownTreeTableRow(f,h)}else{trChangeToDown(h,h.next())}}}function processRefreshAjaxPortalHandler(c){var a=c.data("portal")||c.data("portalid");if(a){if(a=="parentPortal"){if(c){var b=c.closest("[data-ajaxportal]");if(isOk(b)){b.ajaxPortal(true)}}}else{$("#"+a).ajaxPortal(true)}}}var AjaxBtnUtil={init:function(a){this.initBy("[data-ajaxbtn]",a)},initBy:function(cssSelector,parentEle){var parent=getRealParentJqueryObject(parentEle);if(!isOk(parent)){return false}var that=this;cssSelector=cssSelector||"[data-ajaxbtn]";parent.on("click",cssSelector,function(e){e.preventDefault();e.stopPropagation();if(this.hasAttribute("disabled")||this.hasAttribute("data-disabled")){return false}var action=$(this);var url=action.attr("href");if(!url){url=action.data("url")}if(!url){LayerMsgBox.alert("请设置URL地址",2);return false}var checkHandler=action.data("check-handler");if(checkHandler){var checkResult;var exeCheck_handler=eval(checkHandler);if(exeCheck_handler&&typeof(exeCheck_handler)=="function"){checkResult=exeCheck_handler(action);if(!checkResult){return false}if(typeof(checkResult)!="boolean"){if(isArray(checkResult)){url=url+checkResult.join(",")}else{url=url+checkResult}}}}url=actionUrl(url);url=processEleUrlByLinkOtherParamEle(action,url);var dataconfirm=action.data("confirm");if(!dataconfirm&&cssSelector==".jbolt_table_delbtn"){dataconfirm="确定删除此项?"}if(dataconfirm){LayerMsgBox.confirm(dataconfirm,function(){that.exeFun(action,url)})}else{that.exeFun(action,url)}})},exeFun:function(d,a){var h=d.data("loading");var j=d.data("timeout")||jboltAjaxTimeout;var c=d.data("success-time")||1000;var i=d.data("nomsg");var f=this;LayerMsgBox.loading(h,j);var k=d.data("success-handler")||d.data("handler");var b=d.data("fail-handler");var e=function(l){f.exeTheHandler(b,d,l)};Ajax.get(a,function(l){LayerMsgBox.closeLoadingNow();if(i){f.exeTheHandler(k,d,l)}else{LayerMsgBox.success(l.msg?l.msg:"操作成功",c,function(){f.exeTheHandler(k,d,l)})}},b?e:null,false,j)},exeTheHandler:function(handler,action,data){if(handler){disposeTooltip(action);if(handler=="removeTr"){removeTr(action)}else{if(handler=="removeTrCascade"){removeTrCascade(action)}else{if(handler=="removeByKey"){removeByKey(action)}else{if(handler=="jboltTablePageToFirst"){loadJBoltPlugin(["jbolttable"],function(){jboltTablePageToFirst(action)})}else{if(handler=="jboltTablePageToLast"){loadJBoltPlugin(["jbolttable"],function(){jboltTablePageToLast(action)})}else{if(handler=="refreshJBoltTable"||handler=="jboltTableRefresh"){loadJBoltPlugin(["jbolttable"],function(){refreshJBoltTable(action)})}else{if(handler=="refreshJBoltMainTable"||handler=="jboltMainTableRefresh"){loadJBoltPlugin(["jbolttable"],function(){refreshJBoltMainTable(action)})}else{if(handler=="refreshCurrentAjaxPortal"){refreshCurrentAjaxPortal(action)}else{if(handler=="removeJBoltTableCheckedTr"){loadJBoltPlugin(["jbolttable"],function(){removeJBoltTableCheckedTr(action,false)})}else{if(handler=="jboltTableRemoveCheckedRow"){loadJBoltPlugin(["jbolttable"],function(){jboltTableRemoveCheckedRow(action,false)})}else{if(handler=="moveUp"){trMoveUp(action.closest("tr"))}else{if(handler=="moveDown"){trMoveDown(action.closest("tr"))}else{if(handler=="refreshPortal"){processRefreshAjaxPortalHandler(action)}else{if(handler=="refreshJstree"){var jstreeId=action.data("jstree-id");refreshJstreeHandler(jstreeId)}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(action,data)}}}}}}}}}}}}}}}}}};var OpenPageBtnUtil={init:function(a){this.initBy("[data-openpage]",a)},initBy:function(cssSelector,parentEle){var parent=getRealParentJqueryObject(parentEle);if(!isOk(parent)){return false}var that=this;cssSelector=cssSelector||"[data-openpage]";parent.on("click",cssSelector,function(e){e.preventDefault();e.stopPropagation();if(this.hasAttribute("disabled")||this.hasAttribute("data-disabled")){return false}var action=$(this);var orignUrl=action.data("origin-url")||action.data("orign-url")||action.data("orignurl")||action.data("src-url")||action.data("srcurl")||action.attr("href")||action.data("url")||action.data("contentid")||action.data("content-id")||action.data("content")||action.data("content-func");if(!orignUrl){LayerMsgBox.alert("请设置URL地址",2);return false}if(!this.hasAttribute("data-origin-url")&&!this.hasAttribute("data-orign-url")&&!this.hasAttribute("data-orignurl")&&!this.hasAttribute("data-src-url")&&!this.hasAttribute("data-srcurl")){action.data("origin-url",orignUrl).attr("data-origin-url",orignUrl)}var openpage=action.data("openpage");if(!openpage||(openpage&&openpage!="dialog"&&openpage!="jboltlayer")){var checkHandler=action.data("check-handler");if(checkHandler){var checkResult;var exeCheck_handler=eval(checkHandler);if(exeCheck_handler&&typeof(exeCheck_handler)=="function"){checkResult=exeCheck_handler(action);if(typeof(checkResult)=="boolean"&&checkResult==false){return false}if(typeof(checkResult)!="boolean"){if(isArray(checkResult)){orignUrl=orignUrl+checkResult.join(",")}else{orignUrl=orignUrl+checkResult}}if(this.hasAttribute("href")){action.attr("href",orignUrl)}else{action.data("url",orignUrl).attr("data-url",orignUrl)}}}}var dataconfirm=action.data("confirm");if(dataconfirm&&openpage!="jboltlayer"){LayerMsgBox.confirm(dataconfirm,function(){that.exeFun(action)})}else{that.exeFun(action)}return false})},exeFun:function(e){var d=e.data("openpage");var f=e.data("target");if(d){var c=e.attr("href")||e.data("url");switch(d){case"blank":var b=document.createElement("a");c=actionUrl(c);c=processEleUrlByLinkOtherParamEle(e,c);c=processJBoltTableEleUrlByLinkColumn(e,c);b.href=c;b.target="_blank";b.click();break;case"jboltlayer":if(f&&f=="parent"){parent.JBoltLayerUtil.openBy(e)}else{JBoltLayerUtil.openBy(e)}break;case"dialog":DialogUtil.openBy(e);break;case"self":if(f&&f=="parent"){if(parent.jboltWithTabs){c=actionUrl(c);c=processEleUrlByLinkOtherParamEle(e,c);c=processJBoltTableEleUrlByLinkColumn(e,c);parent.JBoltTabUtil.currentTabGo(c)}else{parent.JBoltPjaxUtil.openByType(e)}}else{if(jboltWithTabs){c=actionUrl(c);c=processEleUrlByLinkOtherParamEle(e,c);c=processJBoltTableEleUrlByLinkColumn(e,c);JBoltTabUtil.currentTabGo(c)}else{JBoltPjaxUtil.openByType(e)}}break;case"ajaxportal":if(f&&f=="parent"){parent.AjaxPortalUtil.openBy(e)}else{AjaxPortalUtil.openBy(e)}break;case"iframe":e.data("open-type",2).attr("data-open-type",2);if(f&&f=="parent"){if(parent.jboltWithTabs){parent.JBoltTabUtil.openByType(e)}else{parent.JBoltPjaxUtil.openByType(e)}}else{if(jboltWithTabs){JBoltTabUtil.openByType(e)}else{JBoltPjaxUtil.openByType(e)}}break}}else{if(f&&f=="parent"){if(parent.jboltWithTabs){parent.JBoltTabUtil.openByType(e)}else{parent.JBoltPjaxUtil.openByType(e)}}else{if(jboltWithTabs){JBoltTabUtil.openByType(e)}else{JBoltPjaxUtil.openByType(e)}}}}};function processUrlRqType(b,d,a){if(b){if(b.startWith("http://")||b.startWith("https://")||b.startWith("://")){var f=b.replace("http://","").replace("https://","").replace("www","");if(f.startWith("://")){f=f.substring(3)}if(!f.startWith(JBoltBaseTagHrefNoSchema)){return b}}if(b.indexOf("?")!=-1){b=b+"&_jb_rqtype_="+d}else{if(b.indexOf("-")!=-1){b=b+"-_jb_rqtype_"+d}else{var c=b.charAt(b.length-1);if(c=="/"){b=b.substring(0,b.length-1);b=b+"?_jb_rqtype_="+d}else{var h=b.lastIndexOf("/");if(h==-1){b=b+"?_jb_rqtype_="+d}else{var e=b.substring(h+1);if(isNaN(e)){b=b+"?_jb_rqtype_="+d}else{b=b+"-_jb_rqtype_"+d}}}}}}return b}var PageOptUtil={init:function(){var a=this;DialogUtil.initBy("[data-dialogbtn]");AjaxBtnUtil.initBy("[data-ajaxbtn]");AjaxPortalUtil.initBy("[data-portalbtn]")}};var TableUtil={init:function(){AjaxBtnUtil.initBy(".jbolt_table_delbtn");DialogUtil.initBy(".jbolt_table_editbtn");DialogUtil.initBy(".jbolt_table_addbtn")}};var FormDate={destory:function(a){laydate.destory(a)},hide:function(e){if(!e){jboltBody.find(".layui-laydate").remove();return}var d=getRealParentJqueryObject(e);if(!isOk(d)){return false}var b=d.find("input[data-date][lay-key]");if(isOk(b)){var f,c,a;b.each(function(){f=$(this);c=f.attr("lay-key");a=jboltBody.find("#layui-laydate"+c);if(isOk(a)){a.remove();f.removeAttr("lay-key")}})}},initDate:function(dateEle){var editable=dateEle.data("editable");if(!editable){dateEle.attr("readonly","readonly")}var dateType=dateEle.data("type");if(!dateType){dateType="date"}var datefmt=dateEle.data("fmt");if(!datefmt){switch(dateType){case"date":datefmt="yyyy-MM-dd";break;case"time":datefmt="HH:mm";break;case"datetime":datefmt="yyyy-MM-dd HH:mm";break;default:datefmt="yyyy-MM-dd";break}}var id=dateEle.attr("id");if(!id){id=dateEle.attr("name");if(id){id=id.replace(".","_")+"_"+randomId()}else{id="date_"+randomId()}dateEle.attr("id",id)}var minutes=dateEle.data("minutes");var changeHandler=dateEle.data("change-handler");var doneHandler=dateEle.data("done-handler");var small=dateEle.data("small");dateEle.removeAttr("lay-key","");var theme=dateEle.data("theme");var triggerType=dateEle.data("trigger")||"click";var range=dateEle.data("range");if(typeof(range)=="boolean"&&range){range="~"}var dateOptions={elem:"#"+id,type:dateType,format:datefmt,trigger:triggerType,theme:theme,range:range,ready:function(date){var layDate=$(".layui-laydate");if(small){layDate.addClass("small")}if(datefmt.indexOf("ss")==-1&&dateType!="month"&&dateType!="year"){layDate.addClass("noseconds");layDate.find(".laydate-time-list>li:eq(2)").remove()}if(minutes){var minutesArr=minutes.split(",");if(datefmt=="HH:mm"||datefmt=="HH:mm:ss"){var box=layDate.find(".laydate-time-list li ol").eq(1);box.find("li").each(function(){var value=this.innerText;var inArr=$.inArray(value,minutesArr);if(inArr==-1){$(this).remove()}})}else{if(datefmt.indexOf("HH:mm")!=-1){layDate.find(".laydate-btns-time").on("click",function(){var box=layDate.find(".laydate-time-list li ol").eq(1);box.find("li").each(function(){var value=this.innerText;var inArr=$.inArray(value,minutesArr);if(inArr==-1){$(this).remove()}})})}}}if(small){var eleTop=dateEle.offset().top;layDate.css({top:(eleTop-265)+"px"})}},change:function(value,date,endDate){if(changeHandler){if(typeof(changeHandler)&&changeHandler=="checkme"){FormChecker.checkIt(dateEle)}else{var change_handler=eval(changeHandler);if(change_handler&&typeof(change_handler)=="function"){change_handler(dateEle,value)}}}},done:function(value,date,endDate){if(doneHandler){if(typeof(doneHandler)=="string"&&doneHandler=="checkme"){FormChecker.checkIt(dateEle)}else{var done_handler=eval(doneHandler);if(done_handler&&typeof(done_handler)=="function"){done_handler(dateEle,value)}}}}};if(dateEle[0].hasAttribute("data-min")){var min=dateEle.data("min");dateOptions.min=min}if(dateEle[0].hasAttribute("data-max")){var max=dateEle.data("max");dateOptions.max=max}laydate.render(dateOptions)},initDates:function(c){if(!isOk(c)){return false}var a=c.length;for(var b=0;b<a;b++){this.initDate(c.eq(b))}},init:function(b){var a=getRealParentJqueryObject(b);if(!isOk(a)){return false}var c=a.find("input[data-date]");if(!isOk(c)){return false}this.initDates(c)}};function jsonObjectToUrlParam(d){var b=[];for(var a in d){var c=d[a];if(typeof(c)!=undefined&&typeof(c)!="undefined"&&c!="undefined"&&c!=null){if(c.constructor==Array){c.forEach(function(e){b.push(a+"="+e)})}else{b.push(a+"="+c)}}}return b.join("&")}var DialogUtil={initBy:function(b,d){var a=getRealParentJqueryObject(d);if(!isOk(a)){return false}var c=this;a.on("click",b,function(f){f.preventDefault();f.stopPropagation();c.openBy(this);return false})},openBy:function(ele){var action=getRealJqueryObject(ele);if(!isOk(action)){LayerMsgBox.alert("DialogUtil.openBy(ele)参数异常",2);return false}disposeTooltip(action);var target=action.data("target");if(target){action.data("target","").attr("data-target","");if(target=="parent"){parent.DialogUtil.openBy(action);action.data("parent","parent")}else{if(target=="outparent"){parent.parent.DialogUtil.openBy(action)}}action.data("target",target).attr("data-target",target);return false}var url=action.data("url");if(!url){url=action.attr("href");if(url=="javascript:void(0)"){url=null}}var contentid=action.data("contentid")||action.data("content-id");var contentFunc=action.data("content-func");var content=action.data("content");if(contentFunc){var content_exe_func=eval(contentFunc);if(content_exe_func&&typeof(content_exe_func)=="function"){content=content_exe_func()}}if(!url&&!contentid&&!content){LayerMsgBox.alert("没有设置dialog的加载URL或者内容",2);return false}var checkHandler=action.data("check-handler");if(checkHandler){var checkResult;var exeCheck_handler=eval(checkHandler);if(exeCheck_handler&&typeof(exeCheck_handler)=="function"){checkResult=exeCheck_handler(action);if(typeof(checkResult)=="boolean"&&checkResult==false){return false}if(typeof(checkResult)!="boolean"){if(isArray(checkResult)){url=url+checkResult.join(",")}else{url=url+checkResult}}}}var title=action.data("dialog-title")||action.attr("dialog-title")||action.data("title")||action.attr("title")||action.text();var keepOpen=action.data("keep-open");if(typeof(keepOpen)=="boolean"&&keepOpen){var dialogKey=action.data("dialog-key");var iframe;if(dialogKey){iframe=jboltBody.find(".layui-layer iframe[data-dialog-key='"+dialogKey+"']")}else{iframe=jboltBody.find(".layui-layer iframe")}if(isOk(iframe)){if(dialogKey){var iframeKey=iframe.data("dialog-key");if(dialogKey==iframeKey){url=actionUrl(url);url=processEleUrlByLinkOtherParamEle(action,url,false);url=processJBoltTableEleUrlByLinkColumn(action,url);url=processUrlRqType(url,"dialog");iframe.attr("src",url);layer.title(title);return false}}else{url=actionUrl(url);url=processEleUrlByLinkOtherParamEle(action,url,false);url=processJBoltTableEleUrlByLinkColumn(action,url);url=processUrlRqType(url,"dialog");iframe.attr("src",url);layer.title(title);return false}}else{var oldIframe=jboltBody.find(".layui-layer iframe");if(isOk(oldIframe)&&dialogKey){var iframeKey=oldIframe.data("dialog-key");if(dialogKey!=iframeKey){layer.closeAll()}}}}var handler=action.data("handler");var closeHandler=action.data("close-handler");var dialog_area=action.data("area");var w="800px";var h="500px";if(dialog_area){var area=dialog_area.split(",");var ww=area[0];var hh=area[1];if(ww.indexOf("px")!=-1||ww.indexOf("%")!=-1){w=ww}else{w=ww+"px"}if(hh.indexOf("px")!=-1||hh.indexOf("%")!=-1){h=hh}else{h=hh+"px"}}if(w.indexOf("%")==-1&&w.indexOf("px")!=-1){var pw=Number(w.replace("px",""));if(pw>jboltWindowWidth){w=(jboltWindowWidth-10)+"px"}}if(h.indexOf("%")==-1&&h.indexOf("px")!=-1){var ph=Number(h.replace("px",""));if(ph>jboltWindowHeight){h=(jboltWindowHeight-10)+"px"}}var dialog_scroll=action.data("scroll");if(dialog_scroll==undefined||dialog_scroll=="undefined"||(typeof(dialog_scroll)=="string"&&dialog_scroll!="no")||(typeof(dialog_scroll)=="boolean"&&dialog_scroll==true)){dialog_scroll="yes"}else{dialog_scroll="no"}var fs=action.data("fs");if(fs&&(fs=="true"||fs==true)){dialog_scroll="yes"}var cdrfp=action.data("cdrfp");if(cdrfp==undefined||cdrfp=="undefined"||cdrfp==""){cdrfp=false}var portalId=action.data("portalid")||action.data("portal-id")||action.data("portal");var btn=action.data("btn");var action_id=action.attr("id");if(!action_id){action_id="dialogbtn_"+randomId();action.attr("id",action_id)}var btnAlign=action.data("btn-align");var shade=action.data("shade");var shadeClose=action.data("shadeclose");var offset=action.data("offset");if(!offset){offset="auto"}else{if(offset.indexOf(",")!=-1){var oarr=offset.split(",");if(!oarr||(oarr&&oarr.length!=2)){offset="auto"}else{var ox=oarr[0];var oy=oarr[1];if(typeof(ox)=="string"&&ox.indexOf("%")!=-1){var p=Number(ox.replace("%",""));ox=(parseInt(jboltWindowWidth*p/100))+"px"}else{if(typeof(ox)=="string"&&ox.indexOf("%")==-1){ox=Number(ox)+"px"}}if(typeof(oy)=="string"&&oy.indexOf("%")!=-1){var p=Number(oy.replace("%",""));oy=(parseInt(jboltWindowHeight*p/100))+"px"}else{if(typeof(oy)=="string"&&oy.indexOf("%")==-1){oy=Number(oy)+"px"}}offset=[oy,ox]}}else{if(offset=="multi"){var lastLayer=jboltBody.find(".layui-layer:last");if(isOk(lastLayer)){var lastOffset=lastLayer.offset();offset=[lastOffset.top+40,lastOffset.left+40]}else{offset="auto"}}}}var closeBtn=action.data("top-closebtn");var okBtnText=action.data("ok-btn-text")||"确定";var closeBtnText=action.data("close-btn-text")||"关闭";var successHandler=action.data("success-handler");this.openNewDialog({ele:action,title:title,width:w,height:h,url:url,offset:offset,shade:shade,shadeClose:shadeClose,scroll:dialog_scroll,btn:btn,btnAlign:btnAlign,handler:handler,closeBtn:closeBtn,closeHandler:closeHandler,cdrfp:cdrfp,fs:fs,successHandler:successHandler,portalId:portalId,contentId:contentid,content:content,okBtnText:okBtnText,closeBtnText:closeBtnText})},openNewDialog:function(q){if(q.fs){q.width="100%";q.height="100%"}else{if(q.width){if(q.width.indexOf("%")==-1&&q.width.indexOf("px")==-1){q.width=q.width+"px"}}else{q.width="800px"}if(q.height){if(q.height.indexOf("%")==-1&&q.height.indexOf("px")==-1){q.height=q.height+"px"}}else{q.width="500px"}}var o=q.okBtnText||"确定";var l=q.closeBtnText||"关闭";var c=[];var b=q.btn;if(!b||b=="yes"||b=="true"){c=[o,l]}else{if(b&&b=="no"){c=[]}else{if(b&&b=="close"){c=[o,l]}else{if(b&&b=="ok"){c=[o]}else{if(b&&b.indexOf(",")!=-1){c=b.split(",")}}}}}var m=2;if(!(q.url)&&(q.contentId||q.content)){m=1}var i="";if(m==1){if(q.contentId){i=$("#"+q.contentId).html()}else{if(q.content){if(q.content=="this"){i=q.ele.html();i='<div class="p-3 text-break">'+i+"</div>"}else{i='<div class="p-3 text-break">'+q.content+"</div>"}}}}else{var a=actionUrl(q.url);if(isOk(q.ele)){a=processEleUrlByLinkOtherParamEle(q.ele,a,false);if(!a){return false}a=processJBoltTableEleUrlByLinkColumn(q.ele,a);if(!a){return false}}a=processUrlRqType(a,"dialog");i=[a,q.scroll]}shade=(q.shade!=undefined||q.shade=="")?q.shade:0.3;shadeClose=(q.shadeClose!=undefined)?q.shadeClose:false;var p=q.btnAlign?q.btnAlign:"right";var d="r";switch(p){case"left":d="l";break;case"center":d="c";break;case"right":d="r";break}var e=typeof(q.closeBtn);var n=1;if(e=="undefined"){n=1}else{n=q.closeBtn}var f=this;var j={type:m,title:(q.title||"新窗口"),shadeClose:shadeClose,shade:shade,maxmin:true,closeBtn:n,offset:q.offset?q.offset:"auto",area:[q.width,q.height],content:i,btn:c,btnAlign:d,success:function(t,r){if(m==2&&q.ele){var u=q.ele.data("dialog-key");if(u){var s=t.find("iframe");if(s){s.data("dialog-key",u).attr("data-dialog-key",u)}}}if(q.successHandler){f.exeBindHandler(q.successHandler,q)}},yes:function(s,r){if(m==2){var t=window[r.find("iframe")[0]["name"]];t.submitThisForm(function(){LayerMsgBox.close(s);if(q.handler){q.exeOkHandler=true;f.exeBindHandler(q.handler,q)}})}},end:function(){if(q.exeOkHandler){return false}if(q.cdrfp){if(q.closeHandler){var r=typeof(q.closeHandler);if(r=="string"){f.exeBindHandler(q.closeHandler,q)}else{if(r=="function"){q.closeHandler()}}}else{refreshPjaxContainer()}}else{if(q.closeHandler){var r=typeof(q.closeHandler);if(r=="string"){f.exeBindHandler(q.closeHandler,q)}else{if(r=="function"){q.closeHandler()}}}}}};if(q.zIndex){j.zIndex=q.zIndex}if(q&&q.id){j.id=q.id}else{if(q.ele){j.id=q.ele.attr("id")+"_layer"}else{j.id=randomId()+"_layer"}}var k=layer.open(j);var h=$("#layui-layer"+k);if(b){if(b=="close"){h.find("a.layui-layer-btn0").hide()}else{if(b=="ok"){h.find("a.layui-layer-btn1").hide()}else{if(b=="no"){h.find(".layui-layer-btn").remove()}}}}if(q.ele){h.data("trigger-action",q.ele);if(q.ele.data("in-editable-td")){h.data("link-editable-td",q.ele.closest("td"))}}},getCurrent:function(){return jboltBody.find(".layui-layer").first()},getByIndex:function(a){return jboltBody.find("#layui-layer"+a)},getCurrentTriggerEle:function(){var a=this.getCurrent();if(isOk(a)){return a.data("trigger-action")}return null},exeBindHandler:function(handler,options){if(handler=="refreshPortal"){if(options.portalId){LayerMsgBox.success("操作成功",500,function(){if(options.portalId=="parentPortal"){if(options.ele){var parentPortal=options.ele.closest("[data-ajaxportal]");if(isOk(parentPortal)){parentPortal.ajaxPortal(true)}}}else{$("#"+options.portalId).ajaxPortal(true)}})}else{LayerMsgBox.alert("没有配置data-portalid",2)}}else{if(handler=="refreshJstree"){var jstreeId=options.jstreeId||(options.ele?options.ele.data("jstree-id"):null);refreshJstreeHandler(jstreeId)}else{if(handler=="jboltTablePageToFirst"){loadJBoltPlugin(["jbolttable"],function(){jboltTablePageToFirst(options.ele)})}else{if(handler=="jboltTablePageToLast"){loadJBoltPlugin(["jbolttable"],function(){jboltTablePageToLast(options.ele)})}else{if(handler=="refreshJBoltTable"||handler=="jboltTableRefresh"){loadJBoltPlugin(["jbolttable"],function(){refreshJBoltTable(options.ele)})}else{if(handler=="refreshJBoltMainTable"||handler=="jboltMainTableRefresh"){loadJBoltPlugin(["jbolttable"],function(){refreshJBoltMainTable(options.ele)})}else{if(handler=="refreshCurrentAjaxPortal"){refreshCurrentAjaxPortal(options.ele)}else{if(handler=="removeJBoltTableCheckedTr"){loadJBoltPlugin(["jbolttable"],function(){removeJBoltTableCheckedTr(options.ele,false)})}else{if(handler=="jboltTableRemoveCheckedRow"){loadJBoltPlugin(["jbolttable"],function(){jboltTableRemoveCheckedRow(options.ele,false)})}else{var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler()}}}}}}}}}}}};function jboltTableLoadByDialogForm(f,d){if(!d){var b=parent.DialogUtil.getCurrentTriggerEle();if(!b){LayerMsgBox.alert("jboltTableLoadByDialogForm指定tableId参数异常-1，无法定位",2);return false}var a=b.data("jbolt-table-id");if(!a){LayerMsgBox.alert("jboltTableLoadByDialogForm指定tableId参数异常-2，无法定位",2);return false}d=a}var c=$("#"+f);if(!isOk(c)){LayerMsgBox.alert("jboltTableLoadByDialogForm指定formId参数异常，无法定位",2);return false}var e=c.serializeJSON();return parent.jboltTableReadByConditions(d,e)}Date.prototype.Format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in c){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(c[b]):(("00"+c[b]).substr((""+c[b]).length)))}}return a};function isArray(a){return $.isArray(a)}function isEmpty(a){return(a=="undefined"||a==null||a==""||a==false)}function isNotEmpty(a){return((a!=null&&a!="undefined"&&a!="")||a==true)}function showFormEleErrorStyle(d,f,b){LayerMsgBox.closeLoadingNow();if(f&&(d.is(":hidden")||(d.is("input")&&d.attr("type")=="hidden"))){LayerMsgBox.error("<span class='j_text_danger'>"+f+"</span>",1000);return false}var e=d;var a=false;if(d.is("select")){var c=d.data("select-type");if(c&&c=="select2"){e=d.next().find(".select2-selection");a=true}}if(f){disposeTooltip(e);e.tooltip({boundary:"window",container:"body",title:f}).tooltip("show");$("#"+e.attr("aria-describedby")).addClass("error").find(".tooltip-inner").text(f)}if(a){e.removeClass("border-success").addClass("border-danger")}else{e.removeClass("is-valid").addClass("is-invalid")}if(!b){d.focus();e.shake(1,5,300)}}function removeFormEleErrorStyle(d){var e=d;var a=false;if(d.is("select")){var b=d.data("select-type");if(b&&b=="select2"){e=d.next().find(".select2-selection");a=true}}var c=e.data("show-success-result");if(a){e.removeClass("border-danger");if(typeof(c)=="undefined"||(typeof(c)=="boolean"&&c==true)){e.addClass("border-success")}}else{e.removeClass("is-invalid");if(typeof(c)=="undefined"||(typeof(c)=="boolean"&&c==true)){e.addClass("is-valid")}}e.tooltip("dispose")}function removeFormEleAllStyle(c){var d=c;var a=false;if(c.is("select")){var b=c.data("select-type");if(b&&b=="select2"){d=c.next().find(".select2-selection");a=true}}if(a){d.removeClass("border-danger").removeClass("border-success")}else{d.removeClass("is-invalid").removeClass("is-valid")}d.tooltip("dispose")}jQuery.fn.shake=function(a,c,b,d){this.each(function(){var f=$(this);if(f.data("noshake")){return true}f.css({position:"relative"});for(var e=1;e<=a;e++){f.animate({left:(c*-1)},(((b/a)/4))).animate({left:c},((b/a)/2)).animate({left:0},(((b/a)/4)))}});if(d){d()}return this};function processCheckTab(a){var b=a.closest("div[role='tabpanel']");if(isOk(b)){var c=b.attr("id");$(".nav.nav-tabs .nav-item.nav-link[href='#"+c+"']").tab("show")}}function showItCheckFailResult(a,b){if(a.is("input")&&a.attr("type")=="hidden"){return}showFormEleErrorStyle(a,b,true)}function showItCheckSuccessResult(a){if(a.is("input")&&a.attr("type")=="hidden"){return}removeFormEleErrorStyle(a)}function TestRgexp(b,a){return b.test(a)}var vcity={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};var IdCardNoCheckUtil={isCardNo:function(a){var b=/(^\d{15}$)|(^\d{17}(\d|X)$)/;if(!b.test(a)){return false}return true},checkProvince:function(b){var a=b.substr(0,2);if(vcity[a]==undefined){return false}return true},checkBirthday:function(a){var b=a.length;if(b=="15"){var j=/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;var d=a.match(j);var e=d[2];var c=d[3];var f=d[4];var h=new Date("19"+e+"/"+c+"/"+f);return this.verifyBirthday("19"+e,c,f,h)}if(b=="18"){var i=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;var d=a.match(i);var e=d[2];var c=d[3];var f=d[4];var h=new Date(e+"/"+c+"/"+f);return this.verifyBirthday(e,c,f,h)}return false},verifyBirthday:function(d,h,a,e){var b=new Date();var c=b.getFullYear();if(e.getFullYear()==d&&(e.getMonth()+1)==h&&e.getDate()==a){var f=c-d;if(f>=3&&f<=100){return true}return false}return false},checkParity:function(e){e=this.changeFivteenToEighteen(e);var b=e.length;if(b=="18"){var d=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var a=new Array("1","0","X","9","8","7","6","5","4","3","2");var h=0,f,c;for(f=0;f<17;f++){h+=e.substr(f,1)*d[f]}c=a[h%11];if(c==e.substr(17,1)){return true}return false}return false},changeFivteenToEighteen:function(c){if(c.length=="15"){var b=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var a=new Array("1","0","X","9","8","7","6","5","4","3","2");var e=0,d;c=c.substr(0,6)+"19"+c.substr(6,c.length-6);for(d=0;d<17;d++){e+=c.substr(d,1)*b[d]}c+=a[e%11];return c}return c}};function checkIdCardNo(a){if(a===""){return"身份证号不能为空"}if(IdCardNoCheckUtil.isCardNo(a)===false){return"身份证号码不正确"}if(IdCardNoCheckUtil.checkProvince(a)===false){return"身份证号码不正确"}if(IdCardNoCheckUtil.checkBirthday(a)===false){return"身份证号码生日不正确"}if(IdCardNoCheckUtil.checkParity(a)===false){return"身份证号码校验位不正确"}return null}var jboltFormCheckRuleMap=[{type:"number",method:function(a){return(!isNaN(a))}},{type:"pznumber",method:function(a){return(!isNaN(a)&&a*1>=0)}},{type:"pzint",method:function(a){return((TestRgexp(/^-?[0-9]\d*$/,a))&&(a*1>=0))}},{type:"pnumber",method:function(a){return(!isNaN(a)&&a*1>0)}},{type:"int",method:function(a){return TestRgexp(/^-?[0-9]\d*$/,a)}},{type:"pint",method:function(a){return TestRgexp(/^[0-9]*[1-9][0-9]*$/,a)}},{type:"email",method:function(a){return TestRgexp(/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,a)}},{type:"filepath",method:function(a){return TestRgexp(/^([a-zA-Z]){1}:(\\[^\/\\:\*\?\"<>]+)*(\\)?$/,a)}},{type:"url",method:function(a){return TestRgexp(/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$/,a)}},{type:"url_nohttp",method:function(a){return TestRgexp(/^((https|http|ftp|rtsp|mms){0,1}(:\/\/){0,1})(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$/,a)}},{type:"date",method:function(a){return TestRgexp(/^[1-9]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,a)}},{type:"time",method:function(a){return TestRgexp(/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d$/,a)}},{type:"time_hm",method:function(a){return TestRgexp(/^(20|21|22|23|[0-1]\d):[0-5]\d$/,a)}},{type:"datetime",method:function(a){return TestRgexp(/^[1-9]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])\s+(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d$/,a)}},{type:"datetime_hm",method:function(a){return TestRgexp(/^[1-9]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])\s+(20|21|22|23|[0-1]\d):[0-5]\d$/,a)}},{type:"money",method:function(a){return TestRgexp(/(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/,a)}},{type:"money_4",method:function(a){return TestRgexp(/(^[1-9]\d*(\.\d{1,4})?$)|(^0(\.\d{1,4})?$)/,a)}},{type:"phone",method:function(a){return TestRgexp(/^1(3|4|5|6|7|8|9)\d{9}$/,a)}},{type:"tel",method:function(a){return TestRgexp(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/,a)}},{type:"zh_cn",method:function(a){return TestRgexp(/[\u4e00-\u9fa5]/,a)}},{type:"ip",method:function(a){return TestRgexp(/(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\.(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)/,a)}},{type:"postalcode",method:function(a){return TestRgexp(/\d{6}/,a)}},{type:"idcardno",method:function(a,b){return checkIdCardNo(a,b)}},{type:"letter_num",method:function(a){return TestRgexp(/^\w+$/,a)}},{type:"letter",method:function(a){return TestRgexp(/^[A-Za-z]+$/,a)}},{type:"proportion",method:function(a){return TestRgexp(/^[1-9]\d*:[1-9]\d*$/,a)}},{type:"proportion_multi",method:function(e){if(!e){return false}if(e.indexOf(":")==-1){return false}var c=e.toString().split(":");if(!isOk(c)){return false}var b=c.length;if(b<2){return false}var a=true;for(var d in c){if(c[d].length==0||isNaN(c[d])){a=false}}return a}},{type:"password",method:function(b){if(!b){return false}var a=b.length;return a>=6&&a<=16}}];function isDOM(b){var c=false;try{b.is(":hidden")}catch(a){c=true}return c}function addRuleToJBoltRuleMap(a){if(isArray(a)&&isOk(a)){jboltFormCheckRuleMap.push.apply(jboltFormCheckRuleMap,a)}}function changeFormControlDisabled(a){var b=getRealJqueryObject(a);if(!isOk(b)){return}b.attr("disabled","disabled").attr("readonly","readonly");removeFormEleAllStyle(b)}function changeFormControlEnable(a){var b=getRealJqueryObject(a);if(!isOk(b)){return}b.removeAttr("disabled").removeAttr("readonly");removeFormEleAllStyle(b)}function changeFormControlRequired(a){changeFormControlRequiredState(a,true)}function changeFormControlNotRequired(a){changeFormControlRequiredState(a,false)}function changeFormControlRequiredState(b,a){var c=getRealJqueryObject(b);if(!isOk(c)){return}if(a){c.data("notnull",true).attr("data-notnull",true);requiredAndStarIt(c)}else{c.data("notnull",false).attr("data-notnull",false);removeRequiredAndStar(c)}removeFormEleAllStyle(c)}var FormChecker={init:function(){var a=this;jboltBody.on("input","[data-rule]:not(select)",function(){var b=$(this);if(!b.data("ajax-check-url")){b.data("noshake",true);a.checkIt(b);b.data("noshake",false)}});jboltBody.on("change","select[data-rule]",function(){var b=$(this),d;var c=b.data("select-type");if(c&&c=="select2"){d=b.next().find(".select2-selection")}if(b.data("firstchanged")){b.data("noshake",true);if(isOk(d)){d.data("noshake",true)}a.checktype(b);b.data("noshake",false);if(isOk(d)){d.data("noshake",false)}}else{b.data("firstchanged",true);if(isOk(d)){d.data("firstchanged",true)}}});a.initInputCheckWithAjax()},initInputCheckWithAjax:function(){jboltBody.on("blur","input[data-ajax-check-url]",function(c){c.preventDefault();c.stopPropagation();var a=$(this),d=$.trim(a.val()),b=a.data("ajax-check-url");if(d&&b){LayerMsgBox.loading("校验中...",10000);b=actionUrl(b);$.ajax({url:b,type:"post",dataType:"json",timeout:10000,data:{data:d},success:function(e){if(e.state=="ok"){showItCheckSuccessResult(a);LayerMsgBox.closeLoading()}else{if(e.msg){if(e.msg=="jbolt_system_locked"){showJboltLockSystem()}else{if(e.msg=="jbolt_nologin"){showReloginDialog()}else{if(e.msg&&e.msg=="jbolt_terminal_offline"){showReloginDialog();LayerMsgBox.alert("当前用户已在其它终端登录，本机已下线",2)}else{showItCheckFailResult(a,e.msg);LayerMsgBox.error(e.msg,1500)}}}}else{LayerMsgBox.error("校验异常",1500)}}},error:function(){showItCheckFailResult(a);LayerMsgBox.error("网络通讯异常",1500)}})}return false})},checkEle:function(a){return this.checkIt(a,true,true)},checkIt:function(h,f,i){var d=this;var c=getRealJqueryObject(h);var e=true;if(c.is(":disabled")){return true}if(!i){if(!c.val()){removeFormEleAllStyle(c);return true}}if(c.data("rule")){var a=d.checktype(c);var b=c.is("textarea");if(!a){e=false;if(c.is("input")&&c.attr("type")=="hidden"){return}c.removeClass("is-valid").addClass("is-invalid");processCheckTab(c);c.shake(2,10,400);if(f){c.focus()}if(c.is("input")&&c.attr("type")=="file"){return}}else{e=true;if(c.is("input")&&c.attr("type")=="hidden"){return}c.removeClass("is-invalid").addClass("is-valid");if(c.is("input")&&c.attr("type")=="file"){return}}}return e},check:function(d){var a=getRealJqueryObject(d);var b=this;var c=true;a.find("input,textarea,select,[data-rule='checkbox'],[data-rule='radio']").each(function(){if(!c){return c}var f=$(this);if(f.is(":disabled")){return true}if(typeof(f.data("rule"))!="undefined"){var e=b.checktype(f);if(!e){c=false}else{c=true}}});return c},checkCheckboxRequired:function(d,a,b){var c=this;var e=d.data("name");if(!e){removeFormEleErrorStyle(d);return false}var f=$("input[type='checkbox'][name='"+e+"']:checked");if(f&&f.length>0){d.removeClass("bdc-danger").addClass("bdc-success");removeFormEleErrorStyle(d);return true}d.removeClass("bdc-success").addClass("bdc-danger");if(!a){a="必须选择至少一个选项"}c.showMyTipsIfNeed(d,a,b);return false},checkSelectRequired:function(b,a,c){var d=this;var f=b.val();var e=(f&&f!=""&&f!="0"&&f!="-1"&&f.length>0);if(e){removeFormEleErrorStyle(b);return true}if(!a){a="必须选择一个选项"}d.showMyTipsIfNeed(b,a,c);return false},checkRadioRequired:function(d,a,b){var c=this;var e=d.data("name");if(!e){removeFormEleErrorStyle(d);return false}var f=$("input[type='radio'][name='"+e+"']:checked");if(f&&f.length>0){d.removeClass("bdc-danger").addClass("bdc-success");removeFormEleErrorStyle(d);return true}d.removeClass("bdc-success").addClass("bdc-danger");if(!a){a="必须选择一个选项"}c.showMyTipsIfNeed(d,a,b);return false},checktype:function(c){var b=this;var f=c.data("rule");if(!f){return true}var d=c.data("tips"),a=c.data("show"),e=c.data("notnull");var h=null;if(f=="checkbox"){if(e==null||e==true||e=="true"){return b.checkCheckboxRequired(c,d,a)}else{return true}}else{if(f=="radio"){if(e==null||(typeof(e)=="boolean"&&e==true)||e=="true"){return b.checkRadioRequired(c,d,a)}else{return true}}else{if(f=="select"){if(e==null||(typeof(e)=="boolean"&&e==true)||e=="true"){return b.checkSelectRequired(c,d,a)}else{return true}}else{h=c.val()}}}if(a!=null){g(a).innerHTML=""}if(typeof h=="string"){h=h.trim()}if(!h){if(e==null||(typeof(e)=="boolean"&&e==true)||e=="true"){if(!d){if(c.attr("type")=="file"){d="此文件必须上传"}else{d="必填项"}}showFormEleErrorStyle(c,d);if(a==null){}else{g(a).innerHTML=d}return false}else{return true}}return b.checkTypes(c,f,h,d,a,e)},checkTypes:function(k,j,l,e,m,c){var p=this;var f=j.split(";");var a=true;var h=1;var o=2;var b=3;var n=f.length;for(var d=0;d<n;d++){var j=f[d];var q=p.checkSelf(k,j,l,e,m,c);if(q!=b){if(q==o){continue}else{a=false;break}}q=p.checkCompare(k,j,l,e,m,c);if(q!=b){if(q==o){continue}else{a=false;break}}}if(a){removeFormEleErrorStyle(k)}return a},checkCompare:function(l,f,m,e,n,c){var q=this;var h=1;var o=2;var b=3;var a=q.getRealTypeValue(m);var p=q.getCompareValue(f);if(f.indexOf("len=")!=-1){if(m.length==p){return o}if(!e){e="必须输入"+p+"个字符"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("len>=")!=-1){if(m.length>=p){return o}if(!e){e="至少输入"+p+"个字符"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("len>")!=-1){if(m.length>p){return o}if(!e){e="至少输入"+(p+1)+"个字符"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("fix=")!=-1){var k=m.split(".");if(k.length==1&&p==0){return o}if(k.length==2&&k[1].length==p){return o}if(!e){e="小数位必须保留"+p+"位"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("fix>=")!=-1){var k=m.split(".");if(k.length==1&&p==0){return o}if(k.length==2&&k[1].length>=p){return o}if(!e){e="小数位至少保留"+p+"位"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("fix>")!=-1){var k=m.split(".");if(k.length==2&&k[1].length>p){return o}if(!e){e="小数位至少保留"+p+"位"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("sum=")!=-1){var k=m.trim().split(":");var j=0;for(var d in k){j=j+Number(k[d])}if(j==p){return o}if(!e){e="比例值的和必须等于"+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("sum>=")!=-1){var k=m.trim().split(":");var j=0;for(var d in k){j=j+Number(k[d])}if(j>=p){return o}if(!e){e="比例值的和必须大于等于"+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("sum>")!=-1){var k=m.trim().split(":");var j=0;for(var d in k){j=j+Number(k[d])}if(j>p){return o}if(!e){e="比例值的和必须大于"+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf(">=")!=-1){if(a>=p){return o}if(!e){e="值必须>="+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("len<=")!=-1){if(m.length<=p){return o}if(!e){e="最多可输入"+p+"个字符"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("len<")!=-1){if(m.length<p){return o}if(!e){e="最多可输入"+(p-1)+"个字符"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("fix<=")!=-1){var k=m.split(".");if(k.length==1){return o}if(k.length==2&&k[1].length<=p){return o}if(!e){e="小数位最多保留"+p+"位"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("fix<")!=-1){var k=m.split(".");if(k.length==1){return o}if(k.length==2&&k[1].length<p){return o}if(!e){e="小数位最多保留"+(p-1)+"位"}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("sum<=")!=-1){var k=m.trim().split(":");var j=0;for(var d in k){j=j+Number(k[d])}if(j<=p){return o}if(!e){e="比例值的和必须小于等于"+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("sum<")!=-1){var k=m.trim().split(":");var j=0;for(var d in k){j=j+Number(k[d])}if(j<p){return o}if(!e){e="比例值的和必须小于"+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("<=")!=-1){if(a<=p){return o}if(!e){e="值必须<="+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf(">")!=-1){if(a>p){return o}if(!e){e="值必须>"+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("<")!=-1){if(a<p){return o}if(!e){e="值必须小于"+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("!=")!=-1){if(a!=p){return o}if(!e){e="值不能="+p}q.showMyTipsIfNeed(l,e,n);return h}else{if(f.indexOf("==")!=-1){if(a==p){removeFormEleErrorStyle(l);return o}if(!e){if(f.indexOf("#")!=-1){e="值必须等于id为["+f.substring(f.indexOf("#")+1)+"]元素的值"}else{e="值必须="+p}}q.showMyTipsIfNeed(l,e,n);return h}}}}}}}}}}}}}}}}}}}}}return b},getRealTypeValue:function(a){if(!isNaN(a)){return Number(a)}return a},getCompareValue:function(b){var a=this;if(b.indexOf("#")!=-1){var c=b.substring(b.indexOf("#"));return a.getRealTypeValue($(c).val())}else{if(b.indexOf("len<=")!=-1||b.indexOf("fix<=")!=-1||b.indexOf("sum<=")!=-1||b.indexOf("len>=")!=-1||b.indexOf("fix>=")!=-1||b.indexOf("sum>=")!=-1){return a.getRealTypeValue(b.substring(5))}if(b.indexOf("len=")!=-1||b.indexOf("fix=")!=-1||b.indexOf("sum=")!=-1||b.indexOf("len<")!=-1||b.indexOf("fix<")!=-1||b.indexOf("sum<")!=-1||b.indexOf("len>")!=-1||b.indexOf("fix>")!=-1||b.indexOf("sum>")!=-1){return a.getRealTypeValue(b.substring(4))}if(b.indexOf("len")!=-1||b.indexOf("fix")!=-1||b.indexOf("sum")!=-1){b=b.substring(3)}if(b.indexOf("=")!=-1){return a.getRealTypeValue(b.substring(2))}else{return a.getRealTypeValue(b.substring(1))}}},showMyTipsIfNeed:function(b,c,a){if(c!=null){showFormEleErrorStyle(b,c);if(a==null){}else{g(a).innerHTML=c}}else{removeFormEleErrorStyle(b)}},checkSelf:function(j,f,k,e,l,c){var n=this;var h=1;var m=2;var b=3;if(f=="string"){return m}var a=false;for(var d=0;d<jboltFormCheckRuleMap.length;d++){if(f==jboltFormCheckRuleMap[d].type){a=true;var o=jboltFormCheckRuleMap[d].method.call(this,k);if(!o){if(f=="idcardno"){n.showMyTipsIfNeed(j);return m}if(!e){switch(f){case"email":e="Email格式不正确";break;case"phone":e="手机号格式不正确";break;case"tel":e="电话号码格式不正确";break;case"money":e="必须为金额(价格)格式 默认最多小数点后保留2位";break;case"money_4":e="必须为金额(价格)格式 最多小数点后保留4位";break;case"number":e="必须为数字";break;case"pnumber":e="必须为正数";break;case"pznumber":e="必须为大于等于0的数字";break;case"pzint":e="必须为0或正整数";break;case"int":e="必须为整数";break;case"pint":e="必须为正整数";break;case"date":e="必须为日期格式 例：2019-01-01";break;case"time":e="必须为时间格式 例：12:59:59";break;case"time_hm":e="必须为时间格式 例：12:59";break;case"datetime":e="必须为完整日期时间格式 例：2019-01-01 12:59:59";break;case"datetime_hm":e="必须为日期时间格式 例：2019-01-01 12:59";break;case"idnum":e="必须为18位身份证号 例：370523198901033922";break;case"postalcode":e="必须为6位邮政编码 例：6473098";break;case"zh_cn":e="必须为中文";break;case"letter_num":e="只能输入英文字母、数字和下划线";break;case"letter":e="只能输入英文字母";break;case"ip":e="必须为IP地址正确格式 例：127.0.0.1";break;case"password":e="密码长度必须为6~16个字符";break;case"select":e="必须选择一项";break;case"proportion":e="比例格式不正确 例 2:10";break;case"proportion_multi":e="比例格式不正确 例 2:10 或者 2:5:5";break;default:e="格式不正确";break}}n.showMyTipsIfNeed(j,e,l);return h}if(f=="idcardno"){n.showMyTipsIfNeed(j,o);return h}}}return a?m:b}};function clickOneJBoltMenuGroup(h){var f=h.closest("nav");var b=null;if(JBolt_Enable_Topnav){b=jboltAdminLeftNavs.find(".jbolt_admin_nav:not(.d-none).expansion")}else{b=jboltAdminLeftNavs.find(".jbolt_admin_nav.expansion")}if(!h.hasClass("l1link")){if(isOk(b)){var a,e,c;b.each(function(){a=$(this);e=a.data("key");c=f.data("key");if(e!=c){if(!a.hasClass("single_link")){a.removeClass("expansion");a.find(".jbolt_menu_group i.jbicon.jb-arrowdown").removeClass("haschanged")}}})}var d=h.find("i.jbicon.title_arrow");if(d.hasClass("haschanged")){f.removeClass("expansion");d.removeClass("haschanged")}else{f.addClass("expansion");d.addClass("haschanged")}}else{if(isOk(b)){b.removeClass("expansion");b.find(".jbolt_menu_group i.jbicon.jb-arrowdown").removeClass("haschanged")}f.addClass("expansion");f.find(".jbolt_menu_group i.jbicon.title_arrow").addClass("haschanged")}setTimeout(function(){changeLeftNavScroll()},400)}function initAdminLeftNav(){if(typeof(JBolt_Left_Nav_width)=="undefined"||!JBolt_Left_Nav_width){return false}var a=localStorage.getItem("jbolt_hideMenu");if(a=="true"){jboltBody.find(".jbolt_admin_nav.expansion").removeClass("expansion");jboltAdmin.addClass("hideMenu");jboltBody.find(".jbolt_toggle_Left_nav_btn").addClass("hidden");jboltAdmin.find(".jbolt_admin_left").css("width","60px");jboltAdmin.find(".jbolt_admin_logo_box").css("width","60px");jbolt_tabbar.css("left","60px");jboltAdminMain.css("left","60px")}else{jboltAdmin.addClass("normalMenu");jboltAdmin.find(".jbolt_admin_left").css("width",JBolt_Left_Nav_width+"px");jboltAdmin.find(".jbolt_admin_logo_box").css("width",JBolt_Left_Nav_width+"px");jbolt_tabbar.css("left",JBolt_Left_Nav_width+"px");jboltAdminMain.css("left",JBolt_Left_Nav_width+"px")}jboltBody.on("click",".jbolt_admin_left_navs li.has_items",function(){if(jboltAdmin.hasClass("hideMenu")){return false}var k=$(this);var j=k.find("a");var b=k.next("nav");var c=k.data("level");var e,h;var i=jboltBody.find(".jbolt_admin_left_navs li.has_items[data-level='"+c+"'].expansion");if(isOk(i)){e=i.find("a");h=e.data("key")}var f=j.data("key");var d=j.find("i.jbicon.title_arrow");d.toggleClass("haschanged");if(isOk(i)&&f!=h){i.removeClass("expansion");e.find("i.jbicon.title_arrow").removeClass("haschanged")}k.toggleClass("expansion");setTimeout(function(){changeLeftNavScroll()},400);return false});jboltBody.on("click",".jbolt_admin_left_navs>a[data-hasurl][data-open-type='1']",function(c){var b=jboltAdminLeftNavs.find(".jbolt_admin_nav.expansion");if(isOk(b)){b.removeClass("expansion");b.find(".jbolt_menu_group i.jbicon.jb-arrowdown").removeClass("haschanged")}});jboltBody.on("click",".jbolt_admin_left_navs .jbolt_menu_group",function(b){clickOneJBoltMenuGroup($(this))});jboltBody.on("mouseenter",".jbolt_admin.hideMenu  nav.jbolt_admin_nav .jbolt_menu_group",function(i){var b=$(this).closest("nav.jbolt_admin_nav");var f=b.find("ul.jbolt_admin_menus").first(),m=parseInt(f.outerHeight()),j=parseInt(b.offset().top),d=b.width();var k=m;if(m-10>jboltWindowHeight-j){j=jboltWindowHeight-m;if(j<120){j=120}k=jboltWindowHeight-j+60}else{j=j+60}f.css({left:d+"px",top:j+"px","max-height":k+"px"});var l=(jboltWindowHeight-(jboltWindowHeight-j+60-f.outerHeight()));var h=b.offset().top;var c=(h+60);if(l<c){if(h<jboltWindowHeight&&c>jboltWindowHeight){j=j+(c-l)-(c-jboltWindowHeight)}else{j=j+(c-l)}}f.css("top",j+"px")}).on("mouseleave",".jbolt_admin.hideMenu  nav.jbolt_admin_nav",function(c){var b=$(this).find("ul.jbolt_admin_menus").first();b.css({"max-height":"none",height:"auto"})});initLeftNavScroll()}function changeLeftNavScroll(){initLeftNavScroll()}function initLeftNavScroll(){}function pjaxErrorProcess(a){JBoltPjaxUtil.sendPjax("admin/pjaxerror",mainPjaxContainerId,{errorCode:a})}function urlWithFormData(d,c){var b=c.serialize();var a=b.replaceAll("=undefined","=");if(d.indexOf("?")!=-1){d=d+"&"+a}else{d=d+"?"+a}return d}function urlWithJsonData(b,a){var c=jsonObjectToUrlParam(a);if(isOk(c)){if(b.indexOf("?")==-1){b=b+"?"+c}else{b=b+"&"+c}}return b}function pjaxSubmitForm(a){var c=getRealJqueryObject(a);if(isOk(c)){var b=c.attr("action");if(b){b=urlWithFormData(b,c);$.pjax({url:b,container:mainPjaxContainerId})}else{LayerMsgBox.alert("Form 未配置action",2)}}else{LayerMsgBox.alert("Form 参数异常",2)}return false}var pjaxErrorTpl='<div class="jbolt_page" data-dontchangeleftnav="true"><div class="jbolt_page_content"><div style="margin: 20px auto;max-width: 500px"><div class="alert alert-danger">404,您访问的资源不存在!</div></div></div></div>';var JBoltPjaxUtil={openByType:function(e){var b=e.attr("href")||e.data("url");if(!b||b.indexOf("javascript")!=-1){return false}b=actionUrl(b);b=processEleUrlByLinkOtherParamEle(e,b);var c=e.data("key")||randomId();var d=$.trim(e.data("text")||e.data("title")||e.attr("title")||e.text()||"新标签页");var a=e.data("open-type");if(!a){a=1}var f=e.data("open-option");if(!f||(f&&!f.hideLeftNav)){jboltAdmin.removeClass("fullMainContainer")}if(typeof(a)=="number"){switch(a){case 1:JBoltPjaxUtil.sendPjax(b,mainPjaxContainerId);break;case 2:activeLeftNavByKey(c);pjaxAdminLeftNavWithIframe(b,f);break;case 3:activeLeftNavByKey(c);adminLeftNavshowInDialog(d,b,f);break;case 4:activeLeftNavByKey(c);JBoltLayerUtil.openByNav(b,f);break;default:JBoltPjaxUtil.sendPjax(b,mainPjaxContainerId);break}}else{if(typeof(a)=="string"){switch(a){case"iframe":activeLeftNavByKey(c);pjaxAdminLeftNavWithIframe(b,f);break;case"dialog":activeLeftNavByKey(c);adminLeftNavshowInDialog(d,b,f);break;case"jboltlayer":activeLeftNavByKey(c);JBoltLayerUtil.openByNav(b,f);break;default:JBoltPjaxUtil.sendPjax(b,mainPjaxContainerId);break}}}},sendPjax:function(b,a,c){b=actionUrl(b);$.pjax({url:b,container:a?a:mainPjaxContainerId,extData:c})},triggerPjaxJBoltPageCloseHandler:function(jboltPage){var jboltPage=jboltPage?jboltPage:(mainPjaxContainer.find(".jbolt_page[data-close-handler]"));var closeHandler=jboltPage.data("close-handler");if(closeHandler){if(closeHandler=="removeCommand"&&JBoltWS){var commands=jboltPage.data("remove-command");JBoltWS.removeCommand(commands)}else{var exe_handler=eval(closeHandler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(jboltPage)}}}},initPjaxEvent:function(){if(!hasPjax){return}var a=this;$.pjax.defaults.timeout=5000;jboltBody.on("pjax:start",function(){a.triggerPjaxJBoltPageCloseHandler();LayerMsgBox.load(3,5000);closeJBoltLayer();FormDate.hide()}).on("pjax:success",function(){JBoltPjaxUtil.afterPjax()}).on("pjax:end",function(){LayerMsgBox.closeLoadNow();LayerMsgBox.closeAll()}).on("pjax:error",function(i,b,d,c){if(!jboltWithTabs){i.preventDefault();var h=b?(b.responseText||pjaxErrorTpl):pjaxErrorTpl;mainPjaxContainer.empty().html(h);var f=$(i.relatedTarget).data("key");if(f){activeLeftNavByKey(f)}return false}}).on("pjax:timeout",function(b){LayerMsgBox.closeAll();b.preventDefault()}).on("pjax:popstate",function(b){if(b.direction=="back"){var c=jboltBody.data("ispjax");if(!c){refreshPjaxContainer()}}});jboltBody.on("submit","form[data-pjaxsubmit]",function(b){var c=$(this).data("needcheck");if(c){if(FormChecker.check(this)){$.pjax.submit(b,mainPjaxContainerId)}}else{$.pjax.submit(b,mainPjaxContainerId)}return false});jboltBody.on("click",'a[data-pjax]:not([target]),.jbolt_admin_left_navs a[data-open-type="1"]:not([target])',function(d){d.preventDefault();d.stopPropagation();var f=$(this),h=f.data("open-option"),b=f.attr("href"),c=f.data("key");if(c){activeLeftNavByKey(c)}if(!h||(h&&!h.hideLeftNav)){jboltAdmin.removeClass("fullMainContainer")}JBoltPjaxUtil.sendPjax(b,mainPjaxContainerId);return false});jboltBody.on("click",".jbolt_admin_left_navs a[data-open-type='2']",function(d){d.preventDefault();d.stopPropagation();var f=$(this),h=f.data("open-option"),b=f.attr("href"),c=f.data("key");if(c){activeLeftNavByKey(c)}if(!h||(h&&!h.hideLeftNav)){jboltAdmin.removeClass("fullMainContainer")}pjaxAdminLeftNavWithIframe(b,h);return false});jboltBody.on("click",".jbolt_admin_left_navs a[data-open-type='3']",function(d){d.preventDefault();d.stopPropagation();var h=$(this),i=h.data("open-option"),f=$.trim(h.text()),b=h.attr("href"),c=h.data("key");if(c){activeLeftNavByKey(c)}if(!i||(i&&!i.hideLeftNav)){jboltAdmin.removeClass("fullMainContainer")}adminLeftNavshowInDialog(f,b,i);return false});jboltBody.on("click",".jbolt_admin_left_navs a[data-open-type='4']",function(d){d.preventDefault();d.stopPropagation();var f=$(this),h=f.data("open-option"),b=f.attr("href"),c=f.data("key");if(c){activeLeftNavByKey(c)}if(!h||(h&&!h.hideLeftNav)){jboltAdmin.removeClass("fullMainContainer")}JBoltLayerUtil.openByNav(b,h);return false})},initAdminPjax:function(){this.initPjaxEvent();var a=jboltBody.data("ispjax");if(!a){JBoltPjaxUtil.afterPjax()}},afterPjax:function(){pjaxLoadRequirePluginAndInit();$(".tooltip.show").remove();initOpenLeftNav();SelectUtil.initAutoSetValue(mainPjaxContainer);FileUploadUtil.init(mainPjaxContainer);ImgUploadUtil.init(mainPjaxContainer);SwitchBtnUtil.init(mainPjaxContainer);FormDate.init(mainPjaxContainer);CityPickerUtil.init(mainPjaxContainer);LayerTipsUtil.init(mainPjaxContainer);HtmlEditorUtil.init(mainPjaxContainer);MasterSlaveUtil.init(mainPjaxContainer);ImageViewerUtil.init(mainPjaxContainer);RadioUtil.init(mainPjaxContainer);CheckboxUtil.init(mainPjaxContainer);AutocompleteUtil.init(mainPjaxContainer);Select2Util.init(mainPjaxContainer);SelectUtil.init({parent:mainPjaxContainer});MultipleFileInputUtil.init(mainPjaxContainer);AjaxPortalUtil.init(mainPjaxContainer);JSTreeUtil.init(mainPjaxContainer);JBoltInputUtil.init(mainPjaxContainer);RangeSliderUtil.init(mainPjaxContainer);JBoltInputWithClearBtnUtil.init(mainPjaxContainer);JBoltInputWithCalculatorUtil.init(mainPjaxContainer);initToolTip(mainPjaxContainer);initPopover(mainPjaxContainer);JBoltTableUtil.init(mainPjaxContainer);JBoltTreeTableUtil.init(mainPjaxContainer);JBoltTabViewUtil.initUI(mainPjaxContainer);TextareaUtil.initUI(mainPjaxContainer);JsonEditorUtil.init(mainPjaxContainer);findRequiredAndStarIt(mainPjaxContainer);var b=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li.active");if(isOk(b)){var a=b.data("id");activeTopnavFirstLeftMenusNotSingleLink(a)}}};function refreshCurrentTabContent(){var b=JBoltTabUtil.getCurrentTabContent();if(b&&b.length==1){LayerMsgBox.load(3);var a=b.find("iframe.jbolt_main_iframe");if(isOk(a)){a.attr("src",a.attr("src"))}else{b.ajaxPortal(true,null,true,function(){LayerMsgBox.closeLoadNow()})}}}function changeCurrentTabTitle(a){JBoltTabUtil.changeCurrentTabTitle(a)}function changeTabTitle(a,b){JBoltTabUtil.changeTabTitle(a,b)}function refreshTheTabContent(b){if(b&&b.length==1){LayerMsgBox.load(3);var a=b.find("iframe.jbolt_main_iframe");if(isOk(a)){a.attr("src",a.attr("src"))}else{b.ajaxPortal(true,null,true,function(){LayerMsgBox.closeLoadNow()})}}}function isIE(){if(!!window.ActiveXObject||"ActiveXObject" in window){return true}else{return false}}function refreshPjaxContainer(b){if(b){var c=getRealJqueryObject(b);if(isOk(c)){disposeTooltip(c)}}if(window.self!=window.top){reloadCurrentPage()}else{if(jboltWithTabs){refreshCurrentTabContent()}else{var a=mainPjaxContainer.find("iframe.jbolt_main_iframe");if(isOk(a)){a.attr("src",a.attr("src"))}else{if(isIE()){reloadCurrentPage()}else{$.pjax.reload(mainPjaxContainerId)}}}}}function initOpenLeftNav(){var d=null;if(jboltWithTabs){var c=JBoltTabUtil.getCurrentTabContent();if(c&&c.length==1){d=c.find("div.jbolt_page[data-key]:first")}}else{d=$("div.jbolt_page[data-key]:first")}if(d&&d.length==1){var b=d.data("key");var a=d.data("dontchangeleftnav");if(!a){openLeftNav(b)}}}function activeLeftNavByKey(h){var b=jboltAdminLeftNavs.find("nav.jbolt_admin_nav a.active");if(b.data("key")==h){return false}b.removeClass("active");var d;if(jboltHasTopNav){d=$(".jbolt_admin_nav:not(.d-none).expansion");if(isOk(d)){d.removeClass("expansion");d.find(".jbolt_menu_group i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged")}jboltAdminLeftNavs.find(".jbolt_admin_nav:not(.d-none) li.has_items").removeClass("expansion").find("i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged")}else{d=$(".jbolt_admin_nav.expansion");if(isOk(d)){d.removeClass("expansion");d.find(".jbolt_menu_group i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged")}jboltAdminLeftNavs.find("li.has_items").removeClass("expansion").find("i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged")}var j=jboltAdminLeftNavs.find("nav.jbolt_admin_nav a[data-key='"+h+"']").first();if(isOk(j)){j.addClass("active");var a=j.closest("nav");if(isOk(a)){a.addClass("expansion");a.find(".jbolt_menu_group i.jbicon.jb-arrowdown:not(.haschanged)").addClass("haschanged");var i=j.closest("li");processParentUlAndHasItemsLiExp(i,a);if(jboltWithTabs){var f=a.data("topnavid");var e=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li[data-id='"+f+"']");if(isOk(e)){activeTopnav(e)}}var c=j.data("open-option");if(c&&c.hideLeftNav){hideLeftAndFullMainConainer()}else{jboltAdmin.removeClass("fullMainContainer")}}}}function actionUrl(a){if(a&&a.charAt(0)=="/"&&a.charAt(1)!="/"){a=a.substring(1)}if(a&&a.indexOf("\\")!=-1){a=a.replace(/\\/g,"/")}return a}function openLeftNav(b){b=actionUrl(b);var d=jboltAdminLeftNavs.find("nav.jbolt_admin_nav a.active");var c=jboltAdminLeftNavs.find("nav.jbolt_admin_nav.single_link.expansion");if(isOk(c)&&d.data("key")!=c.data("key")){c.removeClass("expansion")}if(d.attr("href")==b){return false}d.removeClass("active");var e;if(jboltHasTopNav){e=$(".jbolt_admin_nav:not(.d-none).expansion");e.removeClass("expansion");e.find(".jbolt_menu_group i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged");jboltAdminLeftNavs.find(".jbolt_admin_nav:not(.d-none) li.has_items").removeClass("expansion").find("i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged")}else{e=$(".jbolt_admin_nav.expansion");e.removeClass("expansion");e.find(".jbolt_menu_group i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged");jboltAdminLeftNavs.find("li.has_items").removeClass("expansion").find("i.jbicon.jb-arrowdown.haschanged").removeClass("haschanged")}var j=jboltAdminLeftNavs.find("nav.jbolt_admin_nav a[href='"+b+"']").first();if(isOk(j)){j.addClass("active");var a=j.closest("nav");if(isOk(a)){a.addClass("expansion");a.find(".jbolt_menu_group i.jbicon.jb-arrowdown:not(.haschanged)").addClass("haschanged");var i=j.closest("li");processParentUlAndHasItemsLiExp(i,a);var h=a.data("topnavid");var f=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li[data-id='"+h+"']");if(isOk(f)){activeTopnav(f)}}}}function processParentUlAndHasItemsLiExp(a,d){var e=a.data("level");if(e<=2){return false}var b=a.closest("ul.jbolt_admin_menus");if(isOk(b)){var c=b.prev("li.has_items");if(isOk(c)){c.addClass("expansion").find("i.jbicon.jb-arrowdown:not(.haschanged)").addClass("haschanged");processParentUlAndHasItemsLiExp(c,d)}}}function pjaxJBoltPageCloseHandler(){var a=mainPjaxContainer.find(".jbolt_page[data-close-handler]");if(a&&a.length==1){a.on()}}function pjaxLoadRequirePluginAndInit(){var a=mainPjaxContainer.find(".jbolt_page[data-require-plugin],.jbolt_page[data-init-handler]");if(a&&a.length==1){jboltPageLoadRequirePluginAndInit(a)}}function pageLoadRequirePluginAndInit(){var a=jboltBody.find(".jbolt_page[data-require-plugin],.jbolt_page[data-init-handler]");if(a&&a.length==1){jboltPageLoadRequirePluginAndInit(a)}}function processLoadedPlugins(a){var c=new Array();for(var b in a){if(!loadedPlugins[a[b]]){c.push(a[b])}}return c}function loadJBoltPlugin(plugins,callback){if(plugins&&plugins.length>0){if(typeof(plugins)=="string"){if(plugins.indexOf(",")!=-1){plugins=plugins.split(",")}else{plugins=[plugins]}}if(plugins&&isArray(plugins)&&plugins.length>=2){plugins=JBoltArrayUtil.unique(plugins)}plugins=processLoadedPlugins(plugins);if(!plugins||plugins.length==0){if(callback){var exe_handler=eval(callback);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler()}}return false}var plugin,pluginName;var cssArr,jsArr,plen=plugins.length;var exeCallback=function(docallback){var exe_handler=eval(docallback);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler()}};var count=0;var loadJsCss=function(pluginName){var lplugin=jboltPlugins[pluginName];if(lplugin){var cssArr=lplugin.css;var jsArr=lplugin.js;if(isOk(cssArr)){AssetsLazyLoad.css(cssArr,function(){if(isOk(jsArr)){AssetsLazyLoad.js(jsArr,function(){count++;loadedPlugins[pluginName]=lplugin})}else{count++;loadedPlugins[pluginName]=lplugin}})}else{if(isOk(jsArr)){AssetsLazyLoad.js(jsArr,function(){count++;loadedPlugins[pluginName]=lplugin})}}}else{count++}};for(var i in plugins){loadJsCss(plugins[i])}if(callback){var timer=setInterval(function(){if(count==plugins.length){clearInterval(timer);exeCallback(callback)}},10)}}}function jboltPageLoadRequirePluginAndInit(jboltPage){var requirePlugin=jboltPage.data("require-plugin");var initHandler=jboltPage.data("init-handler");if(requirePlugin){var plugins=requirePlugin.split(",");loadJBoltPlugin(plugins,initHandler)}else{var exe_handler=eval(initHandler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(jboltPage)}}}function portalLoadRequirePluginAndInit(c){var a=getRealParentJqueryObject(c);if(!isOk(a)){return false}var b=a.find(".jbolt_page[data-require-plugin]");if(b&&b.length==1){jboltPageLoadRequirePluginAndInit(b)}}function jboltPageSubmitForm(f,e,a,i){var d=e.closest(".pages");if(!i){var l=d.find("#gonu");if(l&&l.length>0){i=l.val()}else{i=1}}var j=d.find("#pageSize").val();a.append('<input type="hidden" name="page" value="'+i+'"/>');a.append('<input type="hidden" name="pageSize" value="'+j+'"/>');var m=a.attr("id");if(m){var n=jboltBody.find("table[data-conditions-form='"+m+"']");if(isOk(n)){var c=n.data("sort");if(c){var k=c.split(":");var b=k[0];var h=k[1];a.append('<input type="hidden" name="sortColumn" value="'+b+'"/>');a.append('<input type="hidden" name="sortType" value="'+h+'"/>')}}}a.submit()}function initPage(b,f,l,m){var d=null;var c=$("#"+b);var k=c.closest(".pages");var e=c.closest("[data-ajaxportal]");if(e&&e.length==1){d=e}else{if(jboltWithTabs){d=JBoltTabUtil.getCurrentTabContent()}else{d=mainPjaxContainer;var i=!(d&&d.length==1);if(i){d=$("body .jbolt_page");var h=!(d&&d.length==1);if(h){d=jboltBody}}}}if(!d){return false}var a=d.find("#"+m);var j=a.attr("action");loadJBoltPlugin(["pagination"],function(){c.pagination(f,{num_edge_entries:1,current_page:(l-1),callback:function(n,o){if(isNaN(n)==false){var p=n+1;jboltPageSubmitForm(d,c,a,p);return false}}});k.find("#gonu").on("keydown",function(n){if(n.keyCode==109||n.keyCode==189){return false}});k.find(".page-btn").on("click",function(){var n=k.find("#gonu");if(isOk(n)){if(FormChecker.checkIt(n[0])){jboltPageSubmitForm(d,c,a)}}else{jboltPageSubmitForm(d,c,a)}});k.find("#pageSize").on("change",function(){jboltPageSubmitForm(d,c,a,1)})})}function activeTopnav(d){var c=d.parent().find("li.active");var b=isOk(c);var a=d.data("id");if(b&&a==c.data("id")){return}if(b){c.removeClass("active")}d.addClass("active");jboltAdminLeftNavs.find("nav[data-topnavid='"+a+"']").removeClass("d-none");jboltAdminLeftNavs.find("nav:not([data-topnavid='"+a+"'])").addClass("d-none");activeTopnavFirstLeftMenusNotSingleLink(a)}function activeTopnavFirstLeftMenusNotSingleLink(b){var a=jboltAdminLeftNavs.find("nav:not(.d-none).expansion");if(!isOk(a)){var c=jboltAdminLeftNavs.find("nav:not(.d-none):first");if(isOk(c)){var d=c.find(".jbolt_menu_group");if(isOk(d)){clickOneJBoltMenuGroup(d)}}}}function jboltAdminLayoutInitTopNavFirst(){if(JBolt_Enable_Topnav){var a=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li.active");if(!isOk(a)){var b=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li:first");if(isOk(b)){activeTopnav(b)}}}}function useSessionStorageToActiveTab(){var c,a=false;for(var b in jbolt_tabs_array){c=jbolt_tabs_array[b];if(typeof(c.active)=="boolean"&&c.active){a=true;break}}return a}function jboltAdminIndexInitFirstLeftNav(){var d=useSessionStorageToActiveTab();if(d){return}var h=null;var c=0;if(JBolt_Enable_Topnav){var f=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li.active");if(!isOk(f)){f=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li:first")}if(isOk(f)){c=f.data("id");h=$(".jbolt_admin_left_navs .jbolt_admin_nav[data-topnavid='"+c+"']").first()}if(!isOk(h)){h=$(".jbolt_admin_left_navs .jbolt_admin_nav").first();c=h.data("topnavid")||0}}else{h=$(".jbolt_admin_left_navs .jbolt_admin_nav").first()}if(isOk(h)){var b=h.find("a[data-hasurl]").first();if(b&&b.length>0){b.trigger("click");if(JBolt_Enable_Topnav&&c==0){var e=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li[data-id='0']");if(isOk(e)){activeTopnav(e)}}}}}function toggleLeftMenuEventByTopnav(){jboltBody.on("click",".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li",function(){activeTopnav($(this))});var b=$(".jbolt_admin_main_top>ul.jbolt_admin_topnavs>li[data-id='0']");if(isOk(b)){var a=jboltAdminLeftNavs.find("nav[data-topnavid='0']");if(isOk(a)){b.removeClass("d-none")}}}function toggleMenuEvent(){jboltBody.on("click",".jbolt_toggle_Left_nav_btn",function(){var b=$(this);b.toggleClass("hidden");disposeTooltip(b);$(".jbolt_admin_nav.expansion").removeClass("expansion");jboltAdmin.toggleClass("hideMenu").toggleClass("normalMenu");jboltAdminLeftNavs.find("nav.jbolt_admin_nav a.active").removeClass("active");var a=jboltAdmin.hasClass("hideMenu");if(a){jboltAdmin.find(".jbolt_admin_left").css("width","60px");jboltAdmin.find(".jbolt_admin_logo_box").css("width","60px");jbolt_tabbar.css("left","60px");jboltAdminMain.css("left","60px")}else{jboltAdmin.find(".jbolt_admin_left").css("width",JBolt_Left_Nav_width+"px");jboltAdmin.find(".jbolt_admin_logo_box").css("width",JBolt_Left_Nav_width+"px");jbolt_tabbar.css("left",JBolt_Left_Nav_width+"px");jboltAdminMain.css("left",JBolt_Left_Nav_width+"px");initOpenLeftNav()}localStorage.setItem("jbolt_hideMenu",a)})}function hideLeftMenu(){var a=$(".jbolt_toggle_Left_nav_btn");a.addClass("hidden");disposeTooltip(a);$(".jbolt_admin_nav.expansion").removeClass("expansion");jboltAdmin.addClass("hideMenu").removeClass("normalMenu");jboltAdminLeftNavs.find("nav.jbolt_admin_nav a.active").removeClass("active");jboltAdmin.find(".jbolt_admin_left").css("width","60px");jboltAdmin.find(".jbolt_admin_logo_box").css("width","60px");jbolt_tabbar.css("left","60px");jboltAdminMain.css("left","60px");localStorage.setItem("jbolt_hideMenu",true)}function hideLeftAndFullMainConainer(){var a=$(".jbolt_toggle_Left_nav_btn");a.addClass("hidden");disposeTooltip(a);$(".jbolt_admin_nav.expansion").removeClass("expansion");jboltAdmin.addClass("hideMenu fullMainContainer").removeClass("normalMenu");jboltAdminLeftNavs.find("nav.jbolt_admin_nav a.active").removeClass("active");jboltAdmin.find(".jbolt_admin_logo_box").css("width","60px");localStorage.setItem("jbolt_hideMenu",true)}function goback(){history.go(-1)}function reloadCurrentPage(){var a=self.location.href;history.go(0)}function userLogout(){LayerMsgBox.confirm("确认注销并退出系统吗？",function(){self.location.href="admin/logout"});return false}function hideParentLayerDialogBtn(a){if(a==0||a==1){var b=parent.$(".layui-layer.layui-layer-iframe:last  .layui-layer-btn"+a);if(isOk(b)){b.hide()}}else{hideAllParentLayerDialogBtn()}}function hideAllParentLayerDialogBtn(){var a=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn");if(isOk(a)){a.hide()}}function bindKeycodeForDialogOkBtn(a){if(window.self!=window.top){parent.bindKeycodeForDialogOkBtn(a)}jboltBody.on("keyup",function(c){if(c.keyCode==a){if(window.self!=window.top){var b=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn0");if(isOk(b)){b.click()}}else{var b=$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn0");if(isOk(b)){b.click()}}}})}function bindEnterForDialogOkBtn(a){bindKeycodeForDialogOkBtn(13)}function bindKeycodeForDialogCloseBtn(a){if(window.self!=window.top){parent.bindKeycodeForDialogCloseBtn(a)}jboltWindow.on("keyup",function(c){if(c.keyCode==a){if(window.self!=window.top){var b=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn1");if(isOk(b)){b.click()}}else{var b=$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn1");if(isOk(b)){b.click()}}}})}function bindEscForDialogCloseBtn(){bindKeycodeForDialogCloseBtn(27)}function bindKeycodeForDialogBtnByBtnId(b){var a=b.length;if(window.self!=window.top){parent.bindKeycodeForDialogBtnByBtnId(b)}jboltWindow.on("keyup",function(f){var d;for(var c=0;c<a;c++){d=b[c];if(d.key==f.keyCode){if(window.self!=window.top){var d=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn").find("a#"+d.id);if(isOk(d)){d.click()}}else{var d=$(".layui-layer.layui-layer-iframe:last .layui-layer-btn").find("a#"+d.id);if(isOk(d)){d.click()}}}}})}function clickLayerBtnById(b){var a=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn").find("a#"+b);if(isOk(a)){a.click()}}function clickLayerOkBtn(){var a=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn0");if(isOk(a)){a.click()}}function clickLayerCloseBtn(){var a=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn1");if(isOk(a)){a.click()}}function changeParentLayerDialogBtnTitle(a,c){var b=parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn"+a);if(isOk(b)){b.text(c)}}function changeParentLayerDialogOkBtnTitle(a){changeParentLayerDialogBtnTitle(0,a)}function changeParentLayerDialogCancelBtnTitle(a){changeParentLayerDialogBtnTitle(1,a)}function getParentLayerDialogBtn(a){return parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn"+a)}function getParentLayerDialogBtns(){return parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn>a")}function changeParentLayerDialogOkBtnStateToSubmiting(){if(self!=top){var a=getParentLayerDialogBtn(0);changeBtnStateToSubmiting(a)}}function changeParentLayerAllDialogBtnStateToDisabled(){if(self!=top){var a=getParentLayerDialogBtns();if(isOk(a)){a.attr("disabled","disabled")}}}function changeParentLayerDialogOkBtnStateToDisabled(){if(self!=top){var a=getParentLayerDialogBtn(0);if(isOk(a)){a.attr("disabled","disabled")}}}function cancelParentLayerDialogOkBtnStateToDisabled(){if(self!=top){var a=getParentLayerDialogBtn(0);if(isOk(a)){a.removeAttr("disabled")}}}function cancelParentLayerAllDialogBtnStateToDisabled(){if(self!=top){var a=getParentLayerDialogBtns();if(isOk(a)){a.removeAttr("disabled")}}}function cancelParentLayerDialogAllBtnStateToSubmiting(){if(self!=top){var a=getParentLayerDialogBtns();if(isOk(a)){a.each(function(){cancelBtnStateToSubmiting($(this))})}}}function changeLayerDialogBtnStateToSubmiting(a){changeBtnStateToSubmiting(a);changeParentLayerAllDialogBtnStateToDisabled()}function cancelLayerDialogBtnStateToSubmiting(a){cancelBtnStateToSubmiting(a);cancelParentLayerAllDialogBtnStateToDisabled()}function changeBtnStateToSubmiting(b){if(isOk(b)){var a=b.data("origin-text");var c=b.text();if(!a){b.data("origin-text",c).attr("data-origin-text",c)}b.attr("disabled","disabled");b.text("处理中...")}}function cancelBtnStateToSubmiting(b){if(isOk(b)){b.removeAttr("disabled");var a=b.data("origin-text");if(a){b.text(a)}}}function cancelParentLayerDialogOkBtnStateToSubmiting(){if(self!=top){var a=getParentLayerDialogBtn(0);cancelBtnStateToSubmiting(a)}}function showParentLayerDialogBtn(a){if(a){parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn .layui-layer-btn"+a).show()}else{parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn").show()}}function checkExistLayerDialogBtnById(a){return parent.$(".layui-layer.layui-layer-iframe:last .layui-layer-btn").find("a#"+a)}function checkExistLayerDialogBtn(c,d,a){var e=c.find("a."+a.replace(" ","."));var b=null;if(e&&e.length>0){e.each(function(){var f=$(this);if($.trim(f.text())==$.trim($("<span>"+d+"</span>").text())){b=f;return false}})}return b}function addParentLayerDialogBtn(h,k,b,f){var j=parent.$(".layui-layer:last .layui-layer-btn");if(notOk(j)){return false}var i=checkExistLayerDialogBtn(j,h,k);var e;if(i){i.remove()}e="lay_btn_"+randomId();var a="<a tabindex='-1' id='"+e+"' class='"+k+"'>"+h+"</a>";var c=j.find("a.layui-layer-btn"+(f?"0":"1"));if(isOk(c)){c.before(a)}else{j.append(a)}var d=parent.$("body").find("#"+e);if(isOk(d)){d.on("click",function(l){l.preventDefault();l.stopPropagation();if(d.attr("disabled")){return false}if(b){b(d,function(){cancelLayerDialogFormsSubmiting($("form"));cancelLayerDialogBtnStateToSubmiting(d)})}})}return e}function changeLayerDialogFormSubmiting(a){var b=getRealJqueryObject(a);if(isOk(b)){b.data("submiting",true).attr("data-submiting",true)}}function cancelLayerDialogFormSubmiting(a){var b=getRealJqueryObject(a);if(isOk(b)){b.data("submiting",false).removeAttr("data-submiting")}}function cancelLayerDialogFormsSubmiting(a){if(isOk(a)){a.data("submiting",false).removeAttr("data-submiting")}}function ajaxSubmitForm(b,a,e){var d=getRealJqueryObject(b);if(isOk(d)){if(FormChecker.check(d)){var c=d.action;LayerMsgBox.loading("提交中...",10000);d.ajaxSubmit({type:"post",url:c,success:function(f){if(f.state=="ok"){if(a){LayerMsgBox.success(f.msg,500,function(){a(f)})}else{LayerMsgBox.success(f.msg,500)}}else{LayerMsgBox.closeLoadingNow();if(e){e(f)}else{LayerMsgBox.alert(f.msg,2)}}}})}}return false}function getRealJqueryObject(c){if(!c){return null}var b=typeof(c);var d=null;if(b=="string"){var a=c.charAt(0);if(a=="#"||a=="."){d=$(c)}else{d=$("#"+c)}}else{if(b=="object"){if(isDOM(c)){d=$(c)}else{d=c}}}return d}function getRealParentJqueryObject(b){var a=getRealJqueryObject(b);return a?a:jboltBody}function ajaxSubmitFormAndGoBack(a,c,e,b,d){ajaxSubmitForm(a,function(){if(jboltWithTabs){if(b){JBoltTabUtil.currentTabGo(c,e);if(d){changeCurrentTabTitle(d)}}else{closeCurrentAndReloadTiggerTab()}}else{JBoltPjaxUtil.sendPjax(c,mainPjaxContainerId,e)}})}function closeCurrentTab(){if(jboltWithTabs){JBoltTabUtil.closeCurrentTab()}}function closeCurrentAndReloadTiggerTab(b,a,d){if(jboltWithTabs){var e=JBoltTabUtil.getCurrentTab();if(isOk(e)){if(b){JBoltTabUtil.showJboltTab(b,false,function(){JBoltTabUtil.close(e);if(a||d){refreshJBoltTable(d)}else{refreshPjaxContainer()}})}else{var c=e.data("trigger-tab-key");if(c&&JBoltTabUtil.isJboltTabExist(c)){JBoltTabUtil.showJboltTab(c,false,function(){JBoltTabUtil.close(e);if(a||d){refreshJBoltTable(d)}else{refreshPjaxContainer()}})}else{JBoltTabUtil.close(e);if(a||d){refreshJBoltTable(d)}else{refreshPjaxContainer()}}}}}else{if(a||d){refreshJBoltTable(d)}else{refreshPjaxContainer()}}}function pageFormSubmit(a){var b=getRealJqueryObject(a);if(isOk(b)&&FormChecker.check(b)){b.attr("onsubmit","return true;");b.submit()}}function formSubmit(a){var b=getRealJqueryObject(a);if(isOk(b)){b.submit()}}function formSubmitWithChecker(a){var b=getRealJqueryObject(a);if(isOk(b)&&FormChecker.check(b)){b.submit()}}function submitFormInCurrentTab(b,a,f){if(jboltWithTabs){var e=getRealJqueryObject(b);if(isOk(e)){if(FormChecker.check(e)){var d=JBoltTabUtil.getCurrentTabContent();if(d&&d.length==1){var c=e.attr("action");if(c){c=urlWithFormData(c,e);LayerMsgBox.load(3);d.ajaxPortal(true,c,true,function(h){LayerMsgBox.closeLoadNow();if(a){a(h)}},function(h){if(f){f(h)}})}else{LayerMsgBox.alert("Form 未设置action",2)}}}}}else{ajaxSubmitForm(e,a,f)}}function initJboltAdminTopStyleChange(){var a=$(".jbolt_admin_main_top");initToolTip(a)}function isWithtabs(){var a=$(".jbolt_admin.withtabs");return a&&a.length==1}function tabContentFormSubmitWithAjaxPortal(b){var a=JBoltTabUtil.getCurrentTabContent();if(isOk(a)){formSubmitToAjaxPortal(b,a)}}function formSubmitToAjaxPortal(b,a){var f=getRealJqueryObject(b);if(isOk(f)&&a){var d=f.attr("action");if(d){d=urlWithFormData(d,f);LayerMsgBox.load(3);var h;if(isArray(a)){for(var e in a){if(a.eq){h=a.eq(e)}else{h=getRealJqueryObject(a[e])}if(isOk(h)){h.ajaxPortal(true,d,true,function(){LayerMsgBox.closeLoadNow()})}}}else{if(typeof(a)=="string"&&a.indexOf(",")!=-1){var c=a.split(",");for(var e in c){h=getRealJqueryObject(a[e]);if(isOk(h)){h.ajaxPortal(true,d,true,function(){LayerMsgBox.closeLoadNow()})}}}else{h=getRealJqueryObject(a);if(isOk(h)){h.ajaxPortal(true,d,true,function(){LayerMsgBox.closeLoadNow()})}}}}else{LayerMsgBox.alert("Form 未配置action",2)}}else{LayerMsgBox.alert("参数异常",2)}return false}function currentTabContentRedirectWithAjaxPortal(b){var d=JBoltTabUtil.getCurrentTab();if(isOk(d)){var a=d.data("url");d.data("backurl",a);d.attr("data-backurl",a)}var c=JBoltTabUtil.getCurrentTabContent();if(isOk(c)){LayerMsgBox.load(3);c.ajaxPortal(true,b,true,function(){LayerMsgBox.closeLoadNow()})}}function initAdminAjaxPortalFormSubmitEvent(){jboltBody.on("submit",".jbolt_page_title form:not([data-ajaxportal-form]),form[data-submittabportal]:not([data-ajaxportal-form])",function(b){b.preventDefault();b.stopPropagation();var a=$(this);var c=a.data("needcheck");if(c==undefined||c==null||c=="undefined"||c==""){c=true}if(c){if(FormChecker.check(this)){tabContentFormSubmitWithAjaxPortal(a)}}else{tabContentFormSubmitWithAjaxPortal(a)}return false})}function toggleInputHidden(c){if(c.indexOf(",")!=-1){var b=c.split(",");for(var a in b){toggleOneInputHidden(b[a])}}else{toggleOneInputHidden(c)}}function toggleOneInputHidden(b){var a=g(b);if(a.type=="hidden"){a.type="text"}else{a.type="hidden"}}var JBoltTabViewUtil={initUI:function(h){var e=getRealParentJqueryObject(h);if(!isOk(e)){return false}var f=this;var i=e.find(".jbolt_tab_view");if(isOk(i)){var c,d,b=0,a;i.each(function(){b=0;c=$(this);a=this.id;if(!a){a="jbv_"+randomId(5);this.id=a}c.children(".jbolt_tab_links").attr("data-view-id",a).find(".jbolt_tab_link").attr("data-view-id",a);c.children(".jbolt_tab_contens").attr("data-view-id",a).children(".jbolt_tab_conten").attr("data-view-id",a);d=c.find(".jbolt_tab_links[data-view-id='"+a+"']>.jbolt_tab_link.active");if(!isOk(d)){b=c.data("active-index");if(typeof(b)=="undefined"||b<=0){b=0}f.active(c,b)}})}},initTabLinkEvent:function(){jboltBody.on("click",".jbolt_tab_view>.jbolt_tab_links>.jbolt_tab_link",function(e){e.preventDefault();var link=$(this);var tabContentId=link.attr("href");if(!tabContentId){LayerMsgBox.alert("请设置选项卡href绑定内容区域ID",2);return false}var tabView=link.closest(".jbolt_tab_view");var viewId=tabView[0].id;var activeLink=tabView.find(".jbolt_tab_links[data-view-id='"+viewId+"']>.jbolt_tab_link.active");var handler=tabView.data("handler");var exe_handler=handler?(eval(handler)):null;if(isOk(activeLink)){var activeTabContentId=activeLink.attr("href");if(activeTabContentId==tabContentId){if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(tabContentId,link.index())}return false}activeLink.removeClass("active");tabView.find(activeTabContentId).removeClass("active")}link.addClass("active");tabView.find(tabContentId).addClass("active");if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(tabContentId,link.index())}})},active:function(b,a){var c=b.find('.jbolt_tab_links[data-view-id="'+b[0].id+'"]>.jbolt_tab_link:eq('+a+")");if(isOk(c)){c.trigger("click")}}};var MasterSlaveUtil={initJBoltTable:function(l){var j=getRealParentJqueryObject(l);if(!isOk(j)){return false}if(j.data("init-ms")){return false}j.data("init-ms",true);var a=j.find(".jbolt_page_content");if(isOk(a)){var c=a.closest(".jbolt_page");var d=c.height()-2;var h=c.find(".jbolt_page_title");if(isOk(h)){d=d-h.height()-parseInt(h.css("margin-bottom"))}a.css({height:d+"px"})}var f=this;var k=a.find(".jbolttable_master_slave_box");if(!isOk(k)){return false}var e=k.length;for(var b=0;b<e;b++){f.initJBoltTableMasterSlave(k.eq(b))}},initJBoltTableMasterSlave:function(e){var b,c,j=e.data("sizes");if(j){var h=j.split(":");var d=Number(h[0])*10;var k=Number(h[1])*10;j=[d,k]}else{j=[60,40]}var b,c;var i=randomId();var a="master_"+i;var f="slave_"+i;e.find(".split.master").attr("id",a);e.find(".split.slave").attr("id",f);loadJBoltPlugin(["splitjs","jbolttable"],function(){Split(["#"+a,"#"+f],{direction:"vertical",sizes:j,gutterSize:6,onDragEnd:function(){b.each(function(){c=$(this).jboltTable("inst");if(c){c.me.processTableFillBox(c)}})}});b=e.find(".jbolt_table:not([data-jbolttable])").attr("data-jbolttable",true).jboltTable()})},init:function(f){var d=getRealParentJqueryObject(f);if(!isOk(d)){return false}var e=this;var b=d.find(".jbolt_master_slave_box");if(!isOk(b)){return false}var a=b.length;for(var c=0;c<a;c++){e.initHeight(b.eq(c))}},initMasterTableEvent:function(){var a=this;jboltBody.on("click",".jbolt_page .jbolt_master_slave_box .jbolt_master_container table.table>tbody>tr",function(){var d=$(this);d.parent().find("tr.active").removeClass("active");d.addClass("active");var e=d.data("id");if(!e){LayerMsgBox.alert("数据TR绑定data-id为空",2)}else{LayerMsgBox.load(3);var b=d.closest(".jbolt_master_slave_box").find(".jbolt_slave_container [data-ajaxportal]");var c=b.length;if(b&&c){b.each(function(k){var f=$(this);var j=f.data("origin-url")||f.data("orign-url")||f.data("orignurl")||f.data("srcurl")||f.data("src-url");if(!j){LayerMsgBox.alert("AjaxPortal组件需要设置data-origin-url",2);LayerMsgBox.closeLoadNow();return false}else{var l=j[j.length-1];var h=j;if(l=="="||l=="-"||l=="/"){h=h+e}else{h=h+"/"+e}f.ajaxPortal(true,h,true,function(){if(k==c-1){LayerMsgBox.closeLoadNow()}a.initPortalHeight(f)})}})}}})},initPortalHeight:function(b){var a=b.closest(".jbolt_slave_container");if(a&&a.length>0){var c=a.outerHeight()-45;a.find(".jbolt_slave_body").each(function(){var d=$(this);var f=d.parent().find(".jbolt_slave_top");if(f&&f.length>0){var e=f.outerHeight();d.height(c-e)}else{d.height(c)}})}},initHeight:function(d){var c=d.closest(".jbolt_page");var e=c.find(".jbolt_page_content");if(isOk(c)&&isOk(e)){var a=c.outerHeight()-2-parseInt(c.css("padding-bottom"))*2;var b=c.find(".jbolt_page_title");if(isOk(b)){a=a-parseInt(b.outerHeight())-parseInt(b.css("margin-bottom"))}d.height(a)}}};function resizeJBoltLayer(){JBoltLayerUtil.processLayerByWindowResize()}var resizingJboltTableWidth=false;function resizeJboltTableWidth(){}function resizeFillHeightJboltTable(){var a=jboltBody.find(".jbolt_table_view table.jbolt_table.jbolt_main_table[data-height='fill']");if(isOk(a)){a.each(function(){var c=$(this);var b=c.jboltTable("inst");if(b){b.me.resize(b)}})}}function resizeFillBoxHeightJboltTable(){var a=jboltBody.find(".jbolt_table_view table.jbolt_table.jbolt_main_table[data-height='fill_box']");if(isOk(a)){a.each(function(){var c=$(this);var b=c.jboltTable("inst");if(b){b.me.processTableFillBox(b)}})}}function onwindowReisze(){jboltWindow.bind("resize",function(){jboltWindowWidth=jboltWindow.width();jboltWindowHeight=jboltWindow.height();JBoltLayerUtil.processLayerByWindowResize();JBoltInputUtil.hideJBoltInputLayer();resizeJboltTableWidth();resizeFillHeightJboltTable();resizeFillBoxHeightJboltTable();MasterSlaveUtil.init(mainPjaxContainer)})}function toggleVisiable(a,d){var e,b;if(d){var f=getRealJqueryObject(d);if(isOk(f)){var b=f.closest("[data-ajaxportal]");if(!isOk(b)){b=f.closest(".jbolt_page");if(!isOk(b)){b=jboltBody}}}if(isOk(b)){e=b.find(a)}else{e=$(a)}}else{if(jboltWithTabs){var c=JBoltTabUtil.getCurrentTabContent();if(isOk(c)){e=c.find(a)}}else{if(isOk(mainPjaxContainer)){e=mainPjaxContainer.find(a)}else{e=jboltBody.find(a)}}}if(isOk(e)){if(e.is(":hidden")){e.show()}else{e.hide()}}}function processUnLockAndAfterLogin(){self.location.href=JBoltBaseTagHref}var lockHtmlTpl='<div oncontextmenu="doNothing()" class="j_locksystem noselect" id="j_locksystem"><div class="j_lockmain"><h1>屏幕已锁</h1><div class="j_lockpassword"><input onkeyup="unlockSystem(event)" maxlength="40" type="password" id="unlockpwd" placeholder="输入密码 回车解锁" name="password"  autocomplete="off" /><div class="j_reloginbtn"><a onclick="showReloginDialog(false,processUnLockAndAfterLogin)" href="javascrip:void(0)">切换用户</a></div></div></div></div>';var lockSystemTimer=null;function checkLockSystem(){if(!lockSystemTimer){return false}var a=$("#j_locksystem");if(isOk(a)){a.removeClass("__web-inspector-hide-shortcut__");a.show();if(a[0].style.visibility!="visible"){a[0].style.visibility="visible"}}else{showJBoltLockSystemEle()}}function showJboltLockSystem(){if(window.self!=window.top){parent.showJboltLockSystem()}else{showJBoltLockSystemEle();if(!lockSystemTimer){lockSystemTimer=setInterval(checkLockSystem,1000)}}}function showJBoltLockSystemEle(){var a=$("#j_locksystem");if(!(a&&a.length==1)){jboltBody.append(lockHtmlTpl);a=$("#j_locksystem")}$("#unlockpwd").val("");a.removeClass("__web-inspector-hide-shortcut__");FormDate.hide();a.show()}function md5(p){function y(b,a){return(b<<a)|(b>>>(32-a))}function F(k,b){var V,a,d,x,c;d=(k&2147483648);x=(b&2147483648);V=(k&1073741824);a=(b&1073741824);c=(k&1073741823)+(b&1073741823);if(V&a){return(c^2147483648^d^x)}if(V|a){if(c&1073741824){return(c^3221225472^d^x)}else{return(c^1073741824^d^x)}}else{return(c^d^x)}}function t(a,c,b){return(a&c)|((~a)&b)}function s(a,c,b){return(a&b)|(c&(~b))}function r(a,c,b){return(a^c^b)}function q(a,c,b){return(c^(a|(~b)))}function f(W,V,aa,Z,k,X,Y){W=F(W,F(F(t(V,aa,Z),k),Y));return F(y(W,X),V)}function D(W,V,aa,Z,k,X,Y){W=F(W,F(F(s(V,aa,Z),k),Y));return F(y(W,X),V)}function u(W,V,aa,Z,k,X,Y){W=F(W,F(F(r(V,aa,Z),k),Y));return F(y(W,X),V)}function e(W,V,aa,Z,k,X,Y){W=F(W,F(F(q(V,aa,Z),k),Y));return F(y(W,X),V)}function h(k){var W;var d=k.length;var c=d+8;var b=(c-(c%64))/64;var V=(b+1)*16;var X=Array(V-1);var a=0;var x=0;while(x<d){W=(x-(x%4))/4;a=(x%4)*8;X[W]=(X[W]|(k.charCodeAt(x)<<a));x++}W=(x-(x%4))/4;a=(x%4)*8;X[W]=X[W]|(128<<a);X[V-2]=d<<3;X[V-1]=d>>>29;return X}function H(c){var b="",d="",k,a;for(a=0;a<=3;a++){k=(c>>>(a*8))&255;d="0"+k.toString(16);b=b+d.substr(d.length-2,2)}return b}function v(b){b=b.replace(/\r\n/g,"\n");var a="";for(var k=0;k<b.length;k++){var d=b.charCodeAt(k);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a}var E=Array();var L,j,G,w,i,U,T,S,R;var O=7,M=12,J=17,I=22;var C=5,B=9,A=14,z=20;var o=4,n=11,m=16,l=23;var Q=6,P=10,N=15,K=21;p=v(p);E=h(p);U=1732584193;T=4023233417;S=2562383102;R=271733878;for(L=0;L<E.length;L+=16){j=U;G=T;w=S;i=R;U=f(U,T,S,R,E[L+0],O,3614090360);R=f(R,U,T,S,E[L+1],M,3905402710);S=f(S,R,U,T,E[L+2],J,606105819);T=f(T,S,R,U,E[L+3],I,3250441966);U=f(U,T,S,R,E[L+4],O,4118548399);R=f(R,U,T,S,E[L+5],M,1200080426);S=f(S,R,U,T,E[L+6],J,2821735955);T=f(T,S,R,U,E[L+7],I,4249261313);U=f(U,T,S,R,E[L+8],O,1770035416);R=f(R,U,T,S,E[L+9],M,2336552879);S=f(S,R,U,T,E[L+10],J,4294925233);T=f(T,S,R,U,E[L+11],I,2304563134);U=f(U,T,S,R,E[L+12],O,1804603682);R=f(R,U,T,S,E[L+13],M,4254626195);S=f(S,R,U,T,E[L+14],J,2792965006);T=f(T,S,R,U,E[L+15],I,1236535329);U=D(U,T,S,R,E[L+1],C,4129170786);R=D(R,U,T,S,E[L+6],B,3225465664);S=D(S,R,U,T,E[L+11],A,643717713);T=D(T,S,R,U,E[L+0],z,3921069994);U=D(U,T,S,R,E[L+5],C,3593408605);R=D(R,U,T,S,E[L+10],B,38016083);S=D(S,R,U,T,E[L+15],A,3634488961);T=D(T,S,R,U,E[L+4],z,3889429448);U=D(U,T,S,R,E[L+9],C,568446438);R=D(R,U,T,S,E[L+14],B,3275163606);S=D(S,R,U,T,E[L+3],A,4107603335);T=D(T,S,R,U,E[L+8],z,1163531501);U=D(U,T,S,R,E[L+13],C,2850285829);R=D(R,U,T,S,E[L+2],B,4243563512);S=D(S,R,U,T,E[L+7],A,1735328473);T=D(T,S,R,U,E[L+12],z,2368359562);U=u(U,T,S,R,E[L+5],o,4294588738);R=u(R,U,T,S,E[L+8],n,2272392833);S=u(S,R,U,T,E[L+11],m,1839030562);T=u(T,S,R,U,E[L+14],l,4259657740);U=u(U,T,S,R,E[L+1],o,2763975236);R=u(R,U,T,S,E[L+4],n,1272893353);S=u(S,R,U,T,E[L+7],m,4139469664);T=u(T,S,R,U,E[L+10],l,3200236656);U=u(U,T,S,R,E[L+13],o,681279174);R=u(R,U,T,S,E[L+0],n,3936430074);S=u(S,R,U,T,E[L+3],m,3572445317);T=u(T,S,R,U,E[L+6],l,76029189);U=u(U,T,S,R,E[L+9],o,3654602809);R=u(R,U,T,S,E[L+12],n,3873151461);S=u(S,R,U,T,E[L+15],m,530742520);T=u(T,S,R,U,E[L+2],l,3299628645);U=e(U,T,S,R,E[L+0],Q,4096336452);R=e(R,U,T,S,E[L+7],P,1126891415);S=e(S,R,U,T,E[L+14],N,2878612391);T=e(T,S,R,U,E[L+5],K,4237533241);U=e(U,T,S,R,E[L+12],Q,1700485571);R=e(R,U,T,S,E[L+3],P,2399980690);S=e(S,R,U,T,E[L+10],N,4293915773);T=e(T,S,R,U,E[L+1],K,2240044497);U=e(U,T,S,R,E[L+8],Q,1873313359);R=e(R,U,T,S,E[L+15],P,4264355552);S=e(S,R,U,T,E[L+6],N,2734768916);T=e(T,S,R,U,E[L+13],K,1309151649);U=e(U,T,S,R,E[L+4],Q,4149444226);R=e(R,U,T,S,E[L+11],P,3174756917);S=e(S,R,U,T,E[L+2],N,718787259);T=e(T,S,R,U,E[L+9],K,3951481745);U=F(U,j);T=F(T,G);S=F(S,w);R=F(R,i)}return(H(U)+H(T)+H(S)+H(R)).toLowerCase()}function unlockSystem(c){var f=c.keyCode?c.keyCode:c.which?c.which:c.charCode;if(f==13){var b=$("#unlockpwd");var e=b.val();if(!($.trim(e))){alert("请输入登录密码")}else{$(".j_lockmain>h1").text("解锁中...");var d=randomId(2);var a=randomId(3);e=d+md5(e)+a;Ajax.post("/admin/unLockSystem",{password:e},function(h){$(".j_lockmain>h1").text("解锁成功");setTimeout(function(){closeJboltLockSystem();LayerMsgBox.success("解锁成功",500,function(){$(".j_lockmain>h1").text("屏幕已锁")})},300)},function(h){b.val("");$(".j_lockmain>h1").text("屏幕已锁");alert(h.msg)})}}}function closeJboltLockSystem(){if(window.self!=window.top){parent.closeJboltLockSystem()}else{clearInterval(lockSystemTimer);lockSystemTimer=null;if(isOk(jboltAdmin)){$("#unlockpwd").val("");$("#j_locksystem").hide()}else{reloadCurrentPage()}}}function doNothing(){window.event.returnValue=false;return false}function processInnerElesInit(b){var a=getRealParentJqueryObject(b);$(".tooltip.show").remove();SwitchBtnUtil.init(a);SelectUtil.initAutoSetValue(a);FormDate.init(a);LayerTipsUtil.init(a);ImageViewerUtil.init(a);RadioUtil.init(a);CheckboxUtil.init(a);AutocompleteUtil.init(a);Select2Util.init(a);SelectUtil.init({parent:a});initToolTip(a);JBoltInputUtil.init(a);RangeSliderUtil.init(a);JBoltInputWithClearBtnUtil.init(a);JBoltInputWithCalculatorUtil.init(a);FileUploadUtil.init(a);ImgUploadUtil.init(a)}function initToolTip(c){var a;if(c){var b=getRealParentJqueryObject(c);if(isOk(b)){a=b.find("[tooltip],[data-toggle='tooltip']")}}else{a=jboltBody.find("[tooltip],[data-toggle='tooltip']")}if(isOk(a)){a.tooltip({boundary:"window",container:"body"})}}function initPopover(b){var c;if(b){var a=getRealParentJqueryObject(b);if(isOk(a)){c=a.find("[popover],[data-toggle='popover']")}}else{c=jboltBody.find("[popover],[data-toggle='popover']")}if(isOk(c)){c.popover({boundary:"window",container:"body"})}}function destroyToolTip(b){if(b){var a=getRealParentJqueryObject(b);if(isOk(a)){a.find("[tooltip],[data-toggle='tooltip']").tooltip("destroy")}}else{jboltBody.find("[tooltip],[data-toggle='tooltip']").tooltip("destroy")}}function resetToolTip(a){destroyToolTip(a);initToolTip(a)}function changeUserJboltStyle(c){var h=$("#jbolt_user_config_style_box");h.find(".jbolt_config_style.active").removeClass("active");h.find("#jbs_"+c).addClass("active");var d=jboltAdmin[0].className;var f=d.split(" ");var a="";var e="";for(var b in f){e=f[b];if(e!="default"&&e.indexOf("jbolt_style_")==-1){a=a+e+" "}}jboltAdmin[0].className=a+c;changeLeftNavScroll()}var Select2Util={init:function(a){this.initNotAutoLoadSelect(a)},initNotAutoLoadSelect:function(e){if(hasImportSelect2){var c=getRealParentJqueryObject(e);if(!isOk(c)){return false}var b=c.find("select[data-select2]:not([data-autoload]):not([data-linkage])");if(!isOk(b)){return false}var d=this;var a;b.each(function(){a=$(this);d.initAutoLoadSelect(a)})}},initAutoLoadSelectById:function(b){var a=$("#"+b);if(isOk(a)){this.initAutoLoadSelect(a)}},initAutoLoadSelect:function(b){if(hasImportSelect2){var c=b.data("select-type");if(c&&c=="select2"){var d=b.data("placeholder");if(!d){d=b.attr("placeholder");if(!d){d=b.data("text");if(!d){d="请选择"}}}var a=b[0].hasAttribute("multiple");b.select2({theme:"bootstrap",allowClear:true,closeOnSelect:!a,placeholder:d,width:"auto"});processNoMasterTooltip()}}}};function processNoMasterTooltip(){jboltBody.find(".tooltip.show").each(function(){var b=$(this);var c=b.attr("id");if(c){var a=jboltBody.find("[aria-describedby='"+c+"']");if(!isOk(a)){b.remove()}}})}function checkImportSelect2(){var a=$("script[id='select2_js']");return(a&&a.length==1)}function checkImportBootstrapSelect(){var a=$("script[id='bootstrap_select_js']");return(a&&a.length==1)}function processGlobalSelect2(){hasImportSelect2=checkImportSelect2();if(hasImportSelect2){$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.select2.defaults.set("theme","bootstrap")}}function processGlobalBootstrapSelect(){hasImportBootstrapSelect=checkImportBootstrapSelect();if(hasImportBootstrapSelect){$.fn.selectpicker.Constructor.BootstrapVersion="4";$.fn.selectpicker.Constructor.DEFAULTS.style="btn-outline-secondary"}}function ajaxPortalSubmitWithForm(b){var d=getRealJqueryObject(b);if(!isOk(d)){LayerMsgBox.alert("指定Form不存在");return false}var c=d.data("portal")||d.data("portal-id")||d.data("portalid");if(!c){LayerMsgBox.alert("指定Form上没有设置data-portal 指定提交哪个ajaxPortal不存在");return false}var a=getRealJqueryObject(c);if(!isOk(a)){LayerMsgBox.alert("表单上指定的 data-portal 不存在");return false}LayerMsgBox.loading("加载中...",10000);a.ajaxPortal(true);return false}var jboltPortalPageTpl='<div class="jbolt_portal_pages noselect"><div class="pages"><div class="mainPagination mb-1 mb-sm-0  d-block d-sm-inline-block text-center" id="${pageId}"></div><div class="searchPage d-none d-sm-inline-block"><span class="page-go pl-3">到<input style="width:50px;" id="gonu" data-rule="pint" data-tips="请输入正整数" type="text"  oninput="return FormChecker.checkIt(this);" min="1" maxlength="6"  pattern="[0-9]*" class="current_page" value="1">页</span><a tabindex="-1" href="javascript:;" class="page-btn">GO</a><span class="page-sum">共&nbsp;<strong id="totalRow" class="allPage">1</strong>&nbsp;条&nbsp;<strong id="totalPage" class="allPage">1</strong>&nbsp;页</span><select id="pageSize" class="mx-2" style="width:80px;height: 32px;margin-top:-1px;border-color:#e6e6e6;">{@each options as option}{@if option}<option {@if option==pageSize} selected="selected" {@/if} value="${option}">${option}条/页</option>{@/if}{@/each}</select></div></div><div class="clearfix"></div></div>';var jboltPortalPageTpl_mini='<div class="jbolt_portal_pages noselect"><div class="pages"><div class="mainPagination mb-1 mb-sm-0 d-block text-center" id="${pageId}"></div><div class="searchPage d-none"><input type="hidden" id="pageSize" value="${pageSize?pageSize:15}" /></div></div><div class="clearfix"></div></div>';var AjaxPortalUtil={load:function(b){var a=getRealJqueryObject(b);if(isOk(a)){a.data("triggerload",true);a.ajaxPortal(true)}},initPage:function(i,k){var f=i.data("page-box");if(!f){return false}var d=i.closest("jbolt_page");if(notOk(d)){d=jboltBody}var h=d.find("#"+f);if(notOk(h)){alert("ajaxPortal指定的data-page-box未找到");return false}var e=this;var a=i.data("page-mini");i.data("totalpage",k.totalPage);var c=i.data("page");if(!c){c=h.attr("id")+"_pages";i.data("page",c).attr("data-page",c)}var j=h.find(".jbolt_portal_pages");if(notOk(j)){j=e.initPageBoxContent(i,h,c,a)}var b=j.find("#"+c);j.find("#gonu").val(k.pageNumber).attr("max",k.totalPage);j.find("#totalPage").text(k.totalPage);j.find("#totalRow").text(k.totalRow);j.find("#pageSize").val(k.pageSize);if(a){j.find("#gonu").hide();j.find("#totalPage").hide();j.find("#totalRow").hide();j.find("#pageSize").hide()}loadJBoltPlugin(["pagination"],function(){b.pagination(k.totalPage,{num_edge_entries:1,current_page:(k.pageNumber-1),callback:function(l,m){if(isNaN(l)==false){var n=l+1;e.readByPage(i,n);return false}}})});if(!i.data("page-ok")){j.find("#gonu").on("keydown",function(l){if(l.keyCode==109||l.keyCode==189){return false}});j.find("#pageSize").on("change",function(){e.readByPage(i,1)});j.find(".page-btn").on("click",function(){var l=j.find("#gonu");if(isOk(l)){if(FormChecker.checkIt(l[0])){e.readByPage(i)}}else{e.readByPage(i)}})}i.data("page-ok",true)},readByPage:function(b,e){var j=getRealJqueryObject(b);var d=j.data("page-box");if(!d){return false}var c=j.closest("jbolt_page");if(notOk(c)){c=jboltBody}var i=c.find("#"+d);if(notOk(i)){LayerMsgBox.alert("ajaxPortal指定的data-page-box未找到",2);return false}var n=j.data("conditions-form");var a=null;if(n){a=$("#"+n);if(notOk(a)){LayerMsgBox.alert("ajaxPortal绑定data-conditions-form未找到",2);return false}}var l=i.find(".jbolt_portal_pages");if(notOk(l)){LayerMsgBox.alert("ajaxPortal初始化分页组件异常",2);return false}if(!e){var k=l.find("#gonu");if(k&&k.length>0){e=k.val()}else{e=1}}var h=l.find("#pageSize").val();var f=a.find("input[name='page']");if(notOk(f)){a.append('<input type="hidden" name="page" value="'+e+'"/>')}else{f.val(e)}var m=a.find("input[name='pageSize']");if(notOk(m)){a.append('<input type="hidden" name="pageSize" value="'+h+'"/>')}else{m.val(h)}a.submit()},initPageBoxContent:function(h,d,c,a){h.data("page",c).attr("data-page",c);var j=[];var f=h.data("pagesize-options");if(f){if(typeof f=="number"){j=[f]}else{if(f.indexOf(",")!=-1){j=f.split(",")}else{j=[5,10,15,20,30,40,50,100]}}}else{j=[5,10,15,20,30,40,50,100]}var e=h.data("pagesize")||15;var a=h.data("page-mini");var b=juicer(a?jboltPortalPageTpl_mini:jboltPortalPageTpl,{pageId:c,pageSize:e,options:j});var i=$(b);d.append(i);return i},triggerPortalJBoltPageCloseHandler:function(portal,jboltPage){var jboltPage=jboltPage?jboltPage:(portal.find(".jbolt_page[data-close-handler]"));var closeHandler=jboltPage.data("close-handler");if(closeHandler){if(closeHandler=="removeCommand"&&JBoltWS){var commands=jboltPage.data("remove-command");JBoltWS.removeCommand(commands)}else{var exe_handler=eval(closeHandler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(jboltPage)}}}},processError:function(a,b,c){switch(b){case"prepend":a.find(".ajaxPortalLoading").remove();LayerMsgBox.alert("请求资源不存在",2);break;case"append":a.find(".ajaxPortalLoading").remove();LayerMsgBox.alert("请求资源不存在",2);break;case"replace":a.empty().html('<div class="jbolt_page"><div class="jbolt_page_content"><div style="margin: 20px auto;max-width: 500px"><div class="alert alert-danger">404,您访问的资源不存在!</div></div></div></div>');break;default:a.empty().html('<div class="jbolt_page"><div class="jbolt_page_content"><div style="margin: 20px auto;max-width: 500px"><div class="alert alert-danger">404,您访问的资源不存在!</div></div></div></div>');break}if(c){c(a)}},processContent:function(portal,html,json,url,replaceOldUrl,insertType,callback){var htmlObj=$(html);if(replaceOldUrl&&url){portal.data("url",url)}var portalId=portal.attr("id");if(!portalId){portalId=randomId();portal.attr("id",portalId)}LayerMsgBox.closeLoadingNow();switch(insertType){case"prepend":portal.find(".ajaxPortalLoading").remove();portal.prepend(htmlObj);afterAjaxPortal(htmlObj);break;case"append":portal.find(".ajaxPortalLoading").remove();portal.append(htmlObj);afterAjaxPortal(htmlObj);break;case"replace":portal.empty().append(htmlObj);afterAjaxPortal(portal);break;default:portal.empty().append(htmlObj);afterAjaxPortal(portal);break}if(callback){callback(portal,htmlObj,json)}var handler=portal.data("handler");var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(portal,htmlObj,json)}},openBy:function(d){disposeTooltip(d);var b=d.data("portalid")||d.data("portal");var a;if(b=="self"){a=d.closest("[data-ajaxportal]")}else{a=$("#"+b)}if(!isOk(a)){LayerMsgBox.alert("未找到与设置data-portalid匹配的portal",2);return}var c=d.attr("href");if(!c){c=d.data("url");if(!c){c=a.data("url")}}if(!c){LayerMsgBox.alert("请设置URL地址",2);return}LayerMsgBox.load(3);a.ajaxPortal(true,c,true,function(){LayerMsgBox.closeLoadNow()})},initBy:function(b,d){var a=getRealParentJqueryObject(d);if(!isOk(a)){return false}b=b||"[data-portalbtn]";var c=this;a.on("click",b,function(f){f.preventDefault();f.stopPropagation();c.openBy($(this))})},init:function(c){var a;var b=getRealParentJqueryObject(c);if(isOk(b)){a=b.find("[data-ajaxportal]")}if(isOk(a)){a.ajaxPortal(true)}},refresh:function(b){var a=getRealJqueryObject(b);if(isOk(a)){a.ajaxPortal(true)}else{LayerMsgBox.alert("指定刷新区域不存在",2)}},go:function(c,b){var a=getRealJqueryObject(c);if(isOk(a)){a.ajaxPortal(true,b,true)}else{LayerMsgBox.alert("指定加载区域不存在",2)}}};function processImgviewerEvent(){jboltBody.on("click",".viewer-canvas",function(a){if($(a.target).hasClass("viewer-canvas")){$(".viewer-close").trigger("click")}})}$.getMultiScripts=function(a,c){var b=$.map(a,function(d){return $.ajax({async:false,dataType:"script",url:((c||"")+d)})});b.push($.Deferred(function(d){$(d.resolve)}));return $.when.apply($,b)};function initJboltAdmin(){initAdminLeftNav();processGlobalSelect2();processGlobalBootstrapSelect();TableUtil.init();PageOptUtil.init();toggleMenuEvent();toggleLeftMenuEventByTopnav();JBoltLayerUtil.init();MasterSlaveUtil.initMasterTableEvent();processImgviewerEvent();initJboltAdminTopStyleChange();LayerPhotoUtil.init();initBootstrapTab();initJuicer();initImgError();initJboltBodyClick();initAjaxPortalContextMenu();FormChecker.init();DownloadUtil.init();JBoltTabViewUtil.initTabLinkEvent();OpenPageBtnUtil.init();FullScreenBtnUtil.init();SwitchBtnUtil.initEvent();TextareaUtil.initEvent();initJBoltTabsFromSessionStorage()}function useHashToActiveTab(){if(window.location.hash){var b=window.location.hash.substring(1);var a=jboltAdminLeftNavs.find(".jbolt_admin_nav a[data-key='"+b+"']");if(isOk(a)){if(!a.hasClass("active")){a.click();return true}}}return false}function exeLock(b){var a=$("#j_locksystem");if(!isOk(a)||a.is(":hidden")){Ajax.get("admin/lockSystem",function(){showJboltLockSystem();if(b){b()}})}}function processAutoLockScreen(){if(window.self!=window.top){return true}var a=jboltBody.find("script#jbolt_ifvisible");if(isOk(a)){startIfVisible()}return true}function startIfVisible(){var a=$("#JBOLT_AUTO_LOCK_SCREEN_SECONDS");if(isOk(a)){var b=$.trim(a.text());if(!isNaN(b)){JBOLT_AUTO_LOCK_SCREEN_SECONDS=Number(b)}}if(JBOLT_AUTO_LOCK_SCREEN_SECONDS>0&&JBOLT_AUTO_LOCK_SCREEN_SECONDS<=3600){ifvisible.setIdleDuration(JBOLT_AUTO_LOCK_SCREEN_SECONDS);ifvisible.idle(exeLock)}}function initAjaxPortalContextMenu(){jboltBody.on("contextmenu","[data-ajaxportal][data-refresh]",function(c){c.preventDefault();c.stopPropagation();var a=$(this);var d=getMousePos(c);var b=a.find(".jbolt_ajaxportal_menu");if(!isOk(b)){b=$('<div class="dropdown-menu jbolt_ajaxportal_menu"><a tabindex="-1" class="dropdown-item" data-func="refresh" href="javascript:void(0)"><i class="fa fa-refresh mr-1"></i>刷新此区域</a></div>');a.append(b)}b.on("click",function(f){f.preventDefault();f.stopPropagation();b.hide();a.ajaxPortal(true);return false});b.css({top:d.y,left:d.x});b.show();return false})}function hideAjaxPortalContextMenu(){$("div[data-ajaxportal]>.jbolt_ajaxportal_menu").hide()}function initJboltBodyClick(){jboltBody.on("click",function(){JBoltInputUtil.hideJBoltInputLayer();hideAjaxPortalContextMenu()}).on("click","div[data-ajaxportal]",function(){hideAjaxPortalContextMenu()})}function initImgError(){}var date_ymdhm=function(b,a){return date(b,"yyyy-MM-dd HH:mm",a)};var date_ymdhms=function(b,a){return date(b,"yyyy-MM-dd HH:mm:ss",a)};var date_ymd=function(b,a){return date(b,"yyyy-MM-dd",a)};var date_ym=function(b,a){return date(b,"yyyy-MM",a)};var date_hm=function(b,a){return date(b,"HH:mm",a)};var date_hms=function(b,a){return date(b,"HH:mm:ss",a)};var sex=function(b,a){if(!b){return a?a:"-"}return b==1?"男":(b==2?"女":"-")};var time_hm=function(c,a){if(!c&&!a){return""}if(c){if(c.indexOf(":")==-1){return""}var d=c.split(":");if(d.length>=3){c=d[0]+":"+d[1]}}else{if(!c||a){if(typeof(a)=="string"){if(a=="now"){var b=new Date();return b.getHours()+":"+b.getMinutes()}return a}else{c=a}}}return c};var time_hms=function(c,a){if(!c&&!a){return""}if(c){if(c.indexOf(":")==-1){return""}var d=c.split(":");if(d.length>=3){c=d[0]+":"+d[1]+":"+d[2]}}else{if(!c||a){if(typeof(a)=="string"){if(a=="now"){var b=new Date();return b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()}return a}else{c=a}}}return c};var date=function(d,b,a){if(!d&&!a){return""}if(!d&&a){if(typeof(a)=="string"){if(a=="now"){return new Date().Format(b)}return a}else{d=a}}var c=typeof(d);if(c=="string"){d=new Date(d.replace(/-/g,"/"))}return d.Format(b)};var jbolt_default_img_url="assets/img/uploadimg.png";var real_image=function(a){if(!a){return jbolt_default_img_url}if(JBOLT_BASE_UPLOAD_PATH_PRE&&a.indexOf(JBOLT_BASE_UPLOAD_PATH_PRE)!=-1){a=a.replace(JBOLT_BASE_UPLOAD_PATH_PRE,"")}return actionUrl(a)};function money_1(a){var b=numberFormat(a,1);return b.toString()==="0"?"":b}function money_2(a){var b=numberFormat(a,2);return b.toString()==="0"?"":b}function money_3(a){var b=numberFormat(a,3);return b.toString()==="0"?"":b}function money_4(a){var b=numberFormat(a,4);return b.toString()==="0"?"":b}function numberFormat2(d,b,c,a,f){var e=numberFormat(d,b,c,a,f);return removeNumberEndZero(e,false)}function numberFormat3(d,b,c,a,f){var e=numberFormat2(d,b,c,a,f);return e.toString()==="0"?"":e}function numberFormat(f,c,j,e,i){f=(f+"").replace(/[^0-9+-Ee.]/g,"");i=i||"round";var b=!isFinite(+f)?0:+f,a=!isFinite(+c)?0:Math.abs(c),m=(typeof e==="undefined")?",":e,d=(typeof j==="undefined")?".":j,l="",h=function(q,p){var o=Math.pow(10,p);return""+parseFloat(Math[i](parseFloat((q*o).toFixed(p*2))).toFixed(p*2))/o};l=(a?h(b,a):""+Math.round(b)).split(".");var k=/(-?\d+)(\d{3})/;while(k.test(l[0])){l[0]=l[0].replace(k,"$1"+m+"$2")}if((l[1]||"").length<a){l[1]=l[1]||"";l[1]+=new Array(a-l[1].length+1).join("0")}return l.join(d)}function prettyTime(d){if(!d){return"刚刚"}var p=new Date().getTime();var q=typeof(d);var k;if(q=="object"){k=d.getTime()}else{if(q=="string"){k=Date.parse(d.replace(/-/gi,"/"))}}var h=1000;var e=h*60;var i=e*60;var n=i*24;var j=n*30;var l=0;var o=p-k;if(o<0){return d}var c=o/j;var b=o/(7*n);var a=o/n;var f=o/i;var m=o/e;if(c>=1){return d}else{if(b>=1){l=parseInt(b)+"个星期前"}else{if(a>=1){l=parseInt(a)+"天前"}else{if(f>=1){l=parseInt(f)+"个小时前"}else{if(m>=1){l=parseInt(m)+"分钟前"}else{l="刚刚"}}}}}return l}function rownum(b,a,c){if(!b){b=1}if(!a){a=0}return((b-1)*a)+(+c+1)}function tofixed_1(a){return tofixed(a,1,false,true)}function tofixed_2(a){return tofixed(a,2,false,true)}function tofixed_3(a){return tofixed(a,3,false,true)}function tofixed_4(a){return tofixed(a,4,false,true)}function tofixed(d,c,a,b){d=d?Number(d):0;c=c||0;var e=d?d.toFixed(c):0;if(a){e=removeFixedNumberAllZero(e,c,b)}return e}function removeNumberEndZero(e,c){if(typeof(e)=="undefined"){return c?0:e}if(typeof(e)!="string"){e=e.toString()}if(e=="."){return c?0:""}var b=e.length;if(b==0){return c?0:e}if(b>=2&&e.indexOf(".")!=-1){if(e.endWith(".")){e=e.substring(0,b-1)}else{var d=-1;for(var a=b-1;a<b;a--){if(e.charAt(a)!="0"){d=a;break}}if(d!=-1){if(e.charAt(d)=="."){e=e.substring(0,d)}else{e=e.substring(0,d+1)}}}}if(e.length==0){return c?0:e}if(e=="."){return c?0:""}return e}function removeFixedNumberAllZero(e,d,c){if(typeof(e)=="undefined"){return c?0:e}if(typeof(e)!="string"){e=e.toString()}if(e=="."){return c?0:""}var b=e.length;if(b==0){return c?0:e}if(d&&e.length>0){var f=".";for(var a=0;a<d;a++){f=f+"0"}e=e.replace(f,"")}if(e.length==0){return c?0:e}if(e=="."){return c?0:""}return e}function replaceStr(c,b,a){return c.replace(b,a)}var colorClass=["primary","success","info","danger","warning","secondary"];function colorClassByLevel(a){if(a<1||a>6){return"primary"}return colorClass[a-1]}var colorClass_checkstate=["secondary","info","success","danger"];function colorClassByCheckState(a){if(a<1||a>4){return"secondary"}return colorClass_checkstate[a-1]}function colorClassByType(a){if(a<1||a>6){return"primary"}return colorClass[a-1]}var colorClass_Difficulty3=["success","primary","danger"];var colorClass_Difficulty4=["success","primary","warning","danger"];var colorClass_Difficulty5=["success","primary","info","warning","danger"];function colorClassByDifficulty3(a){if(a<1||a>3){return"info"}return colorClass_Difficulty3[a-1]}function colorClassByDifficulty4(a){if(a<1||a>4){return"info"}return colorClass_Difficulty4[a-1]}function colorClassByDifficulty5(a){if(a<1||a>5){return"secondary"}return colorClass_Difficulty5[a-1]}var colorClass_byState=["secondary","info","danger","success","warning","dark"];function colorClassByState(a){if(a<1||a>6){return"secondary"}return colorClass_byState[a-1]}function colorClassByServiceState(a){if(a<1||a>6){return"secondary"}return colorClass_byState[a-1]}var colorClass_priorityLevel=["priorityLevel_1","priorityLevel_2","priorityLevel_3","priorityLevel_4","priorityLevel_5","priorityLevel_6"];function colorClassByPriorityLevel(a){if(a<1||a>6){return"primary"}return colorClass_priorityLevel[a-1]}function initJuicer(){juicer.register("date",date);juicer.register("time_hm",time_hm);juicer.register("time_hms",time_hm);juicer.register("date_hm",date_hm);juicer.register("date_hms",date_hms);juicer.register("date_ym",date_ym);juicer.register("date_ymd",date_ymd);juicer.register("date_ymdhm",date_ymdhm);juicer.register("date_ymdhms",date_ymdhms);juicer.register("real_image",real_image);juicer.register("real_url",real_image);juicer.register("pretty_time",prettyTime);juicer.register("number_format",numberFormat);juicer.register("number_format2",numberFormat2);juicer.register("number_format3",numberFormat3);juicer.register("money_1",money_1);juicer.register("money_2",money_2);juicer.register("money_3",money_3);juicer.register("money_4",money_4);juicer.register("rownum",rownum);juicer.register("str_join",StrUtil.join);juicer.register("str_underline",StrUtil.underline);juicer.register("str_camel",StrUtil.camel);juicer.register("tofixed",tofixed);juicer.register("tofixed_1",tofixed_1);juicer.register("tofixed_2",tofixed_2);juicer.register("tofixed_3",tofixed_3);juicer.register("tofixed_4",tofixed_4);juicer.register("removeNumberZero",removeNumberEndZero);juicer.register("removeNumberEndZero",removeNumberEndZero);juicer.register("removeFixedNumberAllZero",removeFixedNumberAllZero);juicer.register("sex",sex);juicer.register("replaceStr",replaceStr);juicer.register("colorClassByLevel",colorClassByLevel);juicer.register("colorClassByType",colorClassByType);juicer.register("colorClassByCheckState",colorClassByCheckState);juicer.register("colorClassByDifficulty3",colorClassByDifficulty3);juicer.register("colorClassByDifficulty4",colorClassByDifficulty4);juicer.register("colorClassByDifficulty5",colorClassByDifficulty5);juicer.register("colorClassByState",colorClassByState);juicer.register("colorClassByServiceState",colorClassByServiceState);juicer.register("colorClassByPriorityLevel",colorClassByPriorityLevel);juicer.register("toJsonString",toJsonString)}function toJsonString(j,f,h){if(!j){return"{}"}if(f&&f.length>0){var a;var d=f.split(",");if(isArray(j)){var b;for(var e in j){b=j[e];var c={};for(var e in d){a=d[e];if(a){c[a]=b[a]}}if(h){c.isImg=isImg(b[h]);c.fileSuffix=getFileExtension(b[h])}}}else{var c={};for(var e in d){a=d[e];if(a){c[a]=j[a]}}if(h){c.isImg=isImg(b[h]);c.fileSuffix=getFileExtension(b[h])}return JSON.stringify(c)}}return JSON.stringify(j)}function initBootstrapTab(){jboltBody.on("click",".nav-tabs a.nav-link",function(a){a.preventDefault();a.stopPropagation();$(this).tab("show");return false})}function isHasPjax(){var a=$("#pjaxScript");return a&&a.length==1}var MultipleFileInputUtil={init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("[data-multiplefileinput]");if(!isOk(a)){return false}this.initInputs(a)},initInputs:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["fileinput"],function(){var c=a.length;for(var d=0;d<c;d++){b.initInput(a.eq(d),false)}})},processHandler:function(input,handler,res){var exe_handler=eval(handler);if(exe_handler&&typeof(exe_handler)=="function"){exe_handler(input,res)}},changeSyncInputFiles:function(c,b){var e;for(var d in multipleUploadFiles){if(multipleUploadFiles[d]["key"]==c){for(var a in b){multipleUploadFiles[d]["value"].push(b[a])}e=multipleUploadFiles[d]["value"];break}}if(e){return e}var f={key:c,value:b};multipleUploadFiles.push(f);return f.value},clearInputFiles:function(a){for(var b in multipleUploadFiles){if(multipleUploadFiles[b]["key"]==a){multipleUploadFiles[b]["value"]=[];break}}},findInputFiles:function(b){if(multipleUploadFiles.length==0){var a=new Array();var e={key:b,value:a};multipleUploadFiles.push(e);return e.value}else{var d;for(var c in multipleUploadFiles){if(multipleUploadFiles[c]["key"]==b){d=multipleUploadFiles[c]["value"];break}}if(d){return d}var a=new Array();var e={key:b,value:a};multipleUploadFiles.push(e);return e.value}},setValueTo:function(h,c){var b=this;var e=h.data("setvalueto");if(!e){return false}var k=h.attr("id");var f=h.data("sync");var l=null;if(f){l=b.changeSyncInputFiles(k,c.data)}else{l=b.findInputFiles(k);l.push(c.data)}if(l&&l.length>0){var d=new Array();for(var a in l){d.push(l[a].url)}var j=d.join(",");$("#"+e).val(j).change()}},processRemoveSetValueTo:function(j,a){var c=this;var f=j.data("setvalueto");if(!f){return false}var k=j.attr("id");var h=j.data("sync");var l=c.findInputFiles(k);if(l&&l.length>0){var d=0;for(var b in l){d=a.indexOf((h?"_":"-")+l[b].fileId);if(d!=-1){l.splice(b,1)}}if(l.length>0){var e=new Array();for(var b in l){e.push(l[b].url)}$("#"+f).val(e.join(",")).change()}else{$("#"+f).val("").change()}}},processFileclearedSetValueTo:function(c){var d=this;var a=c.data("setvalueto");if(!a){return false}var b=c.attr("id");$("#"+a).val("").change();d.clearInputFiles(b)},initEvent:function(a){var e=this;var c=a.data("handler");if(c){var d=a.data("sync");if(d){a.on("filebatchuploadsuccess",function(i,j,f,h){if(c=="setValueTo"){e.setValueTo(a,j.response)}else{e.processHandler(a,c,j.response)}})}else{a.on("fileuploaded",function(i,j,f,h){if(c=="setValueTo"){e.setValueTo(a,j.response)}else{e.processHandler(a,c,j.response)}})}}a.on("filesuccessremove",function(h,i){if(c&&c=="setValueTo"){e.processRemoveSetValueTo(a,i)}var f=a.data("filesuccessremove");if(f){e.processHandler(a,f,i)}});a.on("fileremoved",function(h,i){if(c&&c=="setValueTo"){e.processRemoveSetValueTo(a,i)}var f=a.data("fileremoved");if(f){e.processHandler(a,f,i)}});a.on("filecleared",function(h){if(c&&c=="setValueTo"){e.processFileclearedSetValueTo(a)}var f=a.data("filecleared");if(f){e.processHandler(a,f)}});var b=a.data("extrahandler");if(b){e.processHandler(a,b)}},_initInput:function(a,d,c){if(d&&d.length==1){var b=a.clone();d.before(b);d.remove();b.fileinput(c);this.initEvent(b)}else{a.fileinput(c);this.initEvent(a)}},initInput:function(input,needLoadPlugin){var that=this;var chooseBtnText=input.data("choosebtntext");if(!chooseBtnText){chooseBtnText="请选择"}var maxFileCount=input.data("max-filecount");if(!maxFileCount){maxFileCount=9}var maxFileSize=input.data("max-filesize");if(!maxFileSize){maxFileSize=200}var theme=input.data("theme");if(!theme){theme="fa"}var sync=input.data("sync");var uploadAsync=true;if(sync){uploadAsync=false}var uploadUrl=input.data("uploadurl");if(!uploadUrl){LayerMsgBox.alert("请设置多文件组件上传地址：data-uploadurl",2)}var options={enctype:"multipart/form-data",previewFileType:"any",theme:theme,uploadAsync:uploadAsync,allowedPreviewTypes:["image","html","text","video","audio","flash","object"],uploadUrl:uploadUrl,append:true,overwriteInitial:false,maxFileCount:maxFileCount,maxFileSize:maxFileSize,initialPreviewAsData:true,showSort:true,showCaption:false,showCancel:false,language:"zh",browseClass:"btn btn-success",browseLabel:chooseBtnText,removeClass:"btn btn-danger",removeLabel:"清空",uploadClass:"btn btn-info",uploadLabel:"全部上传",fileActionSettings:{showRemove:true,showUpload:false,showDownload:false,showZoom:true,showDrag:true}};var deleteUrl=input.data("deleteurl");if(deleteUrl){options.deleteUrl=deleteUrl}var dataOptions=input.data("options");if(dataOptions){var dpoptionFunc=eval(dataOptions);if(dpoptionFunc&&typeof(dpoptionFunc)=="function"){var configOptions=dpoptionFunc();Object.assign(options,configOptions)}}var inputId=input.attr("id");var fielInputBox=input.closest(".file-input");if(needLoadPlugin){loadJBoltPlugin(["fileinput"],function(){that._initInput(input,fielInputBox,options)})}else{this._initInput(input,fielInputBox,options)}}};var JBoltTreeTableUtil={init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("[data-jbolttreetable]");if(!isOk(a)){return false}this.initTables(a)},initTables:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["jbolttable"],function(){var c=a.length;for(var d=0;d<c;d++){b.initTable(a.eq(d),false)}})},initTable:function(b,c){var a=this;if(c){loadJBoltPlugin(["jbolttable"],function(){a._initTable(b)})}else{this._initTable(b)}},_initTable:function(a){a.jboltTreeTable()}};var JBoltTableUtil={init:function(c){var b=getRealParentJqueryObject(c);if(!isOk(b)){return false}var a=b.find("[data-jbolttable]:not([data-jbolttreetable])");if(!isOk(a)){return false}this.initTables(a)},initTables:function(a){if(!isOk(a)){return false}var b=this;loadJBoltPlugin(["jbolttable"],function(){var c=a.length;for(var d=0;d<c;d++){b.initTable(a.eq(d),false)}})},initTable:function(b,c){var a=this;if(c){loadJBoltPlugin(["jbolttable"],function(){a._initTable(b)})}else{this._initTable(b)}},_initTable:function(a){if(!window.jbolt_table_js_version){return null}if(!a[0].hasAttribute("data-jbolttable")){a.attr("data-jbolttable",true)}a.jboltTable()},get:function(a){if(!window.jbolt_table_js_version){return null}return getJBoltTable(a)},getInst:function(a){if(!window.jbolt_table_js_version){return null}return getJBoltTableInst(a)}};function deepClone(d){var c=Object.prototype.toString.call(d);var b;if(c==="[object Array]"){b=[];if(d.length>0){for(var a=0;a<d.length;a++){b.push(deepClone(d[a]))}}}else{if(c==="[object Object]"){b={};for(var a in d){b[a]=deepClone(d[a])}}else{b=d}}return b}var JBoltNotifyBox={notify:function(d,b){var a={width:300,messageHeight:200,size:"mini",delay:false,title:false,msg:"消息",position:"top right",img:false};var e=Object.keys(b);if(e&&e.length>0){for(var c in e){a[e[c]]=b[e[c]]}}Lobibox.notify(d,a)},success:function(a){a.msg=a.msg||"成功";this.notify("success",a)},error:function(a){a.msg=a.msg||"失败";this.notify("error",a)},warning:function(a){a.msg=a.msg||"警告";this.notify("warning",a)},info:function(a){a.msg=a.msg||"消息";this.notify("info",a)}};var JBoltArrayUtil={remove:function(c,b){var a=-1;if(isOk(c)&&typeof(b)!=undefined&&typeof(b)!="undefined"){$.each(c,function(d,e){if(e===b){c.splice(d,1);a=d;return false}})}return a},replace:function(c,a,b){c.splice(a,1,b)},merge:function(f,a,d){if(typeof(d)=="undefined"||a<0||a>=f.length){return}var e=f[a];var c=Object.keys(d);for(var b in c){e[c[b]]=d[c[b]]}},prepend:function(f,d){if(d){var a=deepClone(d);if(isArray(a)){var c=a.length;var e=c-1;for(var b=e;b>=0;b--){f.unshift(a[b])}}else{f.unshift(a)}}},append:function(e,b){if(b){var a=deepClone(b);if(isArray(a)){var d=a.length;for(var c=0;c<d;c++){e.push(a[c])}}else{e.push(a)}}},removeByIndex:function(c,a,b){c.splice(a,b?b:1)},insert:function(f,b,e){if(f&&e){var a=deepClone(e);if(f.length==0){this.append(f,a)}else{if(b<0){this.prepend(f,a)}else{if(b>=f.length){this.append(f,a)}else{if(isArray(a)){var d=a.length;for(var c=0;c<d;c++){f.splice(b+c,0,a[c])}}else{f.splice(b,0,a)}}}}}},removeObjectByAttr:function(d,a,c){var b=this;if(isOk(d)&&a){$.each(d,function(e,f){if(f[a]===c){b.removeByIndex(d,e);return false}})}},changeOneItemAttrValue:function(e,b,a,d){if(isOk(e)&&b>=0&&a){var c=e.length;if(b<=c-1){e[b][a]=d}}},changeOneItemOtherAttrValueByAttr:function(f,b,d,e,a){if(isOk(f)){var c=-1;$.each(f,function(h,i){if(i[b]==d){c=h;return false}});this.changeOneItemAttrValue(f,c,e,a)}},changeItemsAttrValue:function(c,a,b){if(isOk(c)&&a){$.each(c,function(d,e){e[a]=b})}},unique:function(a){return a.filter(function(c,b){return a.indexOf(c,0)===b})},moveUp:function(a,b,c){return this.move(a,b,c,true)},moveDown:function(a,b,c){return this.move(a,b,c,false)},move:function(e,c,d,f){var b,l,k,j,a=c[0],i=e.length,h=c[c.length-1];if(f){b=e.slice(0,d);l=e.slice(c[0],c[c.length-1]+1);k=e.slice(d,c[0]);j=e.slice(c[c.length-1]+1)}else{b=e.slice(0,a);l=e.slice(c[c.length-1]+1,d+1);k=e.slice(a,c[c.length-1]+1);j=e.slice(d+1)}return b.concat(l).concat(k).concat(j)}};var StrUtil={join:function(){if(arguments.length<=2){return arguments[0]}var a=[];var b=arguments[arguments.length-1];for(var c=0;c<arguments.length-1;c++){if(/^\s*$/.test(arguments[c])){continue}a.push(arguments[c])}return a.join(b)},underline:function(c,b){var a=c.replace(/([A-Z])/g,"_$1");if(b){return a.toUpperCase()}else{return a.toLowerCase()}},camel:function(c,b){var a;if(c.indexOf("_")!=-1){a=c.toLowerCase();a=a.replace(/_([\w+])/g,function(d,e){return e.toUpperCase()})}else{a=c}if(b){a=a.replace(/\b(\w)(\w*)/g,function(e,d,f){return d.toUpperCase()+f})}return a}};$(function(){var b=processAutoLockScreen();if(!b){return false}initJboltAdmin();if(needPjax&&hasPjax){if(jboltWithTabs){JBoltTabUtil.init();JBoltTabUtil.addJboltTabWithoutContentUrl();var a=JBoltTabUtil.getCurrentTabContent();if(a&&a.length==1){afterAjaxPortal(a)}initAdminAjaxPortalFormSubmitEvent()}else{JBoltPjaxUtil.initAdminPjax()}}else{pageLoadRequirePluginAndInit();if(jboltWithTabs){JBoltTabUtil.init();initAdminAjaxPortalFormSubmitEvent()}else{JBoltPjaxUtil.initPjaxEvent()}SelectUtil.initAutoSetValue();FileUploadUtil.init();ImgUploadUtil.init();SwitchBtnUtil.init();FormDate.init();CityPickerUtil.init();LayerTipsUtil.init();HtmlEditorUtil.init();ImageViewerUtil.init();AutocompleteUtil.init();RadioUtil.init();CheckboxUtil.init();Select2Util.init();SelectUtil.init();MultipleFileInputUtil.init();AjaxPortalUtil.init();JSTreeUtil.init();JBoltInputUtil.init();RangeSliderUtil.init();JBoltInputWithClearBtnUtil.init();JBoltInputWithCalculatorUtil.init();initToolTip();initPopover();JBoltTableUtil.init();JBoltTreeTableUtil.init();JBoltTabViewUtil.initUI();TextareaUtil.initUI();JsonEditorUtil.init();findRequiredAndStarIt()}onwindowReisze();mainScrollEvent();JBoltClipboardUtil.init()});function mainScrollEvent(){mainPjaxContainer.on("scroll",function(){AutocompleteUtil.hideResult(mainPjaxContainer);JBoltInputUtil.hideJBoltInputLayer()})}function findRequiredAndStarIt(d){if(!autoShowRequiredLabelStar){return false}var c=getRealParentJqueryObject(d);if(!isOk(c)){return false}var a="[data-rule]:not([data-notnull='false']):not([type='hidden']):not([data-radio])";var b=c.find(a);if(isOk(b)){b.each(function(e){requiredAndStarIt(b.eq(e))})}}function requiredAndStarIt(a){var h,i,c,b,f;var e=a.data("rule");if(a[0].hasAttribute("data-checkbox")){c=a.find("label:first");if(c.parent().hasClass("checkbox")==false&&!c.hasClass("is_required")){c.addClass("is_required")}if(!e){a.data("rule","checkbox").attr("data-rule","checkbox")}}else{if(a[0].hasAttribute("data-radio")){if(!e){a.data("rule","radio").attr("data-rule","radio")}}else{if(a[0].hasAttribute("data-autoload")){if(!e){a.data("rule","select").attr("data-rule","select")}}else{if(!e){a.data("rule","required").attr("data-rule","required")}}}h=a.closest(".form-group");if(isOk(h)){i=h.find("label");if(isOk(i)){if(a.hasClass("ac_input")){f=a.parent().prev()}else{f=a.prev()}if(isOk(f)){if(f[0].tagName=="LABEL"){c=f}else{b=a.parent()}}else{if(a.hasClass("ac_input")||a.parent().hasClass("ac_input_box")){b=a.parent().parent()}else{b=a.parent()}}if(isOk(b)&&b[0].tagName=="DIV"){if(b.hasClass("input-group")||b.hasClass("form-group")){c=h.find("label:first")}else{var d=b.prev();if(isOk(d)){if(d[0].tagName=="LABEL"){c=d}}}}if(isOk(c)&&!c.hasClass("is_required")){c.addClass("is_required")}}}else{h=a.closest(".input-group");if(isOk(h)){c=h.find(".input-group-text");if(isOk(c)&&!c.hasClass("is_required")){c.addClass("is_required")}}}}}function removeRequiredAndStar(a){var f,h,c,b,e;if(a[0].hasAttribute("data-checkbox")){c=a.find("label:first");if(c.parent().hasClass("checkbox")==false&&c.hasClass("is_required")){c.removeClass("is_required")}}else{f=a.closest(".form-group");if(isOk(f)){h=f.find("label");if(isOk(h)){if(a.hasClass("ac_input")){e=a.parent().prev()}else{e=a.prev()}if(isOk(e)){if(e[0].tagName=="LABEL"){c=e}else{b=a.parent()}}else{if(a.hasClass("ac_input")||a.parent().hasClass("ac_input_box")){b=a.parent().parent()}else{b=a.parent()}}if(isOk(b)&&b[0].tagName=="DIV"){if(b.hasClass("input-group")){c=f.find("label:first")}else{var d=b.prev();if(isOk(d)){if(d[0].tagName=="LABEL"){c=d}}}}if(isOk(c)&&c.hasClass("is_required")){c.removeClass("is_required")}}}else{f=a.closest(".input-group");if(isOk(f)){c=f.find(".input-group-text");if(isOk(c)&&c.hasClass("is_required")){c.removeClass("is_required")}}}}}function refreshCurrentAjaxPortal(b){var c=getRealJqueryObject(b);var a=c.closest("[data-ajaxportal]");if(isOk(a)){a.ajaxPortal(true)}}function showReloginDialog(b,a){if(window.self!=window.top){parent.showReloginDialog(b,a)}else{layer.closeAll();DialogUtil.openNewDialog({title:"请重新登录",width:"500",height:"400",offset:"auto",zIndex:20220610,url:"admin/relogin",handler:a?a:refreshPjaxContainer});if(b||typeof(b)=="undefined"){LayerMsgBox.error("当前登录已经失效，请重新登录系统!",2000)}}}function formReset(a,b){var c=function(){if(isDOM(a)){a.reset()}else{var d=getRealJqueryObject(a);if(isOk(d)){d[0].reset()}}};if(b){LayerMsgBox.confirm("确认重置表单？",c)}else{c()}}(function(n,p,u){var w=n([]),s=n.resize=n.extend(n.resize,{}),o,l="setTimeout",m="resize",t=m+"-special-event",v="delay",r="throttleWindow";s[v]=350;s[r]=true;n.event.special[m]={setup:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.add(a);n.data(this,t,{w:a.width(),h:a.height()});if(w.length===1){q()}},teardown:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.not(a);a.removeData(t);if(!w.length){clearTimeout(o)}},add:function(b){if(!s[r]&&this[l]){return false}var c;function a(d,i,h){var f=n(this),e=n.data(this,t);e.w=i!==u?i:f.width();e.h=h!==u?h:f.height();c.apply(this,arguments)}if(n.isFunction(b)){c=b;return a}else{c=b.handler;b.handler=a}}};function q(){o=p[l](function(){w.each(function(){var d=n(this),a=d.width(),b=d.height(),c=n.data(this,t);if(a!==c.w||b!==c.h){d.trigger(m,[c.w=a,c.h=b])}});q()},s[v])}})(jQuery,this);function showMsgCenterRedDot(){if(isOk(msgCenterRedDot)){msgCenterRedDot.show()}}function hideMsgCenterRedDot(){if(isOk(msgCenterRedDot)){msgCenterRedDot.hide()}}function readUserMsgCenterUnreadInfo(a){Ajax.get("admin/msgcenter/unreadInfo",function(b){if(b.data){showMsgCenterRedDot()}else{hideMsgCenterRedDot()}if(a){a()}})}function initReadUserMsgCenterUnreadInfo(){if(isOk(msgCenterRedDot)){readUserMsgCenterUnreadInfo(function(){setInterval(readUserMsgCenterUnreadInfo,30000)})}}function jboltTableGetHiprintUrl(h,f,e){var c=getRealJqueryObject(h);var d=c.data("jbolt-table-id");if(!d){LayerMsgBox.alert("按钮未绑定表格");return false}var a=f;var b=e?jboltTableGetCheckedId(c):jboltTableGetCheckedIds(c);if(!b){return false}if(typeof(b)!="boolean"){if(isArray(b)){a=a+b.join(",")}else{a=a+b}}a=actionUrl(a);a=processEleUrlByLinkOtherParamEle(c,a);return a}function jboltTableHiprintToPdf(e,b,d,c,f){var a=jboltTableGetHiprintUrl(e,d,c);if(a){loadJBoltPlugin(["hiprint"],function(){jboltHiprintToPdf(b,"url",a,f)})}}function jboltTableHiprintWebPrint(e,b,d,c){var a=jboltTableGetHiprintUrl(e,d,c);if(a){loadJBoltPlugin(["hiprint"],function(){jboltHiprintWebPrint(b,"url",a)})}}function jboltHiprintWebPrint(e,d,a,b){if(!e){LayerMsgBox.alert("请指定正确的模板SN编号",2);return}if(!a){LayerMsgBox.alert("请填写JSON数据",2);return}if(d=="json"&&(typeof(a)!="object"||!jsonObjectValueIsOk(a))){LayerMsgBox.alert("请填写JSON数据",2);return}var c;LayerMsgBox.loading("执行中...",20000);Ajax.get("admin/hiprint/tpl/content?sn="+e,function(f){if(!f.data){LayerMsgBox.alert("打印模板无效",2)}else{if(d=="url"){Ajax.get(a,function(h){if(h.data){c=new hiprint.PrintTemplate({template:JSON.parse(f.data)});if(b){c.print2(h.data)}else{c.print(h.data)}LayerMsgBox.closeLoadingNow()}else{LayerMsgBox.alert("未读取到有效打印数据",2)}})}else{c=new hiprint.PrintTemplate({template:JSON.parse(f.data)});if(b){c.print2(a)}else{c.print(a)}LayerMsgBox.closeLoadingNow()}}})}function jboltHiprintWebRender(e,d,c,a){var f=getRealJqueryObject(e);if(!isOk(f)){LayerMsgBox.alert("请指定正确的渲染容器ele",2);return}if(!d){LayerMsgBox.alert("请指定正确的模板SN编号",2);return}if(!a){LayerMsgBox.alert("请填写JSON数据",2);return}if(c=="json"&&(typeof(a)!="object"||!jsonObjectValueIsOk(a))){LayerMsgBox.alert("请填写JSON数据",2);return}LayerMsgBox.loading("渲染中...",20000);var b;f.empty();Ajax.get("admin/hiprint/tpl/content?sn="+d,function(h){if(!h.data){LayerMsgBox.alert("打印模板无效",2)}else{if(c=="url"){Ajax.get(a,function(j){if(j.data){b=new hiprint.PrintTemplate({template:JSON.parse(h.data)});var k=b.getHtml(j.data).html();if(k){f.html(k);f.data("printtemplate",b);f.data("printdata",j.data)}LayerMsgBox.closeLoadingNow()}else{LayerMsgBox.alert("未读取到有效打印数据",2)}})}else{b=new hiprint.PrintTemplate({template:JSON.parse(h.data)});var i=b.getHtml(a).html();if(i){f.html(i);f.data("printtemplate",b);f.data("printdata",a)}LayerMsgBox.closeLoadingNow()}}})}function jboltHiprintWebPrintByHtml(d,b){var e=getRealJqueryObject(d);if(!isOk(e)){LayerMsgBox.alert("请指定正确的渲染容器ele",2);return}LayerMsgBox.loading("执行中...",20000);var c=e.data("printtemplate");if(c){var a=e.data("printdata");if(a){if(b){c.print2(a)}else{c.print(a)}LayerMsgBox.closeLoadingNow()}else{LayerMsgBox.alert("未读取到有效打印数据",2)}}else{LayerMsgBox.closeLoadingNow()}}function jboltHiprintToPdfByHtml(c,e){var d=getRealJqueryObject(c);if(!isOk(d)){LayerMsgBox.alert("请指定正确的渲染容器ele",2);return}LayerMsgBox.loading("执行中...",20000);e=(e?e:("导出PDF_"+new Date().Format("yyyyMMddHHmmss")));var b=d.data("printtemplate");if(b){var a=d.data("printdata");if(a){b.toPdf(a,e);LayerMsgBox.closeLoadingNow()}else{LayerMsgBox.alert("未读取到有效数据",2)}}else{LayerMsgBox.closeLoadingNow()}}function jboltHiprintToPdf(d,c,a,e){if(!d){LayerMsgBox.alert("请指定正确的模板SN编号",2);return}if(!a){LayerMsgBox.alert("请填写JSON数据",2);return}if(c=="json"&&(typeof(a)!="object"||!jsonObjectValueIsOk(a))){LayerMsgBox.alert("请填写JSON数据",2);return}var b;e=(e?e:("导出PDF_"+new Date().Format("yyyyMMddHHmmss")));LayerMsgBox.loading("导出PDF...",60000);Ajax.get("admin/hiprint/tpl/content?sn="+d,function(f){if(!f.data){LayerMsgBox.alert("打印模板无效",2)}else{if(c=="url"){Ajax.get(a,function(h){if(h.data){b=new hiprint.PrintTemplate({template:JSON.parse(f.data)});b.toPdf(h.data,e);LayerMsgBox.closeLoadingNow()}else{LayerMsgBox.alert("未读取到有效数据",2)}})}else{b=new hiprint.PrintTemplate({template:JSON.parse(f.data)});b.toPdf(a,e);LayerMsgBox.closeLoadingNow()}}})}function freelyDragging(a,c,b){a.on("mousedown",function(f){disposeTooltip(a);c.draging=true;var d=c.offset();c.data("pointx",parseInt(Math.abs(f.clientX-d.left)));c.data("pointy",parseInt(Math.abs(f.clientY-d.top)));b.addClass("noselect")});b.on("mousemove",function(f){if(c.draging){var d=c.data("pointx")||10;var h=c.data("pointy")||10;c.offset({top:f.clientY-h,left:f.clientX-d})}});b.on("mouseup",function(d){disposeTooltip(a);c.draging=false;b.removeClass("noselect")})}function hideJBoltPageLoading(){setTimeout(function(){$("#jbolt_page_loader_main").fadeOut(200)},500)}function isJSON(c){if(typeof c=="string"){try{var b=JSON.parse(c);if(typeof b=="object"){return true}else{return false}}catch(a){console.error("error："+c+"!!!"+a);return false}}console.error("It is not a string!")};