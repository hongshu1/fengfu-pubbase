<div class="jbolt_page_title">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="col">
            <form class="form-inline" id="warehousebeginformtable_form_#(pageId)" style="left: 30px;text-align: left">
              <select class="form-control"
                      name="sourcebilltype"
                      data-autoload
                      data-url="admin/dictionary/options?key=stock_sourcebilltype"
                      data-select-type="select2"
                      data-text="=来源类型="
                      data-value-attr="name"
                      data-text-attr="name"
                      data-select="#(sourcebilltype??)"></select>

              <input data-date data-type="date" data-fmt="yyyy-MM-dd" readonly="readonly" autocomplete="off"
                     class="form-control" placeholder="=开始日期=" name="starttime" data-tips="开始时间" maxlength="23"
                     value=""/>
              <span class="input-group-text">至</span>
              <input data-date data-type="date" data-fmt="yyyy-MM-dd" readonly="readonly" autocomplete="off"
                     class="form-control" placeholder="=结束日期=" name="endtime" data-tips="结束时间" maxlength="23" value="">

              <button type="submit" class="btn btn-outline-secondary"><i class="fa fa-search"></i> 查询</button>
              <button type="reset" class="btn btn-outline-secondary"><i class="fa fa-reset"></i> 重置</button>
            </form>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<textarea class="jb_tpl_box" id="warehousebeginForm_tpl_#(pageId)">
  {@each datas as data,index}
    <tr data-id="${data.autoid}">
      <td>${pageNumber,pageSize,index | rownum}</td>
      <td title="${data.state}">${data.state}</td>
      <td title="${data.sourcebilltype}">${data.sourcebilltype}</td>
      <td title="${data.invcode}">${data.invcode}</td>
      <td title="${data.cinvcode1}">${data.cinvcode1}</td>
      <td title="${data.cinvname1}">${data.cinvname1}</td>
      <td title="${data.cinvstd}">${data.cinvstd}</td>
      <td title="${data.cuomname}">${data.cuomname}</td>
      <td title="${data.vencode}">${data.vencode}</td>
      <td title="${data.cvenname}">${data.cvenname}</td>
      <td title="${data.ipkgqty,0|number_format}">${data.ipkgqty,0|number_format}</td>
      <td title="${data.barcode}">${data.barcode}</td>
      <td title="${data.qty,0|number_format}">${data.qty,0|number_format}</td>
      <td title="${data.batch}">${data.batch}</td>
      <td title="${data.createdate}">${data.createdate}</td>
      <td title="${data.reportfilename}">${data.reportfilename}</td>
      <td title="${data.createperson}">${data.createperson}</td>
      <td title="${data.createdate}">${data.createdate}</td>
    </tr>
  {@/each}
</textarea>
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">


        <div class="jbolt_table_toolbar" id="warehousebeginform_toolbar_#(pageId)">
          <div class="col-md-4">
            <div class="form-group row">
              <div class="btn-group dropdown" role="group" aria-label="btn-group" data-require-plugin="hiprint">
                <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" id="print" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> 打印</button>
                <div class="dropdown-menu" aria-labelledby="exportMenuButton">
                  <button class="btn dropdown-item" data-usecheckedids="true" data-check-handler="jboltTableGetCheckedIds" onclick="containerPrint('check')"><i class="fa fa-download"></i> 打印勾选行</button>
                  <button class="btn dropdown-item" onclick="containerPrint('page')"><i class="fa fa-download"></i> 打印当前页</button>
                </div>
              </div>
              <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
                <button onclick="detailJboltTableRemoveCheckedRow(this, true)" class="btn btn-success btn-sm">
                  删除
                </button>
              </div>
              <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
                <button onclick="closeHandler()" class="btn btn-info btn-sm">
                  关闭
                </button>
              </div>

            </div>
          </div>
        </div>
        <table class="jbolt_table jbolt_main_table  table-center"
               id="warehousebeginform_TableId_#(pageId)"
               data-jbolttable
               data-ajax="true"
               data-url="admin/warehousebeginofperiod/detailDatas?masid=#(barcodemaster.AutoID??)"
               data-height="300"
               data-column-resize="true"
               data-conditions-form="warehousebeginformtable_form_#(pageId)"
               data-page="warehousebeginform_page_#(pageId)"
               data-column-prepend="1:checkbox:true"
               data-rowtpl="warehousebeginForm_tpl_#(pageId)"
               data-toolbar="warehousebeginform_toolbar_#(pageId)"
               data-toolbar="warehousebeginform_toolbar_#(pageId)">
          <thead>
          <tr>
            <th data-width="30px">序号</th>
            <th data-width="150" data-column="state">状态</th>
            <th data-width="150" data-column="sourcebilltype">来源类型</th>
            <th data-width="150" data-column="invcode">存货编码</th>
            <th data-width="180" data-column="cinvcode1">客户部番</th>
            <th data-width="180" data-column="cinvname1">部品名称</th>
            <th data-width="150" data-column="cinvstd">规格</th>
            <th data-width="120" data-column="cuomname">主计量单位</th>
            <th data-width="150" data-column="vencode">供应商编码</th>
            <th data-width="150" data-column="cvenname">供应商名称</th>
            <th data-width="100" data-column="ipkgqty" title="包装数量">包装数量</th>
            <th data-width="150" data-column="barcode">条码号</th>
            <th data-width="100" data-column="qty">数量</th>
            <th data-width="150" data-column="batch">批次号</th>
            <th data-width="150" data-column="createdate">生产日期</th>
            <th data-width="180" data-column="reportfilename" title="标签打印模板">标签打印模板</th>
            <th data-width="120" data-column="createperson">创建人</th>
            <th data-width="150" data-column="createdate">创建时间</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>


#define js()
<script>
  hideParentLayerDialogBtn(0);
  hideParentLayerDialogBtn(1);

  /**
   * 打印
   * @param autoid
   */
  function containerPrint(mark) {
    let rows;
    if (mark == 'check') {
      rows = jboltTableGetCheckedDatas();
      if (rows == null) {
        return;
      }
    } else {
      rows = jboltTableGetAllDatas();
    }

    let code = [];
    let sn = "";
    for (let i in rows) {
      let rowdata = rows[i];
      sn = rowdata.sn;
      // var autoid = rowdata.masid;
      var autoid = rowdata.autoid;
      code.push(autoid);
    }
    jboltHiprintWebPrint(sn, 'url', 'admin/warehousebeginofperiod/detailPrintData?ids=' + code.join(",") + "&&mark=" + mark);
  }

  /**
   * 删除选中的行
   * @param ele
   * @param confirm
   * @param callback
   * @returns
   */
  function detailJboltTableRemoveCheckedRow(ele, confirm, callback) {
    var action = getRealJqueryObject(ele);
    if (isOk(action)) {
      var success = checkMasterTableId(action);
      if (!success) {
        return false;
      }
    }
    var isCheckedNone = jboltTableIsCheckedNone(ele);
    if (isCheckedNone) {
      LayerMsgBox.alert("请至少选择一行数据", 2);
    } else {
      var ids = jboltTableGetCheckedIds(ele, true);
      if (ids) {
        LayerMsgBox.confirm("所选数据中包含数据库已存数据，确定删除吗？",function(){
          let url = "admin/warehousebeginofperiod/deleteByIds?ids="+ids
          Ajax.get(url,function(res){
            //refreshJBoltTable("#jbolt_table_checkouttableparam_split_#(pageId)3");
            refreshPjaxContainer
            window.parent.refreshPjaxContainer();
          });
        });
      } else {
        removeJBoltTableCheckedTr(ele, confirm, callback);
      }
      return true;
    }
    return false;
  }

</script>
<!--#include("/_view/_admin/common/_formjs.html",formId="warehouseAreaForm")-->
#end

