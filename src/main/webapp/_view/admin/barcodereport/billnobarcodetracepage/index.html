#@jboltLayout()
#define main()
#set(pageId=RandomUtil.random(6))
<div class="jbolt_page" data-key="#(pmkey??)" data-require-plugin="hiprint">

<div class="jbolt_page_title">
	<div class="row">
	<div class="col-md-auto">
	<h1>客户传票汇总管理</h1>
	</div>
	<div class="col">
		<form class="form-inline" id="BillNoBarcodeTracePageForm_#(pageId)"   onsubmit="return false;" method="post">
			<input type="text" autocomplete="off" class="form-control" placeholder="=订单号=" name="billno"
				   value=""/>
			<input type="text" autocomplete="off" class="form-control" placeholder="=客户名称=" name="cusname"
				   value=""/>
			<input type="text" autocomplete="off" class="form-control" placeholder="=存货编码=" name="invcode"
				   value=""/>
			<input type="text" autocomplete="off" class="form-control" placeholder="=客户部番=" name="otherinvcode"
				   value=""/>
			<input type="text" autocomplete="off" class="form-control" placeholder="=部品名称=" name="otherinvname"
				   value=""/>
			<input type="text" autocomplete="off" class="form-control" placeholder="=传票号=" name="barcode"
				   value=""/>
			<select style="width:150px" class="form-control"
					data-autoload
					data-text="=状态="
					name="iorderstatus"
			>
				<option value="">=状态=</option>
				<option value="1">生成</option>
				<option value="2">出货准备</option>
				<option value="3">出货扫码</option>
				<option value="4">已出货</option>
				<option value="5">已核对</option>
				<option value="6">已失效</option>
			</select>
			<button  type="submit" class="btn btn-outline-secondary" ><i class="fa fa-search"></i> 查询</button>
			<button type="reset"  class="btn btn-outline-secondary"><i class="fa fa-reset"></i> 重置</button>
		</form>
	</div>
	<div class="col-md-auto">
	</div>
	</div>
</div>
<div class="jbolt_page_content">
<!-- JBoltTable的数据模板定义-->
<textarea class="jb_tpl_box" id="BillNoBarcodeTracePageRowtpl_#(pageId)">
{@each datas as data,index}
<tr data-id="${data.autoid}">
  <td>${pageNumber,pageSize,index | rownum}</td>
	<td>
	<a  tooltip    href="/admin/barcodeReport/BillNoBarcodeTracePage/details?barcode=${data.barcode}" data-area="100%,100%"  class="jbolt_table_editbtn">变更记录</a>
	</td>

	<td>${data.billstate}</td> <!--最新状态-->
	<td>${data.billno}</td> <!--单据单号-->
	<td>${data.cscode}</td> <!--客户编码-->
	<td>${data.cusname}</td> <!--客户名称-->
	<td>${data.invcode}</td> <!--存货编码-->
	<td>${data.otherinvcode}</td> <!--客户部番-->
	<td>${data.otherinvname}</td> <!--部品名称-->
	<td>${data.invstd}</td> <!--规格-->
	<td>${data.poscode}</td> <!--主记录单位编码-->
	<td>${data.barcode}</td> <!--现品票条码-->
	<td >${data.version}</td> <!--版本号-->
	<td>${data.qty}</td> <!--数量-->
	<td>${data.scheduledate}</td> <!--计划到货日期-->
	<td>${data.pickupdate}</td> <!--取货计划日期-->
	<td>${data.shipmentdate}</td> <!--出货扫描日期-->
	<td>${data.checkdate}</td> <!--货款核对日期-->
	<td>${data.createdate}</td> <!--创建日期-->

	<td hidden>${data.posname}</td> <!--主记录单位名称-->
	<td hidden>${data.whcode}</td> <!--仓库编码-->
	<td hidden>${data.poscode}</td> <!--库区编码-->
	<td hidden>${data.batch}</td> <!--批次号-->
	<td hidden>${data.whname}</td> <!--仓库名称-->
	<td hidden>${data.posname}</td> <!--库区名称-->
</tr>
{@/each}
</textarea>

	<!-- 工具条 toolbar -->
	<div class="jbolt_table_toolbar" id="BillNoBarcodeTracePage_toolbar_#(pageId)">
		<div class="col-sm-auto" role="group" aria-label="btn-group">
			<div class="btn-group dropdown" role="group" aria-label="btn-group">
				<div class="btn-group dropdown ">
					<button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" id="exportContainerButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> 数据导出</button>
					<div class="dropdown-menu" aria-labelledby="exportContainerButton">
						<button class="btn dropdown-item" data-usecheckedids="true" data-downloadbtn data-url="/admin/barcodeReport/InventoryBarcodeTracePage/downloadChecked"><i class="fa fa-download"></i> 导出选中</button>
						<button class="btn dropdown-item" data-downloadbtn data-url="/admin/barcodeReport/InventoryBarcodeTracePage/downloadChecked" data-form="Container_form_#(pageId)"><i class="fa fa-download"></i> 条件导出</button>
					</div>
				</div>
			</div>
			<div class="btn-group dropdown" role="group" aria-label="btn-group" data-require-plugin="hiprint">
				<button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" id="print" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">打印</button>
				<div class="dropdown-menu" aria-labelledby="exportMenuButton">
					<button class="btn dropdown-item" data-usecheckedids="true" data-check-handler="jboltTableGetCheckedIds" onclick="containerPrint_#(pageId)('check')"><i class="fa fa-download"></i> 打印勾选行</button>
					<button class="btn dropdown-item" onclick="containerPrint_#(pageId)('page')"><i class="fa fa-download"></i> 打印当前页</button>
				</div>
			</div>
		</div>


		<div class="clearfix"></div>
	</div>




	<table class="jbolt_table jbolt_main_table table-center"
		   data-jbolttable
		   data-autoload="false"
		   data-height="fill"
		   data-ajax="true"
		   data-width="auto"
		   data-url="admin/barcodeReport/BillNoBarcodeTracePage/newdatas"
		   data-column-resize="true"
		   data-column-prepend="1:checkbox:true"
		   data-conditions-form="BillNoBarcodeTracePageForm_#(pageId)"
		   data-rowtpl="BillNoBarcodeTracePageRowtpl_#(pageId)"
		   data-page="BillNoBarcodeTracePage_toolbar_#(pageId)"

		   data-pagesize="100"
		   data-pagesize-options="5,10,15,20,30,40,50,100,500,1000"
		   data-fixed-columns-left="1,2,3"
		   data-fixed-columns-right="-1"
	>
<thead>
<tr>
	<th data-width="60" data-column="index">序号</th>
	<th data-width="150" data-column="AutoID">操作</th>
	<th data-width="150" data-column="billstate">最新状态</th>
	<th data-width="150" data-column="billno">订单号</th>
	<th data-width="150" data-column="cscode">客户编码</th>
	<th data-width="150" data-column="cusname">客户名称</th>
	<th data-width="100" data-column="invcode">存货编码</th>
	<th data-width="100" data-column="otherinvcode">客户部番</th>
	<th data-width="100" data-column="otherinvname">部品名称</th>
	<th data-width="150" data-column="invstd">规格</th>
	<th data-width="120" data-column="poscode">主计量单位</th>
	<th data-width="100" data-column="barcode">现品票</th>
	<th data-width="100" data-column="version">版本号</th>
	<th data-width="100" data-column="qty">数量</th>
	<th data-width="100" data-column="scheduledate">计划到货日期</th>
	<th data-width="100" data-column="pickupdate">取货计划日期</th>
	<th data-width="100" data-column="shipmentdate">出货扫描日期</th>
	<th data-width="100" data-column="checkdate">货款核对日期</th>
	<th data-width="100" data-column="createdate">创建日期</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
#end

#define js()
<script type="text/javascript">
	// 打印
	function containerPrint_#(pageId)(mark) {
		let rows;
		if (mark == 'check') {
			rows = jboltTableGetCheckedDatas();
			if (rows == null) {
				return;
			}
		} else {
			rows = jboltTableGetAllDatas();
		}

		let code = [];
		var k=0;
		for (let i in rows) {
			k++;
			let rowdata = rows[i];
			var ccode = rowdata.barcode;
			var istatus = rowdata.istatus;
			var cdocno = rowdata.cdocno;
			if (ccode == null){
				LayerMsgBox.error("第"+k+"行["+cdocno+"]异常单,请审核再打印！！！",3000);
				return false;
			}
			code.push(ccode);
		}
		jboltHiprintWebPrint('109607', 'url', 'admin/barcodeReport/BillNoBarcodeTracePage/PrintData?ids=' + code.join(",") + "&&mark=" + mark);
	}
</script>
#end
