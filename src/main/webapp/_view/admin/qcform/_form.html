#set(pageId=RandomUtil.random(6))
<form onsubmit="return false;" id="QcFormForm" action="#(action)" method="post">
    #if(qcForm.iAutoId??)
    <input type="hidden" id="qcFormiAutoId_#(pageId)" name="qcForm.iAutoId" value="#(qcForm.iAutoId??)"/>
    #end
    <div class="row">
        <div class="col">
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">检验表格名称</label>
                <div class="col-10">
                    <input type="text" data-rule="required" data-notnull="true" data-tips="请输入检验表格名称"
                           data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入检验表格名称"
                           maxlength="40" name="qcForm.cQcFormName" value="#(qcForm.cQcFormName??)"/>
                </div>
            </div>

            <!-- 检验表格项目表的的数据模板定义-->
            <script type="text/template" id="dictionaryType_tpl_#(pageId)">
                {@each datas as data,index}
                <tr data-id="${data.iautoid}" class="hand" data-changed="">
                    {@if pageSize&&pageSize>0}
                    <td>${((pageNumber-1)*pageSize)+(+index+1)}</td>
                    {@else}
                    <td>${+index+1}</td>
                    {@/if}
                    <td>${data.cqcformname}</td>
                    <td style="display: none">${data.iqcitemid}</td>
                    <td data-editable="false">${data.cqcitemname}</td>
                    <td>
                        <a href="/admin/qcform/qcformitem/up/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="上移" data-handler="moveUp"   class="jbolt_table_btn"><i class="fa fa-arrow-up c-info"></i></a>
                        <a href="/admin/qcform/qcformitem/down/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="下移" data-handler="moveDown"  class="jbolt_table_btn"><i class="fa fa-arrow-down c-info"></i></a>
                        <a href="/admin/qcform/qcformitem/deletes/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="删除" data-handler="removeTr" data-confirm="确定删除这个顶部导航？" class="jbolt_table_delbtn"><i class="fa fa-remove  c-danger"></i></a>
                    </td>
                </tr>
                {@/each}
            </script>
            <!-- 检验表格参数表的的数据模板定义-->
            <script type="text/template" id="QcFormParamSplit_tpl_#(pageId)" >
                {@each items as son}
                ${son,typeLevel|getDictionaryTypeLevel}
                {@include "#QcFormParamSplit_tpl_#(pageId)",son}
                {@/each}
                {@each datas as data,index}
                <tr data-id="${data.iautoid}">
                    {@if pageSize&&pageSize>0}
                    <td>${((pageNumber-1)*pageSize)+(+index+1)}</td>
                    {@else}
                    <td>${+index+1}</td>
                    {@/if}
                    <td data-editable="false">${data.cqcitemnames}</td>
                    <td>${data.cqcparamnames}</td>
                    <td style="display: none">${data.iqcformitemid}</td>
                    <td style="display: none">${data.iqcparamid}</td>
                    <td style="display: none">${data.iitemseq}</td>
                    <td>
                        <a href="/admin/qcform/qcformparam/up/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="上移" data-handler="moveUp"   class="jbolt_table_btn"><i class="fa fa-arrow-up c-info"></i></a>
                        <a href="/admin/qcform/qcformparam/down/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="下移" data-handler="moveDown"  class="jbolt_table_btn"><i class="fa fa-arrow-down c-info"></i></a>
                        <a href="/admin/qcform/qcformparam/deletes/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="删除" data-handler="removeTr" data-confirm="确定删除这个顶部导航？" class="jbolt_table_delbtn"><i class="fa fa-remove  c-danger"></i></a>
                    </td>
                </tr>
                {@/each}
            </script>


            <!-- 检验表格项目表的的数据模板定义-->
            <script type="text/template" id="QcFormTableParam_tpl_#(pageId)">
                {@each datas as data,index}
                <tr data-id="${data.iautoid}" class="hand" data-changed="">
                    {@if pageSize&&pageSize>0}
                    <td>${((pageNumber-1)*pageSize)+(+index+1)}</td>
                    {@else}
                    <td>${+index+1}</td>
                    {@/if}
<!--                    #for(data:rowTwoList)-->
<!--                    <td>-->
<!--                        #(data.cqcparamname??)-->
<!--                    </td>-->
<!--                    #end-->
                    <td>${data.cqcparamname}</td>
                    <td>
                        <input type="text"
                               style="height: 30px; font-size: 12px;"
                               data-autocomplete
                               data-url="/admin/qcform/customerList?iQcFormId=#(qcForm.iAutoId??)&is=${data.cqcparamname}"
                               data-header="名称"
                               data-column-attr="cqcparamname"
                               data-text-attr="cqcparamname"
                               data-value-attr="cqcparamname"
                               data-rule="required"
                               data-notnull="true"
                               autocomplete="off" class="form-control" maxlength="30"/>
                    </td>
<!--                    <td>${data.itype}</td>-->
<!--                    <td>${data.istdval}</td>-->
<!--                    <td>${data.imaxval}</td>-->
<!--                    <td>${data.iminval}</td>-->
<!--                    <td>${data.coptions}</td>-->
<!--                    <td>-->
<!--                        <a href="/admin/qcform/qcformitem/up/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="上移" data-handler="moveUp"   class="jbolt_table_btn"><i class="fa fa-arrow-up c-info"></i></a>-->
<!--                        <a href="/admin/qcform/qcformitem/down/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="下移" data-handler="moveDown"  class="jbolt_table_btn"><i class="fa fa-arrow-down c-info"></i></a>-->
<!--                        <a href="/admin/qcform/qcformitem/deletes/${data.iautoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="删除" data-handler="removeTr" data-confirm="确定删除这个顶部导航？" class="jbolt_table_delbtn"><i class="fa fa-remove  c-danger"></i></a>-->
<!--                    </td>-->
                </tr>
                {@/each}
            </script>





            <!-- 检验表格项目表的的form数据定义-->
            <div class="card">
                <div class="card-header py-2">
                    <div class="row">
                        <div class="col pt-2"><label>数据分类</label></div>
                        <div class="col-md-auto">
                            <form id="qcformitemTypeForm_#(pageId)" class="form-inline" onsubmit="return false;">
                                <!-- 工具条 toolbar -->
                                <div class="jbolt_table_toolbar" id="bomcompare_split_toolbar_#(pageId)">

                                    <div class="col-md-l pt-2" role="group" aria-label="btn-group">
                                        <button onclick="addBomcompareTr(this)" class="btn btn-primary btn-sm"><i
                                                class="fa fa-plus"></i> 新增
                                        </button>
                                        <button onclick="QcFormItemsubmit(this)" class="btn btn-primary btn-sm" ><i class="fa fa-save"></i> 保存</button>

                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card-body overflow-auto" style="height: calc(100vh - #(jboltLayerTop+32+32+42+60)px);">
                    <table id="jbolt_table_QcFormItem_split" class="table-center jbolt_table thead_font_normal dictionaryTypes" data-jbolttable data-column-resize="true" data-height="fill_box"
                           data-rowtpl="dictionaryType_tpl_#(pageId)"
                           data-ajax="true"
                           data-url="/admin/qcform/getItemCombinedListByPId?iQcFormId=#(qcForm.iAutoId??)"
                           data-conditions-form="qcformitemTypeForm_#(pageId)"
                           data-page="dictionary_type_page_#(pageId)"
                           data-toolbar="bomcompare_split_toolbar_#(pageId)"
                           data-page-mini="true"
                           data-pagesize="15"
                           data-row-click-handler="readqcformparams"
                           data-row-click-active="true"
                           data-fixed-columns-left="1"
                           data-fixed-columns-right="-1,-2"
                           data-ajax-success-handler="clearDicTable_#(pageId)"
                           data-width="auto"
                           data-editable="true"
                           data-editable-option="getQcFormItemTableOptions_split"
                    >
                        <thead>
                        <tr>
                            <th data-width="60" data-column="index">项次</th>
                            <th data-width="100" data-column="cqcformname">检验表格</th>
                            <th data-width="100" data-column="iqcitemid" style="display: none">检验项目id</th>
                            <th data-width="100" data-column="cqcitemname">检验项目</th>
                            <th data-width="100">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 检验表格参数表的的form数据定义-->
            <div class="card">
                <div class="card-header py-2">
                    <div class="row">
                        <div class="col-md-auto">
                            <form style="display:none;" id="dictionaryForm_#(pageId)" class="form-inline" onsubmit="return false;">
                                <input  type="hidden" name="typeId" id="dicTypeId_#(pageId)" value="#(typeId??)"/>
                                <div style="display:none;" class="col-md-l  pt-2"  id="dicOptBtns_#(pageId)">
                                    <button data-link-para-ele="#dicTypeId_#(pageId)" onclick="addparam(this)" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> 新增</button>
                                    <button onclick="QcFormParamsubmit(this)" class="btn btn-primary btn-sm" ><i class="fa fa-save"></i> 保存</button>

                                </div></form>
                        </div>

                        <div class="col pt-2"><label>数据项 :<span id="selectDicTypeName" class="text-danger">未选</span></label></div>

                    </div>
                </div>
                <div class="card-body overflow-auto" style="height: calc(100vh - #(jboltLayerTop+32+32+42+60)px);">
                    <table id="jbolt_table_qcformparam_split" class="jbolt_table thead_font_normal dictionaryTypes" data-jbolttable data-column-resize="true" data-height="fill_box"
                           data-rowtpl="QcFormParamSplit_tpl_#(pageId)"
                           data-ajax="true"
                           data-conditions-form="dictionaryForm_#(pageId)"
                           data-treetable="all:1"
                           data-width="auto"
                           data-toolbar="bomcompare_splits_toolbar_#(pageId)"
                           data-url="/admin/qcform/getQcFormParamListByPId?iQcFormId=#(qcForm.iAutoId??)"
                           data-editable="true"
                           data-editable-option="getQcFormParamTableOptions_split"
                           data-bind-elements="#jboltTableAddBtn1_ajax_#(pageId)"
                    >
                        <thead>
                        <tr>
                            <th data-width="60" data-column="index">项次</th>
                            <th data-width="100" data-column="cqcitemnames">参数名称</th>
                            <th data-width="100" data-column="cqcparamnames">参数项目名称</th>
                            <th data-width="180">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 检验表格项目表的的form数据定义-->
            <div class="card">
                <div class="card-header py-2">
                    <div class="row">
                        <div class="col pt-2"><label>数据分类</label></div>
                        <div class="col-md-auto">
                            <form id="qcformtableparamForm_#(pageId)" class="form-inline" onsubmit="return false;">
                                <!-- 工具条 toolbar -->
                                <div class="jbolt_table_toolbar" id="qcformtableparam_split_toolbar_#(pageId)">
                                    <div class="col-md-l pt-2" role="group" aria-label="btn-group">
                                        <button onclick="addBomcompareTr(this)" class="btn btn-primary btn-sm"><i
                                                class="fa fa-plus"></i> 新增
                                        </button>
                                        <button onclick="QcFormItemsubmit(this)" class="btn btn-primary btn-sm" ><i class="fa fa-save"></i> 保存</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card-body overflow-auto" style="height: calc(100vh - #(jboltLayerTop+32+32+42+60)px);">
                    <table id="jbolt_table_qcformtableparam_split" class="table-center jbolt_table thead_font_normal dictionaryTypes" data-jbolttable data-column-resize="true" data-height="fill_box"
                           data-rowtpl="QcFormTableParam_tpl_#(pageId)"
                           data-ajax="true"
                           data-url="/admin/qcform/getQcFormTableParamListByPId?iQcFormId=#(qcForm.iAutoId??)"
                           data-page="dictionary_type_page_#(pageId)"
                           data-toolbar="qcformtableparam_split_toolbar_#(pageId)"
                           data-page-mini="true"
                           data-row-click-handler="readqcformparams"
                           data-row-click-active="true"
                           data-ajax-success-handler="clearDicTable_#(pageId)"
                           data-width="auto"
                           data-editable="true"
                           data-editable-option="getqcformtableparamTableOptions_split"
                    >
                        <thead>
                        <tr>
                            <th data-width="60" data-column="index">项次</th>
                            #for(data:rowOneList)
                            <th colspan="#(data.cn??)" data-width="300" data-column="#(data.pcname??)">
                                #(data.pcname??)
                            </th>
                            #end
                            <th data-width="120" data-column="iType">参数录入方式</th>
                            <th data-width="120" data-column="iStdVal">标准值</th>
                            <th data-width="120" data-column="iMaxVal">最大设定值</th>
                            <th data-width="120" data-column="iMinVal">最小设定值</th>
                            <th data-width="120" data-column="cOptions">列表可选值</th>
                            <th data-width="100">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>





           <div class="form-group row"
                 data-radio
                 data-name="qcForm.isEnabled"
                 data-value-attr="sn"
                 data-default="options_first"
                 data-url="admin/dictionary/options?key=options_enable"
                 data-label="是否启用"
                 data-width="col-sm-2,col-10"
                 data-value="#(qcForm.isEnabled??)"
                 data-rule="radio"
                 data-notnull="true"
                 data-tips="请输入删除状态：0. 未删除 1. 已删除"
                 data-inline="true"
            >
            </div>

        </div>
    </div>
</form>
#define js()
<script>

    // <!--	隐藏一个不需要的按钮-->
    hideParentLayerDialogBtn(0);

    //检验表格项目保存
    function QcFormItemsubmit() {
        jboltTableSubmit('#jbolt_table_QcFormItem_split');
    }
    //检验表格参数保存
    function QcFormParamsubmit() {
        jboltTableSubmit('#jbolt_table_qcformparam_split');
    }
    /**
     * 关闭弹窗
     * */
    function dialogClose() {
        parent.layer.close(parent.layer.getFrameIndex(window.name));
    }

    //绑定检验表格参数和检验表格项目关联
    function clearDicTable_#(pageId)(){
        $("#selectDicTypeName").text("未选");
        $("#dicTypeId_#(pageId)").val("");
        $("#dicKeywords_#(pageId)").val("");
        $("#dictionaryForm_#(pageId)").hide();
        $("#dicOptBtns_#(pageId)").hide();
        $("#expandCollapseOpt_#(pageId)").hide();
        refreshJBoltTable("jbolt_table_qcformparam_split");
    }
    function readqcformparams(table,tr,typeId,jsonData) {
        $("#selectDicTypeName").text(jsonData.cqcitemname);
        $("#dicTypeId_#(pageId)").val(jsonData.iautoid);
        $("#dicKeywords_#(pageId)").val("");
        $("#dictionaryForm_#(pageId)").show();
        $("#dicOptBtns_#(pageId)").show();
        $("#mian").text(jsonData.cqcitemname);
        if(jsonData.modeLevel==2){
            $("#expandCollapseOpt_#(pageId)").show();
        }else{
            $("#expandCollapseOpt_#(pageId)").hide();
        }
        refreshJBoltTable("jbolt_table_qcformparam_split");
    }

    //检验表格项目新增
    function addBomcompareTr(ele) {
        const dataList = jboltTableGetAllDatas('#jbolt_table_QcFormItem_split', ['iqcitemid']);
        let FormItemCodes = '';
        if(isOk(dataList)){
            dataList.forEach((value,index)=>{
                FormItemCodes = FormItemCodes.concat(",").concat(value.iqcitemid);
            })
        }
        if(isOk(FormItemCodes)){
            FormItemCodes = FormItemCodes.concat(",");
        }
        const url = "/admin/qcform/qcformitem/qcFormItemDatas?type=1&FormItemCodes=" + FormItemCodes;
        $(ele).data("url", url);
        DialogUtil.openBy(ele);
    }
    //检验表格项目提交
    function getQcFormItemTableOptions_split(){
        return {
            trigger: "click",
            // insertDefaultValues: {username: '#(JBoltUserKit.getUserName())'},
            submit: {
                withForm: ["QcFormForm"],
                type: "all",
                url: "/admin/qcform/submitByJBoltTable",
                success: function (res, table, td) {
                    if (res.state === 'ok') {
                        LayerMsgBox.success(res.msg, 1000, function () {
                            refreshPjaxContainer();
                            parent.LayerMsgBox.closeAll();
                            parent.refreshPjaxContainer();
                        });
                    } else {
                        LayerMsgBox.alert(res.msg, 2);
                    }
                }
            },
            cols: {
                index: {
                    submitAttr:"iseq",
                },
                iqcitemid: {
                    submitAttr:"iqcitemid",
                },
                cqcitemname: {
                    submitAttr:"cqcitemname",
                    type: "input",
                },

            }
        };
    }

    //检验表格参数新增
    function addparam(ele) {
        const dataList = jboltTableGetAllDatas('#jbolt_table_qcformparam_split', ['iqcparamid']);
        let FormItemCodes = '';
        if(isOk(dataList)){
            dataList.forEach((value,index)=>{
                FormItemCodes = FormItemCodes.concat(",").concat(value.iqcparamid);
            })
        }
        if(isOk(FormItemCodes)){
            FormItemCodes = FormItemCodes.concat(",");
        }
        const url = "/admin/qcform/qcformparam/qcformparamDatas?type=2&FormItemCodes=" + FormItemCodes;
        $(ele).data("url", url);
        DialogUtil.openBy(ele);
    }

    //检验表格参数提交
    function getQcFormParamTableOptions_split(){
        return {
            trigger: "click",
            // insertDefaultValues: {username: '#(JBoltUserKit.getUserName())'},
            submit: {
                withForm: ["QcFormForm"],
                type: "all",
                url: "/admin/qcform/QcFormParamJBoltTable",
                success: function (res, table, td) {
                    if (res.state === 'ok') {
                        LayerMsgBox.success(res.msg, 1000, function () {
                            window.location.reload();
                            parent.refreshPjaxContainer();
                            // parent.layer.close(parent.layer.getFrameIndex(window.name));
                        });
                    } else {
                        LayerMsgBox.alert(res.msg, 2);
                    }
                }
            },
            cols: {
                iautoid: {
                    submitAttr: "iautoid",
                },
                iqcformid: {
                    submitAttr:"iqcformitemid",
                },
                cqcitemnames: {
                    submitAttr:"cqcitemnames",
                    type: "input"
                },
                iqcparamid: {
                    submitAttr:"iqcparamid",
                },
                cqcparamnames: {
                    submitAttr:"cqcparamnames",
                },
                iitemseq: {
                    submitAttr:"iitemseq",
                    type: "input"
                },

            }
        };
    }

    //检验表格录入方式提交
    function getqcformtableparamTableOptions_split() {
        var editableTableOptions = {
            trigger: "click",
            submit: {
                withForm: ["QcFormForm"],
                type: "all",
                url: "/admin/qcform/QcFormTableParamJBoltTable",
                success: function (res, table, td) {
                    if (res.state === 'ok') {
                        LayerMsgBox.success(res.msg, 1000, function () {
                            parent.LayerMsgBox.closeAll();
                            parent.refreshPjaxContainer();
                        });
                    } else {
                        LayerMsgBox.alert(res.msg, 2);
                    }
                }
            },
            cols: {
                iType: {
                    submitAttr: "itype",
                },
                iStdVal: {
                    submitAttr:"istdval",
                },
                iMaxVal: {
                    submitAttr:"imaxval",
                    type: "input"
                },
                iMinVal: {
                    submitAttr:"iminval",
                    type: "input"
                },
                cOptions: {
                    submitAttr:"coptions",
                    type: "input"
                },


            }


        };
        return editableTableOptions;
    }


</script>

#end

