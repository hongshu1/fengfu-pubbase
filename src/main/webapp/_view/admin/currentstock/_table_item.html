<div class="row">
    <div class="col-12">
           <textarea class="jb_tpl_box" id="positionSplit_tpl_#(pageId)">
            {@each datas as data,index}
                <tr data-id="${data.iautoid}">
                    <td>${pageNumber,pageSize,index | rownum}</td>
                    <td>${data.poscode}</td>
                    <td>${data.posname}</td>
                    <td>${data.whcode}</td>
                    <td>${data.whname}</td>
                    <td>${data.invcode}</td>
                    <td>${data.invname}</td>
                    <td>${data.qty}</td>
                    <td>${data.num}</td>
                </tr>
            {@/each}
            </textarea>
        <div class="card">
            <div class="card-body">
                <!-- 工具条 toolbar -->
                <div class="jbolt_table_toolbar" id="position_split_toolbar_#(pageId)">
                    <div class="btn-group" role="group" aria-label="btn-group">
                        <button onclick="addTr(this)" data-area="100%,90%"  class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> 新增</button>

                        <button onclick="jboltTableRemoveCheckedRow(this, true)" class="btn btn-danger btn-sm"><i
                                class="fa fa-trash"></i> 删除
                        </button>

                    </div>
                    <div class="clearfix"></div>
                </div>

                <table class="jbolt_table jbolt_main_table  table-center"
                       id="jbolt_table_position_split"
                       data-jbolttable
                       data-width="auto"
                       data-height="600"
                       data-column-prepend="1:checkbox:true"
                       data-toolbar="position_split_toolbar_#(pageId)"
                       data-rowtpl="positionSplit_tpl_#(pageId)"
                       data-column-resize="true"
                       data-editable="true"
                       data-editable-option="getEditableTableOptions"
                >
                    <thead>
                    <tr>
                        <th data-width="60" data-column="index">序号</th>
                        <th data-width="150"  data-column="poscode">库位编码</th>
                        <th data-width="150"  data-column="posname">库位名称</th>
                        <th data-width="150"  data-column="whcode">仓库编码</th>
                        <th data-width="150"  data-column="whname">仓库名称</th>
                        <th data-width="150" data-column="invcode">存货编码</th>
                        <th data-width="150" data-column="invname">存货名称</th>
                        <th data-width="150" data-column="qty">账面数量</th>
                        <th data-width="150" data-column="num">账面件数</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    function addTr(ele) {
        var poscode=$("#poscode").val();
        var whcode=$("#whcode").val();

        var url="admin/currentstock/CurrentStockBySelect?whcode="+whcode+"&poscode="+poscode;
        $(ele).data("url",url);
        DialogUtil.openBy(ele);
    }
    function refreshMoPlanNo() {
        const dataList = jboltTableGetAllDatas('#jbolt_table_position_split'['index']);
        const table = getRealJboltTableByEle('#jbolt_table_position_split');
        if (isOk(dataList)) {
            Ajax.get("admin/moplanm/getMoPlanNo?count=" + dataList.length, function (res) {
                dataList.forEach((value, index) => {
                    const $tr = $('#jbolt_table_position_split').find("tbody>tr[data-index='" + index + "']");
                    jboltTableSetCell(table, $tr, "cmoplanno", res.data[index], res.data[index]);
                })
            });
        }
    }

    function uploadFiles(fileInput, type, btn, res) {
        if (res.state === "ok") {
            jboltTableInsertRow("#jbolt_table_position_split", res.data.dataSource, false, false, true)
            if (isOk(res.data.errorMsg)) {
                document.getElementById("msg").style.display = "";
                $("#errorMsg").text(res.data.errorMsg)
            } else {
                document.getElementById("msg").style.display = "none";
                $("#errorMsg").text("")
            }
        }
    }

    function getEditableTableOptions() {
        return {
            trigger: "click",
            initRowCount: 0,
            maxRowCount: 3000,
            keepCellStyleCols: [1, 2, 3, "total", "enable"],//不可填 但是也不需要设置不可填样式的列
            submit: {
                withForm: ["plMoplanmForm"],
                type: "all",
                url: "admin/currentstock/jboltTableSubmit",
                success: function (res) {
                    if (res.state === "ok") {
                        LayerMsgBox.success(res.msg, 1000, function () {
                            refreshPjaxContainer();
                            parent.LayerMsgBox.closeAll();
                            parent.refreshPjaxContainer();
                        });
                    } else {
                        LayerMsgBox.alert(res.msg, 2);
                    }
                },
            },
            cols: {
                iautoid: {
                    submitAttr: "iautoid",
                },
                cmoplanno: {
                    type: 'input',
                    readOnly: true
                },
                iitemid: {
                    type: 'input',
                    readOnly: true
                },
                dplandate: {
                    submitAttr: "dplandate",
                    type: "date",
                    required: true
                },
                citemcode: {
                    type: "dialogbtn",
                    placeholder: "选择料品",
                    dialog: {
                        url: "admin/itemroutinginvc/item_dialog_index?masterautoid=#(masterautoid)",
                        area: "85%,95%",
                        title: "选择料品",
                        btn: "确定,关闭"
                    },
                    header: "子件品名,别名,规格,生产单位,生产单位",
                    columnAttr: "iautoid,citemname,caliasname,cspecs,imanufactureuom,imanufactureuom",
                    changeColumns: [
                        {column: "iitemid", use: "iautoid"},
                        {column: "citemname", use: "citemname"},
                        {column: "caliasname", use: "caliasname"},
                        {column: "cspecs", use: "cspecs"},
                        {column: "imanufactureuom", use: "imanufactureuom"},
                        {column: "imanufactureuom", use: "imanufactureuom"}],
                },
                iplanqty: {type: "input_number", rule: "number", required: true, placeholder: "0", min: "1"}
            }
        };
    }

</script>