#set(pageId=RandomUtil.random(6))
<div class="jbolt_page_title">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="col">
                        <button onclick="submitThisForm()" class="btn btn-success btn-sm" onclick="submitThisForm()"><i
                                class="fa fa-refresh"></i> 保存</button>
                        <button onclick="closeHandler()" class="btn btn-info btn-sm"><i
                                class="fa fa-window-maximize"></i> 关闭
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form onsubmit="return false;" id="sysscandeliver_#(pageId)" action="#(action)" method="post">
                        #if(sysscandeliver.autoid??)
                        <input type="hidden" name="sysscandeliver.autoid" value="#(sysscandeliver.autoid??)" />
                        #end
                        <div class="row">

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">客户名称</label>
                                    <div class="col-9">
                                        <input id="versionCusName" style="width: 100%" data-width="300" type="text"
                                               data-autocomplete data-url="/admin/scanCodeShipment/getCustomer"
                                               data-hiddeninput="versionCusCode" class="form-control"
                                               data-handler=""
                                               value="#(sysscandeliver.cusname??)"
                                               placeholder="请选择客户" data-tips="请选择客户" maxlength="40">

                                        <input type="hidden" class="form-control" id="versionCusCode"
                                               name="sysscandeliver.cuscode"
                                               placeholder="客户编码"
                                               data-value-attr="cuscode"
                                               value="#(sysscandeliver.cuscode??)"/>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">客户位置</label>
                                    <div class="col-9">
                                        <div class="input-group-append">
                                    <input type="text" data-notnull="true"
                                           class="form-control"
                                           placeholder="请选择客户位置" maxlength="40" name="sysscandeliver.receiveaddress"
                                           value="#(sysscandeliver.receiveaddress??)" />
                                    <button class="btn btn-primary" data-dialogbtn data-link-para-ele="#versionCusCode"
                                            data-area="80%,80%" data-title="选择数据（单选）"
                                            data-url="/admin/scanCodeShipment/getCusAddress"><i
                                            class="fa fa-search mr-1"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">仓库名称</label>
                                    <div class="col-9">
                                        <input type="hidden" name="sysscandeliver.whcode"
                                               value="#(sysscandeliver.whcode??)"/>
                                        <input type="text" data-notnull="true" data-tips="仓库名称"
                                               readonly="readonly" class="form-control"
                                                placeholder="仓库名称"
                                               value="#(sysscandeliver.whname??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">订单号</label>
                                    <div class="col-9">
                                        <div class="input-group-append">
                                            <input type="hidden" id="SourceBillID" class="form-control"
                                                   name="sysscandeliver.sourcebillid" placeholder="来源ID"
                                                   value="#(sysscandeliver.sourcebillid??)" />
                                            <input type="text" id="sourceBillNo"
                                                   class="form-control"
                                                   placeholder="请选择订单号"
                                                   maxlength="40" name="sysscandeliver.sourcebillno"
                                                   value="#(sysscandeliver.sourcebillno??)" />
                                            <button class="btn btn-primary" data-dialogbtn data-link-para-ele=""
                                                    data-area="80%,80%" data-title="选择数据（单选）" id="billButton"
                                                    data-url="/admin/scanCodeShipment/orderData"><i
                                                    class="fa fa-search mr-1"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">日期</label>
                                    <div class="col-9">
                                        <input type="text" data-date data-type="date"
                                               data-fmt="yyyy-MM-dd"
                                               class="form-control" placeholder="请设置日期"
                                               maxlength="10" name="sysscandeliver.billdate"
                                               value="#date(DateUtil.toDate(sysscandeliver.billdate??DateUtil.getNow()),'yyyy-MM-dd')">
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">备注</label>
                                    <div class="col-9">
                                        <input type="text"
                                                class="form-control"
                                                placeholder="请输备注" maxlength="40" name="sysscandeliver.memo"
                                               value="#(sysscandeliver.memo??)" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="jbolt_page_content">
    <script type="text/template" id="sysscandeliver_tpl_#(pageId)">
        {@each datas as data,index}
        <tr data-id="${data.autoid}">
            <td>${pageNumber,pageSize,index | rownum}</td>
            <td>
                <a href="admin/sysscandeliverdetail/delete/${data.autoid}" data-ajaxbtn data-loading="执行中 "
                tooltip data-title="删除" data-handler="refreshJBoltTable" data-confirm="确定删除此数据？"
                class="jbolt_table_delbtn"><i class="fa fa-remove c-danger">删除</i></a>

            </td>
            <!-- <td>${data.whcode}</td>
            <td>${data.whname}</td> -->
            <td>${data.cusbarcode}</td>
            <td>${data.barcode}</td>
            <td>${data.ccontainercode}</td>
            <td>${data.cinvcode}</td>
            <td>${data.cinvcode1}</td>
            <td>${data.cinvname1}</td>
            <td>${data.qty}</td>
            <td>${data.cinvstd}</td>
            <td>${data.inventorycuomname}</td>

        </tr>
        {@/each}
    </script>
    <div class="jbolt_table_toolbar" id="sysscandeliver_toolbar_#(pageId)" style="display: flex">

        <div class="clearfix">
            <form class="form-inline" id="sysscandeliver_detail_#(pageId)">

                <input type="text" autocomplete="off" class="form-control"  placeholder="现品票扫码" name="barcode"
                       value="" />
                <input type="text" autocomplete="off"  class="form-control"  placeholder="容器扫码" style="display: none"
                       name="storeNum"
                       id="storeNum"
                       value="" />
                <span style="padding: 0 12px 0 12px">
                开启容器扫码:
                <img data-switchbtn data-value="false" id="switchBtn" data-handler="switchFun"/>
                    </span>
                <button type="submit" class="btn btn-outline-secondary"><i class="fa fa-search"></i> 搜索</button>
            </form>
        </div>
        <div style="padding-left: 65%">
        <button onclick="jboltTableRemoveCheckedRow(this, true, false)" class="btn btn-outline-secondary"><i class="fa fa-trash"></i> 删除</button>
        </div>
        </div>
    </div>

<table  class="jbolt_table thead_font_normal table-bordered table-center"
        ### 可排序列 定义 多个用逗号隔开
        ### 启用动态调整列宽
        data-column-resize="true"
        ### 设置为异步加载数据
        data-ajax="true"
        data-ajax-success-handler=""
        ### 数据接口地址
        data-url="admin/sysscandeliverdetail/findEditTableDatas"
        data-conditions-form="sysscandeliver_detail_#(pageId)"
        ### 禁止回车键新增行
        data-auto-create-empty-tr="false"
        ### 加一列checkbox
        data-column-prepend="1:checkbox"
        data-tfoot-fixed="true"
        data-jbolttable
        id="jbolt_Table_#(pageId)"
        data-rowtpl="sysscandeliver_tpl_#(pageId)"
        data-toolbar="sysscandeliver_toolbar_#(pageId)"
        data-editable="true"
        data-page="sysscandeliver_tpl_#(pageId)"
        data-editable-option="getJBoltTableEditableColsOpton">
    <thead class="fw_normal">
    <tr>
        <th data-width="60">序号</th>
        <th data-width="150">操作</th>
        <!-- <th data-width="100" data-column="whcode">入库库区</th>
        <th data-width="100" data-column="whname">仓库名称</th> -->
        <th data-width="100" data-column="cusbarcode">客户传票号</th>
        <th data-width="100" data-column="barcode">现品票</th>
        <th data-width="100" data-column="ccontainercode">容器编码</th>
        <th data-width="100" data-column="cinvcode">存货编码</th>
        <th data-width="100" data-column="cinvcode1">客户部番</th>
        <th data-width="100" data-column="cinvname1">部品名称</th>
        <th data-width="100" data-column="qty">数量</th>
        <th data-width="100" data-column="cinvstd">规格型号</th>
        <th data-width="100" data-column="inventorycuomname">主计量单位</th>

    </tr>
    </thead>
</table>

</div>
#define js()
<script>
    /**
     * 开启容器扫码
     * @param ele
     */
    function switchFun(ele) {
        console.log('ele',ele.data("value"));
        let isOpen = ele.data("value");
        if (isOpen){
            $("#storeNum").show();
        } else {
            $("#storeNum").hide();
        }
    }
</script>
<script>
    hideParentLayerDialogBtn(0);
    hideParentLayerDialogBtn(1);
    function submitThisForm() {
        jboltTableSubmit("#jbolt_Table_#(pageId)");
    }

    function getJBoltTableEditableColsOpton() {
        var editableTableOptions = {

            submit: {
                withForm: ["sysscandeliver_#(pageId)"],
                name: 'sysscandeliver',
                type: "all",
                url: "/admin/scanCodeShipment/submitAll",
                success: function (res) {
                    LayerMsgBox.success("提交成功", 600, function () {
                        parent.refreshPjaxContainer();
                        parent.layer.closeAll();
                    });
                }
            },
            cols: {
                AutoID: {
                    submitAttr: "AutoID",
                },
                sourcebillno: {
                    type: "input",//类型
                    placeholder: "订单编号", //输入提示，里面
                    tooltip: "订单编号",//输入提示，上方
                },
                spotticket: {
                    type: "input",//类型
                    placeholder: "现品票", //输入提示，里面
                    tooltip: "现品票",//输入提示，上方
                },
                whcode: {
                    placeholder: "仓库", //输入提示，里面
                    tooltip: "仓库",//输入提示，上方
                    type: "autocomplete",
                    //目前供应商都是空的无法过滤

                    url: "admin/SysEnumeration/wareHouse",
                    maxLength: 100,
                    required: true,
                    placeholder: "请选择仓库编码",
                    textAttr: "whcode",
                    width: 500,
                    valueAttr: "whcode",//选择赋值的字段
                    columnAttr: "whcode,whname",//下来看的时候显示哪些字段
                    header: '仓库编码,仓库名称',
                    changeColumns: [{ column: "whcode", use: "whcode" }, { column: "whname", use: "whname" }]
                },
                barcode: { //条码
                    maxLength: 100,
                    required: true,
                    placeholder: "=请选择=",
                    type: "autocomplete",
                    url: "admin/otherout/barcodeDatas",
                    textAttr: "barcode",
                    width: 800,
                    sync: "",
                    valueAttr: "barcode",
                    columnAttr: "barcode,cinvcode,cinvdddcode,cinvname,cinvstd,inventorycuomname,qty,cequipmentmodelname",
                    header: '现品票,存货编码,存货代码,存货名称,规格型号,主计量单位,数量,所属机型',
                    changeColumns: [{ column: "barcode", use: "barcode" }, { column: "cinvcode", use: "cinvcode" }, { column: "cinvcode1", use: "cinvcode1" },
                    { column: "cinvname1", use: "cinvname1" }, { column: "cinvstd", use: "cinvstd" },
                    { column: "cinvccode", use: "cinvccode" }, { column: "cinvcname", use: "cinvcname" },
                    { column: "cuomclassname", use: "cuomclassname" }, { column: "iinventoryid", use: "iautoid" }, { column: "sourcebilltype", use: "sourcebilltype" },
                    { column: "sourcebillno", use: "sourcebillno" }, { column: "sourcebilldid", use: "sourcebilldid" },
                    { column: "sourcebillnorow", use: "sourcebillnorow" }, { column: "sourcebillid", use: "sourcebillid" }, { column: "cinvdddcode", use: "cinvdddcode" },
                    { column: "cinvname", use: "cinvname" }, { column: "inventorycuomname", use: "inventorycuomname" },
                    { column: "sourcebillid", use: "sourcebillid" }, { column: "qty", use: "qty" }]

                },
            }
        };
        return editableTableOptions;
    }
    function closeHandler() {
        parent.layer.close(parent.layer.getFrameIndex(window.name));
        window.parent.refreshJBoltTable();
    }

    /**
    * 获得选中的供应商数据
    * @param data
    */
    function setChooseDialogSelectResultFromSupplier(data) {
        console.log(data)
        $("#ccusname").val(data.ccusname);
        $("#cbarcode").val(data.cbarcode);
        $("#cbarcode1").val(data.cbarcode);

    }
    function setChooseDialogSelectResultFromSuppliertwo(data) {
        console.log(data)
        $("#cdistrictcode").val(data.cdistrictcode);
        $("#cdistrictname").val(data.cdistrictname);
        $("#cwhname").val(data.cwhname);

    }

</script>
#end
