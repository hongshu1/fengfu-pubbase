#@adminDialogLayout()

#define css()
<link href="assets/plugins/Grape/16.0.2/css/gc.spread.sheets.16.0.2.css" rel="stylesheet">
<style>
    .spread-container {
        height:75.5vh;
    }

    .gc-statusbar {
        height: 25px;
        min-height: 25px;
        background: #217346;
        font-size: 0.6rem;
        color: aliceblue;
    }
    body,p {
        margin: 0px;
        padding: 0px;
        font-size: 12px;
        color: black;
    }

    #box {
        height: 100vh;
        font-weight: bold;
    }
    /* 头部用户数据 */
    .nav_title {
        text-indent: 1rem;
        padding: 10px 0px;
        font-size: 0.9rem;
        color: #5C5C5C;
        border: 1px solid #CCCCCC;
    }

    .search {
        padding: 10px 0px;

    }

    /* 下拉框文字样式 */
    .select {
        margin-right: 15px;
    }

    .span {
        color: #333333;
    }

    .select:nth-child(1) {
        margin-left: 10px;
    }

    /* 搜索重置按钮样式 */
    .button {
        margin: 0px 10px;
        padding: 3px 10px;
        background-color: #fff;
        border: #797979 1px solid;
    }
    /* 表格工具 */
    .but_box {
        padding: 15px 0px;
        padding-left: 15px;
        border-bottom: none;
    }

    /* 表格按钮 */
    .but_box button {
        padding: 3px 10px;
        margin-right: 8px;
        background-color: #fff;
        border: #797979 1px solid;
        border-radius: 5px;
    }
</style>
#end

#define main()
#set(pageId=RandomUtil.random(6))
<div class="jbolt_page">
    <div class="jbolt_page_title">
        <!-- 头部标题开始 -->
        <nav>
            <p class="nav_title">制造工单人员安排</p>
        </nav>
        <!-- 头部标题结束 -->
        <!-- 搜索工具类开始 -->
        <div class="search">
            <div class="select">
                <span class="span">生产部门：</span>
                <select style="width:150px;height:25px;">
                    <option value=""></option>
                </select>
            </div>
        </div>
        <!-- 搜索工具类结束 -->
    </div>
    <div class="jbolt_page_content">
        <div class="sample-container">
            <!-- 表格 -->
            <div id="table-tool">
                <!-- 表格工具开始 -->
                <div class="but_box">
                    <button class="button">数据导出</button>
                    <button class="button">数据导入</button>
                    <button class="button">保存</button>
                    <button class="button">提交审批</button>
                </div>
                <!-- 创建表格目标DOM元素，id为ss的HTML -->
                <div id="ss" class="spread-container"></div>
                <div id="statusBar" class="gc-statusbar"></div>
            </div>
        </div>
    </div>
</div>

#end

#define js()
<script type="text/javascript" src="assets/plugins/Grape/gc.spread.sheets.all.12.0.7.min.js"></script>
<script type="text/javascript">
    var spread = new GC.Spread.Sheets.Workbook(document.getElementById('ss'), {sheetCount: 1});
    //设置状态栏
    var statusBar = new GC.Spread.Sheets.StatusBar.StatusBar(document.getElementById('statusBar'));
    var sheet = spread.getSheet(0);//按照下标获取表单
    //设置全局内容水平垂直居中
    sheet.getRange(-1,-1,-1,-1).hAlign(GC.Spread.Sheets.HorizontalAlign.center).vAlign(GC.Spread.Sheets.VerticalAlign.center);
    //设置全局的字体样式
    sheet.getRange(-1, -1,-1,-1).font('宋体 bold 10px');
    //状态栏
    statusBar.bind(spread);
    spread.getSheet(0).options.colHeaderAutoText = GC.Spread.Sheets.HeaderAutoText["numbers"];//表头列号换成数字
    var parmsDefault = {
        RowCount:200,           //一列多少单元格
        ColumnCount:500,         //一行多少单元格
        rowindex:0,				//x轴索引
        columnindex:0,			//y轴索引
        dayRow:10,              //day渲染起始下标
        weekRow:10,             //week渲染起始下标
        tableData:[],           //接收添加的数据
    };
    var parmsArr = [Object.assign({},parmsDefault)];
    //添加属性
    parmsArr[0]['spread'] = spread;
    parmsArr[0]['activeSheet'] = spread.getSheet(0);//获取指定的表单
    var parms = parmsArr[0];

    //设置全局表单的背景颜色
    spread.options.grayAreaBackColor = '#fff';
    const jsonData = {"data":[{"cinvcode":"302303","cinvcode1":"18307-TJB -AO21-73","cinvname1":"STAY D 2QU/2DW/2DU2.0T SLNCR","iinventoryid":"274202973512270","iworkregionmid":"1638094852165296128","rowdatas":[{"cequipment":{"cequipmentname":"测试2/测试设备2","iequipmentid":"1638063960836509696,1638077922919550976"},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"","iequipmentid":""},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"","iequipmentid":""},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"","iequipmentid":""},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}}]},{"cinvcode":"502998","cinvname1":"擦拭纸","iinventoryid":"451617187998654","iworkregionmid":"1654680843648667648","rowdatas":[{"cequipment":{"cequipmentname":"测试2/测试设备2/热成型机1","iequipmentid":"1638063960836509696,1638077922919550976,1656215164493496320"},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"","iequipmentid":""},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"","iequipmentid":""},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"测试2","iequipmentid":"1638063960836509696"},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}}]},{"cinvcode":"502998Test","cinvname1":"擦拭纸","iinventoryid":"1658752168447205376","iworkregionmid":"1654680843648667648","rowdatas":[{"cequipment":{"cequipmentname":"测试设备2/热成型机1","iequipmentid":"1638077922919550976,1656215164493496320"},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"","iequipmentid":""},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"","iequipmentid":""},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{"cequipmentname":"测试2","iequipmentid":"1638063960836509696"},"coperation":{"coperationname":"","ioperationid":""}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}},{"cequipment":{},"coperation":{}}]}],"state":"ok"}

    loadInit();
    initData();/**
     * 初始化产线数据
     * @param loadInit
     */
    function loadInit(){
        //设置单元格内容的对齐方式
        var style = new GC.Spread.Sheets.Style();
        style.hAlign = GC.Spread.Sheets.HorizontalAlign.center;
        style.vAlign = GC.Spread.Sheets.VerticalAlign.center;
        spread.sheets.forEach(function(sheet) {
            sheet.setDefaultStyle(style, GC.Spread.Sheets.SheetArea.viewport);
        });
        //设置全局的列宽行高
        sheet.defaults.colWidth = 80;
        sheet.defaults.rowHeight = 30;
        spread.getSheet(0).setRowCount(parms.RowCount); //设置一列单元格的个数
        spread.getSheet(0).setColumnCount(parms.ColumnCount); //设置一行有多少个单元格
        //设置value值和该单元格的对齐方式
        parms.activeSheet.getCell(parms.rowindex, parms.columnindex).text("序号");
        parms.activeSheet.setColumnWidth(parms.columnindex, 40);//设置指定单元格的width
        sheet.addSpan(0,0,3,1);
        parms.activeSheet.getCell(parms.rowindex, parms.columnindex+1).text("产线名称");
        parms.activeSheet.setColumnWidth(parms.columnindex+1, 60);//设置指定单元格的width
        parms.activeSheet.addSpan(0,1,3,1);
        parms.activeSheet.getCell(parms.rowindex, parms.columnindex+2).text("存货编码");
        parms.activeSheet.addSpan(0,2,3,1);
        parms.activeSheet.getCell(parms.rowindex, parms.columnindex+3).text("客户部番");
        parms.activeSheet.addSpan(0,3,3,1);
        parms.activeSheet.getCell(parms.rowindex, parms.columnindex+4).text("部品名称");
        parms.activeSheet.addSpan(0,4,3,1);
        parms.activeSheet.setColumnWidth(parms.columnindex+4, 100);//设置指定单元格的width
        parms.activeSheet.getCell(parms.rowindex, parms.columnindex+5).text("设备名称");
        parms.activeSheet.addSpan(0,5,3,1);
        parms.activeSheet.setColumnWidth(parms.columnindex+5, 140);//设置指定单元格的width
        parms.activeSheet.getCell(parms.rowindex, parms.columnindex+6).text("工序名称");
        parms.activeSheet.addSpan(0,6,3,1);
        parms.activeSheet.setColumnWidth(parms.columnindex+6, 140);//设置指定单元格的width
    }
    /*工作簿暂停活性*/
    function spreadSuspend() {
        spread.suspendPaint(); //渲染前失活(提升性能)
        spread.suspendCalcService(); //暂停计算服务
    }
    /*工作簿开启活性*/
    function spreadResume() {
        spread.resumeCalcService(); //开启计算服务
        spread.resumePaint(); //恢复绘制
    }
    /**
     * 获取接口返回的日期数据
     * @param initDate
     * @param parms 自定义对象，用户接收数据
     * @param sheet 当前活动表单
     */
    function initDate() {
        // let url = "";
        // //获取接口数据
        // Ajax.get(url,(res)=>{
        //     spreadSuspend();//暂停绘制
        //
        //     spreadResume();// 恢复绘制
        // });
    }
    /**
     * 初始化产线数据
     * @param initData
     */
    function initData(){
        console.log(jsonData)
        spreadSuspend();//暂停绘制
        let rowIndex = 3;
        let colIndex=0;
        let serialCol = 1;
        let a1 = 3;
        let A = 5;
        let B = 6;
        let Q = 3;
        let W = 5;
        let C = 6;
        parms.activeSheet.setColumnWidth(1, 150);//设置指定单元格的width
        parms.activeSheet.setColumnWidth(2, 100);//设置指定单元格的width
        parms.activeSheet.setColumnWidth(3, 150);//设置指定单元格的width
        parms.activeSheet.setColumnWidth(4, 150);//设置指定单元格的width
        for (let i = 0; i <jsonData.data.length; i++) {
            // console.log(jsonData.data[i].rowdatas.length);
            //序号
            sheet.setValue(rowIndex, colIndex,i);
            sheet.addSpan(rowIndex,colIndex,jsonData.data[i].rowdatas.length+4,1);
            //产线名称
            sheet.setValue(rowIndex, serialCol,'产线名称'+i);
            parms.activeSheet.addSpan(rowIndex,serialCol,jsonData.data[i].rowdatas.length+4,1);
            //存货编码
            sheet.setValue(rowIndex, serialCol+1,jsonData.data[i].cinvcode);
            parms.activeSheet.addSpan(rowIndex,serialCol+1,jsonData.data[i].rowdatas.length+4,1);
            //客户部番
            sheet.setValue(rowIndex, serialCol+2,jsonData.data[i].cinvcode1);
            parms.activeSheet.addSpan(rowIndex,serialCol+2,jsonData.data[i].rowdatas.length+4,1);
            //部品名称
            sheet.setValue(rowIndex, serialCol+3,jsonData.data[i].cinvname1);
            parms.activeSheet.addSpan(rowIndex,serialCol+3,jsonData.data[i].rowdatas.length+4,1);
            rowIndex+=jsonData.data[i].rowdatas.length+4;
            //
            if(i==0){
                //设备名称
                sheet.setValue(a1+jsonData.data[i].rowdatas.length, A,'产线名称'+i);
                sheet.setValue(a1+jsonData.data[i].rowdatas.length+1, A,'产线名称'+i);
                sheet.setValue(a1+jsonData.data[i].rowdatas.length+2, A,'产线名称'+i);
                sheet.setValue(a1+jsonData.data[i].rowdatas.length+3, A,'产线名称'+i);
                //工序名称
                sheet.setValue(a1+jsonData.data[i].rowdatas.length, B,'产线名称'+i);
                sheet.setValue(a1+jsonData.data[i].rowdatas.length+1, B,'产线名称'+i);
                sheet.setValue(a1+jsonData.data[i].rowdatas.length+2, B,'产线名称'+i);
                sheet.setValue(a1+jsonData.data[i].rowdatas.length+3, B,'产线名称'+i);
            }else{
                let leg = jsonData.data[i].rowdatas.length;
                //设备名称
                sheet.setValue(leg+12 * i + a1, A,'产线名称'+i);
                sheet.setValue(leg+12 * i + a1+1, A,'产线名称'+i);
                sheet.setValue(leg+12 * i + a1+2, A,'产线名称'+i);
                sheet.setValue(leg+12 * i + a1+3, A,'产线名称'+i);
                //工序名称
                sheet.setValue(leg+12 * i + a1, B,'产线名称'+i);
                sheet.setValue(leg+12 * i + a1+1, B,'产线名称'+i);
                sheet.setValue(leg+12 * i + a1+2, B,'产线名称'+i);
                sheet.setValue(leg+12 * i + a1+3, B,'产线名称'+i);
            }
            for (let j = 0; j < jsonData.data[i].rowdatas.length; j++) {
                let leg = jsonData.data[i].rowdatas.length;
                console.log(leg)
                if(i==0){
                    sheet.setValue(Q+j, W,j);
                    // sheet.setValue(Q+j, W,j);
                }else{
                    sheet.setValue(4 * i + leg +3, W,i);
                }
                // sheet.setValue(3, 6,jsonData.data[0].rowdatas[0].coperation.coperationname);
            }
            // parms.activeSheet.getCell(parms.planListRowIndex++, parms.planListColIndex+1).text("实绩需求");
            // parms.activeSheet.setColumnWidth(parms.planListRowIndex, 70);//设置指定单元格的width
            // parms.activeSheet.getCell(parms.planListRowIndex++, parms.planListColIndex+1).text("到货计划");
            // parms.activeSheet.getCell(parms.planListRowIndex++, parms.planListColIndex+1).text("计划在库");
            // let shiyongRow = 3;
            // let shiyongCol = 10;
            // for (var j = 0; j < parms['scheduplanmonth'].data[i].day.length; j++) {
            //     if(i==0){
            //         sheet.setValue(shiyongRow,shiyongCol+j,parms['scheduplanmonth'].data[i].day[j].xuqiu);
            //         sheet.setValue(shiyongRow+1,shiyongCol+j,parms['scheduplanmonth'].data[i].day[j].jihua);
            //         sheet.setValue(shiyongRow+2,shiyongCol+j,parms['scheduplanmonth'].data[i].day[j].zaiku);
            //     }else{
            //         sheet.setValue(3*i+shiyongRow,shiyongCol+j,parms['scheduplanmonth'].data[i].day[j].xuqiu);
            //         sheet.setValue(3*i+shiyongRow+1,shiyongCol+j,parms['scheduplanmonth'].data[i].day[j].jihua);
            //         sheet.setValue(3*i+shiyongRow+2,shiyongCol+j,parms['scheduplanmonth'].data[i].day[j].zaiku);
            //     }
            //
            // }
        }
        spreadResume();// 恢复绘制
    }
</script>
#end
