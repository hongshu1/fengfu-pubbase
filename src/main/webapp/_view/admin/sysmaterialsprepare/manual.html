#@jboltLayout()
#define main()
<div class="row">
    <div class="col">
        <div class="card" style="margin-bottom: 5px">
            <div class="card-body">
                <div class="col">
                    <button
                            class="btn btn-success btn-sm" id="btn1"><i class="fa fa-refresh"></i> 保存
                    </button>
                    <button onclick="closeHandler()"
                            class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i> 关闭
                    </button>
                </div>
            </div>
        </div>
        <div class="card" style="margin-bottom: 5px">
            <div class="card-body">
                <form class="form-inline" id="SysMaterialsprepare_form_#(pageId)" hidden="hidden">
                    <input type="text" autocomplete="off" class="form-control" placeholder="被选中的iinventoryid"
                           name="data" value="" id="manualdata"/>
                    <input type="text" autocomplete="off" class="form-control" placeholder="cmodocno"
                           name="CMO" value="" id="manualdataCMO"/>
                    <div class="btn-group text-center mx-1">
                        <button type="submit" class="btn btn-outline-primary" id="commit"><i class="fa fa-search"></i> 搜索</button>
                        <button type="button" onclick="form.reset();refreshJBoltTable(this);"
                                class="btn btn-outline-secondary"><i class="fa fa-reply-all"></i> 重置
                        </button>
                    </div>
                </form>
                <form onsubmit="return false;" id="SysMaterialsprepare_Form" action="#(action)" method="post">
                    #if(moPickItemM.AutoID??)
                    <input type="hidden" name="sysMaterialsprepare.autoid" value="#(sysMaterialsprepare.AutoID??)"/>
                    #end
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">工单号：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control" placeholder=""
                                           maxlength="40" name="sysMaterialsprepare.BillNo"
                                           readonly
                                           value="#(cmodocno??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">机型 ：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control" placeholder=""
                                           maxlength="40" name="sysMaterialsprepare.cMoDocNo"
                                           readonly
                                           value="#(cequipmentmodelname??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">存货编码：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.cInvName1"
                                           readonly
                                           value="#(cinvcode??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">客户部番：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.iEquipmentModelId"
                                           readonly
                                           value="#(cinvcode1??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">部品名称：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.cInvCode1"
                                           readonly
                                           value="#(cinvname1??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">计划数量：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.cDepName"
                                           readonly
                                           value="#(iqty??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">计划日期：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.dPlanDate"
                                           readonly
                                           value="#(dplandate??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">生产部门：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.cBatch"
                                           readonly
                                           value="#(cdepname??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">产线名称：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.cBatch"
                                           readonly
                                           value="#(cworkname??)"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">班次名称：</label>
                                <div class="col-10">
                                    <input type="text" data-notnull="false"
                                           data-tips=""
                                           data-with-clearbtn="false" autocomplete="off"
                                           class="form-control"
                                           placeholder="" maxlength="40" name="sysMaterialsprepare.cBatch"
                                           readonly
                                           value="#(cworkshiftname??)"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <button onclick="submitThisFormtest()"
                class="btn btn-success btn-sm" hidden="hidden" id="btn2"><i class="fa fa-refresh"></i> 保存
        </button>


        <div class="card" style="margin-bottom: 5px">
            <div class="card-body">
                <div class="col">
                    <button data-dialogbtn
                            data-area="80%,70%"
                            data-handler="jboltTablePageToFirst"
                            data-title="选择存货"
                            data-url="admin/sysMaterialsprepare/MaterialsListchoose?cmodocno=#(cmodocno??)"
                            class="btn btn-success btn-sm"><i class="fa fa-refresh"></i> 新增
                    </button>
                </div>
            </div>
        </div>


    </div>
</div>


<textarea class="jb_tpl_box" id="SysMaterialsprepare_tpl_#(pageId)">
{@each datas as data,index}
<tr data-id="${data.autoid}">
<td>${pageNumber,pageSize,index | rownum}</td>
<td>${data.cinvcode}</td>
<td>${data.cinvcode1}</td>
<td>${data.cinvname1}</td>
<td>${data.cinvstd}</td>
<td>${data.cUomName}</td>
<td>
     <input type="text" class="form-control " placeholder="" maxlength="20" name="iplanqty" value=""/>
</td>
<td>
	<a type="button" onclick="DElete(this)" style="user-select:none"  ><i class="fa c-danger">移除</i></a>
</td>
</tr>
{@/each}
</textarea>
<table class="jbolt_table jbolt_main_table table-center"
       data-jbolttable
       data-width="fill"
       data-height="65%"
       data-ajax="true"
       data-url="admin/sysMaterialsprepare/manualDatas"
       data-rowtpl="SysMaterialsprepare_tpl_#(pageId)"
       data-copy-to-excel="false"
       data-page="SysMaterialsprepare_page"
       data-column-resize="true"
       data-toolbar="SysMaterialsprepare_toolbar_#(pageId)"
       id="manual"
       data-editable="true"
       data-conditions-form="SysMaterialsprepare_form_#(pageId)"
>
    <thead class="fw-normal">
    <tr>
        <th data-width="60" data-column="index">序号</th>
        <th data-width="150" data-column="cinvcode">存货编码</th>
        <th data-min-width="150" data-column="cinvcode1">客户部番</th>
        <th data-width="250" data-column="cinvname1">部品名称</th>
        <th data-width="200" data-column="cinvstd">规格</th>
        <th data-width="150" data-column="cuomname">主计量单位</th>
        <th data-width="150" data-column="">计划数量</th>
        <th data-width="150" data-column="">操作</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>
#end
#define js()
<script type="text/javascript">
    hideParentLayerDialogBtn(0);
    hideParentLayerDialogBtn(1);

    function DElete(val) {
        var oParent = val.parentNode.parentNode;
        oParent.parentNode.removeChild(oParent);
    }

    //保存按钮
    function submitThisFormtest() {
        var mytable = document.getElementById("manual");
        var map1 = [];
        //储存当前工单号
        map1[0] = "id" + ":" + "#(cmodocno??)";
        for (var i = 1, rows = mytable.rows.length; i < rows; i++) {
            if (mytable.rows[i].cells[6].children[0].value){
                //存货编码:输入的数量
                map1.push(mytable.rows[i].cells[1].innerHTML + ":" + mytable.rows[i].cells[6].children[0].value);
            }
        }
        Ajax.post("admin/sysMaterialspreparedetail/submitAll", {"data": map1.toString()},
            function (res) {
                LayerMsgBox.success("保存成功");
            }, function (err) {
                LayerMsgBox.error("保存失败");
            });
    }

    const BTN1 = document.getElementById('btn1');
    const BTN2 = document.getElementById('btn2');

    // 给按钮 2 添加点击事件
    BTN1.addEventListener('click', () => {
        BTN2.onclick();
    });


</script>
#include("/_view/_admin/common/_formjs.html",formId="SysMaterialsprepare_Form")
#end
