#@jboltLayout()
#define main()
#set(pageId=RandomUtil.random(6))
<div class="jbolt_page_title">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="col">
                        <button onclick="closeHandler()" class="btn btn-info btn-sm"><i
                                class="fa fa-window-maximize"></i> 关闭
                        </button>
                        <button onclick="printSysPuinstore()" class="btn btn-info btn-sm"><i
                                class="fa fa-window-maximize"></i> 打印
                        </button>
<!--                        #include("/_view/_common/_approval_btns.html", uri="/admin/purchaseReceiptList", formSn="T_Sys_PUInStore", o=sysPuinstore, edit=edit??, primaryKeyName="AutoID")-->
                        <button onclick="submitApprove('#(sysPuinstore.autoid??)')" class="btn btn-info btn-sm"><i
                                class="fa fa-window-maximize"></i> 审核
                        </button>
                        <button onclick="resetSubmitApprove('#(sysPuinstore.autoid??)')" class="btn btn-info btn-sm"><i
                                class="fa fa-window-maximize"></i> 反审核
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="jbolt_page_content">
        <form onsubmit="return false;" id="sysPuinstore_#(pageId)" method="post">
            #if(sysPuinstore.AutoID??)
            <input id="autoid" type="hidden" name="autoid" value="#(sysPuinstore.autoid??)"/>
            #end
            <div class="row">
                <div class="col">
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">入库单号</label>
                        <div class="col-7">
                            <input id="billno" name="billno" type="text" readonly autocomplete="off"
                                   class="form-control" maxlength="40" value="#(sysPuinstore.billno??)"/>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">订单号</label>
                        <div class="col-sm-7 col-form-label">
                            <div class="input-group-append">
                                <input  type="text" id="sourcebillno" class="form-control border-none"
                                        readonly="readonly" placeholder="" data-rule="required"
                                        value="#(sysPuinstore.sourcebillno??)" />
                                <input id="sourcebillid" name="sourcebillid" type="hidden" value="#(sourcebillid??)"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">供货单位</label>
                        <div class="col-7">
                            <input id="venname" name="cvenname" type="text" readonly="readonly" autocomplete="off" class="form-control" maxlength="40"
                                   value="#(sysPuinstore.cvenname??)"/>
                            <input id="vencode" name="vencode" type="hidden" readonly="readonly" autocomplete="off" class="form-control" maxlength="40"
                                   value="#(sysPuinstore.vencode??)"/>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">备注</label>
                        <div class="col-7">
                            <textarea id="memo" name="memo" class="form-control" placeholder="=请输入备注=" readonly
                                type="text" maxlength="300" value="#(sysPuinstore.memo??)"></textarea>
                        </div>
                    </div>
                </div>

                <div class="col">

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">入库日期</label>
                        <div class="col-6">
                            <input id="createdate" name="createdate" type="text" readonly autocomplete="off"
                                   class="form-control" maxlength="40" value="#(sysPuinstore.billdate??)"/>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">部门</label>
                        <div class="col-6">
                            <input name="deptcode" id="deptcode" class="form-control" value="#(sysPuinstore.cdepname??)"
                                   readonly/>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">审批日期</label>
                        <div class="col-6">
                            <input class="form-control" name="auditdate" type="text" readonly="readonly" maxlength="20"
                                   value="#(sysPuinstore.auditdate??)"/>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">业务员</label>
                        <div class="col-6">
                            <input class="form-control" name="createperson" type="text" readonly="readonly" maxlength="20"
                                   value="#(sysPuinstore.createperson??)"/>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">订单类型</label>
                        <div class="col-6">
                            <input class="form-control" name="sourcebilltype" id="sourcebilltype" type="text" readonly="readonly" maxlength="20"
                                   value="#(sysPuinstore.sourcebilltype??)"/>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">仓库名称</label>
                        <div class="col-6">
                            <input class="form-control" name="whcode" type="text" readonly="readonly" maxlength="20"
                                   value="#(sysPuinstore.whname??)"/>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">采购类型</label>
                        <div class="col-6">
                            <input class="form-control" name="billtype" type="text" readonly="readonly" maxlength="20"
                                   value="#(sysPuinstore.cptname??)"/>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">入库类别</label>
                        <div class="col-6">
                            <input class="form-control" name="crdcode" type="text" readonly="readonly" maxlength="20"
                                   value="#(sysPuinstore.crdname??)"/>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">业务类型</label>
                        <div class="col-6">
                            <input class="form-control" name="ibustype" type="text" readonly="readonly" maxlength="20"
                                   value="#(ibustype??)"/>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!--<div class="jbolt_page_content">-->
<textarea class="jb_tpl_box" id="sysPuinstoreForm_tpl_#(pageId)">
  {@each datas as data,index}
  <tr data-id="${data.autoid}">
    <td>${pageNumber,pageSize,index | rownum}</td>
    <td title="${data.spotticket}">${data.spotticket}</td>
    <td title="${data.invcode}">${data.invcode}</td>
    <td title="${data.cinvname}">${data.cinvname}</td>
    <td title="${data.cinvcode1}">${data.cinvcode1}</td>
    <td title="${data.cinvname1}">${data.cinvname1}</td>
    <td title="${data.cinvstd}">${data.cinvstd}</td>
    <td title="${data.brandname}">${data.brandname}</td>
    <td title="${data.puunitname}">${data.puunitname}</td>
    <td title="${data.qty}">${data.qty}</td>
    <td title="${data.memo}">${data.memo}</td>
  </tr>
  {@/each}
</textarea>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <table id="sysPuinstoreform_TableId_#(pageId)"
                       class="jbolt_table jbolt_main_table  table-center"
                       data-jbolttable
                       data-ajax="true"
                       data-url="admin/sysPuinstoredetail/finddetaildatas?masid=#(sysPuinstore.AutoID??)"
                       data-height="fill"
                       data-column-resize="true"
                       data-conditions-form="sysPuinstoreformtable_form_#(pageId)"
                       data-page="sysPuinstoreform_page_#(pageId)"
                       ###data-column-prepend="1:checkbox:true"
                       data-rowtpl="sysPuinstoreForm_tpl_#(pageId)"
                       data-toolbar="sysPuinstoreform_toolbar_#(pageId)">
                    <thead>
                    <tr>
                        <th data-width="30px">序号</th>
                        <th data-width="180" data-column="spotticket">现品票</th>
                        <th data-width="180" data-column="invcode">存货编码</th>
                        <th data-width="180" data-column="cinvname">存货名称</th>
                        <th data-width="180" data-column="cinvcode1">客户部番</th>
                        <th data-width="180" data-column="cinvname1">部品名称</th>
                        <th data-width="200" data-column="cinvstd">规格型号</th>
                        <th data-width="180" data-column="brandname">品牌</th>
                        <th data-width="150" data-column="puunitname">采购单位</th>
                        <th data-width="100" data-column="qty">数量</th>
                        <th data-width="180" data-column="memo">备注</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <div class="form-group row">
                    <label class="col-sm-2 col-form-label" style="margin-top: 7px">制单人：</label>
                    <div class="col-sm-2 col-form-label">
                        <input type="text" class="form-control border-none" readonly="readonly" autocomplete="off"
                               placeholder="" value="#(sysPuinstore.ccreatename??)"/>
                    </div>
                    <label class="col-sm-2 col-form-label" style="margin-top: 7px">审核人：</label>
                    <div class="col-sm-2 col-form-label">
                        <input type="text" class="form-control border-none" readonly="readonly" autocomplete="off"
                               placeholder="" value="#(sysPuinstore.cauditname??)"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
#define js()
<script>
    hideParentLayerDialogBtn(0);
    hideParentLayerDialogBtn(1);

    function submitThisForm() {
        let data = getJboltTableAllDatas('#sysPuinstoreform_TableId_#(pageId)');
        jboltTableSubmit("#sysPuinstoreform_TableId_#(pageId)");
    }

    function closeHandler() {
        parent.layer.close(parent.layer.getFrameIndex(window.name));
        window.parent.refreshJBoltTable();
    }

    /*
    * 提交审批，推送至u8入库
    *
    * */
    function submitApprove(autoid) {
        if (!autoid) {
            LayerMsgBox.alert("请先保存，再提交审批！", 2);
        }
        LayerMsgBox.loading('审核中...');
        Ajax.post('/admin/purchaseReceiptList/onlyseeAutit?autoid=' + autoid,{}, function (ret) {
            if (ret.state === 'ok') {
                parent.layer.close(parent.layer.getFrameIndex(window.name));
                parent.refreshPjaxContainer();
            } else {
                LayerMsgBox.alert(ret.msg, 2);
            }
        });
    }

    /*
    * 反审核
    * */
    function resetSubmitApprove(autoid) {
        LayerMsgBox.loading('反审核中...');
        Ajax.post('/admin/purchaseReceiptList/resetAutitById?autoid=' + autoid,{}, function (ret) {
            if (ret.state === 'ok') {
                parent.layer.close(parent.layer.getFrameIndex(window.name));
                parent.refreshPjaxContainer();
            } else {
                LayerMsgBox.alert(ret.msg, 2);
            }
        });
    }

    /*
    * 打印
    * */
    function printSysPuinstore(autoid) {
        if (1==1) {
            LayerMsgBox.alert("Sir,暂时没有采购入库单的打印模板标签，后续添加此功能...", 2);
            return;
        }
        let mark = 'page';
        let code=[];
        code.push(autoid);
        LayerMsgBox.loading('打印中...');
        jboltHiprintWebPrint(reportfilename, 'url', 'admin/purchaseReceiptList/getPrintData?ids=' + code.join(",") + "&&mark=" + mark);
    }

</script>
#end
#end