<form onsubmit="return false;" id="CusFieldsMappingD_Form" action="#(action)" method="post">
    
    #if(cusFieldsMappingD.iAutoId??)
    <input type="hidden" name="cusFieldsMappingD.iAutoId" value="#(cusFieldsMappingD.iAutoId??)"/>
    #else
    <input type="hidden" name="cusFieldsMappingD.iCusFieldsMappingMid" value="#(cusFieldsMappingD.iCusFieldsMappingMid??)">
    #end
    
    <div class="row">
        <div class="col">
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">格式名称</label>
                <div class="col-10">
                    <input type="text" value="#(cusfieldsmappingm.cformatname)" disabled/>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">表单名称</label>
                <div class="col-10">
                    <input type="text" value="#(cformnames)" disabled/>
                </div>
            </div>
            
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">系统字段名称</label>
                <div class="col-10">
                    <input type="hidden" name="cusFieldsMappingD.iFormFieldId" value="#(cusFieldsMappingD.iFormFieldId??)" id="iFormFieldId" data-sync-attr="iautoid"/>

                    <input type="text" class="form-control"
                           data-autocomplete
                           data-url="admin/formfield/autocomplete?iformid=#(iformids[0])"
                           data-rule="required"
                           data-sync-ele="#iFormFieldId"
                           data-text-attr="cfieldname"
                           data-column-attr="cfieldcode,cfieldname"
                           placeholder="请选择系统字段"
                           data-tips="请选择系统字段"
                           data-header="字段编码,字段名称"
                           maxlength="40"
                           value="#(cusFieldsMappingD.iFormFieldId??)">
                </div>
            </div>

            <div class="form-group row"
                 data-radio
                 data-name="cusFieldsMappingD.isEncoded"
                 data-value-attr="sn"
                 data-default="options_first"
                 data-url="admin/dictionary/options?key=options_boolean"
                 data-label="是否编码字段"
                 data-width="col-sm-2,col-10"
                 data-value="#(cusFieldsMappingD.isEncoded??)"
                 data-rule="radio"
                 data-notnull="true"
                 data-tips="请输入是否编码字段"
                 data-handler="changeIsEncoded_#(pageId)"
                 data-inline="true">
            </div>

            <div class="form-group row">
                <label class="col-sm-2 col-form-label">导入字段名称</label>
                <div class="col-10">
                    <input type="text" data-rule="required" data-notnull="true" data-tips="请输入导入字段名称" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入导入字段名称" maxlength="40" name="cusFieldsMappingD.cCusFieldName" value="#(cusFieldsMappingD.cCusFieldName??)"/>
                </div>
            </div>

            #ajaxPortal("/admin/cusfieldsmappingd/codingrule?pageId=" + pageId + "&icusfieldsmappingmid=" + cusFieldsMappingD.icusfieldsmappingmid + "&isencoded=" + cusFieldsMappingD.isencoded??true,"cusfieldmappingd_portal_" + pageId, true)
            
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">编码示例</label>
                
                <input type="hidden" name="cusFieldsMappingD.cDemo" value="#(cusFieldsMappingD.cDemo??)">
                
                <div class="col-10" id="cDemo">
                    
                    
                    
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">导入编码字段长度</label>
                <div class="col-10">
                    <input type="number" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入导入编码字段长度" maxlength="40" name="cusFieldsMappingD.iLength" value="#(cusFieldsMappingD.iLength??)"/>
                </div>
            </div>
            <div class="form-group row"
                 data-radio
                 data-name="cusFieldsMappingD.isEnabled"
                 data-value-attr="sn"
                 data-default="options_first"
                 data-url="admin/dictionary/options?key=options_enable"
                 data-label="是否启用"
                 data-width="col-sm-2,col-10"
                 data-value="#(cusFieldsMappingD.isEnabled??)"
                 data-rule="radio"
                 data-notnull="true"
                 data-tips="请输入是否启用"
                 data-inline="true"
            >
            </div>
        </div>
    </div>
</form>

#define js()
#include("_coding_rule_js.html")
<script>
    
    var loaded = false;

    function changeIsEncoded_#(pageId)(r, v) {
        if (!loaded) {
            loaded = true;
            return;
        }
        
        if (loaded) {
            AjaxPortalUtil.go('cusfieldmappingd_portal_#(pageId)', '/admin/cusfieldsmappingd/codingrule?pageId=#(pageId)&icusfieldsmappingmid=#(icusfieldsmappingmid)&isencoded=' + v);
        }
    }

    function updateDemoCode(ele) {
        var datas = jboltTableGetAllDatas(ele);
        console.log(JSON.stringify(datas));

        var $demo = $('#cDemo');
        
        $demo.empty();

        $.each(datas, function (idx, row) {
            // 编码
            if (row.itype == 1) {
                var str = '';
                
                
                for (var i = 0; i < (row.iendlength - row.istartlength + 1); i++) {
                    str += 'X';
                }
                console.log(str);
                
                $demo.append('<span>');
                $demo.append('<span class="col-md-1" style="width:120px">' + str + '</span>');
                $demo.append('</span>');
            }
            // 分隔符
            else { 
                $demo.append('<span>');
                $demo.append('<span class="col-md-1" style="width:120px">' + row.cseperator + '</span>');
                $demo.append('</span>');
            }
        });
    }

</script>
#include("/_view/_admin/common/_formjs.html",formId="CusFieldsMappingD_Form")
#end

