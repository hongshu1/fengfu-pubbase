<div class="jbolt_page_title">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="col">
                        <button onclick="submitThisForm()" class="btn btn-success btn-sm" onclick="submitThisForm()"><i
                                class="fa fa-refresh"></i> 保存</button>
                        <button onclick="" class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i> 提交审批
                        </button>
                        <button onclick="closeHandler()" class="btn btn-info btn-sm"><i
                                class="fa fa-window-maximize"></i> 关闭
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form onsubmit="return false;" id="sysAssem_#(pageId)" action="#(action)" method="post">
                        #if(sysAssem.AutoID??)
                        <input type="hidden" name="sysAssem.AutoID" value="#(sysAssem.AutoID??)" />
                        #end
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">单据号</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输入单据号"
                                            data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输入单据号" maxlength="40" name="sysAssem.BillNo"
                                            value="#(sysAssem.BillNo??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">日期</label>
                                    <div class="col-9">
                                        <input type="text" data-date class="form-control ml-2" placeholder="日期"
                                            maxlength="20" name="sysAssem.BillDate"
                                            value="#(sysAssem.BillDate??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.BillType" value="#(sysAssem.BillType??)"
                                        id="idcode" data-value-attr="id" />
                                    <label class="col-sm-3 col-form-label">转换方式</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete
                                            data-url="admin/formConversionList/dictionary" data-rule="required"
                                            data-hidden-input="idcode" data-text-attr="name"
                                            data-column-attr="id,name" placeholder="请选择转换方式"
                                            data-tips="请选择转换方式" data-header="转换方式编码,转换方式" maxlength="40"
                                            value="#(zhname??)">
                                    </div>
                                </div>
                            </div>


                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.IRdCode" value="#(sysAssem.IRdCode??)"
                                        id="crdcode" data-value-attr="crdcode" />
                                    <label class="col-sm-3 col-form-label">入库类别</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete
                                            data-url="admin/formConversionList/style?brdflag=1" data-rule="required"
                                            data-hidden-input="crdcode" data-text-attr="crdname"
                                            data-column-attr="crdcode,crdname" placeholder="请选择入库类别"
                                            data-tips="请选择入库类别" data-header="入库类别编码,入库类别" maxlength="40"
                                            value="#(rkname??)">
                                    </div>
                                </div>
                            </div>



                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.DeptCode" value="#(sysAssem.DeptCode??)"
                                        id="cdepcode" data-value-attr="cdepcode" />
                                    <label class="col-sm-3 col-form-label">生产部门</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete
                                            data-url="admin/productInList/getDepartment" data-rule="required"
                                            data-hidden-input="cdepcode" data-text-attr="cdepname"
                                            data-column-attr="cdepcode,cdepname" placeholder="请选择生产部门"
                                            data-tips="请选择生产部门" data-header="生产部门编码,生产部门" maxlength="40"
                                            value="#(cdepname??)">
                                    </div>
                                </div>
                            </div>


                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.ORdCode" value="#(sysAssem.ORdCode??)"
                                        id="crdcode1" data-value-attr="crdcode" />
                                    <label class="col-sm-3 col-form-label">出库类别</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete
                                            data-url="admin/formConversionList/style?brdflag=0" data-rule="required"
                                            data-hidden-input="crdcode1" data-text-attr="crdname"
                                            data-column-attr="crdcode,crdname" placeholder="请选择出库类别"
                                            data-tips="请选择出库类别" data-header="出库类别编码,出库类别" maxlength="40"
                                            value="#(ckname??)">
                                    </div>
                                </div>
                            </div>



                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">审批日期</label>
                                    <div class="col-9">
                                        <input type="text" data-date class="form-control ml-2" placeholder="审批日期"
                                            maxlength="20" name="sysAssem.AuditDate" value="#(sysAssem.AuditDate??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">备注</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输入备注"
                                            data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输入备注" maxlength="40" name="sysAssem.Memo"
                                            value="#(sysAssem.Memo??)" />
                                    </div>
                                </div>
                            </div>


                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">制单人</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输制单人"
                                            data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输制单人" maxlength="40" name="sysAssem.CreatePerson"
                                            value="#(sysAssem.CreatePerson??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">审核人</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输审核人"
                                            data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输审核人" maxlength="40" name="sysAssem.AuditPerson"
                                            value="#(sysAssem.AuditPerson??)" />
                                    </div>
                                </div>
                            </div>


                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="jbolt_page_content">
    <script type="text/template" id="sysAssem_tpl_#(pageId)">
        {@each datas as data,index}
        <tr data-id="${data.autoid}">
            <td>${pageNumber,pageSize,index | rownum}</td>
            <td>${data.combinationno}</td>
            <td>
                <a href="admin/sysAssemdetail/delete/${data.autoid}" data-ajaxbtn data-loading="执行中 " 
                tooltip data-title="删除" data-handler="refreshJBoltTable" data-confirm="确定删除此数据？" 
                class="jbolt_table_delbtn"><i class="fa fa-remove c-danger">删除</i></a>
   
            </td>
            <td>${data.assemtype}</td>
            <td>${data.barcode}</td>
            <td>${data.whname}</td>
            <td>${data.cinvcode}</td>
            <td>${data.cinvname}</td>
            <td>${data.cinvcode1}</td>
            <td>${data.cinvname1}</td>
            <td>${data.cinvstd}</td>
            <td>${data.inventorycuomname}</td>
            <td>${data.qty}</td>
            <td>${data.iequipmentmodelid}</td>
            <td>${data.memo}</td>

        </tr>
        {@/each}
    </script>
    <div class="jbolt_table_toolbar" id="sysAssem_toolbar_#(pageId)">
        <div class="col-md-4">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">现品票扫码</label>
                <div class="col-9">
                    <input type="text" data-notnull="true" data-tips="请输入现品票扫码" data-with-clearbtn="true"
                        autocomplete="off" class="form-control" placeholder="请输入现品票扫码" maxlength="40"
                        name="sysAssem.warehousingNo" value="#(sysAssem.warehousingNo??)" />
                </div>
            </div>
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
            <button onclick="jboltTableAppendEmptyRow(this)" class="btn btn-primary btn-sm">搜索</button>
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
            <button onclick="jboltTableAppendEmptyRow(this)" class="btn btn-primary btn-sm">添加行</button>
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
            <button data-ajaxbtn data-handler="refreshJBoltTable" data-check-handler="jboltTableGetCheckedIds"
                id="toolbar_deleteBtn_#(pageId)" data-url="admin/sysAssemdetail/deleteByIds?ids="
                data-confirm="确定删除选中数据？" class="btn btn-outline-danger"><i class="fa fa-trash"></i> 批量删除</button>
        </div>

    </div>

    <table class="jbolt_table thead_font_normal table-bordered table-center" data-jbolttable #if(sysAssem.AutoID??)
        data-ajax="true" data-url="admin/sysAssemdetail/findEditTableDatas?masid=#(sysAssem.AutoID??)" #end
        id="jbolt_Table_#(pageId)" data-column-resize="true" data-tfoot-fixed="true" data-column-prepend="1:checkbox"
        data-rowtpl="sysAssem_tpl_#(pageId)" data-toolbar="sysAssem_toolbar_#(pageId)" data-editable="true"
        data-page="sysAssem_tpl_#(pageId)" data-editable-option="getJBoltTableEditableColsOpton">
        <thead class="fw_normal">
            <tr>
                <th data-width="60" data-column="index">序号</th>
                <th class="combinationno" data-width="100" data-column="combinationno">组号</th>
                <th data-width="150">操作</th>
                <th class="assemtype" data-width="100" data-column="assemtype">类型</th>
                <th class="barcode" data-width="100" data-column="barcode">现品票</th>
                <th class="whname" data-width="100" data-column="whname">仓库名称</th>
                <th class="cinvcode" data-width="100" data-column="cinvcode">存货编码</th>
                <th class="cinvname" data-width="100" data-column="cinvname">存货名称</th>
                <th class="cinvcode1" data-width="100" data-column="cinvcode1">客户部番</th>
                <th class="cinvname1" data-width="100" data-column="cinvname1">部品名称</th>
                <th class="cinvstd" data-width="100" data-column="cinvstd">规格型号</th>
                <th class="inventorycuomname" data-width="100" data-column="inventorycuomname">主计量单位</th>
                <th class="qty" data-width="100" data-column="qty">数量</th>
                <th class="iequipmentmodelid" data-width="100" data-column="iequipmentmodelid">所属机型</th>
                <th class="memo" data-width="100" data-column="memo">备注</th>

            </tr>
        </thead>
    </table>

</div>
#define js()
<script>
    hideParentLayerDialogBtn(0);
    hideParentLayerDialogBtn(1);
    function submitThisForm() {
        jboltTableSubmit("#jbolt_Table_#(pageId)");
    }

    function getJBoltTableEditableColsOpton() {
        var editableTableOptions = {

            submit: {
                withForm: ["sysAssem_#(pageId)"],
                name: 'sysAssem',
                type: "all",
                url: "/admin/formConversionList/submitAll",
                success: function (res) {
                    LayerMsgBox.success("提交成功", 600, function () {
                        parent.refreshPjaxContainer();
                        parent.layer.closeAll();
                    });
                }
            },
            cols: {
                AutoID: {
                    submitAttr: "AutoID",
                },
                memo: {
                    type: "input",//类型
                    placeholder: "备注", //输入提示，里面
                    tooltip: "备注",//输入提示，上方
                },

                qty: {
                    type: "amount",//类型
                    placeholder: "数量", //输入提示，里面
                    tooltip: "数量",//输入提示，上方
                },


                barcode: {
                    // type:"select",
                    // url:admin/inventory/autocomplete,//url地址
                    //valueAttr:"",//显示的字段，可以设置多个
                    //onlyleaf:true,//树形结构只能选择叶子节点
                    //required:true,//必填
                    // changeColumns:[{column: "iinventoryid",//显示绑定的字段
                    //                 use: "cinvcode"        //数据源的字段
                    //                 }
                    // ]   
                    type: "autocomplete",
                    url: "admin/formConversionList/barcodeDatas",
                    maxLength: 100,
                    required: true,
                    placeholder: "请选择存货编码",
                    textAttr: "cinvcode",
                    width: 500,
                    valueAttr: "cinvcode",//选择赋值的字段
                    columnAttr: "cinvcode,cinvcode1,cinvname1,cinvstd,cuomname",//下来看的时候显示哪些字段
                    header: '存货编码,客户部番,部品名称,规格,库存主单位',
                    valueAttr: "barcode",
                    columnAttr: "barcode,cinvcode,cinvdddcode,cinvname,cinvstd,inventorycuomname,qty,cequipmentmodelname",
                    header: '现品票,存货编码,存货代码,存货名称,规格型号,主计量单位,数量,所属机型',
                    changeColumns: [{ column: "barcode", use: "barcode" }, { column: "cinvcode", use: "cinvcode" }, { column: "cinvcode1", use: "cinvcode1" },
                    { column: "cinvname1", use: "cinvname1" }, { column: "cinvstd", use: "cinvstd" },
                    { column: "cinvccode", use: "cinvccode" }, { column: "cinvcname", use: "cinvcname" },
                    { column: "cuomclassname", use: "cuomclassname" }, { column: "iinventoryid", use: "iautoid" }, { column: "sourcebilltype", use: "sourcebilltype" },
                    {column: "sourcebillno", use: "sourcebillno"},{column: "sourcebilldid", use: "sourcebilldid"},
                    {column: "sourcebillnorow", use: "sourcebillnorow"},{column: "sourcebillid", use: "sourcebillid"},{column: "cinvdddcode", use: "cinvdddcode"},
                    {column: "cinvname", use: "cinvname"},{column: "inventorycuomname", use: "inventorycuomname"},
                    {column: "sourcebillid", use: "sourcebillid"},{column: "qty", use: "qty"}],
                    // handler: function (table, td, text, value, trJsonData) {
                    //     //逻辑：先判断当前行选择数据的时候能否添加下一行 ;(或者在以上的表格通过disabled处理)
                    //     //能，添加行，通过当前行获取下一行然后赋值
                    //     //不能，通过当前行获取下一行然后赋值
                    //     jboltTableAppendEmptyRow1(table, td, text, value, trJsonData);
                    //     var dq = td.parent();  console.log('dq',dq);
                    //     var down = td.parent().parent().next();  console.log('down',down);
                    //
                    //     // 获取当前行第二个td元素（索引为1）的value值
                    //     var value = down.find('td:eq(13)').text();
                    //     console.log('value',value);
                    //     down.find('.cinvname2').text(value);
                    //     //获取所有的序号
                    //     var datas = jboltTableGetAllDatas("jbolt_Table_#(pageId)");
                    //     console.log('table',table);//整个表格
                    //     console.log('datas',datas);//整个表格数据
                    //     console.log('trJsonData',trJsonData);//当前行数据
                    //     //获当前行的序号
                    // }
                },
          
            }
        };
        return editableTableOptions;
    }
    function closeHandler() {
        parent.layer.close(parent.layer.getFrameIndex(window.name));
        window.parent.refreshJBoltTable();
    }


    function jboltTableAppendEmptyRow1(ele, forceTrChange,text, value, trJsonData) {
        var table = getJBoltTable(ele);
        if (isOk(table)) {
            var jboltTable = table.jboltTable("inst");
            if (jboltTable) {
                var action = getRealJqueryObject(ele);
                if (isOk(action)) {
                    var success = checkMasterTableId(action);
                    if (!success) {
                        return false;
                    }
                }
                if (!jboltTable.isEmpty) {
                    var tr = jboltTable.tbody.find("tr:last");
                    if (isOk(tr)) {
                        return jboltTable.me.insertEmptyRow(jboltTable, tr, false, forceTrChange);
                    }
                }
                return jboltTable.me.insertEmptyRow(jboltTable, null, false, forceTrChange);
            }
        }
        LayerMsgBox.alert("表格组件配置异常", 2);
        return false;
    }

</script>
#end