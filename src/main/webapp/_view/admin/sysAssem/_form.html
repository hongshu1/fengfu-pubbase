
#set(pageId=RandomUtil.random(6))
### 默认为非只读,查看页有readonly=readonly标识
### 【readonly为false】, 或 【审核中或已通过】，设置只读
#if(readonly != 'readonly' && (sysAssem.iAuditStatus??0 == 1 || sysAssem.iAuditStatus??0 == 2))
#set(readonly = 'readonly')
#end

<div class="jbolt_page_title">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="col">
                        <!-- <button onclick="submitThisForm()" class="btn btn-success btn-sm" onclick="submitThisForm()"><i
                                class="fa fa-refresh"></i> 保存</button> -->
                        #if(readonly != 'readonly')
                        <button onclick="submitThisForm_#(pageId)(false)" class="btn btn-success btn-sm"  #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end  ><i
                                class=" fa fa-refresh"></i> 保存</button>
                        #end



                        #include("/_view/_common/_approval_btns.html", formSn="T_Sys_Assem", o=sysAssem,primaryKeyName="AutoID",className="cn.rjtech.admin.sysassem.SysAssemService",permissionKeyPrefix="sysAssem")

                        <button onclick="closeHandler()" class="btn btn-info btn-sm"><i
                                class="fa fa-window-maximize"></i> 关闭
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form onsubmit="return false;" id="sysAssem_#(pageId)" action="#(action)" method="post">
                        #if(sysAssem.AutoID??)
                        <input type="hidden" name="sysAssem.AutoID" value="#(sysAssem.AutoID??)" />
                        #end
                        <input type="hidden" id="detailHidden" name="detailHidden" value="#(detailHidden??)"/>
                        <input type="hidden" id="groupCode" name="groupCode" value="#(groupCode??)"/>
                        <input type="hidden" id="sourceBillType" name="sourceBillType" value="#(sourceBillType??)"/>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">单据号</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输入单据号" disabled
                                            data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输入单据号" maxlength="40" name="sysAssem.BillNo"
                                            value="#(sysAssem.BillNo??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">日期</label>
                                    <div class="col-9">
                                        <input type="text" data-date class="form-control" placeholder="日期" disabled
                                            maxlength="20" name="sysAssem.dcreatetime"
                                            value="#(sysAssem.dcreatetime??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.BillType" value="#(sysAssem.BillType??)"
                                        id="idcode" data-value-attr="id" />
                                    <label class="col-sm-3 col-form-label">转换方式</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end
                                               data-url="admin/formConversionList/dictionary" data-rule="required"
                                            data-hidden-input="idcode" data-text-attr="name"
                                            data-column-attr="id,name" placeholder="请选择转换方式"
                                            data-tips="请选择转换方式" data-header="转换方式编码,转换方式" maxlength="40"
                                            value="#(zhname??)">
                                    </div>
                                </div>
                            </div>

<!--                            <div class="col-md-4">-->
<!--                                <div class="form-group row">-->
<!--                                    <input type="hidden" name="sysAssem.WhCode" value="#(sysAssem.WhCode??)"-->
<!--                                           id="whcode" data-value-attr="whcode"/>-->
<!--                                    <label class="col-sm-3 col-form-label">仓库名称</label>-->
<!--                                    <div class="col-9">-->
<!--                                        <input type="text" class="form-control" data-autocomplete-->
<!--                                               data-url="admin/materialReceiptList/Whcode" data-rule="required"-->
<!--                                               data-hidden-input="whcode"-->
<!--                                               data-sync-ele="#whcode"-->
<!--                                               data-text-attr="whname" name="sysAssem.WhName"-->
<!--                                               data-column-attr="whcode,whname" placeholder="请选择仓库名称"-->
<!--                                               data-tips="请选择仓库名称" data-header="仓库编码,仓库名称" maxlength="40"-->
<!--                                               value="#(sysAssem.WhName??)"-->
<!--                                               #if(sysAssem.iAuditStatus?? ==2 || sysAssem.iAuditStatus?? ==3 || sysAssem.iAuditStatus?? ==1) disabled #end >-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.IRdCode" value="#(sysAssem.IRdCode??)"
                                        id="crdcode" data-value-attr="crdcode" />
                                    <label class="col-sm-3 col-form-label">入库类别</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end
                                               data-url="admin/formConversionList/style?brdflag=1" data-rule="required"
                                            data-hidden-input="crdcode" data-text-attr="crdname"
                                            data-column-attr="crdcode,crdname" placeholder="请选择入库类别"
                                            data-tips="请选择入库类别" data-header="入库类别编码,入库类别" maxlength="40"
                                            value="#(rkname??)">
                                    </div>
                                </div>
                            </div>



                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.DeptCode" value="#(sysAssem.DeptCode??)"
                                        id="cdepcode" data-value-attr="cdepcode" />
                                    <label class="col-sm-3 col-form-label">生产部门</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end
                                               data-url="admin/productInList/getDepartment" data-rule="required"
                                            data-hidden-input="cdepcode" data-text-attr="cdepname"
                                            data-column-attr="cdepcode,cdepname" placeholder="请选择生产部门"
                                            data-tips="请选择生产部门" data-header="生产部门编码,生产部门" maxlength="40"
                                            value="#(cdepname??)">
                                    </div>
                                </div>
                            </div>


                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysAssem.ORdCode" value="#(sysAssem.ORdCode??)"
                                        id="crdcode1" data-value-attr="crdcode" />
                                    <label class="col-sm-3 col-form-label">出库类别</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end
                                               data-url="admin/formConversionList/style?brdflag=0" data-rule="required"
                                            data-hidden-input="crdcode1" data-text-attr="crdname"
                                            data-column-attr="crdcode,crdname" placeholder="请选择出库类别"
                                            data-tips="请选择出库类别" data-header="出库类别编码,出库类别" maxlength="40"
                                            value="#(ckname??)">
                                    </div>
                                </div>
                            </div>



                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">审批日期</label>
                                    <div class="col-9">
                                        <input type="text" data-date class="form-control" placeholder="审批日期" disabled
                                            maxlength="20" name="sysAssem.dAuditTime" value="#(sysAssem.daudittime??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">备注</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输入备注" #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end
                                               data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输入备注" maxlength="40" name="sysAssem.Memo"
                                            value="#(sysAssem.Memo??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">制单人</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输制单人" disabled
                                            data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输制单人" maxlength="40" name="sysAssem.cupdatename"
                                            value="#(sysAssem.cupdatename??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">审核人</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输审核人" disabled
                                               data-with-clearbtn="true" autocomplete="off" class="form-control"
                                               placeholder="请输审核人" maxlength="40" name="sysAssem.cAuditname"
                                               value="#(sysAssem.cauditname??)" />
                                    </div>
                                </div>
                            </div>



                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- 创建Dialog结构 -->
    <div class="dialog-mask" id="dialog-mask">
        <div class="dialog-wrapper">
            <div class="dialog-header">
                <span class="dialog-title">选择人员</span>
                <span class="dialog-close" id="dialog-close">×</span>
            </div>
            <div class="layui-form-item" style="padding-bottom: 0px;padding-top: 15px;margin-bottom: 0px">
                <div class="layui-input-group" style="margin:auto;">

                </div>
            </div>
            <div class="dialog-body">
                <div class="popup-layer" id="popup-layer">
                    <table border width="100%" id="popup_table" style="height: 330px;">
                        <thead>
                        <tr style="height: 35px">
                            <th><input type="checkbox" id="selectAll" onChange="selectAllCheckboxs(event)"></th>
                            <!--                             <th>用户名</th>-->
                            <th>编码</th>
                            <th>姓名</th>
                            <th>手机号</th>
                            <th>部门名称</th>
                        </tr>
                        </thead>
                        <tbody id="layer_tr"></tbody>
                    </table>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-cancel" id="dialog-btn-cancel">取消</button>
                <button class="dialog-btn dialog-btn-ok" id="dialog-btn-ok" onClick="dialogBtnOk()">确定</button>
            </div>
        </div>
    </div>
</div>

### 新增之后，并且为审核流
#if(sysAssem.AutoID?? && sysAssem.iauditway == 2 && sysAssem.iauditstatus != 0)
#include("/_view/admin/approvalm/form_approval_flow.html", formAutoId=sysAssem.AutoID, formSn="T_Sys_PUReceive", btnNeed=1, pId=pageId, primaryKeyName="AutoID", className="cn.rjtech.admin.sysassem.SysAssemService")
#end

<div class="jbolt_page_content">
    <script type="text/template" id="sysAssem_tpl_#(pageId)">
        {@each datas as data,index}
        <tr data-id="${data.autoid}">
            <td>${pageNumber,pageSize,index | rownum}</td>
            #if(readonly == 'readonly')
            <td onclick="dilog(this)" >${data.number}</td>
            #end
            <td>${data.combination}</td>
            <td>${data.assemtype}</td>
            <td>${data.whname}</td>
            <td>${data.posname}</td>
            <td {@if data.autoid} data-editable="false" {@/if}>${data.barcode}</td>
            <td {@if data.autoid} data-editable="false" {@/if}>${data.cinvcode}</td>
            <td>${data.cinvcode1}</td>
            <td>${data.cinvname1}</td>
            <td>${data.dplandate|date_ymd}</td>
            <td>${data.cuomname}</td>
            <td #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) data-editable="false" #end >${data.qty}</td>
<!--            <td #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) data-editable="false" #end >${data.weight}</td>-->
            <td #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) data-editable="false" #end >${data.memo}</td>
            <td hidden>${data.whcode}</td>
            <td hidden>${data.poscode}</td>
            <td hidden>${data.sourcebilldid}</td>
            <td hidden>${data.sourcebilltype}</td>
            <td hidden>${data.ibeforeinventoryid}</td>
            <td hidden>${data.iafterinventoryid}</td>
        </tr>
        {@/each}
    </script>

    <div class="jbolt_table_toolbar buttonDiv  #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1)
 disabled
 #end" id="sysAssem_toolbar_#(pageId)" style="display: flex">
        <div style="padding-right: 15px;">
            <button onclick="insertEmpty(this)" class="btn btn-outline-secondary" #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end  >添加行
            </button>
            <button onclick="jboltTableRemoveCheckedRow(this, true, false)" class="btn btn-outline-secondary" #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end  ><i class="fa fa-trash"></i> 删除</button>
        </div>
        <div class="clearfix">
            <form class="form-inline" id="sysscandeliver_detail_#(pageId)" onsubmit="return false;">
                #if(sysAssem.AutoID??)
                <input type="hidden" name="sysAssem.AutoID" value="#(sysAssem.AutoID??)"/>
                #end
                <input type="text" autocomplete="off" class="form-control"  placeholder="现品票扫码" name="barcode"
                       id="barcode"
                       value="" />
                <button type="button" onclick="searchBarcode()" class="btn btn-outline-secondary" #if(sysAssem.iAuditStatus?? ==2  || sysAssem.iAuditStatus?? ==1) disabled #end  ><i
                        class="fa fa-search"></i> 搜索</button>
<!--                <span style="padding-left: 15px">-->
<!--                <input type="hidden" name="careacode" value="#(careacode??)"-->
<!--                       id="careacode" data-value-attr="careacode"/>-->
<!--                <input type="hidden" name="careaname" value="#(careaname??)"-->
<!--                       id="careaname" data-sync-attr="careaname"/>-->
<!--                <input type="text" class="form-control" data-autocomplete-->
<!--                       data-sync-ele="#careacode,careaname"-->
<!--                       data-link-para-ele="#whcode"-->
<!--                       data-url="admin/scancodereceive/findWhArea"-->
<!--                       data-hidden-input="rdcode" data-text-attr="careacode"-->
<!--                       data-column-attr="careacode,careaname" placeholder="请选择库区"-->
<!--                       data-tips="请选择库区" data-header="请选择库区,库名称" maxlength="40"-->
<!--                       value="#(careaname??)">-->
<!--                    </span>-->
<!--                <button type="button" class="btn btn-outline-secondary" onclick="coverall()"><i class="fa fa-refresh"></i>-->
<!--                    覆盖库区</button>-->
            </form>
        </div>
    </div>
    <table class="jbolt_table thead_font_normal table-bordered table-center"
           id="jbolt_Table_#(pageId)"
           data-jbolttable
           data-ajax-success-handler="tableDataSuccess()"
           data-width="auto"
           data-height="fill"
           data-ajax="true"
           data-page="sysAssem_tpl_#(pageId)"
           data-url="admin/sysAssemdetail/findEditTableDatas?masid=#(sysAssem.AutoID??)"
           data-column-prepend="1:checkbox:true"
           data-toolbar="sysAssem_toolbar_#(pageId)"
           data-url="admin/sysAssemdetail/findEditTableDatas"
           data-conditions-form="sysAssem_#(pageId)"
           data-rowtpl="sysAssem_tpl_#(pageId)"
           data-column-resize="true"
           data-editable="true"
           data-editable-option="getJBoltTableEditableColsOpton_#(pageId)">
        <thead>
        <tr>
            <th data-width="60" data-column="index">序号</th>
            #if(readonly == 'readonly')
            <th data-width="150">条码数</th>
            #end
            <th data-width="60" data-column="combination">组号</th>
            <th data-width="100" data-column="assemtype">类型</th>
            <th data-width="200" data-column="whname">仓库名称</th>
            <th data-width="150" data-column="posname">库区</th>
            <th data-min-width="150" data-column="barcode">现品票</th>
            <th data-width="150" data-column="cinvcode">存货编码</th>
            <th data-width="150" data-column="cinvcode1">客户部番</th>
            <th data-width="110" data-column="cinvname1">部品名称</th>
            <th data-width="100" data-column="dplandate">计划到货日期</th>
            <th data-width="130" data-column="cuomname">主计量单位</th>
            <th data-width="100" data-column="qty">数量</th>
<!--            <th data-width="100" data-column="weight">重量</th>-->
            <th data-width="100" data-column="memo">备注</th>
            <th data-width="150" data-column="whcode" hidden>仓库</th>
            <th data-width="100" data-column="poscode" hidden>入库库区</th>
            <th data-width="100" data-column="sourcebilldid" hidden>行号</th>
            <th data-width="100" data-column="sourcebilltype" hidden>单据类型</th>
            <th data-width="100" data-column="ibeforeinventoryid" hidden>转换前存货id</th>
            <th data-width="100" data-column="iafterinventoryid" hidden>转换后存货id</th>
        </tr>
        </thead>
    </table>

</div>
#define js()
<script>
    hideParentLayerDialogBtn(0);
    hideParentLayerDialogBtn(1);

    var dialogMask = document.getElementById("dialog-mask");
    document.getElementById("dialog-btn-cancel").onclick = function() {
        dialogMask.style.display = "none";
    }
    document.getElementById("dialog-close").onclick = function(){
        dialogMask.style.display = "none";
    }
    function dilog(e){
        var table = $(e).parent().parent();
        var data = jboltTableGetRowJsonData(table, $(e).parent());
        console.log(data);
        // 获取Dialog元素
        dialogMask.style.display = "block";
    }

    /**
     * 搜索现品票
     * */
    function searchBarcode() {
        var barcode = $("#barcode").val();
        if (barcode != null && barcode !== ''){
            var index = LayerMsgBox.loading("执行中......",4000);
            var data = getJboltTableAllDatas("jbolt_Table_#(pageId)",["barcode"]);
            if (data != null){
                for (let i = 0; i < data.length; i++) {
                    if(data[i].barcode === barcode){
                        LayerMsgBox.error("条码已重复");
                        return;
                    }
                }
            }
            var detailHidden = $("#detailHidden").val();
            var groupCode = $("#groupCode").val();
            Ajax.post("admin/formConversionList/getBarcode", {"barcode": barcode,"detailHidden":detailHidden,"groupCode":groupCode},
                function (res) {
                    if (res.state==='ok'){
                        var trJsonData = res.data;
                        jboltTableInsertRow("jbolt_Table_#(pageId)", trJsonData, false);
                        console.log("trJsonData",trJsonData)
                        $("#barcode").val('');
                        Ajax.post("admin/formConversionList/getBarCodeData",
                            {"sourcebillno": trJsonData.sourcebillno,"vencode":trJsonData.vencode,
                                "venname":trJsonData.venname,"iafterinventoryid":trJsonData.iafterinventoryid,"ibeforeinventoryid":trJsonData.ibeforeinventoryid,"qty":trJsonData.qty,
                                "whcode":trJsonData.whcode, "whname":trJsonData.whname, "poscode": trJsonData.poscode , "posname": trJsonData.posname  },
                            function(rres) {
                                console.log('rres', rres)
                                if (rres.state==='ok'){
                                    console.log('data',rres.data);
                                    if (rres.data!==undefined){
                                        // res.data.assemtype = '转换后';
                                        // res.data.combination = trJsonData.combination;
                                        // tableDataSuccess();

                                        rres.data.assemtype = '转换后';
                                        rres.data.combination = trJsonData.combination;
                                        jboltTableInsertRow("jbolt_Table_#(pageId)", rres.data, false, false, false);
                                        tableDataSuccess();
                                        LayerMsgBox.close(index);
                                    } else {
                                        console.log('找不到双单位数据')
                                    }
                                }
                                LayerMsgBox.close(index);
                            },function (err) {
                                LayerMsgBox.close(index);
                            })
                    }
                }, function (err) {
                })
        } else {

        }

    }

    //是否提审
    var submit = false;

    /**
     * 保存方法
     */
    function submitThisForm_#(pageId)(ele) {
        if(ele)
        {
            submit = ele;
        }
        jboltTableSubmit("#jbolt_Table_#(pageId)");
    }

    /**
     * 覆盖库区
     * */
    function coverall() {
        var careacode = $("#careacode").val();
        var careaname = $("#careaname").val();
        if (careacode !== '' && careacode !== null){
            let data = [{"column":"poscode","text":careacode,"value":careacode}];
            jboltTableBatchSetColumns("jbolt_Table_#(pageId)",data,true);
        }
    }

    /**
     * 添加行
     * */
    function insertEmpty(ele) {
        var isSuccess = tableDataSuccess();
        if (isSuccess){
            jboltTableInsertEmptyRow(ele);
        }
    }

    /**
     * 是否初物判断
     * */
    function switchEditableTd(ele) {
        alert('111')
        console.log('ele===>',ele)
    }

    /**
     * 获取表格数据
     * */
    function tableDataSuccess() {
        $("#groupCode").val("");
        let groupCode = 1;
        var data = getJboltTableAllDatas("jbolt_Table_#(pageId)",["cinvcode"]);
        console.log("data"+data)
        if(null != data && data.length % 2 == 0){
            groupCode+=data.length/2
        }

        $("#groupCode").val(groupCode);
        return true;
    }

    /**
     * 保存方法
     */
    function submitThisForm() {
        jboltTableSubmit("#jbolt_Table_#(pageId)");
        return true;
    }

    function getJBoltTableEditableColsOpton_#(pageId)() {
        var editableTableOptions = {
            trigger: "click",
            submit: {
                withForm: ["sysAssem_#(pageId)"],
                type: "all",
                url: "/admin/formConversionList/submitAll",
                success: function (res) {
                    if (res.state === 'ok') {
                        if (submit) {
                            submit_#(pageId)(res.data.autoid,function () {
                                LayerMsgBox.success("提交成功", 600, function () {
                                    parent.refreshPjaxContainer();
                                    parent.layer.closeAll();
                                });
                            });
                        } else {
                            LayerMsgBox.success("提交成功", 600, function () {
                                parent.refreshPjaxContainer();
                                parent.layer.closeAll();
                            });
                        }
                    }
                }
            },
            cols: {
                AutoID: {
                    submitAttr: "AutoID",
                },
                qty:  { //单价
                    type:"amount",
                    required:true,
                    textFormat: function (table, td, text, value, trJsonData) {
                    return (typeof(text)==undefined||typeof(text)=="undefined"||(typeof(text)=='string'&&text.length==0))?"":numberFormat(value,2);
                    },
                    editorFormat:function(table,td,text,value,trJsonData){
                        //编辑器内显示格式化
                        if(!value){return "";}
                        value=value.replaceAll(",","");
                        console.log(removeFixedNumberAllZero(value,2));
                        return removeFixedNumberAllZero(value,2);
                    }
                },
                memo: {
                    type: "input",//类型
                    // required: true,
                    placeholder: "备注", //输入提示，里面
                    tooltip: "备注",//输入提示，上方
                },
                // qty: {
                //     type: "amount",//类型
                //     required: true,
                //     placeholder: "数量", //输入提示，里面
                //     tooltip: "数量",//输入提示，上方
                // },
                // weight: {
                //     type: "amount",//类型
                //     required: true,
                //     placeholder: "重量", //输入提示，里面
                //     tooltip: "重量",//输入提示，上方
                // },
                weight:  { //重量
                    type:"amount",
                    required:true,
                    textFormat: function (table, td, text, value, trJsonData) {
                    return (typeof(text)==undefined||typeof(text)=="undefined"||(typeof(text)=='string'&&text.length==0))?"":numberFormat(value,2);
                    },
                    editorFormat:function(table,td,text,value,trJsonData){
                        //编辑器内显示格式化
                        if(!value){return "";}
                        value=value.replaceAll(",","");
                        console.log(removeFixedNumberAllZero(value,2));
                        return removeFixedNumberAllZero(value,2);
                    }
                },
                sourcebilltype:{
                    submitAttr:"SourceBillType"
                },
                whcode: {
                    placeholder: "仓库", //输入提示，里面
                    tooltip: "仓库",//输入提示，上方
                    type: "autocomplete",
                    //目前供应商都是空的无法过滤
                    url: "admin/SysEnumeration/wareHouse",
                    maxLength: 100,
                    // required: true,
                    textAttr: "whcode",
                    width: 500,
                    valueAttr: "whcode",//选择赋值的字段
                    columnAttr: "whcode,whname",//下来看的时候显示哪些字段
                    header: '仓库编码,仓库名称',
                    changeColumns: [{ column: "whcode", use: "whcode" }]
                },
                poscode: {
                    linkPara: "#whcode",
                    placeholder: "库区", //输入提示，里面
                    tooltip: "库区",//输入提示，上方
                    type: "autocomplete",
                    //根据仓库过滤
                    // linkColumn:"whcode",
                    url: "admin/scancodereceive/findWhArea",
                    maxLength: 100,
                    // required: true,
                    placeholder: "请选择库区编码",
                    textAttr: "careacode",
                    width: 500,
                    valueAttr: "careacode",//选择赋值的字段
                    columnAttr: "careacode,careaname",//下来看的时候显示哪些字段
                    header: '库区,库区名称',
                    changeColumns: [{column: "poscode", use: "careacode"}]
                },
                combination:{
                    submitAttr:"Combination"
                },
                assemtype:{
                    submitAttr:"AssemType"
                },
                sourcebillno:{
                    submitAttr:"SourceBillNo"
                },
                cinvcode11:{
                    linkPara: "input[name='detailHidden'],input[name='groupCode']",
                    maxLength: 100,
                    required: true,
                    placeholder: "=请选择=",
                    type: "autocomplete",
                    url: "admin/scancodereceive/getResource",
                    textAttr: "barcode",
                    width: 800,
                    sync: "",
                    valueAttr: "barcode",
                    columnAttr: "barcode,cinvcode,cinvcode1,cinvname1,cinvstd,qty",
                    header: '现品票,存货编码,客户部番,部品名称,规格型号,数量',
                    changeColumns: [{column: "barcode", use: "barcode"}, {
                        column: "cinvcode",
                        use: "cinvcode"
                    }, {column: "cinvcode1", use: "cinvcode1"},{column: "assemtype", use: "assemtype"},
                        {column: "cinvname1", use: "cinvname1"},{column: "combination", use: "combination"},
                        {column: "cinvstd",use: "cinvstd"}, {column: "dplandate", use: "dplandate"},
                        {column: "vencode",use: "vencode"}, {column: "venname", use: "venname"},
                        {column: "cinvccode", use: "cinvccode"}, {column: "cinvcname",use: "cinvcname"},
                        {column: "cuomname", use: "cuomname"}, {column: "sourcebilltype", use: "sourcebilltype"},
                        {column: "sourcebillno", use: "sourcebillno"},{column: "sourcebilldid", use: "sourcebilldid"},
                        {column: "sourcebillnorow", use: "sourcebillnorow"}, {column: "sourcebillid",use: "sourcebillid"},
                        {column: "qty", use: "qty"}, {column: "quantity", use: "quantity"}],
                    handler:function(table,td,text,value,trJsonData){
                        var cinvcode = trJsonData.cinvcode;
                        var vencode = trJsonData.vencode;
                        var sourcebilltype = trJsonData.sourcebilltype;
                        var qty = trJsonData.qty;
                        Ajax.post("admin/formConversionList/getBarCodeData",
                            {"itemCode": cinvcode,"supplier":vencode,"sourceBillType":sourcebilltype,"qty":qty},
                            function(res) {
                                console.log('res', res)
                                if (res.state==='ok'){
                                    console.log('data',res.data);
                                    if (res.data!=undefined){
                                        res.data.assemtype = '转换后';
                                        res.data.combination = trJsonData.combination;
                                        jboltTableInsertAfterRow(table, td.parent(), res.data);
                                    } else {
                                        console.log('找不到双单位数据')
                                    }
                                }
                            },function (err) {

                            })
                    }
                },
                vencode:{
                    submitAttr:"VenCode"
                },
                barcode: { //条码
                    linkPara: "input[name='detailHidden'],input[name='groupCode']",
                    maxLength: 100,
                    // required: true,
                    placeholder: "=请选择=",
                    type: "autocomplete",
                    url: "admin/formConversionList/getResource",
                    textAttr: "barcode",
                    width: 800,
                    sync: "",
                    valueAttr: "barcode",
                    columnAttr: "barcode,cinvcode,cinvcode1,cinvname1,cinvstd,qty",
                    header: '现品票,存货编码,客户部番,部品名称,规格型号,数量',
                    changeColumns: [{column: "barcode", use: "barcode"}, { column: "cinvcode", use: "cinvcode"},
                        { column: "invcode", use: "cinvcode"}, {column: "cinvcode1", use: "cinvcode1"},{column: "assemtype", use: "assemtype"},
                        {column: "cinvname1", use: "cinvname1"},{column: "combination", use: "combination"},
                        {column: "cinvstd",use: "cinvstd"}, {column: "dplandate", use: "dplandate"},
                        {column: "vencode",use: "vencode"}, {column: "venname", use: "venname"},
                        {column: "posname",use: "posname"}, {column: "poscode", use: "poscode"},
                        {column: "whname",use: "whname"}, {column: "whcode", use: "whcode"},, {column: "autoiddetail", use: "autoiddetail"},
                        {column: "cinvccode", use: "cinvccode"}, {column: "cinvcname",use: "cinvcname"},
                        {column: "cuomname", use: "cuomname"}, {column: "sourcebilltype", use: "sourcebilltype"},
                        {column: "sourcebillno", use: "sourcebillno"},{column: "sourcebilldid", use: "sourcebilldid"},
                        {column: "sourcebillnorow", use: "sourcebillnorow"}, {column: "sourcebillid",use: "sourcebillid"},
                        {column: "qty", use: "qty"},{column: "weight", use: "qty"}, {column: "quantity", use: "quantity"}, {column: "iafterinventoryid", use: "iafterinventoryid"}
                        , {column: "ibeforeinventoryid", use: "ibeforeinventoryid"}],
                    handler:function(table,td,text,value,trJsonData){
                        Ajax.post("admin/formConversionList/getBarCodeData", {"sourcebillno": trJsonData.sourcebillno,"vencode":trJsonData.vencode,
                                "venname":trJsonData.venname,"iafterinventoryid":trJsonData.iafterinventoryid,"ibeforeinventoryid":trJsonData.ibeforeinventoryid,"qty":trJsonData.qty,
                                "whcode":trJsonData.whcode, "whname":trJsonData.whname, "poscode": trJsonData.poscode , "posname": trJsonData.posname  },
                            function(res) {
                                console.log('res', res)
                                if (res.state==='ok'){
                                    console.log('data',res.data);
                                    if (res.data!=undefined){
                                        res.data.assemtype = '转换后';
                                        res.data.combination = trJsonData.combination;
                                        tableDataSuccess();
                                        jboltTableInsertAfterRow(table, td.parent(), res.data,false,false,true);
                                    } else {
                                        console.log('找不到双单位数据')
                                    }
                                }
                            },function (err) {

                            })
                    }
                },
            }
        };
        return editableTableOptions;
    }

</script>
#end
<style>
    /* 设置Dialog的样式 */
    .dialog-mask {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        text-align: center;
        display: none;
    }

    .dialog-wrapper {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 600px;
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .dialog-header {
        padding: 10px;
        background-color: #f5f7fa;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
        border-bottom: 1px solid #ebeef5;
    }

    .dialog-title {
        font-size: 16px;
        font-weight: bold;
        color: #303133;
    }

    .dialog-close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 2rem;
        color: #909399;
        cursor: pointer;
    }

    .dialog-body {
        padding: 20px;
        font-size: 14px;
        color: #606266;
    }

    .dialog-footer {
        padding: 10px;
        text-align: right;
        border-top: 1px solid #ebeef5;
    }

    .dialog-btn {
        display: inline-block;
        padding: 10px 20px;
        font-size: 14px;
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
    }

    .dialog-btn-cancel {
        background-color: #c0c4cc;
        margin-right: 10px;
    }

    .dialog-btn-ok {
        background-color: #409eff;
    }
    .popup-layer{
        width:100%;
        height:330px;
        overflow-y: scroll;
    }
    .hide{
        display: none;
    }
</style>
