#set(pageId=RandomUtil.random(6))
<form onsubmit="return false;" id="personForm_#(pageId)" action="#(action)" method="post">
    
    <div class="row">
        <div class="col-md-auto">
            <p style="font-size: 15px;font-weight:600;"><span>基本信息</span></p>
        </div>
    </div>
    
    <input type="hidden" name="person.iautoid" value="#(person.iautoid??)"/>
    
    <div class="form-group row">
        <input type="hidden" name="person.iuserid" value="#(person.iuserid??)" id="iuserid" data-value-attr="id"/>
        <label class="col-sm-1 col-form-label">所属用户名</label>
        <div class="col">
            <input type="text" class="form-control" #if(person.iuserid??) disabled #end
                   data-autocomplete
                   data-url="admin/user/autocomplete"
                   data-hidden-input="iuserid"
                   data-text-attr="name"
                   data-column-attr="username,name,phone"
                   placeholder="请选择"
                   data-tips="请选择"
                   data-header="用户名,姓名,电话"
                   maxlength="40"
                   value="#(person.cusername??)"
            >
        </div>
        <label class="col-sm-1 col-form-label">人员编码</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off" class="form-control" data-rule="required" placeholder="请输入人员编码" maxlength="20" name="person.cPsn_Num" value="#(person.cPsn_Num??)"/>
        </div>
        <label class="col-sm-1 col-form-label">姓名</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off" class="form-control" data-rule="required" placeholder="请输入姓名" maxlength="40" name="person.cPsn_Name" value="#(person.cPsn_Name??)"/>
        </div>
    </div>
    
    <div class="form-group row">
        <label class="col-sm-1 col-form-label">证件号码</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入证件号码" maxlength="18" name="person.vidno" value="#(person.vidno??)"/>
        </div>
        <div class="row col-sm-4" style="padding: 0; margin: 0" data-radio data-name="person.isex" data-value="#(person.isex??'1')">
            <label class="col-sm-3 col-form-label">性别</label>
            <div class="col text-left" style="padding-top: 1px;">
                <div class="radio radio-primary  radio-inline">
                    <input id="r_isex_false" type="radio" name="person.isex" value="1"/>
                    <label for="r_isex_false">男</label>
                </div>
                <div class="radio radio-primary  radio-inline">
                    <input id="r_isex_true" type="radio" name="person.isex" value="2"/>
                    <label for="r_isex_true">女</label>
                </div>
            </div>
        </div>
        <label class="col-sm-1 col-form-label">人员类别</label>
        <div class="col">
            <select class="form-control"
                    name="person.rpersontype"
                    data-autoload
                    data-url="admin/dictionary/options?key=rPersonType"
                    data-value-attr="sn"
                    data-text-attr="name"
                    data-text="=请选择="
                    data-select="#(person.rpersontype??)">
            </select>
        </div>
    </div>
    
    <div class="form-group row">
        <label class="col-sm-1 col-form-label">手机号</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" data-rule="number" data-notnull="false" autocomplete="off" class="form-control" placeholder="请输入手机" maxlength="100" name="person.cpsnmobilephone" value="#(person.cpsnmobilephone??)"/>
        </div>
        <label class="col-sm-1 col-form-label">工号</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入工号" maxlength="20" name="person.jobnumber" value="#(person.jobnumber??)"/>
        </div>
        <label class="col-sm-1 col-form-label">电子卡号</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入电子卡号" maxlength="30" name="person.cecardno" value="#(person.cecardno??)"/>
        </div>
    </div>
    
    <div class="form-group row">
        <label class="col-sm-1 col-form-label">所属部门</label>
        <div class="col">
            <select class="form-control" name="person.cDept_num"
                    data-autoload
                    data-with-clearbtn="true"
                    data-select-type="select2"
                    data-tips="请选择"
                    data-url="admin/department/getTreeTableDatas"
                    data-text="=请选择="
                    data-text-attr="cdepname"
                    data-value-attr="cdepcode"
                    data-select="#(person.cdept_num??)"
            >
            </select>
        </div>
        <label class="col-sm-1 col-form-label">在职状态</label>
        <div class="col">
            <select class="form-control"
                    name="person.remploystate"
                    data-autoload
                    data-url="admin/dictionary/options?key=job_type"
                    data-value-attr="sn"
                    data-text-attr="name"
                    data-text="=请选择="
                    data-select="#(person.remploystate??)">
            </select>
        </div>
        <label class="col-sm-1 col-form-label">入职日期</label>
        <div class="col">
            <input type="text" data-date data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入日期" maxlength="10" name="person.dhiredate" value="#datetime(person.dhiredate??,'yyyy-MM-dd')"/>
        </div>
    </div>
    
    <div class="form-group row">
        <label class="col-sm-1 col-form-label">所属工种</label>
        <div class="col">
            <select class="form-control"
                    name="person.iworkclassid"
                    data-autoload
                    data-url="admin/workclass/options"
                    data-value-attr="iautoid"
                    data-text-attr="cworkclassname"
                    data-text="=请选择="
                    data-select="#(person.iworkclassid??)">
            </select>
        </div>
        <label class="col-sm-1 col-form-label">工龄</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" disabled autocomplete="off" class="form-control" data-rule="pnumber;fix<=2;" data-notnull="false" placeholder="请输入工龄" maxlength="10" name="person.sysworkage" value="#(person.sysworkage??)"/>
        </div>
        <label class="col-sm-1 col-form-label">出生日期</label>
        <div class="col">
            <input type="text" data-date data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入出生日期" maxlength="10" name="person.dbirthdate" value="#datetime(person.dbirthdate??,'yyyy-MM-dd')"/>
        </div>
    </div>
    
    <div class="form-group row">
        <label class="col-sm-1 col-form-label">邮箱</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入Email" maxlength="100" name="person.cpsnemail" value="#(person.cpsnemail??)"/>
        </div>
    </div>
    <div class="form-group row"
         data-radio
         data-rule="radio"
         data-value="#(person.isenabled??'1' == '1'? 'true' : 'false')"
         data-name="person.isenabled"
         data-default="options_first"
         data-width="col-sm-1"
    >
        <label class="col-sm-1 col-form-label">是否启用</label>
        <div class="col" style="padding-top: 1px;">
            <div class="radio radio-primary  radio-inline">
                <input id="r_isenabled_true" type="radio" name="person.isenabled" value="true"/>
                <label for="r_isenabled_true">是</label>
            </div>

            <div class="radio radio-primary  radio-inline">
                <input id="r_isenabled_false" type="radio" name="person.isenabled" value="false"/>
                <label for="r_isenabled_false">否</label>
            </div>
        </div>
    </div>
    
    <div class="form-group row">
        <label class="col-sm-1 col-form-label">备注</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入备注" maxlength="200" name="person.cmemo" value="#(person.cmemo??)"/>
        </div>
    </div>
    
    <!-- <div class="row">
        <div class="col-md-auto">
            <p style="font-size: 15px;font-weight:600;"><span>业务或者费用部门</span></p>
        </div>
    </div>
    <div class="form-group row">
        <label class="col-sm-1 col-form-label">业务或费用部门</label>
        <div class="col">
            <select class="form-control" name="cdeptnum"
                data-autoload
                data-with-clearbtn="true"
                data-select-type="select2"
                data-tips="请选择"
                data-url="admin/dept/enableOptions"
                data-text="=请选择="
                data-value=""
                >
            </select>
        </div>
        <label class="col-sm-1 col-form-label">操作员编码</label>
        <div class="col">
            <select class="form-control" name="cdeptnum"
                data-autoload
                data-with-clearbtn="true"
                data-select-type="select2"
                data-tips="请选择"
                data-url="#"
                data-text="=请选择="
                data-value=""
                >
            </select>	
        </div>
        <label class="col-sm-1 col-form-label">操作员名称</label>
        <div class="col">
            <input type="text" data-with-clearbtn="true" autocomplete="off"  class="form-control"  placeholder="请输入备注" maxlength="200" name="person.cmemo" value="#(person.cmemo??)"/>			
        </div>
    </div> -->
    
</form>

<div class="row">
    <div class="col-md-auto">
        <p style="font-size: 15px;font-weight:600;"><span>操作资质</span></p>
    </div>
</div>

<!-- JBoltTable的数据模板定义-->
<textarea class="jb_tpl_box" id="jbolt_table_rowtpl_#(pageId)">
{@each datas as data,index}
    <tr data-id="${data.iautoid}" >
    <td>${pageNumber,pageSize,index | rownum}</td>
    <td>
        <a data-ajaxbtn href="/admin/person/deleteByAjax" data-loading="执行中 " tooltip data-title="删除" data-handler="removeTr" data-confirm="确定删除此数据？" class="jbolt_table_delbtn">删除</a>
    </td>
    <td>${data.cequipmentcode}</td>
    <td>${data.cequipmentname}</td>
    <td>${data.cworkname}</td>
    </tr>
{@/each}
</textarea>

<!-- 工具条 toolbar -->
<div class="jbolt_table_toolbar" id="jbolt_table_toolbar_#(pageId)">
    <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
        <button onclick="jboltTableInsertEmptyRow(this)" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> 新增</button>
        <!--  <button onclick="jboltTableRemoveCheckedRow(this)" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i> 删除</button>
         <button onclick="jboltTableRefresh(this,'刷新会丢失新添加未保存的数据，确认刷新吗？')" class="btn btn-success btn-sm"><i class="fa fa-refresh"></i> 刷新</button> -->
    </div>
</div>

<table class="jbolt_table thead_font_normal table-bordered table-center"
       data-jbolttable
       id="jbolt_Table_#(pageId)"
       data-height="400"
       data-width="auto"
       #if(!person.iautoid??)
       data-autoload="false"
       #end
       data-column-resize="true"
       data-rowtpl="jbolt_table_rowtpl_#(pageId)"
       data-toolbar="jbolt_table_toolbar_#(pageId)"
       data-ajax="true"
       data-url="/admin/personequipment/findEditableDatas?iPersonId=#(person.iautoid??)"
       data-editable="true"
       data-editable-option="getEditableTableOptions_#(pageId)"
>
    <thead>
    <tr>
        <th data-width="60">序号</th>
        <th data-width="100">操作</th>
        <th data-column="cequipmentcode" data-width="150">设备编码</th>
        <th data-column="cequipmentname" data-width="100">设备名称</th>
        <th data-column="cworkname" data-width="120">产线名称</th>
    </thead>
    <tbody>
    </tbody>
</table>

#define js()
<script>
    function submitThisForm() {
        jboltTableSubmit("#jbolt_Table_#(pageId)");
    }

    //获得配置参数
    function getEditableTableOptions_#(pageId)() {
        var editableTableOptions = {
            trigger: "click",
            // 初始行数
            //initRowCount:1,
            // 限制最大数 默认30
            submit: {
                withForm: ["personForm_#(pageId)"],
                name: 'personForm',
                type: "all",//cell|all
                //params:{"orderId":3},//携带其他额外参数
                url: "admin/person/submitTable",
                success: function (res) {
                    LayerMsgBox.success("提交成功", 600, function () {
                        parent.refreshPjaxContainer();
                        parent.layer.closeAll();
                    });
                }
            },
            cols: {
                iautoid: {
                    submitAttr: "iautoid",
                },
                cequipmentcode: {
                    type: "autocomplete",
                    url: "admin/equipment/autocomplete",
                    maxLength: 100,
                    placeholder: "请选择",
                    textAttr: "cequipmentcode",
                    width: 500,
                    required: true,
                    valueAttr: "cequipmentcode",
                    columnAttr: "cequipmentcode,cequipmentname,cworkname",
                    header: '设备编码,设备名称,产线名称',
                    changeColumns: [{column: "cequipmentcode", use: "cequipmentcode"}, {column: "cequipmentname", use: "cequipmentname"},
                        {column: "iequipmentid", use: "iautoid"}, {column: "cworkname", use: "cworkname"}]
                }
            }
        };
        return editableTableOptions;
    }
</script>
#end

