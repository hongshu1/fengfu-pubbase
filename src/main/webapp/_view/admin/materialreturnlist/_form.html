#@hiprintcss()
#set(pageId=RandomUtil.random(6))
<div class="jbolt_page">
    <div style="text-align: center; font-size: 24px; color: red">采购入库单</div>
    <div class="jbolt_page_content">
        <form onsubmit="return false;" id="PuinstoreForm" action="#(action)" method="post">
            <div class="jbolt_table_toolbar" id="bomcompare_split_toolbar_#(pageId)">
                <div class="col-md-l pt-2" role="group" aria-label="btn-group">
<!--                    <button onclick="submitAllTables_#(pageId)(this)" #if(type=="0") style="display: none" #end-->
<!--                            data-id="1" data-value="save" class="btn btn-success btn-sm"><i class="fa fa-refresh"></i>-->
<!--                        保存-->
<!--                    </button>-->

<!--                    <button onclick="submitAllTables_#(pageId)(this)" #if(puinstore.iauditstatus != 0) style="display: none"  #end-->
<!--                            data-id="1" data-value="submit" type="submit" class="btn btn-info btn-sm"><i-->
<!--                            class="fa fa-window-maximize"></i> 提交-->
<!--                    </button>-->
<!--                    <button onclick="audit_#(pageId)(this)"-->
<!--                            data-id="2" data-value="submit" type="submit" class="btn btn-info btn-sm"><i-->
<!--                            class="fa fa-window-maximize"></i> 审核-->
<!--                    </button>-->
<!--                    <button onclick="NoApprove_#(pageId)(this)"-->
<!--                            data-id="1" data-value="submit" type="submit" class="btn btn-info btn-sm"><i-->
<!--                            class="fa fa-window-maximize"></i> 反审核-->
<!--                    </button>-->
                    #if(puinstore.autoid??)
                    ### 参数列表
                    ### uri:                接口URI
                    ### formSn:             表单名
                    ### o:                  当前表单对象名
                    ### primaryKeyName:     主键名
                    ###include("/_view/_common/_approval_btns.html", uri="/admin/monthorderm", formSn="Co_MonthOrderM", o=monthorderm, edit=edit??, primaryKeyName="iAutoId")

                    #include("/_view/_common/_approval_btns.html", uri="/admin/materialreturnlist", formSn="T_Sys_PUInStore", o=puinstore, edit=edit??, primaryKeyName="autoid")
                    #end
                    <button onclick="closeHandler()" class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i>
                        关闭
                    </button>
                </div>
            </div>
            #if(puinstore.autoid??)
            <input type="hidden" id="puinstoreautoid" name="puinstore.autoid" value="#(puinstore.autoid??)"/>
            #end
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">入库单号：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstore.billno??)
                </div>
                <label class="col-sm-2 col-form-label">入库日期：</label>
                <div class="col-sm-2 col-form-label">
                    #datetime(puinstore.billdate??,'yyyy-MM-dd')
                </div>
                <label class="col-sm-2 col-form-label">仓库名称：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstore.whname??)
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-2 col-form-label">订单号：</label>
                <div class="col-sm-2 col-form-label">
                    <div class="input-group-append">
                        #(puinstore.sourcebillno??)
                    </div>
                </div>


                <label class="col-sm-2 col-form-label">部门：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstoreName.cdepname??)
                </div>

                <label class="col-sm-2 col-form-label">采购类型：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstoreName.cptname??)
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-2 col-form-label">供货单位：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstoreName.cvenname??)
                </div>

                <label class="col-sm-2 col-form-label">审批日期：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstore.dCreateTime??)
                </div>

                <label class="col-sm-2 col-form-label">入库类别：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstoreName.crdname??)
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-2 col-form-label">备注：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstore.memo??)
                </div>

                <label class="col-sm-2 col-form-label">业务员：</label>
                <div class="col-sm-2 col-form-label">
                    #(puinstore.createperson??)
                </div>
			</div>
			<div class="form-group row">
				<div class="col-11" style="margin-left: 180px;">
					<div class="jbolt_page_content">
						#render("_table_split.html")
					</div>
				</div>
			</div>

			<div class="form-group row">
				<label class="col-sm-2 col-form-label">制单人：</label>
				<div class="col-sm-2 col-form-label">
                    #(puinstore.ccreatename??)
				</div>
				<label class="col-sm-2 col-form-label">审核人：</label>
				<div class="col-sm-2 col-form-label">
                    #(puinstore.auditperson??)
				</div>
			</div>
		</form>
    </div>
</div>
#@hiprintjs()
#define js()
<script>
    hideParentLayerDialogBtn();


    function submitThisForm() {
        return true;
    }

    /**
     * 审核
     * */
    function audit_#(pageId)(ele) {
        var action = getRealJqueryObject(ele);
        var iAutoId = $("#puinstoreautoid").val();
        var mark = action.data("id");
        if (!isEmpty(iAutoId)) {
            Ajax.post("/admin/materialreturnlist/approve", {"iAutoId":iAutoId, "mark":mark},function (res) {
                LayerMsgBox.success(res.msg,1000,function () {
                    parent.refreshJBoltTable();
                    parent.layer.close(parent.layer.getFrameIndex(window.name)); //关闭弹窗
                })
            },function (err) {
                LayerMsgBox.error("请保存提交。后审核！！！",2000)
            })
        } else {
            LayerMsgBox.error("未找到此单据",1000)
        }
    }

    /**
     * 审核
     * */
    function NoApprove_#(pageId)(ele) {
        var action = getRealJqueryObject(ele);
        var iAutoId = $("#puinstoreautoid").val();
        var mark = action.data("id");
        if (!isEmpty(iAutoId)) {
            debugger;
            Ajax.post("/admin/materialreturnlist/NoApprove", {"ids":iAutoId, "mark":mark},function (res) {
                LayerMsgBox.success(res.msg,1000,function () {
                    parent.refreshJBoltTable();
                    parent.layer.close(parent.layer.getFrameIndex(window.name)); //关闭弹窗
                })
            },function (err) {
                LayerMsgBox.error("请保存提交。后审核！！！",2000)
            })
        } else {
            LayerMsgBox.error("未找到此单据",1000)
        }
    }


    function submitAllTables_#(pageId)(ele){
        var action = getRealJqueryObject(ele);
        var id = action.data("id");
        var value = action.data("value");
        var tables = ["Puinstoreform_TableId_#(pageId)"];
        if (checkTds()) {
            jboltTableSubmitMulti(tables, "/admin/materialreturnlist/submitMulti?param=" + id + "&revokeVal=" + value, function (res) {
                if (res.state == "ok") {
                    LayerMsgBox.success(res.msg, 600, function () {
                        debugger;
                        let id = res.AutoID;
                        if (value == "submit"){
                            parent.refreshJBoltTable();
                            // parent.refreshPjaxContainer();
                            // parent.refreshCurrentTabContent();//刷新当前页面
                            self.location.href = "/admin/materialreturnlist/edit/"+id+"-_jb_rqtype_dialog"; //新增的刷新
                        }else {
                            parent.refreshCurrentTabContent();//刷新当前页面
                            // refreshPjaxContainer();
                            parent.layer.close(parent.layer.getFrameIndex(window.name)); //关闭弹窗
                        }
                    })
                } else {
                    LayerMsgBox.error(res.msg);
                }
            });
        }

    }


    function closeHandler() {
        parent.layer.close(parent.layer.getFrameIndex(window.name));
        window.parent.refreshJBoltTable();
    }

    /**
     * 获得选中的订单号数据
     * @param data
     */
    function setChooseDialogSelectResultFromSupplier(data) {
        $("#deptcode").val(data.deptcode);
        $("#deptname").val(data.deptname);
        $("#venname").val(data.venname);
        $("#vencode").val(data.vencode);
        $("#invname").val(data.invname);
        $("#defwhname").val(data.defwhname);
        $("#sourcebillno").val(data.sourcebillno);
        $("#billno").val(data.billno);
    }
</script>
#end

