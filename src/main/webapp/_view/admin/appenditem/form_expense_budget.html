#set(pageId=RandomUtil.random(6))
<div class="jbolt_page_title">
    <div class="row">
        <div class="col-12 form-inline">
            <div class="col-4">
                <h3>基础信息</h3>
            </div>
        </div>
    </div>
</div>
<div class="jbolt_page_content">
<form onsubmit="return false;" id="appendItemForm1" action="#(action)" method="post">
#if(appendItem.iautoid??)
	<input type="hidden" name="appendItem.iautoid" value="#(appendItem.iautoid??)" />
#end
	<input type="hidden" name="appendItem.iservicetype" value="#(appendItem.iservicetype??1)"/>
	<input type="hidden" name="appendItem.ieffectivestatus" value="#(appendItem.ieffectivestatus??1)"/>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">U8部门</label>
		<div class="col">
			<select class="form-control"
           			id="cdepcodeSelect_#(pageId)"
                    data-rule="required"
                    name="appendItem.cdepcode"
                    data-select-type="select2"
                    data-autoload
                    data-tips="请选择u8部门"
                    data-url="admin/department/treeDatasForProposalSystem?isProposal=true"
                    data-text="=请选择u8部门="
                    data-text-attr="cdepname"
                    data-value-attr="cdepcode"
                    data-setvalueto="cdepcode"
                    data-value=""
                    data-handler="findDeptNewestExpenseDatas"
                    data-width="200"
                    data-select="#(appendItem.cdepcode??)"
                    #if(appendItem.ieffectivestatus??==2)
                    disabled
                    #end
                    >
            </select>
            #if(appendItem.iautoid??)
            	<input type="hidden" name="appendItem.cdepcode" value="#(appendItem.cdepcode??)"/>
           	#end
		</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">预算类型</label>
		<div class="col">
	        <select class="form-control"
	                data-autoload
	                id="ibudgettypeshow_#(pageId)"
	                data-rule="required"
	                data-tips="预算类型"
	                data-url="admin/dictionary/options?key=expense_budget_type"
	                data-text="=预算类型="
	                data-text-attr="name"
	                data-value-attr="sn"
	                data-value=""
	                data-select="#(appendItem.ibudgettype??)"
	                data-width="200"
	                disabled
	                >
	        </select>
	        <input type="hidden" id="ibudgettypepara_#(pageId)" name="appendItem.ibudgettype" value="#(appendItem.ibudgettype??)"/>		
		</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">预算年份</label>
		<div class="col">
			<input id="ibudgetyearshow_#(pageId)" type="text" data-date data-type="year" data-with-clearbtn="true" data-fmt="yyyy"  autocomplete="off" class="form-control"  data-rule="required" placeholder="请设置预算年份" data-tips="请设置预算年份" maxlength="10" value="#(appendItem.ibudgetyear??)" disabled/>
		</div>
		<input id="ibudgetyearpara_#(pageId)" type="hidden" name="appendItem.ibudgetyear" value="#(appendItem.ibudgetyear??)"/>
	</div>
	#if(appendItem.iautoid??)
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">预算编号</label>
		<div class="col">
			<input type="text" data-with-clearbtn="true" autocomplete="off"  class="form-control"  placeholder="请输入预算编号" maxlength="30" name="appendItem.ccode" value="#(appendItem.ccode??)" disabled/>
		</div>
	</div>
	#end
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">项目细项名称</label>
		<div class="col">
			<input type="text" 
			#if(appendItem.ieffectivestatus??==2)
            disabled
            #end
			data-with-clearbtn="true" autocomplete="off"  class="form-control"  placeholder="请输入项目细项名称" maxlength="100" name="appendItem.citemname" value="#(appendItem.citemname??)"/>
		</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">事业类型</label>
		<div class="col">
			<select class="form-control"
	          		data-select-type="select2"
	                data-autoload
	                data-tips="事业类型"
	                data-url="admin/dictionary/options?key=career_type"
	                data-text="=事业类型="
	                data-text-attr="name"
	                data-value-attr="sn"
	                data-value=""
					#if(appendItem.ieffectivestatus??==2)
		            disabled
		            #end	                
	                data-select="#(appendItem.icareertype??)"
	                name="appendItem.icareertype"
	                data-width="200"
	                >
	        </select>
		</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">明细科目</label>
		<div class="col">
			<input type="text" autocomplete="off" class="form-control" 
				data-autocomplete 
				data-rule="required"
				data-url="/admin/subjectm/autocomplete"  
				data-hiddeninput="chighestsubjectname_#(pageId),ihighestsubjectid_#(pageId),ilowestsubjectid_#(pageId)" 
				data-text-attr="clowestsubjectname"
				#if(appendItem.ieffectivestatus??==2)
	            disabled
	            #end				
				data-header="科目大类编码,科目大类名称,明细科目编码,明细科目名称"
				data-column-attr="chighestsubjectcode,chighestsubjectname,clowestsubjectcode,clowestsubjectname" 
				placeholder="请请选择明细科目"  data-tips="请选择明细科目"  maxlength="40" 
				value="#(appendItem.clowestsubjectname??)">
		</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">科目大类</label>
		<div class="col">
			<input type="text" class="form-control" id="chighestsubjectname_#(pageId)" data-value-attr="chighestsubjectname" value="#(appendItem.chighestsubjectname??)" autocomplete="off"  disabled/>
		    <input type="hidden" id="ihighestsubjectid_#(pageId)" data-value-attr="ihighestsubjectid" name="appendItem.ihighestsubjectid" autocomplete="off" value="#(appendItem.ihighestsubjectid??)"/>
		    <input type="hidden" id="ilowestsubjectid_#(pageId)" data-value-attr="iautoid" name="appendItem.ilowestsubjectid" autocomplete="off" value="#(appendItem.ilowestsubjectid??)"/>
		</div>
	</div>
    <div class="form-group row"
    	data-radio
    	data-rule="radio"
    	data-value="#(appendItem.islargeamountexpense??)"
    	data-name="appendItem.islargeamountexpense"
    	data-default="options_first"
		#if(appendItem.ieffectivestatus??==2)
        data-disabled
        #end    	
    	data-width="col-sm-2,col"
		>
			<label class="col-sm-2 col-form-label" >是否大额费用</label>
			<div class="col"  style="padding-top: 1px;">
				<div class="radio radio-primary  radio-inline">
					<input  id="r_islargeamountexpense_true" type="radio" name="appendItem.islargeamountexpense" value="1"/>
					<label for="r_islargeamountexpense_true">是</label>
				</div>

				<div class="radio radio-primary  radio-inline">
					<input  id="r_islargeamountexpense_false" type="radio" name="appendItem.islargeamountexpense" value="0"/>
					<label for="r_islargeamountexpense_false">否</label>
				</div>
			</div>
	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">计划类型</label>
		<div class="col">
			<select class="form-control"
	          		data-select-type="select2"
	                data-autoload
					#if(appendItem.ieffectivestatus??==2)
			        disabled
			        #end  	                
	                data-rule="required"
	                data-tips="计划类型"
	                data-url="admin/dictionary/options?key=append_item_isscheduled"
	                data-text="=计划类型="
	                data-text-attr="name"
	                data-handler="isscheduledChange"
	                data-value-attr="sn"
	                data-value=""
	                data-select="#(appendItem.isscheduled??)"
	                name="appendItem.isscheduled"
	                data-width="200"
	                >
	        </select>
		</div>
	</div>		
	<div class="form-group row" id="iBudgetMoneyDiv">
		<label class="col-sm-2 col-form-label">预算总金额(不含税:千元)</label>
		<div class="col">
			<input id="iBudgetMoney" 
					#if(appendItem.ieffectivestatus??==2)
			        disabled
			        #end 			
			type="text" data-with-clearbtn="true" autocomplete="off" data-rule="pznumber;;fix<=2;" class="form-control"  placeholder="请输入预算总金额" maxlength="100" name="appendItem.iBudgetMoney" value="#(appendItem.iBudgetMoney??)"/>
		</div>
	</div>	
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">用途</label>
		<div class="col">
			<input type="text" 
					#if(appendItem.ieffectivestatus??==2)
			        disabled
			        #end 			
			data-with-clearbtn="true" autocomplete="off"  class="form-control"  placeholder="请输入用途" maxlength="200" name="appendItem.cuse" value="#(appendItem.cuse??)"/>
		</div>
	</div>
	
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">备注</label>
		<div class="col">
			<input type="text"
					#if(appendItem.ieffectivestatus??==2)
			        disabled
			        #end 			
			 data-with-clearbtn="true" autocomplete="off"  class="form-control"  placeholder="请输入备注" maxlength="200" name="appendItem.cmemo" value="#(appendItem.cmemo??)"/>
		</div>
	</div>
</form>
</div>
#define js()
<script>
#if(appendItem.ieffectivestatus??==2)
    hideParentLayerDialogBtn(0);
#end 	
	function findDeptNewestExpenseDatas(select){
		if(select.val()){
			Ajax.post("admin/expensebudget/findNewestExpenseBudgetByDeptCode",{cdepcode:select.val()},function(res){
				if(!res.data) {
					LayerMsgBox.error("所选部门没有最新生效的费用预算,不能追加项目,请检查!");
					$("#ibudgettypeshow_#(pageId)").val('');
					$("#ibudgettypepara_#(pageId)").val('');
					$("#ibudgetyearshow_#(pageId)").val('');
					$("#ibudgetyearpara_#(pageId)").val('');
				}else{
					$("#ibudgettypeshow_#(pageId)").val(res.data.ibudgettype);
					$("#ibudgettypepara_#(pageId)").val(res.data.ibudgettype);
					$("#ibudgetyearshow_#(pageId)").val(res.data.ibudgetyear);
					$("#ibudgetyearpara_#(pageId)").val(res.data.ibudgetyear);
				}
			});
		}
	}
	function isscheduledChange(ele){
		if(ele.val() == '2'){
			$('#iBudgetMoneyDiv').css('display','flex');
		}else{
			$("#iBudgetMoney").val(0);
			$('#iBudgetMoneyDiv').css('display','none');
		}
	}
</script>
#include("/_view/_admin/common/_formjs.html",formId="appendItemForm1")
#end
