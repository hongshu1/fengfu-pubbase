#set(pageId=RandomUtil.random(6))
<div class="jbolt_page_title">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="col">
                        <button onclick="save()" class="btn btn-success btn-sm"><i class=" fa fa-refresh"></i> 保存</button>
                        <button onclick="submitThisForm()" class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i> 提交</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form onsubmit="return false;" id="sysPureceive_#(pageId)" action="#(action)" method="post">
                        #if(sysPureceive.AutoID??)
                        <input type="hidden" name="sysPureceive.AutoID" value="#(sysPureceive.AutoID??)" />
                        #end
                        <input type="hidden" name="sysPureceive.Type" value="PUReceiveSpecial"/>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">收料单号</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输入收料单号"
                                            data-with-clearbtn="true" autocomplete="off" class="form-control"
                                            placeholder="请输入收料单号" maxlength="40" name="sysPureceive.BillNo"
                                            value="#(sysPureceive.BillNo??)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">收料日期</label>
                                    <div class="col-9">
                                        <input type="text" data-date class="form-control ml-2" placeholder="收料日期"
                                            maxlength="20" name="sysPureceive.createdate"
                                            value="#(sysPureceive.createdate??)" />
                                    </div>
                                </div>
                            </div>

                            <!--

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="Whcode" value="#(Whcode??)"
                                    id="whcode" data-value-attr="whcode" />
                                    <label class="col-sm-3 col-form-label">仓库名称</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete
                                            data-url="admin/SysEnumeration/wareHouse" data-rule="required"
                                            data-hidden-input="whcode" data-text-attr="whname"
                                            data-column-attr="whcode,whname" placeholder="请选择仓库名称"
                                            data-tips="请选择仓库名称" data-header="仓库编码,仓库名称" maxlength="40"
                                            value="#(whname??)">
                                    </div>
                                </div>
                            </div> -->



                            <div class="col-md-4">
                                <div class="form-group row">
                                    <input type="hidden" name="sysPureceive.VenCode" value="#(sysPureceive.VenCode??)"
                                        id="vencode" data-value-attr="vencode" />
                                    <label class="col-sm-3 col-form-label">供应商名称</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" data-autocomplete
                                            data-url="admin/scancodereceive/venCode" data-rule="required"
                                            data-hidden-input="vencode" data-text-attr="venname"
                                            data-column-attr="vencode,venname" placeholder="请选择供应商名称"
                                            data-tips="请选择供应商名称" data-header="供应商编码,供应商名称" maxlength="40"
                                            value="#(venname??)">
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">收料人</label>
                                    <div class="col-9">
                                        <input type="text" data-notnull="true" data-tips="请输收料人" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输收料人" maxlength="40" name="username" value="#(username??)" />
                                    </div>
                                </div>
                            </div>

                        </div>
                        <input id="operationType" type="hidden" name="operationType" value="#(operationType??)">
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="jbolt_page_content">
    <script type="text/template" id="sysPureceive_tpl_#(pageId)">
        {@each datas as data,index}
        <tr data-id="${data.autoid}">
            <td>${pageNumber,pageSize,index | rownum}</td>
            <td>
                <a href="admin/scancodereceivedetail/delete/${data.autoid}" data-ajaxbtn data-loading="执行中 " tooltip data-title="删除" data-handler="refreshJBoltTable" data-confirm="确定删除此数据？" class="jbolt_table_delbtn"><i class="fa fa-remove c-danger">删除</i></a>
            </td>
            <td>${data.combination}</td>
            <td>${data.barcodetype}</td>
            <td>${data.sourcebillno}</td>
            <td>${data.barcode}</td>
            <td>${data.cinvcode}</td>
            <td>${data.cinvcode1}</td>
            <td>${data.cinvname1}</td>
            <td>${data.plandate}</td>
            <td>${data.uom}</td>
            <td>${data.qtys}</td>
            <td>${data.qty}</td>
            <td>${data.whcode}</td>
            <td><img data-switchbtn data-value="${data.isinitial}" data-handler="switchEditableTd"/></td>
        </tr>
        {@/each}
    </script>

    <div class="jbolt_table_toolbar" id="sysPureceive_toolbar_#(pageId)">
        <div class="col-md-4">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">现品票扫码</label>
                <div class="col-6">
                    <input type="text" data-notnull="true" data-tips="请输入现品票扫码" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入现品票扫码" maxlength="40" name="sysPureceive.warehousingNo" value="#(sysPureceive.warehousingNo??)" />
                </div>
                <div class="btn-group text-center mx-1">
                    <button onclick="jboltTableAppendEmptyRow(this)" class="btn btn-primary btn-sm">搜索</button>
                </div>
            </div>
        </div>

        <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
            <button onclick="jboltTableAppendEmptyRow(this)" class="btn btn-primary btn-sm">添加行</button>
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
            <button data-ajaxbtn data-handler="refreshJBoltTable" data-check-handler="jboltTableGetCheckedIds" id="toolbar_deleteBtn_#(pageId)" data-url="admin/scancodereceivedetail/deleteByIds?ids=" data-confirm="确定删除选中数据？" class="btn btn-outline-danger"><i class="fa fa-trash"></i> 批量删除</button>
        </div>

    </div>

    <table class="jbolt_table thead_font_normal table-bordered table-center"
           id="jbolt_Table_#(pageId)"
           data-jbolttable
           data-ajax-success-handler="tableDataSuccess()"
           data-width="auto"
           data-height="fill"
           data-ajax="true"
           data-page="sysPureceive_tpl_#(pageId)"
           data-column-prepend="1:checkbox:true"
           data-toolbar="sysPureceive_toolbar_#(pageId)"
           data-url="admin/scancodereceivedetail/findEditTableDatas"
           data-conditions-form="sysPureceive_#(pageId)"
           data-rowtpl="sysPureceive_tpl_#(pageId)"
           data-column-resize="true"
           data-editable="true"
           data-editable-option="getJBoltTableEditableColsOpton_#(pageId)">
        <thead>
        <tr>
            <th data-width="60">序号</th>
            <th data-width="150">操作</th>
            <th data-width="100" data-column="combination">组号</th>
            <th data-width="100" data-column="barcodetype">类型</th>
            <th data-width="100" data-column="sourcebillno">订单编号</th>
            <th data-width="100" data-column="barcode">现品票</th>
            <th data-width="150" data-column="cinvcode">存货编码</th>
            <th data-width="150" data-column="cinvcode1">客户部番</th>
            <th data-width="150" data-column="cinvname1">部品名称</th>
            <th data-width="100" data-column="planDate">计划到货日期</th>
            <th data-width="100" data-column="uom">主计量单位</th>
            <th data-width="100" data-column="qtys">数量</th>
            <th data-width="100" data-column="qty">实收数量</th>
            <th data-width="100" data-column="whcode">入库库区</th>
            <th data-width="100" data-column="isinitial" data-editable="false">是否初物</th>
        </tr>
        </thead>
    </table>

</div>
#define js()
<script>
    hideParentLayerDialogBtn(0);
    hideParentLayerDialogBtn(1);

    function tableDataSuccess() {

    }

    function save() {
        jboltTableSubmit("#jbolt_Table_#(pageId)");
    }

    var $operationType = $("#operationType");

    function submitThisForm() {
        $operationType.val("submit");
        jboltTableSubmit("#jbolt_Table_#(pageId)");
        $operationType.val();
    }

    function getJBoltTableEditableColsOpton_#(pageId)() {
        var editableTableOptions = {
            trigger: "click",
            submit: {
                withForm: ["sysPureceive_#(pageId)"],
                name: 'sysPureceive',
                type: "all",
                url: "/admin/scancodereceive/submitAll",
                success: function (res) {
                    LayerMsgBox.success("提交成功", 600, function () {
                        parent.refreshPjaxContainer();
                        parent.layer.closeAll();
                    });
                }
            },
            cols: {
                AutoID: {
                    submitAttr: "AutoID",
                },
                qty: {
                    type: "amount",//类型
                    required: true,
                    placeholder: "数量", //输入提示，里面
                    tooltip: "数量",//输入提示，上方
                },
                whcode: {
                    placeholder: "仓库", //输入提示，里面
                    tooltip: "仓库",//输入提示，上方
                    type: "autocomplete",
                    //目前供应商都是空的无法过滤
                    url: "admin/SysEnumeration/wareHouse",
                    maxLength: 100,
                    required: true,
                    textAttr: "whcode",
                    width: 500,
                    valueAttr: "whcode",//选择赋值的字段
                    columnAttr: "whcode,whname",//下来看的时候显示哪些字段
                    header: '仓库编码,仓库名称',
                    changeColumns: [{ column: "whcode", use: "whcode" }]
                },
                combination:{
                    submitAttr:"Combination"
                },
                barcodetype:{
                    submitAttr:"BarcodeType"
                },
                barcode: { //条码
                    maxLength: 100,
                    required: true,
                    placeholder: "=请选择=",
                    type: "autocomplete",
                    url: "admin/otherout/barcodeDatas",
                    textAttr: "barcode",
                    width: 800,
                    sync: "",
                    valueAttr: "barcode",
                    columnAttr: "sourcebillno,barcode,cinvcode,cinvcode1,cinvname1,cinvstd,cuomclassname,cinvccode,cinvcname,sourcebilltype",
                    header: '订单编号,条码,存货编码,客户部番,部品名称,规格型号,库存主单位,项目大类编码,项目大类名称',
                    changeColumns: [
                        {column: "barcode", use: "barcode"},
                        {column: "cinvcode", use: "cinvcode"},
                        {column: "cinvcode1", use: "cinvcode1"},
                        {column: "cinvname1", use: "cinvname1"},
                        {column: "cinvstd", use: "cinvstd"},
                        {column: "cinvccode", use: "cinvccode"},
                        {column: "cinvcname", use: "cinvcname"},
                        {column: "cuomclassname", use: "cuomclassname"},
                        {column: "iinventoryid", use: "iautoid"},
                        {column: "sourcebilltype", use: "sourcebilltype"},
                        {column: "sourcebillno", use: "sourcebillno"},
                        {column: "sourcebilldid", use: "sourcebilldid"},
                        {column: "sourcebillnorow", use: "sourcebillnorow"},
                        {column: "sourcebillid", use: "sourcebillid"},
                        {column: "qtys", use: "qty"}
                    ],
                    handler:function(table,td,text,value,trJsonData){
                        var cinvcode = trJsonData.cinvcode;
                        console.log('cinvcode',cinvcode)
                        Ajax.post("admin/scancodereceive/getBarCodeData",{"itemCode":cinvcode},function (res) {
                            console.log('res',res)
                            jboltTableInsertRowAfterChecked(table,res.data,true,true,true);
                        })

                        console.log('table',table)
                        console.log('td',td)
                        console.log('text',text)
                        console.log('value',value)
                        console.log('trJsonData',trJsonData)
                    }
                },
            }
        };
        return editableTableOptions;
    }

    function closeHandler() {
        parent.layer.close(parent.layer.getFrameIndex(window.name));
        window.parent.refreshJBoltTable();
    }

</script>
#end
