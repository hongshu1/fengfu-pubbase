#set(pageId=RandomUtil.random(6))
#set(iYear=DateUtil.getYear())
<div class="jbolt_page_title">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="col">
                        <button onclick="" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i> 数据导入</button>
                        <button onclick="submitThisForm()" class="btn btn-success btn-sm" onclick="submitThisForm()"><i class="fa fa-refresh"></i> 保存</button>
                        <button onclick="" class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i> 提交审批</button>
                        <button onclick="closeHandler()" class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i> 关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form onsubmit="return false;" id="AnnualOrderD_Form_#(pageId)" action="#(action)" method="post">
                        #if(annualOrderM.iAutoId??)
                        <input type="hidden" name="annualOrderM.iAutoId" value="#(annualOrderM.iAutoId??)"/>
                        #end
                        <input type="hidden" name="annualOrderM.iOrderStatus" value="#(annualOrderM.iOrderStatus??1)"/>
                        <input type="hidden" name="annualOrderM.iAuditStatus" value="#(annualOrderM.iAuditStatus??0)"/>
                        <input type="hidden" name="annualOrderM.isDeleted" value="#(annualOrderM.isDeleted??0)"/>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">订单号</label>
                                    <div class="col-10">
                                        <input type="text" data-rule="required" data-notnull="true" data-tips="请输入订单号" data-with-clearbtn="true" autocomplete="off" class="form-control" placeholder="请输入订单号" maxlength="40" name="annualOrderM.cOrderNo" value="#(annualOrderM.cOrderNo??)"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group row">
                                	<input type="hidden" name="annualOrderM.iCustomerId" value="#(annualOrderM.iCustomerId??)" id="iCustomerId" data-value-attr="iautoid"/>
                                    <label class="col-sm-3 col-form-label">客户名称</label>
                                    <div class="col-9">
										<input type="text" class="form-control"
											   data-autocomplete
											   data-url="admin/customer/autocomplete"
											   data-rule="required"
											   data-hidden-input="iCustomerId"
											   data-text-attr="ccusname"
											   data-column-attr="ccuscode,ccusname,ccusabbname"
											   placeholder="请选择"
											   data-tips="请选择"
											   data-header="客户编码,客户名称,客户简称"
											   maxlength="40"
											   value="#(annualOrderM.ccusname??)"
											   >                                        
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                            </div>
                            <div class="col-md-4">
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">年份</label>
                                    <div class="col-10">
                                        <input data-done-handler="changeDoneYear"
                                               type="text"
                                               data-rule="required"
                                               data-date
                                               data-type="year"
                                               data-fmt="yyyy"
                                               autocomplete="off"
                                               class="form-control"
                                               maxlength="20"
                                               name="annualOrderM.iYear"
                                               value="#datetime(annualOrderM.iYear??DateUtil.getNow(),'yyyy')"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="jbolt_page_content">
    <script type="text/template" id="jboltTable_demotpl_#(pageId)">
        {@each datas as data,index}
        <tr data-id="${data.iautoid}">
            <td>${pageNumber,pageSize,index | rownum}</td>
            <td>${data.cinvcode}</td>
            <td>${data.cinvcode1}</td>
            <td>${data.cinvname1}</td>
            <td>${data.cinvstd}</td>
            <td>${data.cuomname}</td>
            <td>${data.inowyearmonthamount1}</td>
			<td>${data.inowyearmonthamount2}</td>
			<td>${data.inowyearmonthamount3}</td>
			<td>${data.inowyearmonthamount4}</td>
			<td>${data.inowyearmonthamount5}</td>
			<td>${data.inowyearmonthamount6}</td>
			<td>${data.inowyearmonthamount7}</td>
			<td>${data.inowyearmonthamount8}</td>
			<td>${data.inowyearmonthamount9}</td>
			<td>${data.inowyearmonthamount10}</td>
			<td>${data.inowyearmonthamount11}</td>
			<td>${data.inowyearmonthamount12}</td>
			<td>${data.inowyearmonthamounttotal}</td>
			<td>${data.inextyearmonthamount1}</td>
			<td>${data.inextyearmonthamount2}</td>
			<td>${data.inextyearmonthamount3}</td>
			<td>${data.inextyearmonthamounttotal}</td>
			<td>
    			<a href="admin/person/deleteByAjax" data-ajaxbtn data-loading="执行中 " tooltip data-title="移除行" data-handler="removeTr" data-confirm="确定删除此数据？" class="jbolt_table_delbtn">移除行</a>
			</td>
        </tr>
        {@/each}
    </script>
    <div class="jbolt_table_toolbar" id="AnnualOrderM_toolbar_#(pageId)">
        <div class="btn-group btn-group-sm" role="group" aria-label="btn-group">
            <button onclick="jboltTableAppendEmptyRow(this)" class="btn btn-primary btn-sm">添加行</button>
        </div>
    </div>
    <table class="jbolt_table thead_font_normal table-bordered table-center"
           data-jbolttable
           #if(annualOrderM.iAutoId??)
           data-ajax="true"
           data-url="admin/annualorderd/findEditTableDatas?iAnnualOrderMid=#(annualOrderM.iAutoId??)"
           #end
           id="jbolt_Table_#(pageId)"
           data-column-resize="true"
           data-tfoot-fixed="true"
           data-column-prepend="1:checkbox"
           data-rowtpl="jboltTable_demotpl_#(pageId)"
           data-toolbar="AnnualOrderM_toolbar_#(pageId)"
           data-editable="true"
           data-editable-option="getEditableTableOptions_#(pageId)"
    >
        <thead class="fw_normal">
        <tr>
            <th data-width="60" data-column="index" rowspan="2">序号</th>
            <th data-width="150" data-column="cinvcode" rowspan="2">存货编码</th>
            <th data-width="150" data-column="cinvcode1" rowspan="2">客户部番</th>
            <th data-width="150" data-column="cinvname1" rowspan="2">部品名称</th>
            <th data-width="150" data-column="cinvstd" rowspan="2">规格</th>
            <th data-width="100" data-column="cuomname" rowspan="2">库存主单位</th>
            <th colspan="13" id="nowYear">#(iYear)年</th>
            <th colspan="4" id="nextYear">#(iYear+1)年</th>
            <th data-width="100" rowspan="2">操作</th>
        </tr>
        <tr>
                <th data-column="inowyearmonthamount1">1月</th>
                <th data-column="inowyearmonthamount2">2月</th>
                <th data-column="inowyearmonthamount3">3月</th>
                <th data-column="inowyearmonthamount4">4月</th>
                <th data-column="inowyearmonthamount5">5月</th>
                <th data-column="inowyearmonthamount6">6月</th>
                <th data-column="inowyearmonthamount7">7月</th>
                <th data-column="inowyearmonthamount8">8月</th>
                <th data-column="inowyearmonthamount9">9月</th>
                <th data-column="inowyearmonthamount10">10月</th>
                <th data-column="inowyearmonthamount11">11月</th>
                <th data-column="inowyearmonthamount12">12月</th>
            	<th data-column="inowyearmonthamounttotal">合计</th>
           		<th data-column="inextyearmonthamount1">1月</th>
           		<th data-column="inextyearmonthamount2">2月</th>
           		<th data-column="inextyearmonthamount3">3月</th>
            	<th data-column="inextyearmonthamounttotal">合计</th>
        </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
        <tr>
            <th></th>
            <th>合计</th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        <tr>
        </tfoot>
    </table>
</div>
#define js()
<script>
hideParentLayerDialogBtn(0);
hideParentLayerDialogBtn(1);
function submitThisForm(){
	jboltTableSubmit("#jbolt_Table_#(pageId)");
}
    //获得配置参数
    function getEditableTableOptions_#(pageId)() {
        var editableTableOptions = {
            submit: {
                withForm: ["AnnualOrderD_Form_#(pageId)"],
                name: 'annualOrderDForm',
                type: "all",
                url: "/admin/annualorderm/submitAll",
                success: function (res) {
                    LayerMsgBox.success("提交成功", 600, function () {
                        parent.refreshPjaxContainer();
                        parent.layer.closeAll();
                    });
                }
            },
            cols: {
            	iautoid: {
                    submitAttr: "iautoid",
                },
                cinvcode: {
                    type: "autocomplete",
                    url: "admin/inventory/autocomplete",
                    maxLength: 100,
                    required: true,
                    placeholder: "请选择",
                    textAttr: "cinvcode",
                    width: 500,
                    valueAttr: "cinvcode",
                    columnAttr: "cinvcode,cinvcode1,cinvname1,cinvstd,cuomname",
                    header:'存货编码,客户部番,部品名称,规格,库存主单位',
                    changeColumns:[{column: "cinvcode", use: "cinvcode"},{column: "cinvcode1", use: "cinvcode1"},
                                   {column: "cinvname1", use: "cinvname1"},{column: "cinvstd", use: "cinvstd"},
                                   {column: "cuomname", use: "cuomname"},{column: "iinventoryid", use: "iautoid"}]
                },
                inowyearmonthamount1: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount2: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount3: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount4: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount5: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount6: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount7: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount8: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount9: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount10: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount11: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamount12: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inowyearmonthamounttotal: {
					summary:[{
						dir:"h",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"inowyearmonthamount1+inowyearmonthamount2+inowyearmonthamount3+inowyearmonthamount4+inowyearmonthamount5+inowyearmonthamount6+inowyearmonthamount7+inowyearmonthamount8+inowyearmonthamount9+inowyearmonthamount10+inowyearmonthamount11+inowyearmonthamount12"
					}],
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inextyearmonthamount1: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inextyearmonthamount2: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inextyearmonthamount3: {
					type:"amount",
					placeholder:'数量',
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				},
				inextyearmonthamounttotal: {
					summary:[{
						dir:"h",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"inextyearmonthamount1+inextyearmonthamount2+inextyearmonthamount3"
					}],
					summary:[{
						dir:"v",
						tofixed:2,
						roundtag:"round",
						removezero:true,
						formula:"sum"
					}]
				}
            }
        };
        return editableTableOptions;
    }

    function changeDoneYear(ele, value) {
        #set(iYear=value)
        $("#nowYear").html(ele.val()+"年");
        $("#nextYear").html(ele.val()+"年");
    }

    function closeHandler(){
    	parent.layer.close(parent.layer.getFrameIndex(window.name));
        window.parent.refreshJBoltTable();
    }
</script>
#end

