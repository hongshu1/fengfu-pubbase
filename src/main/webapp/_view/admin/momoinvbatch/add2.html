#@jboltLayout()
#define main()
#set(pageId=RandomUtil.random(6))
#set(printworkorderspotticketsinadvance=JBoltGlobalConfigCache.getBooleanConfigValue("print_work_order_spot_tickets_in_advance"))
<div class="jbolt_page">
    <div class="jbolt_page_content">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <form onsubmit="return false;" id="processDefectForm" action="" method="post">
                            <button onclick="closeHandler()" class="btn btn-danger btn-sm"><i
                                    class="fa fa-window-maximize"></i> 关闭
                            </button>
                            <input type="hidden" name="iautoid" value="#(imodocid??)"/>
                            <hr/>
                            <h5><b>工单信息</b></h5>
                            <div class="form-group row">
                            <label class="col-sm-2 col-form-label">工单号:</label>
                            <div class="col-sm-2">
                                #(moDoc.cmodocno??)
                            </div>
                            <label class="col-sm-2 col-form-label">计划日期:</label>
                            <div class="col-sm-2">
                                #date(moDoc.dplandate??,'yyyy-MM-dd')
                            </div>
                            <label class="col-sm-2 col-form-label">生产部门:</label>
                            <div class="col-sm-2">
                                #(moDoc.cdepname)
                            </div>
                        </div>
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">存货编码:</label>
                                <div class="col-sm-2 col-form-label">
                                    #(moDoc.cinvcode??)
                                </div>
                                <label class="col-sm-2 col-form-label">客户部番:</label>
                                <div class="col-sm-2 col-form-label">
                                    #(moDoc.cnvcode1??)
                                </div>
                                <label class="col-sm-2 col-form-label">部品名称:</label>
                                <div class="col-sm-2 col-form-label">
                                    #(moDoc.cinvname1??)
                                </div>


                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">产线名称:</label>
                                <div class="col-sm-2 col-form-label">
                                    #(moDoc.cworkname??)
                                </div>
                                <label class="col-sm-2 col-form-label">班次名称:</label>
                                <div class="col-sm-2 col-form-label">
                                    #(moDoc.cworkshiftname??)
                                </div>
                                <label class="col-sm-2 col-form-label">计划数量:</label>
                                <div class="col-sm-2 col-form-label">
                                    #(moDoc.iqty??)
                                </div>

                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">完工数量:</label>
                                <div class="col-sm-2 col-form-label">
                                    <input disabled="disabled" name="moDoc.iCompQty" value="#(moDoc.icompqty??0)">
                                </div>
                                <label class="col-sm-2 col-form-label">差异数量:</label>
                                <div class="col-sm-2 col-form-label">
                                    <input disabled="disabled" id="remainder" value="#(moDoc.iqty-moDoc.icompqty??0)">
                                </div>
                                <label class="col-sm-2 col-form-label">包装数量:</label>
                                <div class="col-sm-2 col-form-label">
                                    <input disabled="disabled" name="ipkgqty" value="#(moDoc.ipkgqty??moDoc.iqty)">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-2 col-form-label">作业人员:</label>
                                <input type="text" autocomplete="off" class="form-control"
                                       data-autocomplete
                                       name="moMoinvbatch.jobname"
                                       readonly="readonly"
                                       data-url="admin/person/autocomplete"
                                       data-link-para-ele="#capplypersoncode"
                                       data-sync-ele="capplypersoncode"
                                       data-text-attr="cpsnname"
                                       data-value-attr="cpsnnum"
                                       placeholder="=作业人员="
                                       value="#(moMoinvbatch.jobname??)"
                                       data-column-attr="cpsnnum,cpsnname">
                                <label class="col-sm-2 col-form-label">产线组长:</label>
                                <div class="col-sm-2 col-form-label">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="jbolt_page_content">
    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header"><b>未打印现品票</b></div>
                <div class="card-body">
                    #include("table1.html")
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header"><b>已打印现品票</b></div>
                <div class="card-body">
                    #include("table2.html")
                </div>
            </div>
        </div>
    </div>
    </div>
</div>
#define js()
<script>
    function submitForm(){
        LayerMsgBox.confirm("确认保存此数据?",function(){
            submitThisForms("admin/processdefect/saveprocessDefect");

        });
    }
   function submitForms(){
       LayerMsgBox.confirm("确认提交此数据?",function(){
           submitThisForms("admin/processdefect/subprocessDefect");

       });
   }
    function submitThisFormsd(){
        var postDatas=formToJson("#processDefectForm");
        LayerMsgBox.loading("更新中...",5000);
        var data = {};
        data.attr = JSON.stringify(postDatas);
        var formdata=
            Ajax.post("admin/processdefect/saveprocessDefect",$('#processDefectForm').serialize(),function(res){
                LayerMsgBox.success("操作成功",500,function(){
                    parent.refreshJBoltTable();
                });
            });

    }
    function  submitThisForms(url){
        $.ajax({
            url: url,
            type: "post",
            dataType: "json",
            //contentType: "application/json; charset=utf-8",
            data:$('#processDefectForm').serialize(),//传送的数据
            success: function (res) {//执行成功
                if(data.state=="ok"){

                        LayerMsgBox.success("保存成功",300,function(){
                            parent.refreshJBoltTable();
                        })

                }else{
                    LayerMsgBox.alert(data.msg,2);


                }
            },
            error: function () {//执行失败
                LayerMsgBox.alert("网络通讯异常",2);

            },
            complete: function (data) { //不管成功还是失败后

            }
        });
    }
   function closeHandler(){
       parent.layer.close(parent.layer.getFrameIndex(window.name));
       window.parent.refreshJBoltTable();
   }

   function modifyTable1() {
       // 刷新页面
       refreshJBoltTable($("#table1_#(pageId)"));
       $("#create_moinvbatch_#(pageId)").hide();
       #if(printworkorderspotticketsinadvance)
       $("#toolbar_deleteBtn_#(pageId)").removeAttr("disabled");
       #end
       return true;
   }

   function checkDatas() {
       var datas = getJboltTableAllDatas("table1_#(pageId)");
       // 已生成现品票数据默认隐藏生成现品票按钮
       if (datas) {
           $("#create_moinvbatch_#(pageId)").hide();
           #if(printworkorderspotticketsinadvance)
           $("#toolbar_deleteBtn_#(pageId)").removeAttr("disabled");
           #end
       }
   }

    /**
     * 打印刷新已打印现品票数据
     */
   function refreshTable2() {
       // 更新
       refreshJBoltTable("table2_##(pageId)");

       // 调用打印
   }
</script>
#include("/_view/_admin/common/_formjs.html",formId="processDefectForm")
#end
#end

