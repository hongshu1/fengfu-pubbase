#set(pageId=RandomUtil.random(6))
<div class="jbolt_page">
	<div class="jbolt_page_content">
<form onsubmit="return false;" id="otherOutForm_#(pageId)"  action="#(action)" method="post">

	<div class="jbolt_table_toolbar" id="bomcompare_split_toolbar_#(pageId)">
		<div class="col-md-l pt-2" role="group" aria-label="btn-group">
			<button onclick="submitAllTables_#(pageId)(this)" #if(type =="0") style="display: none" #end data-id="1" data-value="save" class="btn btn-success btn-sm"><i class="fa fa-refresh"></i> 保存</button>
<!--			<button onclick="submitAllTables_#(pageId)(this)" #if(type =="0") style="display: none" #end data-id="2" data-value="submit" type="submit" class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i> 提交审批</button>-->


			#if(readonly != 'readonly')
			<button onclick="submitThisForm_#(pageId)()" class="btn btn-outline-secondary btn-xs">保存</button>
			#end

			### 参数列表
			### uri:                    接口URI
			### formSn:                 表单名
			### o:                      当前表单对象名
			### primaryKeyName:         主键名
			### permissionKeyPrefix:    权限key
			### redonly:                查看页定义为readonly=readonly, 新增/编辑页 可不传
			### className:              实现审批业务的类名




			#if(otherOut.autoid??)
			#include("/_view/_common/_approval_btns.html", uri="/admin/otherout", formSn="T_Sys_OtherOut", o=otherOut, primaryKeyName="autoid",className="cn.rjtech.admin.otherout.OtherOutService", permissionKeyPrefix="monthorderm")
			#end
			<button onclick="closeHandler()" class="btn btn-info btn-sm"><i class="fa fa-window-maximize"></i> 关闭</button>
		</div>
	</div>
	#if(otherOut.autoid??)
	<input type="hidden" id="otherOutautoid" name="otherOut.autoid" value="#(otherOut.autoid??)" />
	#end
	<input type="hidden" name="otherOut.sourcebilltype" value="#(otherOut.sourcebilltype??)" />
	<input type="hidden" name="otherOut.type" value="#(otherOut.type??)" />
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">领料单号：</label>
		<div class="col-sm-2 col-form-label">
			<input type="text" class="form-control border-none"  readonly="readonly"  placeholder=""  name="otherOut.billno" value="#(otherOut.billno??)"/>
		</div>
		<label class="col-sm-2 col-form-label">需求日期</label>
		<div class="col-sm-2 col-form-label">
			<input type="text"  data-date  id="purchaseDate"  class="form-control"
				   placeholder="请输入需求日期" maxlength="30" name="otherOut.billdate"
				   value="#datetime(otherOut.billdate??,'yyyy-MM-dd')">
		</div>

	</div>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">生产部门：</label>
		<div class="col-sm-2 col-form-label">
			<select class="form-control"
					data-autoload
					name="otherOut.deptcode"
					data-tips="请选择部门"
					data-rule="required"
					data-url="admin/department/getTreeTableDatas"
					data-text="=请选择部门="
					data-value=""
					data-value-attr="iautoid"
					data-text-attr="cdepname"
					data-select="#(otherOut.deptcode??)">
			</select>
		</div>
		<input type="hidden" id="cbadnesssns" name="otherOut.memo" value="#(otherOut.memo??)"/>
		<label class="col-sm-2 col-form-label">处置意见：</label>
		<div class="col-sm-5 col-form-label">
			<div class="form-group row"
				 data-hidden-input="cbadnesssns"
				 data-checkbox
				 data-rule="checkbox"
				 data-default=""
				 data-url="admin/dictionary/options?key=opinion"
				 data-value-attr="name"
				 data-text-attr="cbadnesssns"
				 data-inline="true"
				 data-value="#(otherOut.memo??)"
				 data-name="cbadnesssns">
			</div>
		</div>
	</div>


	<div class="form-group row">
		<label class="col-sm-2 col-form-label">要求原因分析：</label>
			<div class="col-sm-2 col-form-label"  style="margin-right: 100px">
				<textarea  style="width: 210px; height: 100px; resize: none" placeholder="=请输入要求原因分析=" type="text" maxlength="300" class="form-control border-none" name="otherOut.reason" placeholder="" value="#(otherOut.reason??)">#(otherOut.reason??)</textarea>
			</div>
	</div>
</form>
	<div class="form-group row">
		<div class="col-11" style="left: 17px;">
			<div class="jbolt_page_content">
				#render("_table_split.html")
			</div>
		</div>
	</div>


	<div class="form-group row">
		<label class="col-sm-2 col-form-label">制单人：</label>
		<div class="col-sm-2 col-form-label">
			<input type="text" class="form-control border-none" readonly="readonly" autocomplete="off"   placeholder="" value="#(otherOut.ccreatename??)"/>
		</div>
		<label class="col-sm-2 col-form-label">制单时间：</label>
		<div class="col-sm-2 col-form-label">
			<input type="text" class="form-control border-none" readonly="readonly" autocomplete="off"   placeholder="" value="#date((otherOut.dcreatetime??),'yyyy-MM-dd HH:mm:ss')"/>
		</div>
	</div>
	</div>
</div>
#define js()
<script>
	hideParentLayerDialogBtn();

	var submit = false;

	function submitThisForm_#(pageId)(s) {
		debugger;
		// 保存并提交
		if (s) {
			submit = s;

		}
		// 调用保存处理
		jboltTableSubmit(ele);
	}

	/**
	 * 新增/修改/提审
	 */
	function successHandler(msg, id) {
		debugger;
		LayerMsgBox.success(msg, 600, function () {
			// 新增/修改，均跳转到详情页
			self.location.href = "/admin/otherout/edit/"+id+"-_jb_rqtype_dialog"; //新增的刷新
			// location.href = '/admin/otherout/edit/' + iautoid + '-_jb_rqtype_dialog';
			parent.refreshPjaxContainer();
		});
	}


	function submitAllTables_#(pageId)(ele){
		// var action = getRealJqueryObject(ele);
		//
		// var id = action.data("id");
		// var value = action.data("value");
		var tables = ["jbolt_table_inventory_split_#(pageId)"];
			jboltTableSubmitMulti(tables, "admin/otherout/submitMulti?param=" , function (res) {
				debugger;
				let id = res.AutoID;
				if (res.state == "ok") {
					LayerMsgBox.success(res.msg, 600, function () {
						if (submit) {
							// 提审

							submit_#(pageId)(id, function (data) {
								console.log(3);
								successHandler('提审成功', id);
								// parent.refreshPjaxContainer();
								// // parent.refreshCurrentTabContent();//刷新当前页面
								// self.location.href = "/admin/otherout/edit/"+id+"-_jb_rqtype_dialog?&edit=true"; //新增的刷新
								// // parent.layer.close(parent.layer.getFrameIndex(window.name)); //关闭弹窗
							});
						} else {
							console.log(4);
							successHandler(res.msg, id);
						}
					})
				} else {
					LayerMsgBox.error(res.msg);
				}
			});
	}



	function closeHandler(){
		parent.layer.close(parent.layer.getFrameIndex(window.name));
		window.parent.refreshJBoltTable();
	}
</script>
#end

