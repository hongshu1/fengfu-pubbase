package cn.jbolt.common.model;

import cn.hutool.extra.emoji.EmojiUtil;
import cn.jbolt._admin.cache.JBoltWechatUserCache;
import cn.jbolt.common.model.base.BaseWechatUser;
import cn.jbolt.core.annotation.TableBind;
import cn.jbolt.core.base.JBoltIDGenMode;
import cn.jbolt.core.util.JBoltRandomUtil;
import cn.jbolt.core.util.JBoltStringUtil;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
@TableBind(dataSource = "main" , table = "jb_wechat_user" , primaryKey = "id" , idGenMode = JBoltIDGenMode.SNOWFLAKE)
public class WechatUser extends BaseWechatUser<WechatUser> {
    public static final String DEFAULT_NICK_NAME = "微信用户";
    @Override
    public WechatUser setHeadImgUrl(String headImgUrl) {
        if(headImgUrl == null || headImgUrl.trim().length() == 0){
            return super.setHeadImgUrl(JBoltWechatUserCache.me.getDefaultAvatar());
        }
        return super.setHeadImgUrl(headImgUrl);
    }

    @Override
    public WechatUser setNickname(String nickname) {
        if(nickname == null || nickname.trim().length() == 0 || DEFAULT_NICK_NAME.equals(nickname)){
            return super.setNickname("用户_"+ JBoltRandomUtil.randomLowWithNumber(6));
        }
//        if(EmojiUtil.containsEmoji(nickname)) {
//            nickname=EmojiUtil.toHtml(nickname);
//        }else {
//            nickname= JBoltStringUtil.filterEmoji(nickname);
//        }
        return super.setNickname(nickname);
    }
}
